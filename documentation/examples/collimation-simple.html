<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Collimation &mdash; BDSIM 1.7.7.develop documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../_static/graphviz.css?v=fd3f3429" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=106dc6df"></script>
        <script src="../_static/doctools.js?v=9a2dae69"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Simple Machine" href="simpleMachine.html" />
    <link rel="prev" title="Beam Dump" href="beamDump.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            BDSIM
              <img src="../_static/bdsim-logo-small.jpg" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                1.7.7.develop
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">User Guide</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../licence.html">Licence &amp; Disclaimer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../authorship.html">Authorship</a></li>
<li class="toctree-l1"><a class="reference internal" href="../introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../running.html">Running BDSIM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../input_syntax.html">Input Syntax</a></li>
<li class="toctree-l1"><a class="reference internal" href="../model_construction.html">Model Construction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../model_control.html">Model Control</a></li>
<li class="toctree-l1"><a class="reference internal" href="../model_customisation.html">Model Customisation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../model_conversion.html">Model Conversion</a></li>
<li class="toctree-l1"><a class="reference internal" href="../externalgeometry.html">External Geometry Formats</a></li>
<li class="toctree-l1"><a class="reference internal" href="../output.html">Output</a></li>
<li class="toctree-l1"><a class="reference internal" href="../output_analysis.html">Output Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../python_utilities.html">Python Utilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="../visualisation.html">Visualisation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../interfacing.html">Interfacing</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../examples.html">Examples &amp; Tests</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../examples.html#basic-examples">Basic Examples</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="airwatertarget.html">Air Water Target</a></li>
<li class="toctree-l3"><a class="reference internal" href="beamLoss.html">Beam Loss</a></li>
<li class="toctree-l3"><a class="reference internal" href="beamDump.html">Beam Dump</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Collimation</a></li>
<li class="toctree-l3"><a class="reference internal" href="simpleMachine.html">Simple Machine</a></li>
<li class="toctree-l3"><a class="reference internal" href="model-model.html">Model-Model</a></li>
<li class="toctree-l3"><a class="reference internal" href="target-simple.html">Target</a></li>
<li class="toctree-l3"><a class="reference internal" href="../basic_example_python_histograms.html">Histograms in Python</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../examples.html#worked-examples">Worked Examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples.html#specific-machines">Specific Machines</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples.html#features">Features</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../support.html">Support</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../history.html">Version History</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer.html">Developer Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../model_description.html">Model Description</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">BDSIM</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../examples.html">Examples &amp; Tests</a></li>
      <li class="breadcrumb-item active">Collimation</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/examples/collimation-simple.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="collimation">
<span id="example-collimation-simple"></span><h1>Collimation<a class="headerlink" href="#collimation" title="Link to this heading"></a></h1>
<ul class="simple">
<li><p>Based on <code class="code docutils literal notranslate"><span class="pre">bdsim/examples/collimation/collimation.gmad</span></code></p></li>
</ul>
<p>This is an example to show how energy deposition and particle spectra
from a small collimation system. There is a more detailed version of
this example described in <a class="reference internal" href="../worked_example_collimation/worked_example_collimation.html#example-collimation-advanced"><span class="std std-ref">Collimation</span></a> with detailed
collimation-specific information.</p>
<p>The model consists of two collimators, followed by a triplet set of
quadrupoles, a shielding wall and a third collimator. The collimators
are made of successively denser material (carbon, copper and tungsten).</p>
<p>The first step is to prepare some data to analyse. 1000 events runs in
around 20s on the developer’s computer. The files can be found in
<code class="code docutils literal notranslate"><span class="pre">bdsim/examples/collimation</span></code>. It can be run with the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">bdsim</span> <span class="o">--</span><span class="n">file</span><span class="o">=</span><span class="n">collimation</span><span class="o">.</span><span class="n">gmad</span> <span class="o">--</span><span class="n">outfile</span><span class="o">=</span><span class="n">data1</span> <span class="o">--</span><span class="n">batch</span> <span class="o">--</span><span class="n">ngenerate</span><span class="o">=</span><span class="mi">1000</span>
</pre></div>
</div>
<p>This will create an output file called <cite>data1.root</cite>.  We can run BDSIM with
the visualisation to get an idea of what happens in the model. This time, we run
without any data output.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">bdsim</span> <span class="o">--</span><span class="n">file</span><span class="o">=</span><span class="n">collimation</span><span class="o">.</span><span class="n">gmad</span> <span class="o">--</span><span class="n">output</span><span class="o">=</span><span class="n">none</span>
</pre></div>
</div>
<p>The following window (with Geant4 setup with the Qt visualiser) should appear.</p>
<figure class="align-center">
<a class="reference internal image-reference" href="../_images/collimation.png"><img alt="../_images/collimation.png" src="../_images/collimation.png" style="width: 90%;" /></a>
</figure>
<p>If we type the following command in the terminal prompt at the bottom of this
window, we can visualise 10 events.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">run</span><span class="o">/</span><span class="n">beamOn</span> <span class="mi">10</span>
</pre></div>
</div>
<p>This looks like:</p>
<figure class="align-center">
<a class="reference internal image-reference" href="../_images/collimation-10events.png"><img alt="../_images/collimation-10events.png" src="../_images/collimation-10events.png" style="width: 90%;" /></a>
</figure>
<p>The particles are colour coded by charge by default (positive: blue, negative: red, and
neutral: green).</p>
<p>The following view was created by adding a ‘cut away plane’ that makes part of
geometry on one side of a plane invisible. Also, the project was set from orthographic
to perspective based using the button on the toolbar (see <a class="reference internal" href="../visualisation.html#visualisation-control-buttons"><span class="std std-ref">Control Buttons</span></a>).
The command for the cut away plane is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">vis</span><span class="o">/</span><span class="n">viewer</span><span class="o">/</span><span class="n">addCutawayPlane</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="n">m</span> <span class="mi">1</span> <span class="mi">0</span> <span class="mi">0</span>
</pre></div>
</div>
<figure class="align-center">
<a class="reference internal image-reference" href="../_images/collimation-cutaway-perspective.png"><img alt="../_images/collimation-cutaway-perspective.png" src="../_images/collimation-cutaway-perspective.png" style="width: 90%;" /></a>
</figure>
<p>We can take a look at the data with ROOT with the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">root</span> <span class="o">-</span><span class="n">l</span> <span class="n">data1</span><span class="o">.</span><span class="n">root</span>
</pre></div>
</div>
<p>The “-l” flag means no logo (slightly quicker), and specifying a file along with the command
means this file will come at the top of any browser windows in ROOT.</p>
<p>We start a TBrowser to inspect the data. The intention here is to inspect the data
and decide which histograms we might want to prepare from it.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">root</span><span class="o">&gt;</span> <span class="n">TBrowser</span> <span class="n">tb</span><span class="p">;</span>
</pre></div>
</div>
<p>ROOT takes commands in C++, so here we construct an ‘instance’ of the TBrowser class
called “tb” (can be any name). The TBrowser brings up a window that allows graphical
exploration of the data. This looks like:</p>
<figure class="align-center">
<a class="reference internal image-reference" href="../_images/collimation-root-browser.png"><img alt="../_images/collimation-root-browser.png" src="../_images/collimation-root-browser.png" style="width: 90%;" /></a>
</figure>
<p>The most interesting information is the in the Event tree. Double-click on this to expand
it and look at the variables. A full explanation of the output here is described in
<a class="reference internal" href="../output.html#output-event-tree"><span class="std std-ref">Event Tree</span></a>. This browser is most useful to get the exact names to prepare
the analysis configuration text file that’s used for analysis.</p>
<p>To produce histograms, we prepare an input text file that describes which histograms
we want to prepare. This file is described in detail in
<a class="reference internal" href="../output_analysis.html#analysis-preparing-analysis-config"><span class="std std-ref">Preparing an Analysis Configuration File</span></a>.
Typically we start by copying an example from
<code class="code docutils literal notranslate"><span class="pre">bdsim/examples/features/analysis/perEntryHistograms/analysisConfig.txt</span></code>.</p>
<p>Below is an example analysis configuration called <code class="code docutils literal notranslate"><span class="pre">analysisConfigSimple.txt</span></code> that is
included in the same example directory.</p>
<figure class="align-center">
<a class="reference internal image-reference" href="../_images/collimation-analysis-simple.png"><img alt="../_images/collimation-analysis-simple.png" src="../_images/collimation-analysis-simple.png" style="width: 100%;" /></a>
</figure>
<p>The data can be analysed with the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rebdsim</span> <span class="n">analysisConfigSimple</span><span class="o">.</span><span class="n">txt</span> <span class="n">data1</span><span class="o">.</span><span class="n">root</span> <span class="n">data1</span><span class="o">-</span><span class="n">histos</span><span class="o">.</span><span class="n">root</span>
</pre></div>
</div>
<p>This will produce an output file called <code class="code docutils literal notranslate"><span class="pre">data1-histos.root</span></code> that contains
the requested histograms as well as a merged copy of any pre-made histograms
in the data file (such as energy deposition).</p>
<p>If we start another ROOT session, or click the refresh button (top left, near “Draw Option”,
looks like a recycle symbol), the file view will refresh and we can browse the new output
file and view the histograms in ROOT.  We can also load the histograms in Python using the
<cite>pybdsim</cite> utility package and make some nicer plots.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ipython</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">pybdsim</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">d</span> <span class="o">=</span> <span class="n">pybdsim</span><span class="o">.</span><span class="n">Data</span><span class="o">.</span><span class="n">Load</span><span class="p">(</span><span class="s2">&quot;data1-histos.root&quot;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">d</span><span class="o">.</span><span class="n">histograms</span>
</pre></div>
</div>
<p>This is described in the manual for <cite>pybdsim</cite> (see <a class="reference internal" href="../python_utilities.html#python-utilities"><span class="std std-ref">Python Utilities</span></a>) and the relevant
section is <a class="reference external" href="http://www.pp.rhul.ac.uk/bdsim/pybdsim/data.html">http://www.pp.rhul.ac.uk/bdsim/pybdsim/data.html</a>. This is what should
be seen:</p>
<figure class="align-center">
<a class="reference internal image-reference" href="../_images/collimation-ipython-explore.png"><img alt="../_images/collimation-ipython-explore.png" src="../_images/collimation-ipython-explore.png" style="width: 100%;" /></a>
</figure>
<p>The following commands can be used to make a few simple plots in Python:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">pybdsim</span><span class="o">.</span><span class="n">Plot</span><span class="o">.</span><span class="n">EnergyDeposition</span><span class="p">(</span><span class="s2">&quot;data1-histos.root&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pybdsim</span><span class="o">.</span><span class="n">Plot</span><span class="o">.</span><span class="n">LossAndEnergyDeposition</span><span class="p">(</span><span class="s2">&quot;data1-histos.root&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span><span class="o">.</span><span class="n">histograms2dpy</span>
<span class="go">{&#39;Event/PerEntryHistograms/AllElectrons&#39;: &lt;pybdsim.Data.TH2 at 0x11e8f9590&gt;,</span>
<span class="go">&#39;Event/PerEntryHistograms/AllParticles&#39;: &lt;pybdsim.Data.TH2 at 0x11e8f95d0&gt;,</span>
<span class="go">&#39;Event/PerEntryHistograms/AllPositrons&#39;: &lt;pybdsim.Data.TH2 at 0x11e8f9550&gt;}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pybdsim</span><span class="o">.</span><span class="n">Plot</span><span class="o">.</span><span class="n">Histogram2D</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">histograms2dpy</span><span class="p">[</span><span class="s1">&#39;Event/PerEntryHistograms/AllParticles&#39;</span><span class="p">],</span> <span class="n">logNorm</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>We leave it to the user to create their own plots, but the basic data exploration is
provided and the user should consult the <cite>pybdsim</cite> source code (see <cite>pybdsim/pybdsim/Plot.py</cite>)
for how we have made these plots using <cite>matplotlib</cite>.</p>
<p>The above commands create the following plots.</p>
<figure class="align-center">
<a class="reference internal image-reference" href="../_images/collimation-energy-deposition.pdf"><img alt="../_images/collimation-energy-deposition.pdf" src="../_images/collimation-energy-deposition.pdf" style="width: 100%;" /></a>
</figure>
<figure class="align-center">
<a class="reference internal image-reference" href="../_images/collimation-losses.pdf"><img alt="../_images/collimation-losses.pdf" src="../_images/collimation-losses.pdf" style="width: 100%;" /></a>
</figure>
<figure class="align-center">
<a class="reference internal image-reference" href="../_images/collimation-allparticles.pdf"><img alt="../_images/collimation-allparticles.pdf" src="../_images/collimation-allparticles.pdf" style="width: 70%;" /></a>
</figure>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="beamDump.html" class="btn btn-neutral float-left" title="Beam Dump" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="simpleMachine.html" class="btn btn-neutral float-right" title="Simple Machine" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright Beam Delivery Simulation (BDSIM) Copyright (c) Royal Holloway, University of London, 2001 - 2025.
      <span class="lastupdated">Last updated on Jun 13, 2025.
      </span></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
    <!-- Theme Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-JYMKZHVZJ2"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-JYMKZHVZJ2', {
          'anonymize_ip': false,
      });
    </script> 

</body>
</html>