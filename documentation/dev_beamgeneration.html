<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Beam Generation &mdash; BDSIM 1.7.7.develop documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="_static/graphviz.css?v=fd3f3429" />

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js?v=5d32c60e"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="_static/documentation_options.js?v=106dc6df"></script>
        <script src="_static/doctools.js?v=9a2dae69"></script>
        <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Sensitivity, Output &amp; Analysis" href="dev_analysisoutput.html" />
    <link rel="prev" title="Fields" href="dev_fields.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            BDSIM
              <img src="_static/bdsim-logo-small.jpg" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                1.7.7.develop
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">User Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="licence.html">Licence &amp; Disclaimer</a></li>
<li class="toctree-l1"><a class="reference internal" href="authorship.html">Authorship</a></li>
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="running.html">Running BDSIM</a></li>
<li class="toctree-l1"><a class="reference internal" href="input_syntax.html">Input Syntax</a></li>
<li class="toctree-l1"><a class="reference internal" href="model_construction.html">Model Construction</a></li>
<li class="toctree-l1"><a class="reference internal" href="model_control.html">Model Control</a></li>
<li class="toctree-l1"><a class="reference internal" href="model_customisation.html">Model Customisation</a></li>
<li class="toctree-l1"><a class="reference internal" href="model_conversion.html">Model Conversion</a></li>
<li class="toctree-l1"><a class="reference internal" href="externalgeometry.html">External Geometry Formats</a></li>
<li class="toctree-l1"><a class="reference internal" href="output.html">Output</a></li>
<li class="toctree-l1"><a class="reference internal" href="output_analysis.html">Output Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="python_utilities.html">Python Utilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="visualisation.html">Visualisation</a></li>
<li class="toctree-l1"><a class="reference internal" href="interfacing.html">Interfacing</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Examples &amp; Tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="support.html">Support</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer Guide</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="history.html">Version History</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="developer.html">Developer Documentation</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="dev_introduction.html">Purpose of Developer Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="dev_contributing.html">Contributing</a></li>
<li class="toctree-l2"><a class="reference internal" href="dev_testing.html">Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="dev_styleguide.html">Style Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="dev_documentation_build.html">Documentation Builds</a></li>
<li class="toctree-l2"><a class="reference internal" href="dev_release.html">Release Checklist</a></li>
<li class="toctree-l2"><a class="reference internal" href="dev_release.html#change-of-year-or-licence">Change Of Year or Licence</a></li>
<li class="toctree-l2"><a class="reference internal" href="dev_programlayout.html">Program Layout</a></li>
<li class="toctree-l2"><a class="reference internal" href="dev_buildsystem.html">Build System &amp; Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="dev_parser.html">Parser</a></li>
<li class="toctree-l2"><a class="reference internal" href="dev_geantusage.html">Geant4 User Action Classes</a></li>
<li class="toctree-l2"><a class="reference internal" href="dev_geometry.html">Geometry</a></li>
<li class="toctree-l2"><a class="reference internal" href="dev_tracking.html">Tracking Algorithms</a></li>
<li class="toctree-l2"><a class="reference internal" href="dev_fields.html">Fields</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Beam Generation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#gauss-twiss-covariance-matrix">Gauss Twiss Covariance Matrix</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="dev_analysisoutput.html">Sensitivity, Output &amp; Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="dev_analysissuite.html">Analysis Suite</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="model_description.html">Model Description</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">BDSIM</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="developer.html">Developer Documentation</a></li>
      <li class="breadcrumb-item active">Beam Generation</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/dev_beamgeneration.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="beam-generation">
<span id="dev-beams"></span><h1>Beam Generation<a class="headerlink" href="#beam-generation" title="Link to this heading"></a></h1>
<p>BDSIM uses the CLHEP random number generator and associated classes to generate
pseudo-random particle distributions for tracking.</p>
<section id="gauss-twiss-covariance-matrix">
<h2>Gauss Twiss Covariance Matrix<a class="headerlink" href="#gauss-twiss-covariance-matrix" title="Link to this heading"></a></h2>
<p>The beam in an accelerator can be described as a 6D distribution of particles. The six
dimensions are three canonical conjugate coordinate pairs in three planes, and can be
represented by the vector - <span class="math notranslate nohighlight">\(\boldsymbol{x} = (x,\,x^{\prime},\,y,y^{\prime},\,t,\,\delta)\)</span>.
The means of that distribution are the beam centroids. The 6x6 matrix of second
order moments of the distribution is referred to as the sigma matrix and can be represented
compactly as <span class="math notranslate nohighlight">\(\Sigma_{ij}=\langle\boldsymbol{x_{i}}\,\boldsymbol{x_{j}}\rangle\)</span>
with the angle brackets denoting a central moment. More explicitly for a particle beam,
this is:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\mathbf{\Sigma}=
\begin{pmatrix}
\langle x^{2}\rangle &amp; \langle x\,x^{\prime}\rangle &amp; \langle x\,y\rangle &amp; \langle x\,y^{\prime}\rangle &amp; \langle x\,t\rangle &amp; \langle x\,\delta\rangle \\
\langle x^{\prime}x\rangle &amp; \langle x^{\prime 2}\rangle &amp; \langle x^{\prime}\,y\rangle &amp; \langle x^{\prime}\,y^{\prime}\rangle &amp; \langle x^{\prime}\,t\rangle &amp; \langle x^{\prime}\,\delta\rangle \\
\langle y\,x\rangle &amp; \langle y\,x^{\prime}\rangle &amp; \langle y^{2}\rangle &amp; \langle y\,y^{\prime}\rangle &amp; \langle y\,t\rangle &amp; \langle y\,\delta\rangle \\
\langle y^{\prime}x\rangle &amp; \langle y^{\prime}x^{\prime}\rangle &amp; \langle y^{\prime}y\rangle &amp; \langle y^{\prime 2}\rangle &amp; \langle y^{\prime}t\rangle &amp; \langle y^{\prime}\delta\rangle \\
\langle t\,x\rangle &amp; \langle t\,x^{\prime}\rangle &amp; \langle t\,y\rangle &amp; \langle t\,y^{\prime}\rangle &amp; \langle t^{2}\rangle &amp; \langle t\,\delta\rangle \\
\langle \delta\,x\rangle &amp; \langle \delta\,x^{\prime}\rangle &amp; \langle \delta\,y\rangle &amp; \langle \delta\,y^{\prime}\rangle &amp; \langle \delta\,t\rangle &amp; \langle \delta^{2}\rangle \\
\end{pmatrix}\end{split}\]</div>
<p>The beam is typically parameterised in an accelerator using the Twiss functions.
<span class="math notranslate nohighlight">\(\beta,\alpha,\gamma\)</span> and dispersions <span class="math notranslate nohighlight">\(\eta_x,\eta_x^{\prime},\eta_y,\eta_y^{\prime}\)</span>.
These are used in combination with beam parameters
<span class="math notranslate nohighlight">\(\epsilon_x,\epsilon_y,\sigma_{\delta},\sigma_{t}\)</span>. The combination of
machine and beam parameters gives the physical observables such as beam size.</p>
<p>Please note that <span class="math notranslate nohighlight">\(\sigma_{\delta}\)</span> is used here for clarity, but its definition is equivalent
to <span class="math notranslate nohighlight">\(\sigma_{E}\)</span> defined in <a class="reference internal" href="model_control.html#beam-parameters"><span class="std std-ref">Beam Parameters</span></a>.</p>
<p>For linear optics, and in the absence of dispersion or energy spread, the three 2x2 submatrices
along the diagonal of the sigma matrix fully represent each plane and can be treated
independently of each other. For example, the horizontal plane is parameterised as:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{pmatrix}
\langle x^{2}\rangle &amp; \langle x\,x^{\prime}\rangle \\
\langle x\,x^{\prime}\rangle &amp; \langle x^{\prime 2}\rangle
\end{pmatrix}
=
\epsilon_{x}
\begin{pmatrix}
\beta_{x} &amp; -\alpha_{x} \\
-\alpha_{x} &amp; \gamma_{x}
\end{pmatrix}.\end{split}\]</div>
<p>When dispersion and energy spread are present, numerous couplings are introduced,
which appear as off-diagonal elements in the sigma matrix. In this case, the energy
dependence of the coordinates results in both longitudinal-transverse and
transverse-transverse couplings.</p>
<p>To be a valid covariance matrix, the sigma (<em>capital sigma</em>) matrix, must be positive
definite. This ensures a positive variance in each dimension.</p>
<p>To derive each term of the covariance matrix, we consider the effect of dispersion
on single coordinates. For example, for an individual particle, the horizontal
position is affected as follows:</p>
<div class="math notranslate nohighlight">
\[x_{i} = x_{\beta i} + \eta_{s}\delta_{i},\]</div>
<p>where <span class="math notranslate nohighlight">\(x_{i}\)</span> is the observed coordinate, <span class="math notranslate nohighlight">\(x_{\beta}\)</span> is the betatron
component and <span class="math notranslate nohighlight">\(\eta_{x}\delta_{i}\)</span> reflects the change due to the particle’s
relative energy offset in a dispersive region.</p>
<p>Because <span class="math notranslate nohighlight">\(x_{\beta}\)</span> and <span class="math notranslate nohighlight">\(\delta_{i}\)</span> are random variables and are
independent by construction, the second order moment in <span class="math notranslate nohighlight">\(x_{\beta}\)</span> can be
factorised using the properties of the variance</p>
<div class="math notranslate nohighlight">
\[\langle x^{2}\rangle = \mathrm{var}[x_{\beta}+\eta_{x}\delta] = \langle x_{\beta}^{2}\rangle + \eta_{x}^{2}\langle\delta_{i}^{2}\rangle = \epsilon_{x}\beta_{x} + \eta_{x}^{2}\sigma_{\delta}^{2},\]</div>
<p>where the last form is obtained by applying the Courant-Snyder equations and rewriting
the variance in terms of standard deviation.</p>
<p>The covariance of the horizontal position and the energy offset can also be obtained as:</p>
<div class="math notranslate nohighlight">
\[\langle x\,\delta\rangle = \textrm{cov}[x_{\beta}+\eta_{x}\delta, \delta] = \langle x_{\beta}\,\delta\rangle + \eta_{x}\langle \delta^{2}\rangle = \eta_{x}\langle\delta^{2}\rangle,\]</div>
<p>as <span class="math notranslate nohighlight">\(\langle x_{\beta}\,\delta\rangle = 0\)</span> by construction as explained above.</p>
<p>Finally, correlations that involve two different variables affected by dispersion
have the same form. For example:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\langle x\,y\rangle &amp;= \mathrm{cov}[x_{\beta}+\eta_{x}\delta,\,x^{\prime}_{\beta}+\eta_{x^{\prime}}\delta] \\
                  &amp;= \langle x_{\beta}\,x^{\prime}_{\beta}\rangle + \eta_{x}\langle x^{\prime}_{\beta}\,\delta\rangle + \eta_{x^{\prime}}\langle x_{\beta}\,\delta\rangle + \eta_{x}\,\eta_{x^{\prime}}\langle\delta^{2}\rangle \\
                  &amp;= \langle x_{\beta}\,x^{\prime}_{\beta}\rangle + \eta_{x}\eta_{x^{\prime}}\langle\delta^{2}\rangle \\
                  &amp;=-\epsilon_{x}\alpha_{x} + \eta_{x}\eta_{x^{\prime}}\sigma_{\delta}^{2}\end{split}\]</div>
<p>All other couplings are done by analogy.</p>
<p>Some useful relations:</p>
<div class="math notranslate nohighlight">
\[\begin{split}&amp;\langle XY\rangle\equiv\mathrm{cov}[X,Y], \\
&amp;\langle X^2\rangle\equiv\mathrm{cov}[X,X]\equiv\mathrm{var}[X]\equiv\sigma_{X}^{2}, \\
&amp;\mathrm{var}[X+Y]=\mathrm{var}[X]+\mathrm{var}[Y]\,\,\mathrm{if\,\,X,Y \, are\,independent}, \\
&amp;\mathrm{cov}[aX+bY,cW+dV]=ac\mathrm{cov}[X,W]+ad\mathrm{cov}[X,V]+bc\mathrm{cov}[Y,W]+bd\mathrm{cov}[Y,V].\end{split}\]</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="dev_fields.html" class="btn btn-neutral float-left" title="Fields" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="dev_analysisoutput.html" class="btn btn-neutral float-right" title="Sensitivity, Output &amp; Analysis" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright Beam Delivery Simulation (BDSIM) Copyright (c) Royal Holloway, University of London, 2001 - 2025.
      <span class="lastupdated">Last updated on Jun 13, 2025.
      </span></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
    <!-- Theme Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-JYMKZHVZJ2"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-JYMKZHVZJ2', {
          'anonymize_ip': false,
      });
    </script> 

</body>
</html>