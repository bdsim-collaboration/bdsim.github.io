<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Program Layout &mdash; BDSIM 1.7.7.develop documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="_static/graphviz.css?v=fd3f3429" />

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js?v=5d32c60e"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="_static/documentation_options.js?v=106dc6df"></script>
        <script src="_static/doctools.js?v=9a2dae69"></script>
        <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Build System &amp; Testing" href="dev_buildsystem.html" />
    <link rel="prev" title="Release Checklist" href="dev_release.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            BDSIM
              <img src="_static/bdsim-logo-small.jpg" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                1.7.7.develop
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">User Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="licence.html">Licence &amp; Disclaimer</a></li>
<li class="toctree-l1"><a class="reference internal" href="authorship.html">Authorship</a></li>
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="running.html">Running BDSIM</a></li>
<li class="toctree-l1"><a class="reference internal" href="input_syntax.html">Input Syntax</a></li>
<li class="toctree-l1"><a class="reference internal" href="model_construction.html">Model Construction</a></li>
<li class="toctree-l1"><a class="reference internal" href="model_control.html">Model Control</a></li>
<li class="toctree-l1"><a class="reference internal" href="model_customisation.html">Model Customisation</a></li>
<li class="toctree-l1"><a class="reference internal" href="model_conversion.html">Model Conversion</a></li>
<li class="toctree-l1"><a class="reference internal" href="externalgeometry.html">External Geometry Formats</a></li>
<li class="toctree-l1"><a class="reference internal" href="output.html">Output</a></li>
<li class="toctree-l1"><a class="reference internal" href="output_analysis.html">Output Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="python_utilities.html">Python Utilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="visualisation.html">Visualisation</a></li>
<li class="toctree-l1"><a class="reference internal" href="interfacing.html">Interfacing</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Examples &amp; Tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="support.html">Support</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer Guide</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="history.html">Version History</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="developer.html">Developer Documentation</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="dev_introduction.html">Purpose of Developer Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="dev_contributing.html">Contributing</a></li>
<li class="toctree-l2"><a class="reference internal" href="dev_testing.html">Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="dev_styleguide.html">Style Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="dev_documentation_build.html">Documentation Builds</a></li>
<li class="toctree-l2"><a class="reference internal" href="dev_release.html">Release Checklist</a></li>
<li class="toctree-l2"><a class="reference internal" href="dev_release.html#change-of-year-or-licence">Change Of Year or Licence</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Program Layout</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#parser">Parser</a></li>
<li class="toctree-l3"><a class="reference internal" href="#geant4-model">Geant4 Model</a></li>
<li class="toctree-l3"><a class="reference internal" href="#geant4-user-action-classes">Geant4 User Action Classes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#analysis">Analysis</a></li>
<li class="toctree-l3"><a class="reference internal" href="#specific-run-time-order">Specific Run Time Order</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="dev_buildsystem.html">Build System &amp; Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="dev_parser.html">Parser</a></li>
<li class="toctree-l2"><a class="reference internal" href="dev_geantusage.html">Geant4 User Action Classes</a></li>
<li class="toctree-l2"><a class="reference internal" href="dev_geometry.html">Geometry</a></li>
<li class="toctree-l2"><a class="reference internal" href="dev_tracking.html">Tracking Algorithms</a></li>
<li class="toctree-l2"><a class="reference internal" href="dev_fields.html">Fields</a></li>
<li class="toctree-l2"><a class="reference internal" href="dev_beamgeneration.html">Beam Generation</a></li>
<li class="toctree-l2"><a class="reference internal" href="dev_analysisoutput.html">Sensitivity, Output &amp; Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="dev_analysissuite.html">Analysis Suite</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="model_description.html">Model Description</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">BDSIM</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="developer.html">Developer Documentation</a></li>
      <li class="breadcrumb-item active">Program Layout</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/dev_programlayout.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="program-layout">
<h1>Program Layout<a class="headerlink" href="#program-layout" title="Link to this heading"></a></h1>
<p>BDSIM progresses in the following general steps:</p>
<ol class="arabic simple">
<li><p>Parser reads and parses input text files that prepare structures representing input - all in GMAD namespace.</p></li>
<li><p>A Geant4 model (geometry, fields, sensitivity) is created based on information from the parser structures.</p></li>
<li><p>Special Geant4 user actions are registered.</p></li>
<li><p>The simulation proceeds either interactively or automatically for a given number of events.</p></li>
<li><p>Some analysis is performed at run time, output is written and post-run analysis can be performed.</p></li>
</ol>
<section id="parser">
<h2>Parser<a class="headerlink" href="#parser" title="Link to this heading"></a></h2>
<p>The parser uses Flex and Bison to automatically generate the C++ code required
given a scripted syntax. This defines a set of rules for the syntax that can be
matched.</p>
<p>The parser is described in much more detail in <a class="reference internal" href="dev_parser.html#dev-parser"><span class="std std-ref">Parser</span></a>.</p>
</section>
<section id="geant4-model">
<h2>Geant4 Model<a class="headerlink" href="#geant4-model" title="Link to this heading"></a></h2>
<p>The use of Geant4 falls into two general parts: the model and the user action classes.  The model
is built using the parser beam line structure through many <em>factories</em>. The details are described
in <a class="reference internal" href="dev_geometry.html#dev-geometry"><span class="std std-ref">Geometry</span></a>, <a class="reference internal" href="dev_fields.html#dev-fields"><span class="std std-ref">Fields</span></a>, <a class="reference internal" href="dev_tracking.html#dev-tracking"><span class="std std-ref">Tracking Algorithms</span></a>, and <a class="reference internal" href="dev_analysisoutput.html#dev-analysisoutput"><span class="std std-ref">Sensitivity, Output &amp; Analysis</span></a>.</p>
</section>
<section id="geant4-user-action-classes">
<h2>Geant4 User Action Classes<a class="headerlink" href="#geant4-user-action-classes" title="Link to this heading"></a></h2>
<p>Apart from the geometry and the fields, the Geant4 managed simulation is largely controlled through
user action classes. Geant4 provides base classes (some virtual, others not) that the developer can
register that allow actions to be taken at specific points, such as the beginning and end of event
actions.</p>
<p>These are discussed in detail in <a class="reference internal" href="dev_geantusage.html#dev-geantusage"><span class="std std-ref">Geant4 User Action Classes</span></a>.</p>
</section>
<section id="analysis">
<h2>Analysis<a class="headerlink" href="#analysis" title="Link to this heading"></a></h2>
<p>Run time analysis is also discussed in the aforementioned <a class="reference internal" href="dev_analysisoutput.html#dev-analysisoutput"><span class="std std-ref">Sensitivity, Output &amp; Analysis</span></a>.</p>
<p>Post run time (outside BDSIM) analysis is discussed in <a class="reference internal" href="dev_analysissuite.html#dev-analysissuite"><span class="std std-ref">Analysis Suite</span></a>.</p>
</section>
<section id="specific-run-time-order">
<h2>Specific Run Time Order<a class="headerlink" href="#specific-run-time-order" title="Link to this heading"></a></h2>
<p>This is a rough description of the first few actions in BDSIM (bdsim.cc) that have to be in this
order.</p>
<ol class="arabic simple">
<li><p><code class="code docutils literal notranslate"><span class="pre">BDSExecOptions</span></code></p></li>
<li><p>Check if Geant4 is available in the current environment (env variables checked) - cannot proceed without this.</p></li>
<li><p>Construct parser and parser input.</p></li>
<li><p>Construct required Geant4 materials, as they’re required by <code class="code docutils literal notranslate"><span class="pre">BDSGlobalConstants</span></code>.</p></li>
<li><p>Force instantiation of <code class="code docutils literal notranslate"><span class="pre">BDSGlobalConstants</span></code> singleton based on <code class="code docutils literal notranslate"><span class="pre">GMAD::Options</span></code>.</p></li>
<li><p>Initialise the pseudo-random number generator engine.</p></li>
</ol>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="dev_release.html" class="btn btn-neutral float-left" title="Release Checklist" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="dev_buildsystem.html" class="btn btn-neutral float-right" title="Build System &amp; Testing" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright Beam Delivery Simulation (BDSIM) Copyright (c) Royal Holloway, University of London, 2001 - 2025.
      <span class="lastupdated">Last updated on Jun 13, 2025.
      </span></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
    <!-- Theme Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-JYMKZHVZJ2"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-JYMKZHVZJ2', {
          'anonymize_ip': false,
      });
    </script> 

</body>
</html>