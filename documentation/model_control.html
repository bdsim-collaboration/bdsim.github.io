<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Model Control &mdash; BDSIM 1.7.7.develop documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="_static/graphviz.css?v=fd3f3429" />

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js?v=5d32c60e"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="_static/documentation_options.js?v=106dc6df"></script>
        <script src="_static/doctools.js?v=9a2dae69"></script>
        <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Model Customisation" href="model_customisation.html" />
    <link rel="prev" title="Model Construction" href="model_construction.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            BDSIM
              <img src="_static/bdsim-logo-small.jpg" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                1.7.7.develop
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">User Guide</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="licence.html">Licence &amp; Disclaimer</a></li>
<li class="toctree-l1"><a class="reference internal" href="authorship.html">Authorship</a></li>
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="running.html">Running BDSIM</a></li>
<li class="toctree-l1"><a class="reference internal" href="input_syntax.html">Input Syntax</a></li>
<li class="toctree-l1"><a class="reference internal" href="model_construction.html">Model Construction</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Model Control</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#random-engine">Random Engine</a></li>
<li class="toctree-l2"><a class="reference internal" href="#beam-parameters">Beam Parameters</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#beam-particle-type">Beam Particle Type</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#ion-beams">Ion Beams</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#different-beam-and-design-particles">Different Beam and Design Particles</a></li>
<li class="toctree-l3"><a class="reference internal" href="#beam-energy-from-the-command-line">Beam Energy From the Command Line</a></li>
<li class="toctree-l3"><a class="reference internal" href="#generate-only-the-input-distribution">Generate Only the Input Distribution</a></li>
<li class="toctree-l3"><a class="reference internal" href="#beam-in-output">Beam in Output</a></li>
<li class="toctree-l3"><a class="reference internal" href="#bunches-and-time-offset">Bunches and Time Offset</a></li>
<li class="toctree-l3"><a class="reference internal" href="#beam-tilt">Beam Tilt</a></li>
<li class="toctree-l3"><a class="reference internal" href="#beam-distributions">Beam Distributions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#reference">reference</a></li>
<li class="toctree-l4"><a class="reference internal" href="#gaussmatrix">gaussmatrix</a></li>
<li class="toctree-l4"><a class="reference internal" href="#gauss">gauss</a></li>
<li class="toctree-l4"><a class="reference internal" href="#gausstwiss">gausstwiss</a></li>
<li class="toctree-l4"><a class="reference internal" href="#circle">circle</a></li>
<li class="toctree-l4"><a class="reference internal" href="#square">square</a></li>
<li class="toctree-l4"><a class="reference internal" href="#ring">ring</a></li>
<li class="toctree-l4"><a class="reference internal" href="#eshell">eshell</a></li>
<li class="toctree-l4"><a class="reference internal" href="#sphere">sphere</a></li>
<li class="toctree-l4"><a class="reference internal" href="#box">box</a></li>
<li class="toctree-l4"><a class="reference internal" href="#halo">halo</a></li>
<li class="toctree-l4"><a class="reference internal" href="#halosigma">halosigma</a></li>
<li class="toctree-l4"><a class="reference internal" href="#composite">composite</a></li>
<li class="toctree-l4"><a class="reference internal" href="#compositespacedirectionenergy">compositespacedirectionenergy</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#beam-distributions-file-based">Beam Distributions - File-Based</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#behaviour">Behaviour</a></li>
<li class="toctree-l4"><a class="reference internal" href="#userfile">userfile</a></li>
<li class="toctree-l4"><a class="reference internal" href="#ptc">ptc</a></li>
<li class="toctree-l4"><a class="reference internal" href="#eventgeneratorfile">eventgeneratorfile</a></li>
<li class="toctree-l4"><a class="reference internal" href="#bdsimsampler">bdsimsampler</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#physics-processes">Physics Processes</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#physics-macro-file">Physics Macro File</a></li>
<li class="toctree-l3"><a class="reference internal" href="#modular-physics-lists">Modular Physics Lists</a></li>
<li class="toctree-l3"><a class="reference internal" href="#em-extra-physics-notes">em_extra Physics Notes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#geant4-reference-physics-lists">Geant4 Reference Physics Lists</a></li>
<li class="toctree-l3"><a class="reference internal" href="#complete-physics-lists">Complete Physics Lists</a></li>
<li class="toctree-l3"><a class="reference internal" href="#proton-diffraction">Proton Diffraction</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#physics-biasing">Physics Biasing</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#cross-section-biasing">Cross-Section Biasing</a></li>
<li class="toctree-l3"><a class="reference internal" href="#geometric-importance-sampling">Geometric Importance Sampling</a></li>
<li class="toctree-l3"><a class="reference internal" href="#muon-splitting">Muon Splitting</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#options">Options</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#common-options">Common Options</a></li>
<li class="toctree-l3"><a class="reference internal" href="#general-run-options">General Run Options</a></li>
<li class="toctree-l3"><a class="reference internal" href="#geometry-options">Geometry Options</a></li>
<li class="toctree-l3"><a class="reference internal" href="#tracking-options">Tracking Options</a></li>
<li class="toctree-l3"><a class="reference internal" href="#physics-process-options">Physics Processes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#visualisation">Visualisation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#output-options">Output Options</a></li>
<li class="toctree-l3"><a class="reference internal" href="#trajectory-filtering-options">Trajectory Filtering Options</a></li>
<li class="toctree-l3"><a class="reference internal" href="#trajectory-storage-options">Trajectory Storage Options</a></li>
<li class="toctree-l3"><a class="reference internal" href="#print-out-options">Print Out Options</a></li>
<li class="toctree-l3"><a class="reference internal" href="#offset-for-main-beam-line">Offset for Main Beam Line</a></li>
<li class="toctree-l3"><a class="reference internal" href="#scoring-map">Scoring Map</a></li>
<li class="toctree-l3"><a class="reference internal" href="#developer-options">Developer Options</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#output-at-a-surface-samplers">Output at a Surface - Samplers</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#attaching-a-plane-sampler-to-a-beamline-element">Attaching a Plane Sampler to a Beamline Element</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#plane-sampler-dimensions">Plane Sampler Dimensions</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#attaching-a-cylindrical-sampler-to-a-beamline-element">Attaching a Cylindrical Sampler to a Beamline Element</a></li>
<li class="toctree-l3"><a class="reference internal" href="#filtering-particles-to-record">Filtering Particles To Record</a></li>
<li class="toctree-l3"><a class="reference internal" href="#sampler-visualisation">Sampler Visualisation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#output-at-an-arbitrary-plane-user-placed-sampler">Output at an Arbitrary Plane - User Placed Sampler</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#types-and-shapes">Types and Shapes</a></li>
<li class="toctree-l4"><a class="reference internal" href="#plane-shape">Plane Shape</a></li>
<li class="toctree-l4"><a class="reference internal" href="#cylinder-shape">Cylinder Shape</a></li>
<li class="toctree-l4"><a class="reference internal" href="#sphere-shape">Sphere Shape</a></li>
<li class="toctree-l4"><a class="reference internal" href="#placement">Placement</a></li>
<li class="toctree-l4"><a class="reference internal" href="#parameters">Parameters</a></li>
<li class="toctree-l4"><a class="reference internal" href="#examples">Examples</a></li>
<li class="toctree-l4"><a class="reference internal" href="#user-sampler-visualisation">User Sampler Visualisation</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#scoring">Scoring</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#sampler-coordinate-systems">Sampler Coordinate Systems</a></li>
<li class="toctree-l3"><a class="reference internal" href="#scorer">Scorer</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#scorer-types">Scorer Types</a></li>
<li class="toctree-l4"><a class="reference internal" href="#conversion-factor-file">Conversion Factor File</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#scorer-mesh">Scorer Mesh</a></li>
<li class="toctree-l3"><a class="reference internal" href="#scoring-examples">Scoring Examples</a></li>
<li class="toctree-l3"><a class="reference internal" href="#visualising-a-scoring-mesh">Visualising a Scoring Mesh</a></li>
<li class="toctree-l3"><a class="reference internal" href="#visualising-scoring-data">Visualising Scoring Data</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#controlling-simulation-speed">Controlling Simulation Speed</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#range-cuts">Range Cuts</a></li>
<li class="toctree-l3"><a class="reference internal" href="#minimum-kinetic-energy">Minimum Kinetic Energy</a></li>
<li class="toctree-l3"><a class="reference internal" href="#minimum-range">Minimum Range</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#dipole-behaviour">Dipole Behaviour</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#fringe-field-integral-behaviour">Fringe Field Integral Behaviour</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pole-face-rotations">Pole Face Rotations</a></li>
<li class="toctree-l3"><a class="reference internal" href="#large-angle-bends">Large Angle Bends</a></li>
<li class="toctree-l3"><a class="reference internal" href="#dipole-scaling">Dipole Scaling</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="model_customisation.html">Model Customisation</a></li>
<li class="toctree-l1"><a class="reference internal" href="model_conversion.html">Model Conversion</a></li>
<li class="toctree-l1"><a class="reference internal" href="externalgeometry.html">External Geometry Formats</a></li>
<li class="toctree-l1"><a class="reference internal" href="output.html">Output</a></li>
<li class="toctree-l1"><a class="reference internal" href="output_analysis.html">Output Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="python_utilities.html">Python Utilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="visualisation.html">Visualisation</a></li>
<li class="toctree-l1"><a class="reference internal" href="interfacing.html">Interfacing</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Examples &amp; Tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="support.html">Support</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="history.html">Version History</a></li>
<li class="toctree-l1"><a class="reference internal" href="developer.html">Developer Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="model_description.html">Model Description</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">BDSIM</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Model Control</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/model_control.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="model-control">
<span id="id1"></span><h1>Model Control<a class="headerlink" href="#model-control" title="Link to this heading"></a></h1>
<ul class="simple">
<li><p><a class="reference internal" href="#random-engine"><span class="std std-ref">Random Engine</span></a></p></li>
<li><p><a class="reference internal" href="#beam-parameters"><span class="std std-ref">Beam Parameters</span></a></p>
<ul>
<li><p><a class="reference internal" href="#beam-distributions"><span class="std std-ref">Beam Distributions</span></a></p></li>
<li><p><a class="reference internal" href="#beam-distributions-file-based"><span class="std std-ref">Beam Distributions - File-Based</span></a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#physics-processes"><span class="std std-ref">Physics Processes</span></a></p>
<ul>
<li><p><a class="reference internal" href="#physics-modular-physics-lists"><span class="std std-ref">Modular Physics Lists</span></a></p></li>
<li><p><a class="reference internal" href="#physics-geant4-lists"><span class="std std-ref">Geant4 Reference Physics Lists</span></a></p></li>
<li><p><a class="reference internal" href="#physics-complete-lists"><span class="std std-ref">Complete Physics Lists</span></a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#physics-biasing"><span class="std std-ref">Physics Biasing</span></a></p>
<ul>
<li><p><a class="reference internal" href="#physics-bias-cross-section-biasing"><span class="std std-ref">Cross-Section Biasing</span></a></p></li>
<li><p><a class="reference internal" href="#physics-bias-importance-sampling"><span class="std std-ref">Geometric Importance Sampling</span></a></p></li>
<li><p><a class="reference internal" href="#physics-bias-muon-splitting"><span class="std std-ref">Muon Splitting</span></a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#bdsim-options"><span class="std std-ref">Options</span></a>
- including <a class="reference internal" href="#beamline-offset"><span class="std std-ref">Offset for Main Beam Line</span></a></p></li>
<li><p><a class="reference internal" href="#sampler-output"><span class="std std-ref">Output at a Surface - Samplers</span></a></p>
<ul>
<li><p><a class="reference internal" href="#sampler-syntax"><span class="std std-ref">Attaching a Plane Sampler to a Beamline Element</span></a></p></li>
<li><p><a class="reference internal" href="#sampler-dimensions"><span class="std std-ref">Plane Sampler Dimensions</span></a></p></li>
<li><p><a class="reference internal" href="#sampler-visualisation"><span class="std std-ref">Sampler Visualisation</span></a></p></li>
<li><p><a class="reference internal" href="#user-sampler-placement"><span class="std std-ref">Output at an Arbitrary Plane - User Placed Sampler</span></a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#scoring"><span class="std std-ref">Scoring</span></a></p>
<ul>
<li><p><a class="reference internal" href="#scoring-mesh"><span class="std std-ref">Scorer Mesh</span></a></p></li>
<li><p><a class="reference internal" href="#scorer"><span class="std std-ref">Scorer</span></a></p></li>
<li><p><a class="reference internal" href="#scorer-types"><span class="std std-ref">Scorer Types</span></a></p></li>
<li><p><a class="reference internal" href="#scorer-conversion-factor-file"><span class="std std-ref">Conversion Factor File</span></a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#controlling-simulation-speed"><span class="std std-ref">Controlling Simulation Speed</span></a></p></li>
<li><p>More details about <a class="reference internal" href="#bend-tracking-behaviour"><span class="std std-ref">Dipole Behaviour</span></a></p></li>
</ul>
<section id="random-engine">
<span id="id2"></span><h2>Random Engine<a class="headerlink" href="#random-engine" title="Link to this heading"></a></h2>
<p>BDSIM, like Geant4 uses CLHEP for pseudo-random number generation. BDSIM requires Geant4 to be
compiled with respect to a system installation of CLHEP and not the partially included one inside
Geant4. This is because we require the full set of classes from CLHEP for beam coordinate generation
but these classes aren’t available in the limited version in Geant4. If we permit Geant4 to use its
own internal CLHEP and BDSIM to use the system CLHEP, we can end up with two random number generators
and the simulation is not reproducible. Therefore we prevent this behaviour at compilation.</p>
<p>BDSIM uses the HepJamesRandom CLHEP engine by default. This was traditionally the default pseudo-random
number engine used in Geant4 until recently. Now, Geant4 uses CLHEP’s MixMax engine. BDSIM explicitly
sets the engine to HepJamesRandom so the same engine is used by Geant4 and BDSIM.</p>
<p>This behaviour can be controlled by the option <code class="code docutils literal notranslate"><span class="pre">randomEngine</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">option</span><span class="p">,</span> <span class="n">randomEngine</span><span class="o">=</span><span class="s2">&quot;hepjames&quot;</span><span class="p">;</span>
<span class="n">option</span><span class="p">,</span> <span class="n">randomEngine</span><span class="o">=</span><span class="s2">&quot;mixmax&quot;</span><span class="p">;</span>
</pre></div>
</div>
<p>Examples are included in <code class="code docutils literal notranslate"><span class="pre">bdsim/examples/features/beam/random-engine*</span></code>.</p>
</section>
<section id="beam-parameters">
<span id="id3"></span><h2>Beam Parameters<a class="headerlink" href="#beam-parameters" title="Link to this heading"></a></h2>
<p>BDSIM starts each event in one of the following ways:</p>
<ol class="arabic simple">
<li><p>Particles coordinates for one particle are generated from a chosen beam distribution,
which is specified in the input GMAD file. In most cases, the particle coordinates
are randomly generated according to a distribution. But this also includes reading
from a <strong>text file</strong>.</p></li>
<li><p>A primary vertex is loaded from an event generator file. This currently requires compiling
BDSIM with HepMC3 to load such files. In this case, each event may start with 1 or more particles.
(see <a class="reference internal" href="#eventgeneratorfile">eventgeneratorfile</a>).</p></li>
<li><p>Hits are loaded from a sampler in BDSIM output file and launched at any location in the
simulation - not necessarily in the same position or same model as they were generated in.
See <a class="reference internal" href="#beam-bdsimsampler"><span class="std std-ref">bdsimsampler</span></a>.</p></li>
</ol>
<p>To specify the input particle distribution, the <code class="code docutils literal notranslate"><span class="pre">beam</span></code> command is
used. This also specifies the particle species and <strong>reference total energy</strong>, which is the
design total energy of the machine. This is used along with the particle species to calculate
the momentum of the reference particle and therefore the magnetic rigidity that normalised magnetic
field strengths are calculated with respect to. For example, the field of dipole magnets
is calculated using this if only the <cite>angle</cite> parameter has been specified.</p>
<p>Apart from the design particle and energy, a beam of particles of a different species and total
energy may be specified. By default, if only one particle is specified this is assumed to be
both the design particle and the particle used for the beam distribution.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><cite>energy</cite> here is the <strong>total energy</strong> of the particle. This must be greater than
the rest mass of the particle.</p>
</div>
<ul class="simple">
<li><p>The user <strong>must</strong> specify at least one of [<code class="code docutils literal notranslate"><span class="pre">energy</span></code>, <code class="code docutils literal notranslate"><span class="pre">kineticEnergy</span></code>,
<code class="code docutils literal notranslate"><span class="pre">momentum</span></code>] as well as <code class="code docutils literal notranslate"><span class="pre">particle</span></code>.</p></li>
<li><p>The central energy of the distribution can be specified (if different) with <code class="code docutils literal notranslate"><span class="pre">E0</span></code>.</p></li>
<li><p>If no distribution is specified, the <a class="reference internal" href="#reference">reference</a> distribution is the default.</p></li>
</ul>
<p>A few minimal examples of beam definition are:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">beam</span><span class="p">,</span> <span class="n">particle</span><span class="o">=</span><span class="s2">&quot;proton&quot;</span><span class="p">,</span>
      <span class="n">energy</span><span class="o">=</span><span class="mf">34.2</span><span class="o">*</span><span class="n">GeV</span><span class="p">;</span>

<span class="n">beam</span><span class="p">,</span> <span class="n">particle</span><span class="o">=</span><span class="s2">&quot;2212&quot;</span><span class="p">,</span>
      <span class="n">kineticEnergy</span><span class="o">=</span><span class="mi">230</span><span class="o">*</span><span class="n">MeV</span><span class="p">;</span>

<span class="n">beam</span><span class="p">,</span> <span class="n">particle</span><span class="o">=</span><span class="s2">&quot;e-&quot;</span><span class="p">,</span>
      <span class="n">momentum</span><span class="o">=</span><span class="mi">600</span><span class="o">*</span><span class="n">MeV</span><span class="p">;</span>
</pre></div>
</div>
<p>Other parameters, such as the beam distribution type, <code class="code docutils literal notranslate"><span class="pre">distrType</span></code>, are optional and can
be specified as described in the following sections.</p>
<section id="beam-particle-type">
<span id="id4"></span><h3>Beam Particle Type<a class="headerlink" href="#beam-particle-type" title="Link to this heading"></a></h3>
<p>The beam particle may be specified by name
as it is in Geant4 (exactly) or by its PDG ID. The follow are available by default:</p>
<ul class="simple">
<li><p><cite>e-</cite> or <cite>e+</cite></p></li>
<li><p><cite>proton</cite> or <cite>anti_proton</cite></p></li>
<li><p><cite>gamma</cite></p></li>
<li><p><cite>neutron</cite></p></li>
<li><p><cite>mu-</cite> or <cite>mu+</cite></p></li>
<li><p><cite>pi-</cite> or <cite>pi+</cite> or <cite>pi0</cite></p></li>
<li><p><cite>photon</cite> or <cite>gamma</cite></p></li>
<li><p><cite>kaon-</cite>, <cite>kaon+</cite>, <cite>kaon0L</cite>, <cite>kaon0S</cite>, <cite>kaon0</cite> (a <cite>kaon0</cite> immediately ‘decay’s into either <cite>kaon0S</cite> or <cite>kaon0L</cite> in Geant4)</p></li>
<li><p><cite>nu_e</cite>, <cite>nu_mu</cite>, <cite>nu_tau</cite>, <cite>anti_nu_e</cite>, <cite>anti_nu_mu</cite>, <cite>anti_nu_tau</cite></p></li>
</ul>
<p>In fact, the user may specify any particle that is available through the physics list
used. If given by name, the particle must be given by the Geant4 name exactly (case sensitive).
The particle names above are always defined and so can always safely be used irrespective of the physics
list used. If the particle definition is not found, BDSIM will print a warning and exit.</p>
<p>If more exotic particles are desired but no corresponding physics processes are desired, then
the special physics list <strong>“all_particles”</strong> can be used to only load the particle definitions.</p>
<p>The Geant4 particle names can be found by executing BDSIM with the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">bdsim</span> <span class="o">--</span><span class="n">file</span><span class="o">=</span><span class="n">yourmodel</span><span class="o">.</span><span class="n">gmad</span> <span class="o">--</span><span class="n">batch</span> <span class="o">--</span><span class="n">printPhysicsProcesses</span>
</pre></div>
</div>
<p>This will print each particle available in the model by the Geant4 name as well as the
physics processes registered to that particle.</p>
<p>The PDG IDs can be found at the PDG website; reviews and tables; Monte Carlo Numbering Scheme.</p>
<ul class="simple">
<li><p><a class="reference external" href="https://pdg.lbl.gov/2020/reviews/rpp2020-rev-monte-carlo-numbering.pdf">https://pdg.lbl.gov/2020/reviews/rpp2020-rev-monte-carlo-numbering.pdf</a></p></li>
</ul>
<section id="ion-beams">
<h4>Ion Beams<a class="headerlink" href="#ion-beams" title="Link to this heading"></a></h4>
<p>The user may also specify any ion with the following syntax:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">beam</span><span class="p">,</span> <span class="n">particle</span><span class="o">=</span><span class="s2">&quot;ion A Z&quot;</span><span class="p">;</span>
</pre></div>
</div>
<p>or:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">beam</span><span class="p">,</span> <span class="n">particle</span><span class="o">=</span><span class="s2">&quot;ion A Z Q&quot;</span><span class="p">;</span>
</pre></div>
</div>
<p>where <cite>A</cite>, <cite>Z</cite> and <cite>Q</cite> should be replaced by the atomic mass number (an integer),
the number of protons in the nucleus, and the charge respectively. The charge is
optional and by default is Z (i.e. a fully ionised ion).  For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">beam</span><span class="p">,</span> <span class="n">particle</span><span class="o">=</span><span class="s2">&quot;ion 12 6&quot;</span><span class="p">,</span>
      <span class="n">energy</span> <span class="o">=</span> <span class="mi">52</span> <span class="o">*</span> <span class="n">GeV</span><span class="p">;</span>
</pre></div>
</div>
<ul class="simple">
<li><p>The user should take care to use a physics list that includes ion physics processes.</p></li>
</ul>
<p>Available input distributions and their associated parameters are described in the following
section.</p>
</section>
</section>
<section id="different-beam-and-design-particles">
<h3>Different Beam and Design Particles<a class="headerlink" href="#different-beam-and-design-particles" title="Link to this heading"></a></h3>
<p>The model may use one particle for design and one for the beam distribution. The “design” particle
is used to calculate the rigidity that is used along with normalised field strengths (such as
<code class="code docutils literal notranslate"><span class="pre">k1</span></code> for quadrupoles) to calculate an absolute field or field gradient. However, it is
often useful to simulate a beam of other particles.  To specify a different particle, the parameter
<code class="code docutils literal notranslate"><span class="pre">beamParticleName</span></code> should be used. For a different energy or kinetic energy or momentum, (only)
one of <code class="code docutils literal notranslate"><span class="pre">E0</span></code>, <code class="code docutils literal notranslate"><span class="pre">Ek0</span></code>, <code class="code docutils literal notranslate"><span class="pre">P0</span></code> should be used.</p>
<p>Examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">beam</span><span class="p">,</span> <span class="n">particle</span><span class="o">=</span><span class="s2">&quot;e-&quot;</span><span class="p">,</span>
      <span class="n">energy</span><span class="o">=</span><span class="mi">100</span><span class="o">*</span><span class="n">GeV</span><span class="p">,</span>
      <span class="n">beamParticleName</span><span class="o">=</span><span class="s2">&quot;e+&quot;</span><span class="p">;</span>
</pre></div>
</div>
<p>This (above) specifies that the magnet field strengths are calculated with respect to a 100 GeV electron
but the beam fired into the model is a 100 GeV positron beam (along with any other relevant distribution
parameters).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">beam</span><span class="p">,</span> <span class="n">particle</span><span class="o">=</span><span class="s2">&quot;e-&quot;</span><span class="p">,</span>
      <span class="n">energy</span><span class="o">=</span><span class="mi">100</span><span class="o">*</span><span class="n">GeV</span><span class="p">,</span>
      <span class="n">beamParticleName</span><span class="o">=</span><span class="s2">&quot;e+&quot;</span><span class="p">,</span>
      <span class="n">E0</span><span class="o">=</span><span class="mi">20</span><span class="o">*</span><span class="n">GeV</span><span class="p">;</span>
</pre></div>
</div>
<p>This (above) specifies that the magnet field strengths are calculated with respect to a 100 GeV electron
and the beam fired into the model is a 20 GeV positron beam.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">beam</span><span class="p">,</span> <span class="n">particle</span><span class="o">=</span><span class="s2">&quot;e-&quot;</span><span class="p">,</span>
      <span class="n">momentum</span><span class="o">=</span><span class="mf">20.3</span><span class="o">*</span><span class="n">GeV</span><span class="p">,</span>
      <span class="n">beamParticleName</span><span class="o">=</span><span class="s2">&quot;proton&quot;</span><span class="p">;</span>
</pre></div>
</div>
<p>This (above) defines a machine designed with respect to an electron beam with 20.3 GeV of momentum but
uses a beam of protons with the exact same momentum (kinetic energy and total energy are calculated
from this value given the proton’s mass).</p>
<ul class="simple">
<li><p>If no <code class="code docutils literal notranslate"><span class="pre">beamParticleName</span></code> variable is specified, it’s assumed to be the same as <code class="code docutils literal notranslate"><span class="pre">particle</span></code>.</p></li>
<li><p>If no <code class="code docutils literal notranslate"><span class="pre">E0</span></code> variable is specified, it’s assumed to be the same as <code class="code docutils literal notranslate"><span class="pre">energy</span></code>.</p></li>
<li><p>If no <code class="code docutils literal notranslate"><span class="pre">beamParticleName</span></code> is given but one of <code class="code docutils literal notranslate"><span class="pre">E0</span></code>, <code class="code docutils literal notranslate"><span class="pre">Ek0</span></code>, <code class="code docutils literal notranslate"><span class="pre">P0</span></code> are given,
the same particle is assumed as <code class="code docutils literal notranslate"><span class="pre">particle</span></code> but with a different energy.</p></li>
</ul>
</section>
<section id="beam-energy-from-the-command-line">
<h3>Beam Energy From the Command Line<a class="headerlink" href="#beam-energy-from-the-command-line" title="Link to this heading"></a></h3>
<p>The energy of the beam can also be controlled using executable options to override what is provided
in the input GMAD files. The following executable options can be used (with example value of 123.456 GeV):</p>
<ul class="simple">
<li><p><code class="code docutils literal notranslate"><span class="pre">--E0=123.456</span></code></p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">--Ek0=123.456</span></code></p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">--P0=123.456</span></code></p></li>
</ul>
<p>This makes it easy to run many instances of BDSIM with different energies. These update the central
energy / kinetic energy / momentum values of the beam and not the design energy / kinetic energy / momentum
so as not to affect the strength of magnetic fields.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">bdsim</span> <span class="o">--</span><span class="n">file</span><span class="o">=</span><span class="n">target</span><span class="o">.</span><span class="n">gmad</span> <span class="o">--</span><span class="n">outfile</span><span class="o">=</span><span class="n">r1</span> <span class="o">--</span><span class="n">batch</span> <span class="o">--</span><span class="n">ngenerate</span><span class="o">=</span><span class="mi">100</span> <span class="o">--</span><span class="n">Ek0</span><span class="o">=</span><span class="mi">400</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>These executable options do not accept units - only the raw number should be provided
and it must be in GeV.</p>
</div>
</section>
<section id="generate-only-the-input-distribution">
<h3>Generate Only the Input Distribution<a class="headerlink" href="#generate-only-the-input-distribution" title="Link to this heading"></a></h3>
<p>BDSIM can generate only the input distribution and store it to file without creating a model or
running any physics simulation. This is very fast and can be used to verify the input distribution
with a large number of particles (for example, 10k to 100k in under one minute).</p>
<p>BDSIM should be executed with the option <code class="code docutils literal notranslate"><span class="pre">--generatePrimariesOnly</span></code> as described in
<a class="reference internal" href="running.html#executable-options"><span class="std std-ref">Executable Options</span></a>.</p>
<p>This <strong>does not</strong> work for <cite>eventgeneratorfile</cite> and <cite>bdsimsampler</cite> distributions.</p>
<ul class="simple">
<li><p>The exact coordinates generated will not be the same as those generated in a run, even
with the same seed. This is because the physics models will also advanced the random
number generator, where as with <code class="code docutils literal notranslate"><span class="pre">--generatePrimariesOnly</span></code>, only the bunch distribution
generator will. For a large number of primaries (at least 100), the option
<code class="code docutils literal notranslate"><span class="pre">offsetSampleMean</span></code> can be used with Gaussian distributions to pre-generate the coordinates
before the run. In this case, they would be consistent.</p></li>
<li><p>This will not work when using an event generator file. Using an event generator
file requires the particle table in Geant4 be loaded and this can only be done
in a full run where we construct the model. By default, the generate primaries
only option only generates coordinates and does not build a Geant4 model.</p></li>
</ul>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>In a conventional run of BDSIM, after a set of coordinates are generated, a check
is made to ensure the total energy chosen is greater than the rest mass of the
particle. This check is <strong>not</strong> done in the case of <code class="code docutils literal notranslate"><span class="pre">--generatePrimariesOnly</span></code>.
Therefore, it’s possible to generate values of total energy below the rest mass of
the beam particle.</p>
</div>
</section>
<section id="beam-in-output">
<h3>Beam in Output<a class="headerlink" href="#beam-in-output" title="Link to this heading"></a></h3>
<p>All of the beam parameters are stored in the output, as described in <a class="reference internal" href="output.html#output-beam-tree"><span class="std std-ref">Beam Tree</span></a>. The
particle coordinates used in the simulation are stored directly in the Primary branch of the
Event Tree, as described in <a class="reference internal" href="output.html#output-event-tree"><span class="std std-ref">Event Tree</span></a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>These are the exact coordinates supplied to Geant4 at the beginning of the event.
Conceptually, these are ‘local’ coordinates with respect to the start of the beam
line. However, if a finite <cite>S0</cite> is specified, the bunch distribution is transformed
to that location in the World, therefore the coordinates are the <strong>global</strong> ones used.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>For large <cite>S0</cite> in a large model, the particles may be displaced by a large
distance as compared to the size of the beam, e.g. 1km offset for 1um beam.
In this case, the limited precision of the <cite>float</cite> used to store the coordinates
in the output may not show the beam distribution as expected. Internally, double
precision numbers are used so that the beam distribution is accurate. A float typically
has seven significant figures and a double 15.</p>
</div>
</section>
<section id="bunches-and-time-offset">
<span id="beam-bunches"></span><h3>Bunches and Time Offset<a class="headerlink" href="#bunches-and-time-offset" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>This does not apply to <code class="code docutils literal notranslate"><span class="pre">eventgeneratorfile</span></code> and <code class="code docutils literal notranslate"><span class="pre">bdsimsampler</span></code> distributions.</p></li>
</ul>
<p>BDSIM offers the feature to simulate multiple bunches at a fixed frequency. This is done as
a final step after generating the coordinates for a single particle from a bunch distribution.
The user specifies how many particles to generate for one bunch before moving on to the next.
For a given bunch, a global time offset is calculated that is added to the T coordinate of each
particle. The ‘bunches’ all start in the same location. The time added can be expressed as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">T</span> <span class="o">=</span> <span class="n">T0</span> <span class="o">+</span> <span class="n">t</span><span class="o">*</span><span class="n">floor</span><span class="p">(</span><span class="n">EI</span> <span class="o">/</span> <span class="n">eventsPerBunch</span><span class="p">)</span>
</pre></div>
</div>
<p>where <code class="code docutils literal notranslate"><span class="pre">T0</span></code> is the offset specified in the beam distribution, <code class="code docutils literal notranslate"><span class="pre">t</span></code> is the
period of the bunches, <code class="code docutils literal notranslate"><span class="pre">floor</span></code> is the mathematical floor function, <code class="code docutils literal notranslate"><span class="pre">EI</span></code> is the
event index (zero counting) and <cite>eventsPerBunch</cite> is the beam parameter specified in the input.</p>
<p>This does not affect the ‘local’ time of the coordinates (i.e. the lower case t in the
Primary coordinates in the output), but it does affect the ‘global’ time (i.e. the upper
case T in the PrimaryGlobal coordinates in the output), which is the one used to place
the particle in the model at the start of an event.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For BDSIM-generated distributions, 1 event = 1 primary particle.</p>
</div>
<p>Relevant beam parameters:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Option</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>Default</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><cite>bunchFrequency</cite></p></td>
<td><p>Frequency in Hz of bunches</p></td>
<td><p>0 *</p></td>
</tr>
<tr class="row-odd"><td><p><cite>bunchPeriod</cite></p></td>
<td><p>Separation in time (s) of bunches</p></td>
<td><p>0 *</p></td>
</tr>
<tr class="row-even"><td><p><cite>eventsPerBunch</cite></p></td>
<td><p>Number of events to simulate with each bunch index</p></td>
<td><p>0</p></td>
</tr>
</tbody>
</table>
<ul class="simple">
<li><p>* One and only one of <code class="code docutils literal notranslate"><span class="pre">bunchFrequency</span></code> and <code class="code docutils literal notranslate"><span class="pre">bunchPeriod</span></code> must be specified if
<code class="code docutils literal notranslate"><span class="pre">eventsPerBunch</span></code> is greater than 0 which implies we want bunches.</p></li>
</ul>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">beam</span><span class="p">,</span> <span class="n">particle</span><span class="o">=</span><span class="s2">&quot;e-&quot;</span><span class="p">,</span>
      <span class="n">kineticEnergy</span><span class="o">=</span><span class="mi">1</span><span class="o">*</span><span class="n">GeV</span><span class="p">,</span>
      <span class="n">distrType</span><span class="o">=</span><span class="s2">&quot;gauss&quot;</span><span class="p">,</span>
      <span class="n">sigmaX</span><span class="o">=</span><span class="mi">10</span><span class="o">*</span><span class="n">um</span><span class="p">,</span>
      <span class="n">sigmaY</span><span class="o">=</span><span class="mi">10</span><span class="o">*</span><span class="n">um</span><span class="p">,</span>
      <span class="n">sigmaT</span><span class="o">=</span><span class="mi">5</span><span class="o">*</span><span class="n">ps</span><span class="p">,</span>
      <span class="n">bunchFrequency</span><span class="o">=</span><span class="mi">357</span><span class="o">*</span><span class="n">MHz</span><span class="p">,</span>
      <span class="n">eventsPerBunch</span><span class="o">=</span><span class="mi">100</span><span class="p">;</span>
</pre></div>
</div>
<p>This will generate particles in a Gaussian distribution with a sigma in time of 5 picoseconds
and therefore a correlated position in z (e.g. sigma z is around 1.5 mm at the speed of light).
The first 100 particles will be centred on T0, which is 0 s by default. The next hundred will have
a similar x,y,z but will have a time centred on 2.8 ns (1 period of 357 MHz). The local time with
respect to the bunch (and therefore z) will still be randomly generated.</p>
<p>An example can be found in <code class="code docutils literal notranslate"><span class="pre">bdsim/examples/features/beam/bunch-frequency.gmad</span></code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For <code class="code docutils literal notranslate"><span class="pre">--generatePrimariesOnly</span></code> the “event number” will be advanced even though
no events are actually simulated and therefore the time coordinate will be consistent
with a full run of BDSIM.</p>
</div>
</section>
<section id="beam-tilt">
<h3>Beam Tilt<a class="headerlink" href="#beam-tilt" title="Link to this heading"></a></h3>
<p>The possibility exists to rotate the beam after the local curvilinear coordinates are calculated
from one of the following bunch distributions. This is an angle about the local unit Z axis, i.e.
the direction of the beam by default. This is applied <strong>after</strong> the local coordinates are generated
by the bunch distribution and rotates, the x,y and xp,yp coordinates by an angle in radians. The
rotation is in a right-handed coordinate system.</p>
<p>Looking along the direction of the beam, a particle at positive X0 and zero Y0 with a tilt of
positive pi/2 will become zero X0 and finite Y0. Looking along the beam direction, the rotation
is clockwise. This is irrespective of particle charge.</p>
<p>The parameter that controls this is <cite>tilt</cite> in the beam command and is in radians. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">beam</span><span class="p">,</span> <span class="n">particle</span><span class="o">=</span><span class="s2">&quot;e-&quot;</span><span class="p">,</span>
      <span class="n">energy</span><span class="o">=</span><span class="mi">10</span><span class="o">*</span><span class="n">GeV</span><span class="p">,</span>
      <span class="n">distrType</span><span class="o">=</span><span class="s2">&quot;gauss&quot;</span><span class="p">,</span>
      <span class="n">sigmaX</span><span class="o">=</span><span class="mi">100</span><span class="o">*</span><span class="n">um</span><span class="p">,</span>
      <span class="n">sigmaY</span><span class="o">=</span><span class="mi">1</span><span class="o">*</span><span class="n">um</span><span class="p">,</span>
      <span class="n">sigmaXp</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">,</span>
      <span class="n">sigmaYp</span><span class="o">=</span><span class="mf">1e-10</span><span class="p">,</span>
      <span class="n">tilt</span><span class="o">=</span><span class="mf">0.01</span><span class="p">;</span>
</pre></div>
</div>
<p>Here a beam 100 x 1 um is generated as a Gaussian and then rotated by 0.01 radians.</p>
</section>
<section id="beam-distributions">
<span id="id5"></span><h3>Beam Distributions<a class="headerlink" href="#beam-distributions" title="Link to this heading"></a></h3>
<p>The following beam distributions are available in BDSIM</p>
<p><strong>No Variation</strong>
- <a class="reference internal" href="#reference">reference</a> (a ‘pencil’ beam)</p>
<p><strong>Gaussian</strong>
- <a class="reference internal" href="#gaussmatrix">gaussmatrix</a>
- <a class="reference internal" href="#gauss">gauss</a>
- <a class="reference internal" href="#gausstwiss">gausstwiss</a></p>
<p><strong>Uniform Type</strong>
- <a class="reference internal" href="#circle">circle</a>
- <a class="reference internal" href="#square">square</a>
- <a class="reference internal" href="#ring">ring</a>
- <a class="reference internal" href="#eshell">eshell</a>
- <a class="reference internal" href="#sphere">sphere</a>
- <a class="reference internal" href="#box">box</a>
- <a class="reference internal" href="#halo">halo</a>
- <a class="reference internal" href="#halosigma">halosigma</a></p>
<p><strong>Composite</strong>
- <a class="reference internal" href="#composite">composite</a>
- <a class="reference internal" href="#compositespacedirectionenergy">compositespacedirectionenergy</a></p>
<p><strong>File-Based</strong> (see <a class="reference internal" href="#beam-distributions-file-based"><span class="std std-ref">Beam Distributions - File-Based</span></a>)</p>
<ul class="simple">
<li><p><a class="reference internal" href="#userfile">userfile</a></p></li>
<li><p><a class="reference internal" href="#ptc">ptc</a></p></li>
<li><p><a class="reference internal" href="#eventgeneratorfile">eventgeneratorfile</a></p></li>
<li><p><a class="reference internal" href="#bdsimsampler">bdsimsampler</a></p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For <a class="reference internal" href="#gauss">gauss</a>, <a class="reference internal" href="#gaussmatrix">gaussmatrix</a> and <a class="reference internal" href="#gausstwiss">gausstwiss</a>, the beam option <cite>beam, offsetSampleMean=1</cite>
documented in <a class="reference internal" href="#developer-options"><span class="std std-ref">Developer Options</span></a> can be used to pre-generate all particle coordinates and
subtract the sample mean from these, effectively removing any small systematic offset in
the bunch at the beginning of the line. This is used only for optical comparisons currently.</p>
</div>
<section id="reference">
<h4>reference<a class="headerlink" href="#reference" title="Link to this heading"></a></h4>
<p>This is a single particle with the same position and angle defined by the following parameters. The
coordinates are the same for every particle fired using the reference distribution. It is therefore
not likely to be useful to generate a large number of repeated events with this distribution unless
the user wishes to explore the different outcome from the physics processes, which will be different
each time should the particle interact. This distribution may be referred to as a ‘pencil’ distribution
by other codes.</p>
<p>These parameters also act as <strong>central</strong> parameters for all other distributions. For example, a Gaussian
distribution may be defined with the <a class="reference internal" href="#gauss">gauss</a> parameters, but with <cite>X0</cite> set to offset the centroid of the
Gaussian with respect to the reference trajectory. Note: <strong>energy</strong> is <strong>total energy</strong> of the
particle - including the rest mass.</p>
<blockquote>
<div></div></blockquote>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Option</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>Default</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><cite>X0</cite></p></td>
<td><p>Horizontal position [m]</p></td>
<td><p>0</p></td>
</tr>
<tr class="row-odd"><td><p><cite>Y0</cite></p></td>
<td><p>Vertical position [m]</p></td>
<td><p>0</p></td>
</tr>
<tr class="row-even"><td><p><cite>Z0</cite></p></td>
<td><p>Longitudinal position [m]</p></td>
<td><p>0</p></td>
</tr>
<tr class="row-odd"><td><p><cite>S0</cite></p></td>
<td><p>Curvilinear S offset [m]</p></td>
<td><p>0</p></td>
</tr>
<tr class="row-even"><td><p><cite>T0</cite></p></td>
<td><p>Longitudinal position [s]</p></td>
<td><p>0</p></td>
</tr>
<tr class="row-odd"><td><p><cite>Xp0</cite></p></td>
<td><p>Horizontal component momentum of unit vector</p></td>
<td><p>0</p></td>
</tr>
<tr class="row-even"><td><p><cite>Yp0</cite></p></td>
<td><p>Vertical component momentum of unit vector</p></td>
<td><p>0</p></td>
</tr>
<tr class="row-odd"><td><p><cite>E0</cite></p></td>
<td><p>Central total energy of bunch distribution (GeV)</p></td>
<td><p>‘energy’</p></td>
</tr>
<tr class="row-even"><td><p><cite>Ek0</cite></p></td>
<td><p>Central kinetic energy of bunch distribution (GeV)</p></td>
<td><p>*</p></td>
</tr>
<tr class="row-odd"><td><p><cite>P0</cite></p></td>
<td><p>Central momentum of bunch distribution (GeV)</p></td>
<td><p>*</p></td>
</tr>
</tbody>
</table>
<ul class="simple">
<li><p>* Only one of <code class="code docutils literal notranslate"><span class="pre">E0</span></code>, <code class="code docutils literal notranslate"><span class="pre">Ek0</span></code> and <code class="code docutils literal notranslate"><span class="pre">P0</span></code> can be set. The others are calculated from
that value.</p></li>
<li><p><cite>S0</cite> allows the beam to be translated to a certain point in the beam line, where the beam
coordinates are with respect to the curvilinear frame at that point in the beam line.</p></li>
<li><p><cite>S0</cite> and <cite>Z0</cite> cannot both be set - BDSIM will exit with a warning if this conflicting input is given.</p></li>
<li><p>If <cite>S0</cite> is used, the local coordinates are generated and then transformed to that point in the beam line.
Each set of coordinates will be stored in the output under <cite>Primary</cite> (local) and <cite>PrimaryGlobal</cite> (global).</p></li>
</ul>
<p>Examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">beam</span><span class="p">,</span> <span class="n">particle</span> <span class="o">=</span> <span class="s2">&quot;e-&quot;</span><span class="p">,</span>
      <span class="n">energy</span> <span class="o">=</span> <span class="mi">10</span><span class="o">*</span><span class="n">GeV</span><span class="p">,</span>
      <span class="n">distrType</span> <span class="o">=</span> <span class="s2">&quot;reference&quot;</span><span class="p">;</span>
</pre></div>
</div>
<p>Generates a beam with all coordinates=0 at the nominal energy.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">beam</span><span class="p">,</span> <span class="n">particle</span> <span class="o">=</span> <span class="s2">&quot;e-&quot;</span><span class="p">,</span>
      <span class="n">energy</span> <span class="o">=</span> <span class="mi">10</span><span class="o">*</span><span class="n">GeV</span><span class="p">,</span>
      <span class="n">distrType</span> <span class="o">=</span> <span class="s2">&quot;reference&quot;</span><span class="p">,</span>
      <span class="n">X0</span> <span class="o">=</span> <span class="mi">100</span><span class="o">*</span><span class="n">um</span><span class="p">,</span>
      <span class="n">Y0</span> <span class="o">=</span> <span class="mf">3.5</span><span class="o">*</span><span class="n">um</span><span class="p">;</span>
</pre></div>
</div>
<p>Generates a particle with an offset of 100 <span class="math notranslate nohighlight">\(\mu\mathrm{m}\)</span> horizontally and 3.5
<span class="math notranslate nohighlight">\(\mu\mathrm{m}\)</span> vertically.</p>
</section>
<section id="gaussmatrix">
<h4>gaussmatrix<a class="headerlink" href="#gaussmatrix" title="Link to this heading"></a></h4>
<p>Uses the <span class="math notranslate nohighlight">\(N\)</span> dimensional Gaussian generator from <cite>CLHEP</cite>, <cite>CLHEP::RandMultiGauss</cite>. The generator
is initialised by a <span class="math notranslate nohighlight">\(6\times1\)</span> means vector and <span class="math notranslate nohighlight">\(6\times 6\)</span> sigma matrix.</p>
<ul class="simple">
<li><p>All parameters from <a class="reference internal" href="#reference">reference</a> distribution are used as centroids.</p></li>
</ul>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Option</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><cite>sigmaNM</cite></p></td>
<td><p>Sigma matrix element (N,M)</p></td>
</tr>
</tbody>
</table>
<ul class="simple">
<li><p>Only the upper-right half of the matrix and diagonal should be populated, as the
elements are symmetric across the diagonal.</p></li>
<li><p>The coordinates are in order 1:<cite>x</cite> (m), 2:<cite>xp</cite>, 3:<cite>y</cite> (m), 4:<cite>yp</cite>, 5:<cite>t</cite> (s), 6:<cite>E</cite> (GeV).</p></li>
</ul>
<p>The user should take care to ensure they specify a positive definite matrix. BDSIM will
emit an error and stop running if this is not the case.</p>
<p>Examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">beam</span><span class="p">,</span> <span class="n">particle</span> <span class="o">=</span> <span class="s2">&quot;e-&quot;</span><span class="p">,</span>
      <span class="n">energy</span> <span class="o">=</span> <span class="mi">10</span><span class="o">*</span><span class="n">GeV</span><span class="p">,</span>
      <span class="n">distrType</span> <span class="o">=</span> <span class="s2">&quot;gaussmatrix&quot;</span><span class="p">,</span>
      <span class="n">sigma11</span> <span class="o">=</span> <span class="mi">100</span><span class="o">*</span><span class="n">um</span><span class="p">,</span>
      <span class="n">sigma22</span> <span class="o">=</span> <span class="mi">3</span><span class="o">*</span><span class="n">um</span><span class="p">,</span>
      <span class="n">sigma33</span> <span class="o">=</span> <span class="mi">50</span><span class="o">*</span><span class="n">um</span><span class="p">,</span>
      <span class="n">sigma44</span> <span class="o">=</span> <span class="mf">1.4</span><span class="o">*</span><span class="n">um</span><span class="p">,</span>
      <span class="n">sigma55</span> <span class="o">=</span> <span class="mf">1e-12</span>
      <span class="n">sigma66</span> <span class="o">=</span> <span class="mf">1e-4</span><span class="p">,</span>
      <span class="n">sigma12</span> <span class="o">=</span> <span class="mf">1e-2</span><span class="p">,</span>
      <span class="n">sigma34</span> <span class="o">=</span> <span class="mf">1.4e-3</span><span class="p">;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>One should take care in defining, say, sigma16, as this is the covariance of the <cite>x</cite> position
and energy. However, this may be proportional to momentum and not total energy. Note, for such
a <em>correlation</em> between <cite>x</cite> and <cite>E</cite>, other off-diagonal terms in the covariance matrix should
be finite also.</p>
</div>
</section>
<section id="gauss">
<h4>gauss<a class="headerlink" href="#gauss" title="Link to this heading"></a></h4>
<p>Uses the <a class="reference internal" href="#gaussmatrix">gaussmatrix</a> beam generator but with simplified input parameters, as opposed to a complete
beam sigma matrix. This beam distribution has a diagonal <span class="math notranslate nohighlight">\(\sigma\)</span>-matrix and does not allow for
correlations between phase space coordinates, so:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\sigma_{11} &amp; =  \sigma_x^2   \\
\sigma_{22} &amp; =  \sigma_x^{\prime 2}  \\
\sigma_{33} &amp; =  \sigma_y^2   \\
\sigma_{44} &amp; =  \sigma_y^{\prime 2}  \\
\sigma_{55} &amp; =  \sigma_{T}^2 \\
\sigma_{66} &amp; =  \sigma_{E}^2.\end{split}\]</div>
<ul class="simple">
<li><p>The coordinates are in order 1:<cite>x</cite> (m), 2:<cite>xp</cite>, 3:<cite>y</cite> (m), 4:<cite>yp</cite>, 5:<cite>t</cite> (s), 6:<cite>E</cite> (GeV).</p></li>
<li><p>All parameters from <a class="reference internal" href="#reference">reference</a> distribution are used as centroids.</p></li>
<li><p>Either <code class="code docutils literal notranslate"><span class="pre">sigmaE</span></code>, <code class="code docutils literal notranslate"><span class="pre">sigmaEk</span></code> or <code class="code docutils literal notranslate"><span class="pre">sigmaP</span></code> can be specified, but not more than one.</p></li>
</ul>
<p>In the case <code class="code docutils literal notranslate"><span class="pre">sigmaP</span></code> is specified, <code class="code docutils literal notranslate"><span class="pre">sigmaE</span></code> is calculated as follows:</p>
<div class="math notranslate nohighlight">
\[\frac{dE}{E} = (\beta_{Lorentz}^2) \frac{dP}{P}\]</div>
<p>for the beam particle. In the case <code class="code docutils literal notranslate"><span class="pre">sigmaEk</span></code> is specified, <code class="code docutils literal notranslate"><span class="pre">sigmaE</span></code> is calculated
as follows:</p>
<div class="math notranslate nohighlight">
\[\frac{dEk}{Ek} = \frac{E}{Ek} \frac{dE}{E}\]</div>
<p>and <code class="code docutils literal notranslate"><span class="pre">sigmaP</span></code> is subsequently calculated as above from this.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Option</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><cite>sigmaX</cite></p></td>
<td><p>Horizontal Gaussian sigma [m]</p></td>
</tr>
<tr class="row-odd"><td><p><cite>sigmaY</cite></p></td>
<td><p>Vertical Gaussian sigma [m]</p></td>
</tr>
<tr class="row-even"><td><p><cite>sigmaXp</cite></p></td>
<td><p>Sigma of the horizontal component of unit momentum</p></td>
</tr>
<tr class="row-odd"><td><p><cite>sigmaYp</cite></p></td>
<td><p>Sigma of the vertical component of unit momentum</p></td>
</tr>
<tr class="row-even"><td><p><cite>sigmaE</cite></p></td>
<td><p><strong>Relative</strong> energy spread <span class="math notranslate nohighlight">\(\sigma_{E}/E\)</span></p></td>
</tr>
<tr class="row-odd"><td><p><cite>sigmaEk</cite></p></td>
<td><p><strong>Relative</strong> energy spread <span class="math notranslate nohighlight">\(\sigma_{Ek}/Ek\)</span></p></td>
</tr>
<tr class="row-even"><td><p><cite>sigmaP</cite></p></td>
<td><p><strong>Relative</strong> momentum spread <span class="math notranslate nohighlight">\(\sigma_{P}/P\)</span></p></td>
</tr>
<tr class="row-odd"><td><p><cite>sigmaT</cite></p></td>
<td><p>Sigma of the temporal distribution [s]</p></td>
</tr>
</tbody>
</table>
</section>
<section id="gausstwiss">
<h4>gausstwiss<a class="headerlink" href="#gausstwiss" title="Link to this heading"></a></h4>
<p>The beam parameters are defined by the usual Twiss parameters (listed below in full)
<span class="math notranslate nohighlight">\(\alpha\)</span>, <span class="math notranslate nohighlight">\(\beta\)</span> and <span class="math notranslate nohighlight">\(\gamma\)</span>, plus dispersion <span class="math notranslate nohighlight">\(\eta\)</span>, from
which the beam <span class="math notranslate nohighlight">\(\sigma\)</span> -matrix is calculated, using the following equations:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\sigma_{11} &amp; =  \epsilon_x \beta_x + \eta_{x}^{2}\sigma_{P}^{2} \\
\sigma_{12} &amp; = -\epsilon_x \alpha_x + \eta_{x}\eta_{xp}\sigma_{P}^{2}\\
\sigma_{21} &amp; = -\epsilon_x \alpha_x + \eta_{x}\eta_{xp}\sigma_{P}^{2}\\
\sigma_{22} &amp; =  \epsilon_x \gamma_x + \eta_{xp}^{2}\sigma_{P}^{2}\\
\sigma_{33} &amp; =  \epsilon_y \beta_y + \eta_{y}^{2}\sigma_{P}^{2}\\
\sigma_{34} &amp; = -\epsilon_y \alpha_y + \eta_{y}\eta_{yp}\sigma_{P}^{2}\\
\sigma_{43} &amp; = -\epsilon_y \alpha_y + \eta_{y}\eta_{yp}\sigma_{P}^{2}\\
\sigma_{44} &amp; =  \epsilon_y \gamma_y + \eta_{yp}^{2}\sigma_{P}^{2}\\
\sigma_{13} &amp; = \eta_{x}\eta_{y}\sigma_{P}^{2}\\
\sigma_{31} &amp; = \eta_{x}\eta_{y}\sigma_{P}^{2}\\
\sigma_{23} &amp; = \eta_{xp}\eta_{y}\sigma_{P}^{2}\\
\sigma_{32} &amp; = \eta_{xp}\eta_{y}\sigma_{P}^{2}\\
\sigma_{14} &amp; = \eta_{x}\eta_{yp}\sigma_{P}^{2}\\
\sigma_{41} &amp; = \eta_{x}\eta_{yp}\sigma_{P}^{2}\\
\sigma_{24} &amp; = \eta_{xp}\eta_{yp}\sigma_{P}^{2}\\
\sigma_{42} &amp; = \eta_{xp}\eta_{yp}\sigma_{P}^{2}\\
\sigma_{16} &amp; = \eta_{x}\sigma_{P}^{2}\\
\sigma_{61} &amp; = \eta_{x}\sigma_{P}^{2}\\
\sigma_{26} &amp; = \eta_{xp}\sigma_{P}^{2}\\
\sigma_{62} &amp; = \eta_{xp}\sigma_{P}^{2}\\
\sigma_{36} &amp; = \eta_{y}\sigma_{P}^{2}\\
\sigma_{63} &amp; = \eta_{y}\sigma_{P}^{2}\\
\sigma_{46} &amp; = \eta_{yp}\sigma_{P}^{2}\\
\sigma_{64} &amp; = \eta_{yp}\sigma_{P}^{2}\\
\sigma_{55} &amp; = \sigma_{T}^2 \\
\sigma_{66} &amp; = \sigma_{P}^2\end{split}\]</div>
<ul class="simple">
<li><p>All parameters from <a class="reference internal" href="#reference">reference</a> distribution are used as centroids.</p></li>
<li><p><cite>sigmaE</cite> or <cite>sigmaP</cite> may be specified in the beam command and
one is calculated from the other.</p></li>
</ul>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Option</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><cite>emitx</cite></p></td>
<td><p>Horizontal beam core geometric emittance [m rad]</p></td>
</tr>
<tr class="row-odd"><td><p><cite>emity</cite></p></td>
<td><p>Vertical beam core geometric emittance [m rad]</p></td>
</tr>
<tr class="row-even"><td><p><cite>emitnx</cite></p></td>
<td><p>Horizontal beam core normalised emittance [m rad] *</p></td>
</tr>
<tr class="row-odd"><td><p><cite>emitny</cite></p></td>
<td><p>Vertical beam core normalised emittance [m rad] *</p></td>
</tr>
<tr class="row-even"><td><p><cite>betx</cite></p></td>
<td><p>Horizontal beta function [m]</p></td>
</tr>
<tr class="row-odd"><td><p><cite>bety</cite></p></td>
<td><p>Vertical beta function [m]</p></td>
</tr>
<tr class="row-even"><td><p><cite>alfx</cite></p></td>
<td><p>Horizontal alpha function</p></td>
</tr>
<tr class="row-odd"><td><p><cite>alfy</cite></p></td>
<td><p>Vertical alpha function</p></td>
</tr>
<tr class="row-even"><td><p><cite>dispx</cite></p></td>
<td><p>Horizontal dispersion function [m]</p></td>
</tr>
<tr class="row-odd"><td><p><cite>dispy</cite></p></td>
<td><p>Vertical dispersion function [m]</p></td>
</tr>
<tr class="row-even"><td><p><cite>dispxp</cite></p></td>
<td><p>Horizontal angular dispersion function</p></td>
</tr>
<tr class="row-odd"><td><p><cite>dispyp</cite></p></td>
<td><p>Vertical angular dispersion function</p></td>
</tr>
<tr class="row-even"><td><p><cite>sigmaE</cite></p></td>
<td><p>Normalised energy spread</p></td>
</tr>
<tr class="row-odd"><td><p><cite>sigmaP</cite></p></td>
<td><p>Normalised momentum spread</p></td>
</tr>
</tbody>
</table>
<ul class="simple">
<li><p>(*) Only one of <code class="code docutils literal notranslate"><span class="pre">emitx</span></code> or <code class="code docutils literal notranslate"><span class="pre">emitnx</span></code> (similarly in y) can be set.</p></li>
</ul>
</section>
<section id="circle">
<h4>circle<a class="headerlink" href="#circle" title="Link to this heading"></a></h4>
<p>Beam of randomly distributed particles with a uniform distribution within a circle in each
dimension of phase space - <cite>x</cite> &amp; <cite>xp</cite>; <cite>y</cite> &amp; <cite>yp</cite>, <cite>T</cite> &amp; <cite>E</cite> with each uncorrelated.
Each parameter defines the maximum absolute extent in that dimension, i.e. the possible values
<cite>x</cite> values range from <cite>-envelopeR</cite> to <cite>envelopeR</cite> for example. Total
energy is also uniformly distributed between <span class="math notranslate nohighlight">\(\pm\)</span> <cite>envelopeE</cite>. No distribution in <cite>z</cite>.</p>
<ul class="simple">
<li><p>All parameters from <a class="reference internal" href="#reference">reference</a> distribution are used as centroids.</p></li>
</ul>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Option</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><cite>envelopeR</cite></p></td>
<td><p>Maximum radial position from central value</p></td>
</tr>
<tr class="row-odd"><td><p><cite>envelopeRp</cite></p></td>
<td><p>Maximum radial component of unit momentum vector</p></td>
</tr>
<tr class="row-even"><td><p><cite>envelopeT</cite></p></td>
<td><p>Maximum time offset [s]</p></td>
</tr>
<tr class="row-odd"><td><p><cite>envelopeE</cite></p></td>
<td><p>Maximum energy offset [GeV]</p></td>
</tr>
</tbody>
</table>
</section>
<section id="square">
<h4>square<a class="headerlink" href="#square" title="Link to this heading"></a></h4>
<p>Particles are randomly uniformly distributed within a square in each phase space dimension,
i.e. (x,xp) and (y,yp). Each parameter defines the maximum absolute extent in that dimension,
i.e. the possible values <cite>x</cite> values range from <cite>-envelopeX</cite> to <cite>+envelopeX</cite>. The total
energy is also uniformly distributed between <span class="math notranslate nohighlight">\(\pm\)</span> <cite>envelopeE</cite>.</p>
<ul class="simple">
<li><p>All parameters from <a class="reference internal" href="#reference">reference</a> distribution are used as centroids.</p></li>
<li><p>All dimensions are uncorrelated.</p></li>
<li><p>Default values of envelopes are 0.</p></li>
</ul>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Option</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><cite>envelopeX</cite></p></td>
<td><p>Maximum position in X [m]</p></td>
</tr>
<tr class="row-odd"><td><p><cite>envelopeXp</cite></p></td>
<td><p>Maximum component in X of unit momentum vector</p></td>
</tr>
<tr class="row-even"><td><p><cite>envelopeY</cite></p></td>
<td><p>Maximum position in Y [m]</p></td>
</tr>
<tr class="row-odd"><td><p><cite>envelopeYp</cite></p></td>
<td><p>Maximum component in Y of unit momentum vector</p></td>
</tr>
<tr class="row-even"><td><p><cite>envelopeT</cite></p></td>
<td><p>Maximum time offset [s]</p></td>
</tr>
<tr class="row-odd"><td><p><cite>envelopeE</cite></p></td>
<td><p>Maximum energy offset [GeV]</p></td>
</tr>
<tr class="row-even"><td><p><cite>envelopeZ</cite></p></td>
<td><p>(Optional) maximum position in Z [m]</p></td>
</tr>
</tbody>
</table>
<p>Since BDSIM v1.7.0, the behaviour changed so that <cite>z</cite> is uncorrelated with <cite>t</cite>. In the previous
behaviour, <cite>t</cite> was sampled uniformly, then <cite>z</cite> calculated from <span class="math notranslate nohighlight">\(c * t\)</span>. To restore this
behaviour, the parameter <cite>zFromT</cite> can be used. e.g. <code class="code docutils literal notranslate"><span class="pre">beam,</span> <span class="pre">zFromT=1;</span></code>.</p>
<p>Examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">beam</span><span class="p">,</span> <span class="n">particle</span><span class="o">=</span><span class="s2">&quot;e-&quot;</span><span class="p">,</span>
      <span class="n">kineticEnergy</span><span class="o">=</span><span class="mi">1</span><span class="o">*</span><span class="n">GeV</span><span class="p">,</span>
      <span class="n">distrType</span><span class="o">=</span><span class="s2">&quot;square&quot;</span><span class="p">,</span>
      <span class="n">envelopeX</span><span class="o">=</span><span class="mi">1</span><span class="o">*</span><span class="n">cm</span><span class="p">,</span>
      <span class="n">envelopeXp</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">,</span>
      <span class="n">envelopeY</span><span class="o">=</span><span class="mi">1</span><span class="o">*</span><span class="n">cm</span><span class="p">,</span>
      <span class="n">envelopeYp</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">,</span>
      <span class="n">envelopeT</span><span class="o">=</span><span class="mi">10</span><span class="o">*</span><span class="n">ns</span><span class="p">;</span>
</pre></div>
</div>
</section>
<section id="ring">
<h4>ring<a class="headerlink" href="#ring" title="Link to this heading"></a></h4>
<p>The ring distribution randomly and uniformly distributes particles around a circle in <cite>x</cite> and <cite>y</cite>. Then,
for a given x,y the radius is randomly and uniformly in density distributed in that annulus. For
all other parameters, the <a class="reference internal" href="#reference">reference</a> coordinates are used, i.e. <cite>xp</cite>, <cite>yp</cite> etc.</p>
<ul class="simple">
<li><p>All parameters from <a class="reference internal" href="#reference">reference</a> distribution are used as centroids.</p></li>
</ul>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Option</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><cite>Rmin</cite></p></td>
<td><p>Minimum radius in <cite>x</cite> and <cite>y</cite> [m]</p></td>
</tr>
<tr class="row-odd"><td><p><cite>Rmax</cite></p></td>
<td><p>Maximum radius in <cite>x</cite> and <cite>y</cite> [m]</p></td>
</tr>
</tbody>
</table>
<ul class="simple">
<li><p>No variation in <cite>z</cite>, <cite>xp</cite>, <cite>yp</cite>, <cite>t</cite>, <cite>s</cite> and total energy. Only central values.</p></li>
</ul>
</section>
<section id="eshell">
<h4>eshell<a class="headerlink" href="#eshell" title="Link to this heading"></a></h4>
<p>Defines an elliptical annulus in phase space in each dimension that’s uncorrelated.</p>
<ul class="simple">
<li><p>All parameters from <a class="reference internal" href="#reference">reference</a> distribution are used as centroids.</p></li>
</ul>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Option</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><cite>shellX</cite></p></td>
<td><p>Ellipse semi-axis in phase space in horizontal position [m]</p></td>
</tr>
<tr class="row-odd"><td><p><cite>shellXp</cite></p></td>
<td><p>Ellipse semi-axis in phase space in horizontal component of unit
momentum vector</p></td>
</tr>
<tr class="row-even"><td><p><cite>shellY</cite></p></td>
<td><p>Ellipse semi-axis in phase space in vertical position [m]</p></td>
</tr>
<tr class="row-odd"><td><p><cite>shellYp</cite></p></td>
<td><p>Ellipse semi-axis in phase space in vertical momentum</p></td>
</tr>
<tr class="row-even"><td><p><cite>shellXWidth</cite></p></td>
<td><p>Spread of ellipse in phase space in horizontal position [m]</p></td>
</tr>
<tr class="row-odd"><td><p><cite>shellXpWidth</cite></p></td>
<td><p>Spread of ellipse in phase space in horizontal component of unit
momentum vector</p></td>
</tr>
<tr class="row-even"><td><p><cite>shellYWidth</cite></p></td>
<td><p>Spread of ellipse in phase space in vertical position [m]</p></td>
</tr>
<tr class="row-odd"><td><p><cite>shellYpWidth</cite></p></td>
<td><p>Spread of ellipse in phase space in vertical momentum</p></td>
</tr>
<tr class="row-even"><td><p><cite>sigmaE</cite></p></td>
<td><p>Extent of <strong>relative</strong> energy spread in total energy. Uniformly
distributed between <span class="math notranslate nohighlight">\(\pm\)</span> <cite>sigmaE</cite>.</p></td>
</tr>
<tr class="row-odd"><td><p><cite>sigmaEk</cite></p></td>
<td><p>Extent of <strong>relative</strong> energy spread in kinetic energy. Uniformly
distributed between <span class="math notranslate nohighlight">\(\pm\)</span> <cite>sigmaEk</cite>.</p></td>
</tr>
<tr class="row-even"><td><p><cite>sigmaP</cite></p></td>
<td><p>Extent of <strong>relative</strong> energy spread in momentum.
Uniformly distributed between <span class="math notranslate nohighlight">\(\pm\)</span> <cite>sigmaP</cite>.</p></td>
</tr>
</tbody>
</table>
<ul class="simple">
<li><p>Note, ‘relative’ energy spread means normalised (e.g. <code class="code docutils literal notranslate"><span class="pre">sigmaE</span></code> = <span class="math notranslate nohighlight">\(\sigma_{E}/E\)</span>)</p></li>
<li><p>Only one of <code class="code docutils literal notranslate"><span class="pre">sigmaE</span></code>, <code class="code docutils literal notranslate"><span class="pre">sigmaEk</span></code> or <code class="code docutils literal notranslate"><span class="pre">sigmaP</span></code> can be used.</p></li>
<li><p>No variation in <cite>t</cite>, <cite>z</cite>, <cite>s</cite>. Only central values.</p></li>
</ul>
</section>
<section id="sphere">
<h4>sphere<a class="headerlink" href="#sphere" title="Link to this heading"></a></h4>
<p>The <cite>sphere</cite> distribution generates a distribution with a uniform random direction at one location.
Points are randomly and uniformly generated on a sphere that are used in a unit vector for the
momentum direction. This is implemented using <cite>G4RandomDirection</cite>, which in turn uses the
Marsaglia (1972) method.</p>
<ul class="simple">
<li><p><cite>Xp0</cite>, <cite>Yp0</cite>, <cite>Zp0</cite> are ignored.</p></li>
<li><p><cite>X0</cite>, <cite>Y0</cite>, <cite>Z0</cite>, <cite>S0</cite>, <cite>T0</cite> can be used for the position of the source.</p></li>
<li><p>No energy spread.</p></li>
</ul>
<p>If an energy spread is desired, please use a <a class="reference internal" href="#beam-composite"><span class="std std-ref">composite</span></a> distribution.</p>
<p>An example can be found in <cite>bdsim/examples/features/beam/sphere.gmad</cite>. Below is an example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">beam</span><span class="p">,</span> <span class="n">particle</span> <span class="o">=</span> <span class="s2">&quot;proton&quot;</span><span class="p">,</span>
      <span class="n">energy</span> <span class="o">=</span> <span class="mf">1.2</span><span class="o">*</span><span class="n">GeV</span><span class="p">,</span>
      <span class="n">distrType</span> <span class="o">=</span> <span class="s2">&quot;sphere&quot;</span><span class="p">,</span>
      <span class="n">X0</span> <span class="o">=</span> <span class="mi">9</span><span class="o">*</span><span class="n">cm</span><span class="p">,</span>
      <span class="n">Z0</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">m</span><span class="p">;</span>
</pre></div>
</div>
</section>
<section id="box">
<h4>box<a class="headerlink" href="#box" title="Link to this heading"></a></h4>
<p>The <cite>box</cite> distribution generates a uniform random uncorrelated distribution in each variable.
Ultimatley, the 3-vector making the direction <cite>xp</cite>, <cite>yp</cite>, and <cite>zp</cite> is normalised (i.e. unit 1).
This results in an uneven distribution in these variables over the range (cube projected onto sphere).</p>
<ul class="simple">
<li><p>The values will vary from -envelope to +envelope.</p></li>
<li><p><cite>Xp0</cite>, <cite>Yp0</cite>, and <cite>Zp0</cite> are ignored from the reference distribution.</p></li>
</ul>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Option</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><cite>envelopeX</cite></p></td>
<td><p>Maximum position in X [m]</p></td>
</tr>
<tr class="row-odd"><td><p><cite>envelopeXp</cite></p></td>
<td><p>Maximum component in X of unit momentum vector</p></td>
</tr>
<tr class="row-even"><td><p><cite>envelopeY</cite></p></td>
<td><p>Maximum position in Y [m]</p></td>
</tr>
<tr class="row-odd"><td><p><cite>envelopeYp</cite></p></td>
<td><p>Maximum component in Y of unit momentum vector</p></td>
</tr>
<tr class="row-even"><td><p><cite>envelopeZ</cite></p></td>
<td><p>Maximum position in Z [m]</p></td>
</tr>
<tr class="row-odd"><td><p><cite>envelopeZp</cite></p></td>
<td><p>Maximum component in Z of unit momentum vector</p></td>
</tr>
<tr class="row-even"><td><p><cite>envelopeT</cite></p></td>
<td><p>Maximum time offset [s]</p></td>
</tr>
<tr class="row-odd"><td><p><cite>envelopeE</cite></p></td>
<td><p>Maximum energy offset [GeV]</p></td>
</tr>
</tbody>
</table>
</section>
<section id="halo">
<span id="beam-halo-distribution"></span><h4>halo<a class="headerlink" href="#halo" title="Link to this heading"></a></h4>
<p>The halo distribution is effectively a flat phase space with the central beam core removed at
<span class="math notranslate nohighlight">\(\epsilon_{\rm core}\)</span>. The beam core is defined using the standard Twiss parameters described
previously. The implicit general form of a rotated ellipse is</p>
<div class="math notranslate nohighlight">
\[\gamma x^2 + 2\alpha\;x\;x^{\prime} + \beta x^{\prime 2} = \epsilon\]</div>
<p>where the parameters have their usual meanings. A phase space point can be rejected or weighted
depending on the single particle emittance, which is calculated as</p>
<div class="math notranslate nohighlight">
\[\epsilon_{\rm SP} = \gamma x^2 + 2\alpha\;x\;x^{\prime} + \beta x^{\prime 2}\]</div>
<p>if the single particle emittance is less than beam emittance, such that <span class="math notranslate nohighlight">\(\epsilon_{\rm SP} &lt; \epsilon_{\rm core}\)</span>
the particle is rejected. <cite>haloPSWeightFunction</cite> is a string that selects the function
<span class="math notranslate nohighlight">\(f_{\rm haloWeight}(\epsilon_{\rm SP})\)</span> which is 1 at the ellipse defined by <span class="math notranslate nohighlight">\(\epsilon_{\rm core}\)</span>. The
weighting functions are either <cite>flat</cite>, one over emittance <cite>oneoverr</cite> or exponential <cite>exp</cite>.</p>
<div class="math notranslate nohighlight">
\[\begin{split}f_{\rm haloWeight}(\epsilon_{\rm SP}) &amp; = 1 \\
f_{\rm haloWeight}(\epsilon_{\rm SP}) &amp; = \left(\frac{\epsilon_{\rm core}}{\epsilon_{\rm SP}}\right)^p \\
f_{\rm haloWeight}(\epsilon_{\rm SP}) &amp; = \exp\left(-\frac{\epsilon_{SP}-\epsilon_{\rm core}}{p \epsilon_{\rm core}}\right)\end{split}\]</div>
<ul class="simple">
<li><p>All parameters from <a class="reference internal" href="#reference">reference</a> distribution are used as centroids.</p></li>
</ul>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Option</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><cite>emitx</cite></p></td>
<td><p>Horizontal beam core geometric emittance [m rad]
<span class="math notranslate nohighlight">\(\epsilon_{{\rm core},x}\)</span></p></td>
</tr>
<tr class="row-odd"><td><p><cite>emity</cite></p></td>
<td><p>Vertical beam core geometric emittance [m rad]
<span class="math notranslate nohighlight">\(\epsilon_{{\rm core},y}\)</span></p></td>
</tr>
<tr class="row-even"><td><p><cite>emitnx</cite></p></td>
<td><p>Horizontal beam core geometric emittance [m rad] *</p></td>
</tr>
<tr class="row-odd"><td><p><cite>emitny</cite></p></td>
<td><p>Vertical beam core geometric emittance [m rad] *</p></td>
</tr>
<tr class="row-even"><td><p><cite>betx</cite></p></td>
<td><p>Horizontal beta function [m]</p></td>
</tr>
<tr class="row-odd"><td><p><cite>bety</cite></p></td>
<td><p>Vertical beta function [m]</p></td>
</tr>
<tr class="row-even"><td><p><cite>alfx</cite></p></td>
<td><p>Horizontal alpha function</p></td>
</tr>
<tr class="row-odd"><td><p><cite>alfy</cite></p></td>
<td><p>Vertical alpha function</p></td>
</tr>
<tr class="row-even"><td><p><cite>haloNSigmaXInner</cite></p></td>
<td><p>Inner radius of halo in x (multiples of sigma)</p></td>
</tr>
<tr class="row-odd"><td><p><cite>haloNSigmaXOuter</cite></p></td>
<td><p>Outer radius of halo in x (multiples of sigma)</p></td>
</tr>
<tr class="row-even"><td><p><cite>haloNSigmaYInner</cite></p></td>
<td><p>Inner radius of halo in y (multiples of sigma)</p></td>
</tr>
<tr class="row-odd"><td><p><cite>haloNSigmaYOuter</cite></p></td>
<td><p>Outer radius of halo in y (multiples of sigma)</p></td>
</tr>
<tr class="row-even"><td><p><cite>haloPSWeightFunction</cite></p></td>
<td><p>Phase space weight function [string]</p></td>
</tr>
<tr class="row-odd"><td><p><cite>haloPSWeightParameter</cite></p></td>
<td><p>Phase space weight function parameters []</p></td>
</tr>
<tr class="row-even"><td><p><cite>haloXCutInner</cite></p></td>
<td><p>X position inner cut in halo (multiples of sigma)</p></td>
</tr>
<tr class="row-odd"><td><p><cite>haloYCutInner</cite></p></td>
<td><p>Y position inner cut in halo (multiples of sigma)</p></td>
</tr>
<tr class="row-even"><td><p><cite>haloXCutOuter</cite></p></td>
<td><p>X position outer cut in halo (multiples of sigma)</p></td>
</tr>
<tr class="row-odd"><td><p><cite>haloYCutOuter</cite></p></td>
<td><p>Y position outer cut in halo (multiples of sigma)</p></td>
</tr>
<tr class="row-even"><td><p><cite>haloXpCutInner</cite></p></td>
<td><p>X momentum inner cut in halo (multiples of sigma)</p></td>
</tr>
<tr class="row-odd"><td><p><cite>haloYpCutInner</cite></p></td>
<td><p>Y momentum inner cut in halo (multiples of sigma)</p></td>
</tr>
<tr class="row-even"><td><p><cite>haloXpCutOuter</cite></p></td>
<td><p>X momentum outer cut in halo (multiples of sigma)</p></td>
</tr>
<tr class="row-odd"><td><p><cite>haloYpCutOuter</cite></p></td>
<td><p>Y momentum outer cut in halo (multiples of sigma)</p></td>
</tr>
</tbody>
</table>
<ul class="simple">
<li><p>* Only one of <code class="code docutils literal notranslate"><span class="pre">emitx</span></code> or <code class="code docutils literal notranslate"><span class="pre">emitnx</span></code> (similarly in y) can be set.</p></li>
<li><p>No variation in <cite>t</cite>, total energy, <cite>z</cite> and <cite>s</cite>. Only central values.</p></li>
</ul>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">beam</span><span class="p">,</span> <span class="n">particle</span>              <span class="o">=</span> <span class="s2">&quot;e-&quot;</span><span class="p">,</span>
      <span class="n">energy</span>                <span class="o">=</span> <span class="mf">1.0</span><span class="o">*</span><span class="n">GeV</span><span class="p">,</span>
      <span class="n">distrType</span>             <span class="o">=</span> <span class="s2">&quot;halo&quot;</span><span class="p">,</span>
      <span class="n">betx</span>                  <span class="o">=</span> <span class="mf">0.6</span><span class="p">,</span>
      <span class="n">bety</span>                  <span class="o">=</span> <span class="mf">1.2</span><span class="p">,</span>
      <span class="n">alfx</span>                  <span class="o">=</span> <span class="o">-</span><span class="mf">0.023</span><span class="p">,</span>
      <span class="n">alfy</span>                  <span class="o">=</span> <span class="mf">1.3054</span><span class="p">,</span>
      <span class="n">emitx</span>                 <span class="o">=</span> <span class="mf">5e-9</span><span class="p">,</span>
      <span class="n">emity</span>                 <span class="o">=</span> <span class="mf">4e-9</span><span class="p">,</span>
      <span class="n">haloNSigmaXInner</span>      <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span>
      <span class="n">haloNSigmaXOuter</span>      <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
      <span class="n">haloNSigmaYInner</span>      <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span>
      <span class="n">haloNSigmaYOuter</span>      <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
      <span class="n">haloPSWeightParameter</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
      <span class="n">haloPSWeightFunction</span>  <span class="o">=</span> <span class="s2">&quot;oneoverr&quot;</span><span class="p">;</span>
</pre></div>
</div>
</section>
<section id="halosigma">
<h4>halosigma<a class="headerlink" href="#halosigma" title="Link to this heading"></a></h4>
<p>Similar to type <cite>halo</cite> except instead of uniformly sampling <span class="math notranslate nohighlight">\(J\)</span>, the single
particle emittance (action), the particle’s <span class="math notranslate nohighlight">\(n\sigma\)</span> is sampled uniformly
instead. The particle action <span class="math notranslate nohighlight">\(J\)</span> is expressed in terms of the multiple of
sigma, <span class="math notranslate nohighlight">\(n\)</span>, the one-sigma transverse beam size <span class="math notranslate nohighlight">\(\sigma\)</span> and the Twiss
beta function <span class="math notranslate nohighlight">\(\beta\)</span> using</p>
<div class="math notranslate nohighlight">
\[J = (n \sigma)^2 / \beta.\]</div>
<p>This randomly generated action variable, combined with the Twiss parameters
<span class="math notranslate nohighlight">\(\alpha\)</span> and <span class="math notranslate nohighlight">\(\beta\)</span> define an ellipse in phase space.  A point is then
randomly generated on this ellipse to get the position and momentum pair for the
given transverse dimension.  This is useful for situations where beam halo intensity
distributions are expressed in terms of <span class="math notranslate nohighlight">\(\sigma\)</span>, allowing for easier
re-weighting in post-processing.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Option</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><cite>emitx</cite></p></td>
<td><p>Horizontal beam core geometric emittance [m rad]
<span class="math notranslate nohighlight">\(\epsilon_{{\rm core},x}\)</span></p></td>
</tr>
<tr class="row-odd"><td><p><cite>emity</cite></p></td>
<td><p>Vertical beam core geometric emittance [m rad]
<span class="math notranslate nohighlight">\(\epsilon_{{\rm core},y}\)</span></p></td>
</tr>
<tr class="row-even"><td><p><cite>emitnx</cite></p></td>
<td><p>Horizontal beam core geometric emittance [m rad] *</p></td>
</tr>
<tr class="row-odd"><td><p><cite>emitny</cite></p></td>
<td><p>Vertical beam core geometric emittance [m rad] *</p></td>
</tr>
<tr class="row-even"><td><p><cite>betx</cite></p></td>
<td><p>Horizontal beta function [m]</p></td>
</tr>
<tr class="row-odd"><td><p><cite>bety</cite></p></td>
<td><p>Vertical beta function [m]</p></td>
</tr>
<tr class="row-even"><td><p><cite>alfx</cite></p></td>
<td><p>Horizontal alpha function</p></td>
</tr>
<tr class="row-odd"><td><p><cite>alfy</cite></p></td>
<td><p>Vertical alpha function</p></td>
</tr>
<tr class="row-even"><td><p><cite>haloNSigmaXInner</cite></p></td>
<td><p>Inner radius of halo in x (multiples of sigma)</p></td>
</tr>
<tr class="row-odd"><td><p><cite>haloNSigmaXOuter</cite></p></td>
<td><p>Outer radius of halo in x (multiples of sigma)</p></td>
</tr>
<tr class="row-even"><td><p><cite>haloNSigmaYInner</cite></p></td>
<td><p>Inner radius of halo in y (multiples of sigma)</p></td>
</tr>
<tr class="row-odd"><td><p><cite>haloNSigmaYOuter</cite></p></td>
<td><p>Outer radius of halo in y (multiples of sigma)</p></td>
</tr>
</tbody>
</table>
<ul class="simple">
<li><p>(*) <code class="code docutils literal notranslate"><span class="pre">emitx(y)</span></code> and <code class="code docutils literal notranslate"><span class="pre">emitnx(y)</span></code> are provided for the user’s convenience and should not both be set.</p></li>
<li><p>No variation in <cite>t</cite>, total energy, <cite>z</cite> and <cite>s</cite>. Only central values.</p></li>
<li><p>Generating a beam in a dispersive region will result in incorrect optics.</p></li>
</ul>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">beam</span><span class="p">,</span> <span class="n">particle</span>              <span class="o">=</span> <span class="s2">&quot;e-&quot;</span><span class="p">,</span>
      <span class="n">energy</span>                <span class="o">=</span> <span class="mf">1.0</span><span class="o">*</span><span class="n">GeV</span><span class="p">,</span>
      <span class="n">distrType</span>             <span class="o">=</span> <span class="s2">&quot;halosigma&quot;</span><span class="p">,</span>
      <span class="n">betx</span>                  <span class="o">=</span> <span class="mf">9.701136465</span><span class="p">,</span>
      <span class="n">bety</span>                  <span class="o">=</span> <span class="mf">46.95602673</span><span class="p">,</span>
      <span class="n">alfx</span>                  <span class="o">=</span> <span class="o">-</span><span class="mf">0.5542165316</span><span class="p">,</span>
      <span class="n">alfy</span>                  <span class="o">=</span> <span class="mf">2.310858304</span><span class="p">,</span>
      <span class="n">emitx</span>                 <span class="o">=</span> <span class="mf">5e-9</span><span class="p">,</span>
      <span class="n">emity</span>                 <span class="o">=</span> <span class="mf">5e-9</span><span class="p">,</span>
      <span class="n">haloNSigmaXInner</span>      <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
      <span class="n">haloNSigmaXOuter</span>      <span class="o">=</span> <span class="mf">5.0</span><span class="p">,</span>
      <span class="n">haloNSigmaYInner</span>      <span class="o">=</span> <span class="mf">2.0</span><span class="p">,</span>
      <span class="n">haloNSigmaYOuter</span>      <span class="o">=</span> <span class="mf">3.0</span><span class="p">;</span>
</pre></div>
</div>
</section>
<section id="composite">
<span id="beam-composite"></span><h4>composite<a class="headerlink" href="#composite" title="Link to this heading"></a></h4>
<p>The horizontal, vertical and longitudinal phase spaces can be defined independently. The <cite>xDistrType</cite>,
<cite>yDistrType</cite> and <cite>zDistrType</cite> can be selected from all the other beam distribution types. All of the
appropriate parameters need to be defined for each individual distribution.</p>
<ul class="simple">
<li><p>All parameters from <a class="reference internal" href="#reference">reference</a> distribution are used as centroids.</p></li>
<li><p>The default for <cite>xDistrType</cite>, <cite>yDistrType</cite> and <cite>zDistrType</cite> are <cite>reference</cite>.</p></li>
</ul>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p><strong>Variable</strong></p></th>
<th class="head"><p><strong>Description</strong></p></th>
<th class="head"><p><strong>Coordinates Used</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><cite>xDistrType</cite></p></td>
<td><p>Horizontal distribution type</p></td>
<td><p>x,xp,weight</p></td>
</tr>
<tr class="row-odd"><td><p><cite>yDistrType</cite></p></td>
<td><p>Vertical distribution type</p></td>
<td><p>y,yp</p></td>
</tr>
<tr class="row-even"><td><p><cite>zDistrType</cite></p></td>
<td><p>Longitudinal distribution type</p></td>
<td><p>z,zp,s,T,totalEnergy</p></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>It is currently not possible to use two differently specified versions of the same
distribution within the composite distribution, i.e. gaussTwiss (parameter set 1) for x
and gaussTwiss (parameter set 2) for y. They will have the same settings as (for example)
only one betx can be specified.</p>
</div>
<p>Examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">beam</span><span class="p">,</span> <span class="n">particle</span><span class="o">=</span><span class="s2">&quot;proton&quot;</span><span class="p">,</span>
      <span class="n">energy</span><span class="o">=</span><span class="mi">3500</span><span class="o">*</span><span class="n">GeV</span><span class="p">,</span>
      <span class="n">distrType</span><span class="o">=</span><span class="s2">&quot;composite&quot;</span><span class="p">,</span>
      <span class="n">xDistrType</span><span class="o">=</span><span class="s2">&quot;eshell&quot;</span><span class="p">,</span>
      <span class="n">yDistrType</span><span class="o">=</span><span class="s2">&quot;gausstwiss&quot;</span><span class="p">,</span>
      <span class="n">zDistrType</span><span class="o">=</span><span class="s2">&quot;gausstwiss&quot;</span><span class="p">,</span>
      <span class="n">betx</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">m</span><span class="p">,</span>
      <span class="n">bety</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">m</span><span class="p">,</span>
      <span class="n">alfx</span> <span class="o">=</span> <span class="mf">0.00001234</span><span class="p">,</span>
      <span class="n">alfy</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.0005425</span><span class="p">,</span>
      <span class="n">emitx</span> <span class="o">=</span> <span class="mf">1e-9</span><span class="p">,</span>
      <span class="n">emity</span> <span class="o">=</span> <span class="mf">1e-9</span><span class="p">,</span>
      <span class="n">sigmaE</span> <span class="o">=</span> <span class="mf">0.00008836</span><span class="p">,</span>
      <span class="n">sigmaT</span> <span class="o">=</span> <span class="mf">0.00000000001</span><span class="p">,</span>
      <span class="n">shellX</span>  <span class="o">=</span> <span class="mi">150</span><span class="o">*</span><span class="n">um</span><span class="p">,</span>
      <span class="n">shellY</span>  <span class="o">=</span> <span class="mi">103</span><span class="o">*</span><span class="n">um</span><span class="p">,</span>
      <span class="n">shellXp</span> <span class="o">=</span> <span class="mf">1.456e-6</span><span class="p">,</span>
      <span class="n">shellYp</span> <span class="o">=</span> <span class="mf">2.4e-5</span><span class="p">,</span>
      <span class="n">shellXWidth</span> <span class="o">=</span> <span class="mi">10</span><span class="o">*</span><span class="n">um</span><span class="p">,</span>
      <span class="n">shellYWidth</span> <span class="o">=</span> <span class="mi">15</span><span class="o">*</span><span class="n">um</span><span class="p">,</span>
      <span class="n">shellXpWidth</span> <span class="o">=</span> <span class="mf">1e-9</span><span class="p">,</span>
      <span class="n">shellYpWidth</span> <span class="o">=</span> <span class="mi">1</span><span class="n">d</span><span class="o">-</span><span class="mi">9</span><span class="p">;</span>
</pre></div>
</div>
</section>
<section id="compositespacedirectionenergy">
<h4>compositespacedirectionenergy<a class="headerlink" href="#compositespacedirectionenergy" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p>Also accepted <code class="code docutils literal notranslate"><span class="pre">compositesde</span></code>.</p></li>
</ul>
<p>The distribution allows 3 different distributions to be mixed together. One for spatial coordinates,
one for directional, and one for energy &amp; time.</p>
<ul class="simple">
<li><p>All parameters from <a class="reference internal" href="#reference">reference</a> distribution are used as centroids.</p></li>
<li><p>The default for <cite>spaceDistrType</cite>, <cite>directionDistrType</cite> and <cite>energyDistrType</cite> are <cite>reference</cite>.</p></li>
</ul>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p><strong>Variable</strong></p></th>
<th class="head"><p><strong>Description</strong></p></th>
<th class="head"><p><strong>Coordinates Used</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><cite>spaceDistrType</cite></p></td>
<td><p>Spatial distribution type</p></td>
<td><p>x,y,z</p></td>
</tr>
<tr class="row-odd"><td><p><cite>directionDistrType</cite></p></td>
<td><p>Directional distribution type</p></td>
<td><p>xp,yp,zp</p></td>
</tr>
<tr class="row-even"><td><p><cite>energyDistrType</cite></p></td>
<td><p>Energy distribution type</p></td>
<td><p>T,totalEnergy</p></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>It is currently not possible to use two differently specified versions of the same
distribution within the composite distribution, i.e. box (parameter set 1) for x
and box (parameter set 2) for y. They will have the same settings as (for example)
only one betx can be specified.</p>
</div>
<p>Examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">beam</span><span class="p">,</span> <span class="n">particle</span> <span class="o">=</span> <span class="s2">&quot;e-&quot;</span><span class="p">,</span>
      <span class="n">kineticEnergy</span> <span class="o">=</span> <span class="mi">30</span><span class="o">*</span><span class="n">MeV</span><span class="p">,</span>
      <span class="n">distrType</span> <span class="o">=</span> <span class="s2">&quot;compositespacedirectionenergy&quot;</span><span class="p">,</span>
      <span class="n">spaceDistrType</span> <span class="o">=</span> <span class="s2">&quot;box&quot;</span><span class="p">,</span>
      <span class="n">directionDistrType</span> <span class="o">=</span> <span class="s2">&quot;sphere&quot;</span><span class="p">,</span>
      <span class="n">envelopeX</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">cm</span><span class="p">,</span>
      <span class="n">envelopeY</span> <span class="o">=</span> <span class="mi">3</span><span class="o">*</span><span class="n">cm</span><span class="p">,</span>
      <span class="n">envelopeZ</span> <span class="o">=</span> <span class="mi">4</span><span class="o">*</span><span class="n">cm</span><span class="p">;</span>
</pre></div>
</div>
</section>
</section>
<section id="beam-distributions-file-based">
<span id="id6"></span><h3>Beam Distributions - File-Based<a class="headerlink" href="#beam-distributions-file-based" title="Link to this heading"></a></h3>
<p>There are two classes of file-based distributions. Firstly, text file ones - <cite>userfile</cite>
and <cite>ptc</cite> that load one line of coordinates per event. Secondly, there are more complex
ones that can have multiple primaries per event - <cite>eventgeneratorfile</cite> and <cite>bdsimsampler</cite>.</p>
<ul class="simple">
<li><p><a class="reference internal" href="#beam-userfile"><span class="std std-ref">userfile</span></a></p></li>
<li><p><a class="reference internal" href="#beam-ptc"><span class="std std-ref">ptc</span></a></p></li>
<li><p><a class="reference internal" href="#beam-eventgenerator"><span class="std std-ref">eventgeneratorfile</span></a></p></li>
<li><p><a class="reference internal" href="#beam-bdsimsampler"><span class="std std-ref">bdsimsampler</span></a></p></li>
</ul>
<p>The later two have a set of particle filters that can be used to load only certain particles.</p>
<section id="behaviour">
<h4>Behaviour<a class="headerlink" href="#behaviour" title="Link to this heading"></a></h4>
<p>The default behaviour since BDSIM V1.7 is to ‘match’ the file length - i.e. simulate the
number of events as there would be in the file. The default is <strong>not to loop</strong> (i.e. repeat) the file.
However, the user can explicitly request a certain number of events, or that the file is
looped (knowingly introducing potential correlations).</p>
<p>For all the file-based distributions, the following beam options apply.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p><strong>Option</strong></p></th>
<th class="head"><p><strong>Default</strong></p></th>
<th class="head"><p><strong>Description</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><cite>distrFileMatchLength</cite></p></td>
<td><p>1 (true)</p></td>
<td><p>Whether to simulate the number of events
that match the number of entries in the file</p></td>
</tr>
<tr class="row-odd"><td><p><cite>distrFileLoop</cite></p></td>
<td><p>0 (false)</p></td>
<td><p>Whether to loop back to the start of the file</p></td>
</tr>
<tr class="row-even"><td><p><cite>distrFileLoopNTimes</cite></p></td>
<td><p>1</p></td>
<td><p>Number of times to go through the
distribution file in its entirety - a value
greater than 1 is required to repeat the file</p></td>
</tr>
</tbody>
</table>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p><cite>option, ngenerate=N</cite> in input GMAD text will be ignored when a distribution file
is used and the default file matching is turned on. The executable option <cite>–ngenerate=N</cite>
must therefore be used, or file length matching turned off.</p>
</div>
<p><strong>Normal Behaviour - No Looping</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">beam</span><span class="p">,</span> <span class="n">distrType</span><span class="o">=</span><span class="s2">&quot;somedistributionhere...&quot;</span><span class="p">,</span>
      <span class="n">distrFile</span><span class="o">=</span><span class="s2">&quot;somefile.dat&quot;</span><span class="p">;</span>
</pre></div>
</div>
<p>The number of events will be generate as matches number of entries in the file.</p>
<p><strong>NGenerate</strong></p>
<p>To simulate fewer events, we must specify ngenerate as an <strong>executable</strong> option.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">bdsim</span> <span class="o">--</span><span class="n">file</span><span class="o">=</span><span class="n">mymodel_w_generator</span><span class="o">.</span><span class="n">gmad</span> <span class="o">--</span><span class="n">outfile</span><span class="o">=</span><span class="n">r1</span> <span class="o">--</span><span class="n">batch</span> <span class="o">--</span><span class="n">ngenerate</span><span class="o">=</span><span class="mi">3</span>
</pre></div>
</div>
<p>This will generate 3 events, no matter how many are in the file. But it will complain
if the number requested is greater than the number in the file and looping is not turned
on in the input GMAD beam definition.</p>
<p><strong>Loop as Needed up to N Events</strong></p>
<p>We must explicitly turn off file length matching and turn on looping.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">beam</span><span class="p">,</span> <span class="n">distrType</span><span class="o">=</span><span class="s2">&quot;somedistributionhere...&quot;</span><span class="p">,</span>
      <span class="n">distrFile</span><span class="o">=</span><span class="s2">&quot;somefile.dat&quot;</span><span class="p">,</span>
      <span class="n">distrFileMatchLength</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
      <span class="n">distrFileLoop</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>

<span class="n">beam</span><span class="p">,</span> <span class="n">ngenerate</span><span class="o">=</span><span class="mi">100</span><span class="p">;</span>
</pre></div>
</div>
<p>This will generate 100 events and if we assume <cite>somefile.dat</cite> has only say 20 events,
it will be replayed (with different event seeds) 5x.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Looping a file is fine if each event is simulated with a different seed,
which would be the default behaviour. However, if you only loop part of
a file, you may ‘enhance’ the statistics of one set of input coordinates
and may bias the final result.</p>
</div>
<p><strong>Looping the Whole File N Times</strong></p>
<p>We can repeat the same file <cite>N</cite> times. The random engine seed will continue to advance
for the physics so even with the same initial particles or coordinates, a different
outcome will happen according to the physics processes. Therefore, it is useful to
sometimes repeat the same distribution multiple times.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">beam</span><span class="p">,</span> <span class="n">distrType</span><span class="o">=</span><span class="s2">&quot;somedistributionhere...&quot;</span><span class="p">,</span>
      <span class="n">distrFile</span><span class="o">=</span><span class="s2">&quot;somefile.dat&quot;</span><span class="p">,</span>
      <span class="n">distrFileLoopNTimes</span><span class="o">=</span><span class="mi">3</span><span class="p">;</span>
</pre></div>
</div>
<p>This will match the file length and repeat the file 3 times. This is the number of times
the file is ‘played’ through, so a value <strong>greater than 1</strong> is typically required to
repeat the file.</p>
<p><strong>Filtering</strong></p>
<p>With the <cite>eventgenerator</cite> and <cite>bdsimsampler</cite> distributions, we can filter which particles
we load. It is therefore possible to exclude all particles from an event or indeed a file.</p>
<ul class="simple">
<li><p>If all particles from a file are excluded and looping is requested, the file will not loop.</p></li>
<li><p>The number of completely skipped events is recorded in the <cite>Run.Summary.nEventsInFileSkipped</cite>
in the output. See <a class="reference internal" href="output.html#output-structure-run-info"><span class="std std-ref">BDSOutputROOTEventRunInfo</span></a>.</p></li>
<li><p>The number of events in total in the input file is written both to <cite>Run.Summary.nEventsInFile</cite>
and to <cite>Header.nOriginalEvents</cite>.</p></li>
<li><p>If <span class="math notranslate nohighlight">\(nEventsInFileSkiipe &gt; 0\)</span>, then the file will be marked as a “skimmed” file as the
number of output events is less than the number of input events. This is recorded in
<cite>Header.skimmedFile</cite>.</p></li>
<li><p>The header variables described here, will only be recorded in the second entry of the header tree.
The first entry is when the file is opened, and the second at the end of a run. ROOT prevents us
from overwriting the first entry.</p></li>
</ul>
</section>
<section id="userfile">
<span id="beam-userfile"></span><h4>userfile<a class="headerlink" href="#userfile" title="Link to this heading"></a></h4>
<p>The <cite>userfile</cite> distribution allows the user to supply an ASCII text file with particle
coordinates that are white-space separated (i.e. spaces, or tabs). The column names and
the units are specified in an input string in the beam definition.</p>
<p>The file may also be compressed using gzip. Any file with the extension <cite>.gz</cite>
will be automatically decompressed during the run without creating any temporary
files. This is recommended, as compressed ASCII is significantly smaller in size.</p>
<p>Any coordinate not specified is taken from the <a class="reference internal" href="#reference">reference</a> distribution parameters.
For example, if only <cite>x</cite> and <cite>xp</cite> are supplied as columns, the energy will be the
central energy of the design beam particle, <cite>y</cite> will be <cite>Y0</cite>, which is by default 0.</p>
<p>If the number of particles to be generated with ngenerate is greater than the number of
particles defined in the file, the bunch generation will reload the file and read the
particle coordinates from the beginning. A warning will be printed out in this case.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For gzip support, BDSIM must be compiled with GZIP. This is normally sourced
from Geant4 and is on by default.</p>
</div>
<ul class="simple">
<li><p>The lines counted by <cite>nlinesIgnore</cite> are truly ignored whether they are a comment or not.</p></li>
<li><p><cite>nlinesSkip</cite> will skip a number of valid lines (excluding comments or empty lines).</p></li>
<li><p>When the file is looped, the <cite>nlinesIgnore</cite> and <cite>nlinesSkip</cite> are done again.</p></li>
<li><p><strong>tar + gz</strong> will not work. The file must be a single file compressed through gzip only.</p></li>
<li><p>Coordinates not specified are taken from the default <a class="reference internal" href="#reference">reference</a> distribution parameters.</p></li>
<li><p>Lines starting with <cite>#</cite> or <cite>!</cite> will be ignored.</p></li>
<li><p>Comments must be on their own line and are not tolerated after numerical values (i.e. at
the end of a line).</p></li>
<li><p>Empty lines will also be ignored.</p></li>
<li><p>A warning will be printed if the line is shorter than the number of variables specified
in <cite>distrFileFormat</cite> and the event aborted - the simulation safely proceeds to the next event.</p></li>
<li><p>In the beam command, <cite>X0</cite>, <cite>Y0</cite>, <cite>Z0</cite>, <cite>Xp0</cite>, <cite>Yp0</cite>, <cite>S0</cite> may be used for offsets.
In the case of <cite>Xp0</cite> and <cite>Yp0</cite>, these must be relatively small such that
<span class="math notranslate nohighlight">\(((Xp0 + xp)^2 + (Yp0 + yp)^2) &lt; 1)\)</span>.</p></li>
<li><p><strong>Conflicting</strong> parameters cannot be set. Exclusive column sets are <cite>E</cite>, <cite>Ek</cite>, <cite>P</cite>, and also
<cite>z</cite> and <cite>S</cite>. The skip column symbol <cite>-</cite> can be used in <cite>distrFileFormat</cite> to skip the others.</p></li>
<li><p>Ion PDG IDs can be used but only fully ionised ions can currently be used.</p></li>
</ul>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>If the <cite>pdgid</cite> column is specified and the file contains exotic particles, the
<strong>“all_particles”</strong> physics list should be included in the physicsList (see <a class="reference internal" href="#id3">Beam Parameters</a>
and <a class="reference internal" href="#modular-physics-lists">Modular Physics Lists</a>) otherwise exotic events will be aborted. By default,
the particles available without any physics list are those listed in <a class="reference internal" href="#id4">Beam Particle Type</a>.
Aside from the basic particles listed there, other particle definitions are only
available through a relevant physics list. The <cite>all_particles</cite> “physics list”
is a proxy to load their definitions. Note, without decay physics used, unstable
particles will be tracked beyond their normal lifetime.</p>
</div>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Option</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p><strong>Required</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><cite>distrFile</cite></p></td>
<td><p>File path to ASCII data file</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-odd"><td><p><cite>distrFileFormat</cite></p></td>
<td><p>A string that details the column names and units. A
list of token[unit] separated by white space where
unit is optional. See below for tokens and units.</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-even"><td><p><cite>nlinesIgnore</cite></p></td>
<td><p>Number of lines to ignore when reading user bunch
input files (e.g. header lines)</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-odd"><td><p><cite>nlinesSkip</cite></p></td>
<td><p>Number of lines to skip into the file. This is for
number of coordinate lines to skip. This does not
comment or empty lines.</p></td>
<td><p>No</p></td>
</tr>
</tbody>
</table>
<p>Skipping and Ignoring Lines:</p>
<ul class="simple">
<li><p><cite>nlinesIgnore</cite> is intended for header lines to ignore at the start of the file.</p></li>
<li><p><cite>nlinesSkip</cite> is intended for the number of particle coordinate lines to skip after <cite>nlinesIgnore</cite>.</p></li>
<li><p><cite>nlinesSkip</cite> is available as the executable option <code class="code docutils literal notranslate"><span class="pre">--distrFileNLinesSkip</span></code>.</p></li>
<li><p>If more events are generated than are lines in the file, the file is read again including the
ignored and skipped lines.</p></li>
</ul>
<p>Examples:</p>
<ol class="arabic simple">
<li><p><cite>nlinesIgnore=1</cite> and <cite>nlinesSkip=3</cite>. The first line and then the next three non-blank or comment
lines are ignored always in the file.</p></li>
<li><p><cite>nlinesIgnore=1</cite> in the input gmad and <cite>–distrFileNLinesSkip=3</cite> is used as an executable option.
The first line and then the next three non-blank or comment lines are skipped.</p></li>
</ol>
<p>Acceptable tokens for the columns are:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p><strong>Token</strong></p></th>
<th class="head"><p><strong>Description</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>“E”</p></td>
<td><p>Total energy</p></td>
</tr>
<tr class="row-odd"><td><p>“Ek”</p></td>
<td><p>Kinetic energy</p></td>
</tr>
<tr class="row-even"><td><p>“P”</p></td>
<td><p>Momentum</p></td>
</tr>
<tr class="row-odd"><td><p>“t”</p></td>
<td><p>Time</p></td>
</tr>
<tr class="row-even"><td><p>“x”</p></td>
<td><p>Horizontal position</p></td>
</tr>
<tr class="row-odd"><td><p>“y”</p></td>
<td><p>Vertical position</p></td>
</tr>
<tr class="row-even"><td><p>“z”</p></td>
<td><p>Longitudinal position</p></td>
</tr>
<tr class="row-odd"><td><p>“xp”</p></td>
<td><p>Horizontal angle</p></td>
</tr>
<tr class="row-even"><td><p>“yp”</p></td>
<td><p>Vertical angle</p></td>
</tr>
<tr class="row-odd"><td><p>“zp”</p></td>
<td><p>Longitudinal angle</p></td>
</tr>
<tr class="row-even"><td><p>“S”</p></td>
<td><p>Global path length displacement,
not to be used in conjunction with “z”.</p></td>
</tr>
<tr class="row-odd"><td><p>“pdgid”</p></td>
<td><p>PDG particle ID</p></td>
</tr>
<tr class="row-even"><td><p>“w”</p></td>
<td><p>Weight</p></td>
</tr>
<tr class="row-odd"><td><p>“-”</p></td>
<td><p>Skip this column</p></td>
</tr>
</tbody>
</table>
<p><strong>Energy Units</strong>
“eV”, “KeV”, “MeV”, “GeV”, “TeV”</p>
<p><strong>Length Units</strong>
“m, “cm”, “mm”, “mum”, “um”, “nm”</p>
<p><strong>Angle Units</strong>
“rad”, “mrad”, “murad”, “urad”</p>
<p><strong>Time Units</strong>
“s”, “ms”, “mus”, “us”, “ns”, “mm/c”, “nm/c”</p>
<p>Examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">beam</span><span class="p">,</span> <span class="n">particle</span> <span class="o">=</span> <span class="s2">&quot;e-&quot;</span><span class="p">,</span>
      <span class="n">energy</span> <span class="o">=</span> <span class="mi">1</span><span class="o">*</span><span class="n">GeV</span><span class="p">,</span>
      <span class="n">distrType</span>  <span class="o">=</span> <span class="s2">&quot;userfile&quot;</span><span class="p">,</span>
      <span class="n">distrFile</span>  <span class="o">=</span> <span class="s2">&quot;Userbeamdata.dat&quot;</span><span class="p">,</span>
      <span class="n">distrFileFormat</span> <span class="o">=</span> <span class="s2">&quot;x[mum]:xp[mrad]:y[mum]:yp[mrad]:z[cm]:E[MeV]&quot;</span><span class="p">;</span>


<span class="n">beam</span><span class="p">,</span> <span class="n">particle</span> <span class="o">=</span> <span class="s2">&quot;e-&quot;</span><span class="p">,</span>
      <span class="n">energy</span> <span class="o">=</span> <span class="mi">1</span><span class="o">*</span><span class="n">GeV</span><span class="p">,</span>
      <span class="n">distrType</span>  <span class="o">=</span> <span class="s2">&quot;userfile&quot;</span><span class="p">,</span>
      <span class="n">distrFile</span>  <span class="o">=</span> <span class="s2">&quot;Userbeamdata.dat&quot;</span><span class="p">,</span>
      <span class="n">distrFileFormat</span> <span class="o">=</span> <span class="s2">&quot;x[mum]:xp[mrad]:y[mum]:yp[mrad]:z[cm]:E[MeV]&quot;</span><span class="p">,</span>
      <span class="n">distrMatchFileLength</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
      <span class="n">distrFileLoop</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="n">option</span><span class="p">,</span> <span class="n">ngenerate</span><span class="o">=</span><span class="mi">100</span><span class="p">;</span>
</pre></div>
</div>
<p>The corresponding <cite>userbeamdata.dat</cite> file looks like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">0</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">1</span> <span class="mi">0</span> <span class="mi">1000</span>
<span class="mi">0</span> <span class="mi">1</span> <span class="mi">0</span> <span class="mi">1</span> <span class="mi">0</span> <span class="mi">1002</span>
<span class="mi">0</span> <span class="mi">1</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">1003</span>
<span class="mi">0</span> <span class="mi">0</span> <span class="mi">2</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">1010</span>
<span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">2</span> <span class="mi">0</span> <span class="mi">1100</span>
<span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">4</span> <span class="mi">0</span> <span class="mi">1010</span>
<span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">3</span> <span class="mi">0</span> <span class="mi">1010</span>
<span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">4</span> <span class="mi">0</span> <span class="mi">1020</span>
<span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">2</span> <span class="mi">0</span> <span class="mi">1000</span>
</pre></div>
</div>
</section>
<section id="ptc">
<span id="beam-ptc"></span><h4>ptc<a class="headerlink" href="#ptc" title="Link to this heading"></a></h4>
<p>Output from MAD-X PTC used as input for BDSIM.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Option</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><cite>distrFile</cite></p></td>
<td><p>PTC output file</p></td>
</tr>
<tr class="row-odd"><td><p><cite>nlinesSkip</cite></p></td>
<td><p>number of lines to skip into the file irrespective of
their contents</p></td>
</tr>
</tbody>
</table>
<ul class="simple">
<li><p>Reference offsets specified in the gmad file such as <cite>X0</cite> are added to each coordinate.</p></li>
<li><p>The number of raw input lines (without interpretation) skipped is <cite>nlinesIgnore</cite> + <cite>nlinesSkip</cite>.</p></li>
</ul>
</section>
<section id="eventgeneratorfile">
<span id="beam-eventgenerator"></span><h4>eventgeneratorfile<a class="headerlink" href="#eventgeneratorfile" title="Link to this heading"></a></h4>
<p>To use a file from an event generator, the HepMC3 library must be used and BDSIM must be
compiled with respect to it.  See <a class="reference internal" href="installation.html#installation-bdsim-config-options"><span class="std std-ref">Optional Configuration Options</span></a> for more details.</p>
<p>When using an event generator file, the <strong>design</strong> particle and total energy must still be
specified. These are used to calculate the magnetic field strengths.</p>
<p>Per-event weights are not yet supported in BDSIM or rebdsim (the analysis tool) and are
set to 1.0.</p>
<p>The following parameters are used to control the use of an event generator file. These are
implemented as <span class="math notranslate nohighlight">\(&gt;=\)</span> and <span class="math notranslate nohighlight">\(&lt;=\)</span> for <cite>Min</cite> and <cite>Max</cite> respectively. i.e.</p>
<div class="math notranslate nohighlight">
\[[MinW, MaxW] \implies \{ W \in \mathbb{R} : MinW \leq W \leq MaxW \}\]</div>
<p>where <cite>W</cite> is some coordinate.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Option</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>distrType</p></td>
<td><p>This should be “eventgeneratorfile:format” where format
one of the acceptable formats listed below.</p></td>
</tr>
<tr class="row-odd"><td><p>distrFile</p></td>
<td><p>The path to the input file desired</p></td>
</tr>
<tr class="row-even"><td><p>eventGeneratorNEventsSkip</p></td>
<td><p>Number of events to skip in the file</p></td>
</tr>
<tr class="row-odd"><td><p>eventGeneratorMinX</p></td>
<td><p>Minimum x coordinate accepted (m)</p></td>
</tr>
<tr class="row-even"><td><p>eventGeneratorMaxX</p></td>
<td><p>Maximum x coordinate accepted (m)</p></td>
</tr>
<tr class="row-odd"><td><p>eventGeneratorMinY</p></td>
<td><p>Minimum y coordinate accepted (m)</p></td>
</tr>
<tr class="row-even"><td><p>eventGeneratorMaxY</p></td>
<td><p>Maximum y coordinate accepted (m)</p></td>
</tr>
<tr class="row-odd"><td><p>eventGeneratorMinZ</p></td>
<td><p>Minimum z coordinate accepted (m)</p></td>
</tr>
<tr class="row-even"><td><p>eventGeneratorMaxZ</p></td>
<td><p>Maximum z coordinate accepted (m)</p></td>
</tr>
<tr class="row-odd"><td><p>eventGeneratorMinXp</p></td>
<td><p>Minimum xp coordinate accepted (unit momentum -1 : 1)</p></td>
</tr>
<tr class="row-even"><td><p>eventGeneratorMaxXp</p></td>
<td><p>Maximum xp coordinate accepted (unit momentum -1 : 1)</p></td>
</tr>
<tr class="row-odd"><td><p>eventGeneratorMinYp</p></td>
<td><p>Minimum yp coordinate accepted (unit momentum -1 : 1)</p></td>
</tr>
<tr class="row-even"><td><p>eventGeneratorMaxYp</p></td>
<td><p>Maximum yp coordinate accepted (unit momentum -1 : 1)</p></td>
</tr>
<tr class="row-odd"><td><p>eventGeneratorMinZp</p></td>
<td><p>Minimum zp coordinate accepted (unit momentum -1 : 1)</p></td>
</tr>
<tr class="row-even"><td><p>eventGeneratorMaxZp</p></td>
<td><p>Maximum zp coordinate accepted (unit momentum -1 : 1)</p></td>
</tr>
<tr class="row-odd"><td><p>eventGeneratorMinT</p></td>
<td><p>Minimum T coordinate accepted (s)</p></td>
</tr>
<tr class="row-even"><td><p>eventGeneratorMaxT</p></td>
<td><p>Maximum T coordinate accepted (s)</p></td>
</tr>
<tr class="row-odd"><td><p>eventGeneratorMinEk</p></td>
<td><p>Minimum kinetic energy accepted (GeV)</p></td>
</tr>
<tr class="row-even"><td><p>eventGeneratorMaxEk</p></td>
<td><p>Maximum kinetic energy accepted (GeV)</p></td>
</tr>
<tr class="row-odd"><td><p>eventGeneratorParticles</p></td>
<td><p>PDG IDs or names (as per Geant4 exactly) for accepted
particles. White space delimited. If empty all particles
will be accepted, else only the ones specified will.</p></td>
</tr>
<tr class="row-even"><td><p>removeUnstableWithoutDecay</p></td>
<td><p>Boolean of whether to remove particles that are unstable
as per their PDG definition but also don’t have a decay
table by default in Geant4. Default on. These particles
would eventually be killed by Geant4 when they decay but
without producing any secondaries.</p></td>
</tr>
</tbody>
</table>
<table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p>eventGeneratorWarnSkippedParticles</p></td>
<td><p>1 (true) by default. Print a small warning for each
event if any particles loaded were skipped or there
were none suitable at all and the event was skipped.</p></td>
</tr>
</tbody>
</table>
<ul class="simple">
<li><p>The filters are applied <strong>before</strong> any offset is added from the reference distribution, i.e.
in the original coordinates of the event generator file.</p></li>
</ul>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Only particles available through the chosen physics list can be used otherwise they will
not have the correct properties and will <strong>not be</strong> added to the primary vertex and are
simply skipped. The number (if any) that are skipped will be printed out for every event.
We recommend using the physics list <code class="code docutils literal notranslate"><span class="pre">option,</span> <span class="pre">physicsList=&quot;all_particles&quot;;</span></code> to
define all particles without any relevant physics list. This can be used in combination
with other physics lists safely.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>If the executable option <cite>-\-generatePrimariesOnly</cite> is used, the coordinates will
not reflect the loaded event and will only be the reference coordinates. This is
because when this option is used, no Geant4 model is built. The event generator
file loader is significantly different from the other distributions and effectively
replaces the primary generator action. In this case, a small model of only a
drift with <cite>option, worldMaterial=”vacuum”;</cite> is the quickest way to achieve the
same thing.</p>
</div>
<ul class="simple">
<li><p>Compressed ASCII files (such as gzipped) cannot be used as HepMC3 does not support this.</p></li>
</ul>
<p>The following formats are available:</p>
<ul class="simple">
<li><p><cite>hepmc2</cite> - HepMC2 data format</p></li>
<li><p><cite>hepmc3</cite> - HepMC3 data format</p></li>
<li><p><cite>hpe</cite> - HEP EVT format (fortran format)</p></li>
<li><p><cite>root</cite> - HepMC ROOT format (not BDSIM’s)</p></li>
<li><p><cite>treeroot</cite> - HepMC ROOT tree format (not BDSIM’s)</p></li>
<li><p><cite>lhef</cite> - LHEF format files</p></li>
</ul>
<p>These are put together with “eventgeneratorfile” for the <cite>distrType</cite> parameter. e.g.
<code class="code docutils literal notranslate"><span class="pre">distrType=&quot;eventgeneratorfile:hepmc2&quot;;</span></code>.</p>
<p>Examples can be found in <cite>bdsim/examples/features/beam/eventgeneratorfile</cite>. Below are some
examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">option</span><span class="p">,</span> <span class="n">physicsList</span><span class="o">=</span><span class="s2">&quot;g4FTFP_BERT&quot;</span><span class="p">;</span>
<span class="n">beam</span><span class="p">,</span> <span class="n">particle</span> <span class="o">=</span> <span class="s2">&quot;proton&quot;</span><span class="p">,</span>
      <span class="n">energy</span> <span class="o">=</span> <span class="mf">6.5</span><span class="o">*</span><span class="n">TeV</span><span class="p">,</span>
      <span class="n">distrType</span> <span class="o">=</span> <span class="s2">&quot;eventgeneratorfile:hepmc3&quot;</span><span class="p">,</span>
      <span class="n">distrFile</span> <span class="o">=</span> <span class="s2">&quot;/Users/nevay/physics/lhcip1/sample1.dat&quot;</span><span class="p">;</span>
</pre></div>
</div>
<p>For only forward particles:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">beam</span><span class="p">,</span> <span class="n">particle</span> <span class="o">=</span> <span class="s2">&quot;proton&quot;</span><span class="p">,</span>
      <span class="n">energy</span> <span class="o">=</span> <span class="mf">6.5</span><span class="o">*</span><span class="n">TeV</span><span class="p">,</span>
      <span class="n">distrType</span> <span class="o">=</span> <span class="s2">&quot;eventgeneratorfile:hepmc3&quot;</span><span class="p">,</span>
      <span class="n">distrFile</span> <span class="o">=</span> <span class="s2">&quot;/Users/nevay/physics/lhcip1/sample1.dat&quot;</span><span class="p">,</span>
      <span class="n">eventGeneratorMinZp</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
</pre></div>
</div>
<p>For only pions:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">beam</span><span class="p">,</span> <span class="n">particle</span> <span class="o">=</span> <span class="s2">&quot;proton&quot;</span><span class="p">,</span>
      <span class="n">energy</span> <span class="o">=</span> <span class="mf">6.5</span><span class="o">*</span><span class="n">TeV</span><span class="p">,</span>
      <span class="n">distrType</span> <span class="o">=</span> <span class="s2">&quot;eventgeneratorfile:hepmc3&quot;</span><span class="p">,</span>
      <span class="n">distrFile</span> <span class="o">=</span> <span class="s2">&quot;/Users/nevay/physics/lhcip1/sample1.dat&quot;</span><span class="p">,</span>
      <span class="n">eventGeneratorParticles</span><span class="o">=</span><span class="s2">&quot;111 211 -211&quot;</span><span class="p">;</span>
</pre></div>
</div>
</section>
<section id="bdsimsampler">
<span id="beam-bdsimsampler"></span><h4>bdsimsampler<a class="headerlink" href="#bdsimsampler" title="Link to this heading"></a></h4>
<p>Recorded hits in a sampler in a BDSIM ROOT output file can be loaded back into BDSIM
and launched through a model. This does not have to be the same model and the starting
position does not need to be the same.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>By default, the ‘local’ hits in the frame of the sampler are loaded and launched
from wherever the beam central coordinates start (e.g. 0,0,0 with direction 0,0,1).
If you want to continue hits from a sampler, you must include the <cite>S</cite> of that sampler
in the original model as a beam offset.</p>
</div>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Option</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><cite>distrType</cite></p></td>
<td><p>This should be “bdsimsampler:samplername”.</p></td>
</tr>
<tr class="row-odd"><td><p><cite>distrFile</cite></p></td>
<td><p>The path to the input file desired.</p></td>
</tr>
<tr class="row-even"><td><p><cite>distrFileMatchLength</cite></p></td>
<td><p>(1 or 0) Whether to run the number of events as is in the
file. On by default, but ignored if –ngenerate used</p></td>
</tr>
</tbody>
</table>
<ul class="simple">
<li><p>Specify <cite>S</cite> in the beam command to offset the loaded data to the desired position in the beam
line. i.e. the sampler data is not played back globally where it was recorded.</p></li>
<li><p><strong>All</strong> of the parameters of <a class="reference internal" href="#eventgeneratorfile">eventgeneratorfile</a> apply - i.e. all of the cuts and filters
apply to this distribution as well, including <strong>skipping</strong>.</p></li>
<li><p>By default, the length of the file is matched. If some events contain no particles of
interest according to the cuts these events will be skipped. Therefore you might have
fewer events afterwards. Turn off <cite>distrFileMatchLength</cite> to allow looping on the file
to generate more.</p></li>
<li><p>Examples can be found in <code class="code docutils literal notranslate"><span class="pre">bdsim/examples/features/beam/bdsimsampler/*gmad</span></code>.</p></li>
<li><p>Remember, a design particle must still be specified in the beam command for the magnets.</p></li>
</ul>
<p>Examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">beam</span><span class="p">,</span> <span class="n">particle</span><span class="o">=</span><span class="s2">&quot;proton&quot;</span><span class="p">,</span>
      <span class="n">kineticEnergy</span><span class="o">=</span><span class="mi">10</span><span class="o">*</span><span class="n">GeV</span><span class="p">,</span>
      <span class="n">distrType</span><span class="o">=</span><span class="s2">&quot;bdsimsampler:d1_1&quot;</span><span class="p">,</span>
      <span class="n">distrFile</span><span class="o">=</span><span class="s2">&quot;../../data/sample1.root&quot;</span><span class="p">;</span>


<span class="n">beam</span><span class="p">,</span> <span class="n">particle</span><span class="o">=</span><span class="s2">&quot;proton&quot;</span><span class="p">,</span>
      <span class="n">kineticEnergy</span><span class="o">=</span><span class="mi">10</span><span class="o">*</span><span class="n">GeV</span><span class="p">,</span>
      <span class="n">distrType</span><span class="o">=</span><span class="s2">&quot;bdsimsampler:d1_1&quot;</span><span class="p">,</span>
      <span class="n">distrFile</span><span class="o">=</span><span class="s2">&quot;../../data/sample1.root&quot;</span><span class="p">,</span>
      <span class="n">eventGeneratorMinZp</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span>
      <span class="n">eventGeneratorMinEK</span><span class="o">=</span><span class="mf">1.5</span><span class="o">*</span><span class="n">GeV</span><span class="p">,</span>
      <span class="n">eventGeneratorMaxEK</span><span class="o">=</span><span class="mi">1</span><span class="o">*</span><span class="n">TeV</span><span class="p">,</span>
      <span class="n">eventGeneratorParticles</span><span class="o">=</span><span class="s2">&quot;111 211 -211 12 -12 proton&quot;</span><span class="p">;</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The number of events may not match the number in the original file. Any events
in the loaded file with 0 hits in that sampler will be skipped as we are not
permitted (nor do we want to) simulate an empty event with no starting particles.
Events are read until at least 1 particle is found in an event. If an event loaded
has more than one particle, that event will also match 1:1 to the output event.</p>
</div>
</section>
</section>
</section>
<section id="physics-processes">
<span id="id7"></span><h2>Physics Processes<a class="headerlink" href="#physics-processes" title="Link to this heading"></a></h2>
<p>BDSIM can exploit all the physics processes that come with Geant4. It is advantageous to
define <strong>only</strong> the processes required so that the simulation covers the desired outcome
want but is also efficient. Geant4 says, “There is no one model that covers all physics
at all energy ranges.”</p>
<p>By default, only tracking in magnetic fields is provided (e.g. <strong>no</strong> physics) and other
processes must be specified to be used.</p>
<p>Rather than specify each individual particle physics process on a per-particle basis,
a series of “physics lists” are provided that are a predetermined set of physics processes
suitable for a certain application. BDSIM follows the Geant4 ethos in this regard and the
majority of those in BDSIM are simple shortcuts to the Geant4 ones.</p>
<p>There are 3 ways to specify physics lists in BDSIM:</p>
<ol class="arabic">
<li><p>BDSIM’s modular physics lists as described in <a class="reference internal" href="#physics-modular-physics-lists"><span class="std std-ref">Modular Physics Lists</span></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">option</span><span class="p">,</span> <span class="n">physicsList</span> <span class="o">=</span> <span class="s2">&quot;em qgsp_bert&quot;</span><span class="p">;</span>
</pre></div>
</div>
</li>
</ol>
<p>These are modular and can be added independently. BDSIM provides a ‘physics list’ for
a few discrete processes that aren’t covered inside Geant4 reference physics lists such as
crystal channelling and cherenkov radiation. It is possible to create a physics list similar
to a Geant4 reference physics list using BDSIM’s modular approach as internally Geant4 does
the same thing.</p>
<ol class="arabic" start="2">
<li><p>Geant4’s reference physics lists as described in <a class="reference internal" href="#physics-geant4-lists"><span class="std std-ref">Geant4 Reference Physics Lists</span></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">option</span><span class="p">,</span> <span class="n">physicsList</span> <span class="o">=</span> <span class="s2">&quot;g4FTFP_BERT&quot;</span><span class="p">;</span>
</pre></div>
</div>
</li>
</ol>
<p>These are more complete “reference physics lists” that use several modular physics lists from Geant4
like BDSIM but in a predefined way that Geant4 quote for references results. These have rather confusingly
similar names. <code class="code docutils literal notranslate"><span class="pre">ftfp_bert</span></code> causes BDSIM to use <code class="code docutils literal notranslate"><span class="pre">G4HadronPhysicsFTFP_BERT</span></code> whereas
<code class="code docutils literal notranslate"><span class="pre">g4FTFP_BERT</span></code> uses <code class="code docutils literal notranslate"><span class="pre">FTFP_BERT</span></code> in Geant4. We refer the pattern 1) as ‘modular physics lists’
and pattern 2) as Geant4 reference physics lists.</p>
<ol class="arabic" start="3">
<li><p>A <em>complete</em> physics list. This is a custom solution for a particular application that is
hard coded in BDSIM. These all start with ‘complete’. See <a class="reference internal" href="#physics-complete-lists"><span class="std std-ref">Complete Physics Lists</span></a>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">option</span><span class="p">,</span> <span class="n">physicsList</span> <span class="o">=</span> <span class="s2">&quot;completechannelling&quot;</span><span class="p">;</span>
</pre></div>
</div>
</li>
</ol>
<p>For general high energy hadron physics it is recommended to use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">option</span><span class="p">,</span> <span class="n">physicsList</span> <span class="o">=</span> <span class="s2">&quot;g4FTFP_BERT&quot;</span><span class="p">;</span>
</pre></div>
</div>
<p>For similar high-energy studies, but concerned with muons it is recommended to use a <a class="reference internal" href="#physics-macro-file"><span class="std std-ref">Physics Macro File</span></a>
with the following options:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">physics_lists</span><span class="o">/</span><span class="n">em</span><span class="o">/</span><span class="n">GammaToMuons</span> <span class="n">true</span>
<span class="o">/</span><span class="n">physics_lists</span><span class="o">/</span><span class="n">em</span><span class="o">/</span><span class="n">PositronToMuons</span> <span class="n">true</span>
<span class="o">/</span><span class="n">physics_lists</span><span class="o">/</span><span class="n">em</span><span class="o">/</span><span class="n">PositronToHadrons</span> <span class="n">true</span>
<span class="o">/</span><span class="n">physics_lists</span><span class="o">/</span><span class="n">em</span><span class="o">/</span><span class="n">MuonNuclear</span> <span class="n">true</span>
<span class="o">/</span><span class="n">physics_lists</span><span class="o">/</span><span class="n">em</span><span class="o">/</span><span class="n">GammaNuclear</span> <span class="n">true</span>
</pre></div>
</div>
<p>Some physics lists are only available in later versions of Geant4. These are filtered at compile
time for BDSIM and it will not recognise a physics list that requires a later version of Geant4
than BDSIM was compiled with respect to.</p>
<p>A summary of the available physics lists in BDSIM is provided below (others can be easily added
by contacting the developers - see <a class="reference internal" href="support.html#feature-request"><span class="std std-ref">Feature Request</span></a>).</p>
<p>See the Geant4 documentation for a more complete explanation of the physics lists.</p>
<ul class="simple">
<li><p><a class="reference external" href="http://geant4-userdoc.web.cern.ch/geant4-userdoc/UsersGuides/PhysicsListGuide/html/physicslistguide.html">Physics List Guide</a></p></li>
<li><p><a class="reference external" href="http://geant4-userdoc.web.cern.ch/geant4-userdoc/UsersGuides/PhysicsListGuide/html/reference_PL/index.html">User Case Guide</a></p></li>
</ul>
<section id="physics-macro-file">
<span id="id8"></span><h3>Physics Macro File<a class="headerlink" href="#physics-macro-file" title="Link to this heading"></a></h3>
<p>Using the option <code class="code docutils literal notranslate"><span class="pre">geant4PhysicsMacroFileName</span></code> a macro file can be specified that will be executed
and interpreted by Geant4 <strong>after</strong> the construction of the physics list but before the start of the run
(in the INIT state). From <code class="code docutils literal notranslate"><span class="pre">examples/features/processes/macros/physics-em-geant4-macro.gmad</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">option</span><span class="p">,</span> <span class="n">geant4PhysicsMacroFileName</span><span class="o">=</span><span class="s2">&quot;emextraphysics.mac&quot;</span><span class="p">;</span>
</pre></div>
</div>
<p>Inside this file, the following commands were used:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">physics_lists</span><span class="o">/</span><span class="n">em</span><span class="o">/</span><span class="n">GammaToMuons</span> <span class="n">true</span>
<span class="o">/</span><span class="n">physics_lists</span><span class="o">/</span><span class="n">em</span><span class="o">/</span><span class="n">PositronToMuons</span> <span class="n">true</span>
<span class="o">/</span><span class="n">physics_lists</span><span class="o">/</span><span class="n">em</span><span class="o">/</span><span class="n">PositronToHadrons</span> <span class="n">true</span>
<span class="o">/</span><span class="n">physics_lists</span><span class="o">/</span><span class="n">em</span><span class="o">/</span><span class="n">MuonNuclear</span> <span class="n">true</span>
<span class="o">/</span><span class="n">physics_lists</span><span class="o">/</span><span class="n">em</span><span class="o">/</span><span class="n">GammaNuclear</span> <span class="n">true</span>
</pre></div>
</div>
<p>We recommend using the visualiser and interactively exploring the commands there to find suitable ones.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>If this option is defined in a GMAD file that is included in another GMAD file,
it may not be found if BDSIM is executed from a different directory. By default,
BDSIM and Geant4 look for the macro relative to the current working directory. This
may occur when executing BDSIM on a computer cluster for example with a relatively
complex model with many includes. In this case, you should use the executable option
<code class="code docutils literal notranslate"><span class="pre">--geant4PhysicsMacroFileName=&lt;filename&gt;</span></code> as described in <a class="reference internal" href="running.html#running-bdsim"><span class="std std-ref">Running BDSIM</span></a>.</p>
</div>
</section>
<section id="modular-physics-lists">
<span id="physics-modular-physics-lists"></span><h3>Modular Physics Lists<a class="headerlink" href="#modular-physics-lists" title="Link to this heading"></a></h3>
<p>A modular physics list can be made by specifying several physics lists separated by spaces. These
are independent.</p>
<ul class="simple">
<li><p>The strings for the modular physics list are case-insensitive.</p></li>
</ul>
<p>Examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">option</span><span class="p">,</span> <span class="n">physicsList</span><span class="o">=</span><span class="s2">&quot;em ftfp_bert&quot;</span><span class="p">;</span>

<span class="n">option</span><span class="p">,</span> <span class="n">physicsList</span><span class="o">=</span><span class="s2">&quot;em_low decay ion hadron_elastic qgsp_bert em_extra;</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Not all physics lists can be used with all other physics lists. BDSIM will print
a warning and exit if this is the case. Generally, lists suffixed with “hp” should
not be used along with the un-suffixed ones (e.g. “qgsp_bert” and “qgsp_bert_hp” should
not be used together). Similarly, the standard electromagnetic variants should not
be used with the regular “em”.</p>
</div>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p><strong>String to use</strong></p></th>
<th class="head"><p><strong>Description</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
<td><p>Transportation of primary particles only - no scattering in material</p></td>
</tr>
<tr class="row-odd"><td><p>all_particles</p></td>
<td><p>All particles definitions are constructed but no physics processes are
created and attached to them. Useful for exotic beams. Note by default
we only construct the necessary particles. It is more efficient to
keep the particle set to the minimum. This uses G4LeptonConstructor,
G4ShortLivedConstructor, G4MesonConstructor, G4BaryonConstructor and
G4IonConstructor.</p></td>
</tr>
<tr class="row-even"><td><p>annihi_to_mumu</p></td>
<td><p>Only annihilation to a muon pair for positrons is registered.</p></td>
</tr>
<tr class="row-odd"><td><p>charge_exchange</p></td>
<td><p><cite>G4ChargeExchangePhysics</cite></p></td>
</tr>
<tr class="row-even"><td><p>channelling</p></td>
<td><p>This constructs the <cite>G4Channelling</cite> and attaches it to all charged
particles. Note this physics process will only work in crystals. This
alone will not give an accurate representation of the distribution
after a crystal as EM physics is required. Multiple scattering should
not be used in combination with this however to achieve the correct
results. Only available for Geant4 V10.4 onwards.</p></td>
</tr>
<tr class="row-odd"><td><p>cherenkov</p></td>
<td><p>Provides Cherenkov radiation for all charged particles. Issued by the
BDSIM physics builder <cite>BDSPhysicsCherenkov</cite> that provides the process
<cite>G4CherenkovProcess</cite>.</p></td>
</tr>
<tr class="row-even"><td><p>decay</p></td>
<td><p>Provides radioactive decay processes using <cite>G4DecayPhysics</cite>. Crucial
for pion decay for example.</p></td>
</tr>
<tr class="row-odd"><td><p>decay_radioactive</p></td>
<td><p>Radioactive decay of long-lived nuclei. Uses
<cite>G4RadioactiveDecayPhysics</cite>.</p></td>
</tr>
<tr class="row-even"><td><p>decay_muonic_atom</p></td>
<td><p><cite>G4MuonicAtomDecayPhysics</cite>. Available from Geant4.10.3 onwards.</p></td>
</tr>
<tr class="row-odd"><td><p>decay_spin</p></td>
<td><p>Decay physics, but with spin correctly implemented. Note: only the
Geant4 tracking integrators track spin correctly. Uses
<cite>G4SpinDecayPhysics</cite>. Available from Geant4.10.2.p01 onwards.</p></td>
</tr>
<tr class="row-even"><td><p>dna</p></td>
<td><p>G4EmDNAPhysics list.  Only applies to G4_WATER material.</p></td>
</tr>
<tr class="row-odd"><td><p>dna_1</p></td>
<td><p>Variant 1 of G4EmDNAPhysics list. Uses G4EmDNAPhysics_option1.</p></td>
</tr>
<tr class="row-even"><td><p>dna_X</p></td>
<td><p>Variant X of G4EmDNAPhysics list, where X is one of 1,2,3,4,5,6,7.</p></td>
</tr>
<tr class="row-odd"><td><p>em</p></td>
<td><p>Transportation of primary particles, ionisation, Bremsstrahlung,
Cherenkov, multiple scattering. Uses <cite>G4EmStandardPhysics</cite>.</p></td>
</tr>
<tr class="row-even"><td><p>em_extra</p></td>
<td><p>This provides extra electromagnetic models, including muon-nuclear
processes and the Bertini electro-nuclear model. Provided by
<cite>G4EmPhysicsExtra</cite>. Responds to the  option <cite>useLENDGammaNuclear</cite> that
requires the <cite>G4LENDDATA</cite> environmental variable to be set for the
optional LEND data set (see ** below). Additional options described
below also allow different parts of this model to be turned on or off.</p></td>
</tr>
<tr class="row-odd"><td><p>em_gs</p></td>
<td><p><cite>G4EmStandardPhysicsGS</cite>. Available from Geant4.10.2 onwards.</p></td>
</tr>
<tr class="row-even"><td><p>em_livermore</p></td>
<td><p><cite>G4EmLivermorePhysics</cite></p></td>
</tr>
<tr class="row-odd"><td><p>em_livermore_polarised</p></td>
<td><p><cite>G4EmLivermorePolarizedPhysics</cite></p></td>
</tr>
<tr class="row-even"><td><p>em_low_ep</p></td>
<td><p><cite>G4EmLowEPPhysics</cite></p></td>
</tr>
<tr class="row-odd"><td><p>em_penelope</p></td>
<td><p>The same as <cite>em</cite>, but using low-energy electromagnetic models. Uses
<cite>G4EmPenelopePhysics</cite></p></td>
</tr>
<tr class="row-even"><td><p>em_ss</p></td>
<td><p><cite>G4EmStandardPhysicsSS</cite></p></td>
</tr>
<tr class="row-odd"><td><p>em_wvi</p></td>
<td><p><cite>G4EmStandardPhysicsWVI</cite></p></td>
</tr>
<tr class="row-even"><td><p>em_1</p></td>
<td><p><cite>G4EmStandardPhysics_option1</cite></p></td>
</tr>
<tr class="row-odd"><td><p>em_2</p></td>
<td><p><cite>G4EmStandardPhysics_option2</cite></p></td>
</tr>
<tr class="row-even"><td><p>em_3</p></td>
<td><p><cite>G4EmStandardPhysics_option3</cite></p></td>
</tr>
<tr class="row-odd"><td><p>em_4</p></td>
<td><p><cite>G4EmStandardPhysics_option4</cite></p></td>
</tr>
<tr class="row-even"><td><p>ftfp_bert</p></td>
<td><p>Fritiof Precompound Model with Bertini Cascade Model. The FTF model
is based on the FRITIOF description of string excitation and
fragmentation. This is provided by <cite>G4HadronPhysicsFTFP_BERT</cite>. All
FTF physics lists require <cite>G4HadronElasticPhysics</cite> to work correctly.</p></td>
</tr>
<tr class="row-odd"><td><p>ftfp_bert_hp</p></td>
<td><p>Similar to <cite>FTFP_BERT</cite>, but with the high precision neutron package.
This is provided by <cite>G4HadronPhysicsFTFP_BERT_HP</cite>.</p></td>
</tr>
<tr class="row-even"><td><p>gamma_to_mumu</p></td>
<td><p>Only gamma to a muon pair for gammas is registered.</p></td>
</tr>
<tr class="row-odd"><td><p>hadronic_elastic</p></td>
<td><p>Elastic hadronic processes. This is provided by
<cite>G4HadronElasticPhysics.</cite></p></td>
</tr>
<tr class="row-even"><td><p>hadronic_elastic_d</p></td>
<td><p><cite>G4HadronDElasticPhysics</cite></p></td>
</tr>
<tr class="row-odd"><td><p>hadronic_elastic_h</p></td>
<td><p><cite>G4HadronHElasticPhysics</cite></p></td>
</tr>
<tr class="row-even"><td><p>hadronic_elastic_hp</p></td>
<td><p><cite>G4HadronElasticPhysicsHP</cite></p></td>
</tr>
<tr class="row-odd"><td><p>hadronic_elastic_lend (<cite>**</cite>)</p></td>
<td><p><cite>G4HadronElasticPhysicsLEND</cite></p></td>
</tr>
<tr class="row-even"><td><p>hadronic_elastic_xs</p></td>
<td><p><cite>G4HadronElasticPhysicsXS</cite></p></td>
</tr>
<tr class="row-odd"><td><p>ion</p></td>
<td><p><cite>G4IonPhysics</cite></p></td>
</tr>
<tr class="row-even"><td><p>ion_binary (<cite>*</cite>)</p></td>
<td><p><cite>G4IonBinaryCascadePhysics</cite></p></td>
</tr>
<tr class="row-odd"><td><p>ion_elastic</p></td>
<td><p><cite>G4IonElasticPhysics</cite></p></td>
</tr>
<tr class="row-even"><td><p>ion_elastic_qmd</p></td>
<td><p><cite>G4IonQMDPhysics</cite></p></td>
</tr>
<tr class="row-odd"><td><p>ion_em_dissociation</p></td>
<td><p>Electromagnetic dissociation for ions. Uses <cite>G4EMDissociation</cite>. May
produce warnings. Experimental.</p></td>
</tr>
<tr class="row-even"><td><p>ion_inclxx (<cite>*</cite>)</p></td>
<td><p><cite>G4IonINCLXXPhysics</cite></p></td>
</tr>
<tr class="row-odd"><td><p>ion_php (<cite>*</cite>)</p></td>
<td><p><cite>G4IonPhysicsPHP</cite>. Available from Geant4.10.3 onwards.</p></td>
</tr>
<tr class="row-even"><td><p>ionisation</p></td>
<td><p>Only ionisation for e+-, p, pbar, pi+-, K+-, mu+-, generic ion.</p></td>
</tr>
<tr class="row-odd"><td><p>lw</p></td>
<td><p>Laserwire photon producing process as if the laserwire had scattered
photons from the beam. Not actively developed, but will register
process.</p></td>
</tr>
<tr class="row-even"><td><p>muon</p></td>
<td><p>Provides muon production and scattering processes. Be careful if using
with <cite>em_extra</cite> as processes may be double registered. Includes Gamma
to muons, annihilation to muon pair, ‘ee’ to hadrons, pion decay to
muons, multiple scattering for muons, muon Bremsstrahlung, pair
production and Cherenkov light are all provided. Given by BDSIM
physics builder (a la Geant4) <cite>BDSPhysicsMuon</cite>.</p></td>
</tr>
<tr class="row-odd"><td><p>muon_inelastic</p></td>
<td><p>Only hadronic interactions for both muons. Incompatible with
<cite>em_extra</cite> and <cite>muon</cite> physics lists.</p></td>
</tr>
<tr class="row-even"><td><p>neutron_tracking_cut</p></td>
<td><p><cite>G4NeutronTrackingCut</cite> allows neutrons to be killed via their tracking
time (i.e. time of flight) and minimum kinetic energy. These options
are set via the option command, <cite>neutronTimeLimit</cite> (s) and
<cite>neutronKineticEnergyLimit</cite> (GeV).</p></td>
</tr>
<tr class="row-odd"><td><p>optical</p></td>
<td><p>Optical physics processes including absorption, Rayleigh scattering,
Mie scattering, optical boundary processes, scintillation and
Cherenkov. This uses <cite>G4OpticalPhysics</cite> class.</p></td>
</tr>
<tr class="row-even"><td><p>qgsp_bert</p></td>
<td><p>Quark-Gluon String Precompound Model with Bertini Cascade model.
This is based on the <cite>G4HadronPhysicsQGSP_BERT</cite> class and includes
hadronic elastic and inelastic processes. Suitable for high energy
(&gt;10 GeV).</p></td>
</tr>
<tr class="row-odd"><td><p>qgsp_bert_hp</p></td>
<td><p>Similar to <cite>QGSP_BERT</cite>, but with the addition of data-driven high
precision neutron models to transport neutrons below 20 MeV down to
thermal energies. This is provided by <cite>G4HadronPhysicsQGSP_BERT_HP</cite>.</p></td>
</tr>
<tr class="row-even"><td><p>qgsp_bic</p></td>
<td><p>Like <cite>QGSP</cite>, but using Geant4 Binary cascade for primary protons and
neutrons with energies below ~10GeV, thus replacing the use of the LEP
model for protons and neutrons. In comparison to the LEP model, Binary
cascade better describes production of secondary particles produced
from interactions of protons and neutrons with nuclei. This is
provided by <cite>G4HadronPhysicsQGSP_BIC</cite>.</p></td>
</tr>
<tr class="row-odd"><td><p>qgsp_bic_hp</p></td>
<td><p>Similar to <cite>QGSP_BIC</cite>, but with the high precision neutron package.
This is provided by <cite>G4HadronPhysicsQGSP_BIC_HP</cite>.</p></td>
</tr>
<tr class="row-even"><td><p>radioactivation</p></td>
<td><p>Use G4Radioactivation process. Atomic de-excitation disabled for now.
Only available for Geant4 V10.4 onwards.</p></td>
</tr>
<tr class="row-odd"><td><p>shielding</p></td>
<td><p><cite>G4HadronPhysicsShielding</cite>. Inelastic hadron physics suitable for
shielding applications.</p></td>
</tr>
<tr class="row-even"><td><p>shielding_lend  (<cite>**</cite>)</p></td>
<td><p><cite>G4HadronPhysicsShieldingLEND</cite>. Similar to <cite>shielding</cite>, but requires
LEND data set for low-energy neutrons. Available from Geant4.10.4
onwards.</p></td>
</tr>
<tr class="row-odd"><td><p>stopping</p></td>
<td><p><cite>G4StoppingPhysics</cite>. Hadronic physics for stopping particles.</p></td>
</tr>
<tr class="row-even"><td><p>synch_rad</p></td>
<td><p>Provides synchrotron radiation for all charged particles. Provided by
BDSIM physics builder <cite>BDSPhysicsSynchRad</cite> that provides the process
<cite>G4SynchrotronRadiation</cite>.</p></td>
</tr>
<tr class="row-odd"><td><p>xray_reflection</p></td>
<td><p>X-ray reflection for most materials. Available from Geant4.11.2
onwards.</p></td>
</tr>
</tbody>
</table>
<p>The following are also accepted as aliases to current physics lists. These are typically previously
used names.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p><strong>Physics List</strong></p></th>
<th class="head"><p><strong>Alias To</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>cerenkov</p></td>
<td><p>cherenkov</p></td>
</tr>
<tr class="row-odd"><td><p>em_low</p></td>
<td><p>em_penelope</p></td>
</tr>
<tr class="row-even"><td><p>hadronic</p></td>
<td><p>ftfp_bert</p></td>
</tr>
<tr class="row-odd"><td><p>hadronic_hp</p></td>
<td><p>ftfp_bert_hp</p></td>
</tr>
<tr class="row-even"><td><p>ionbinary</p></td>
<td><p>ion_binary</p></td>
</tr>
<tr class="row-odd"><td><p>ioninclxx</p></td>
<td><p>ion_inclxx</p></td>
</tr>
<tr class="row-even"><td><p>ionphp</p></td>
<td><p>ion_php</p></td>
</tr>
<tr class="row-odd"><td><p>spindecay</p></td>
<td><p>decay_spin</p></td>
</tr>
<tr class="row-even"><td><p>synchrad</p></td>
<td><p>synch_rad</p></td>
</tr>
</tbody>
</table>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>(*) These physics lists require the optional high-precision data from Geant4. The user should
download this data from the Geant4 website and install it (for example: extract to
&lt;install-dir&gt;/share/Geant4-10.3.3/data/ beside the other data) and export the environmental
variable <cite>G4PARTICLEHPDATA</cite> to point to this directory.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>(**) These physics lists require the optional LEND data set that can be downloaded
from the Geant4 website. It should be extracted and the environmental variable
<cite>G4LENDDATA</cite> set to the directory containing it.</p>
</div>
</section>
<section id="em-extra-physics-notes">
<span id="physics-em-extra-notes"></span><h3>em_extra Physics Notes<a class="headerlink" href="#em-extra-physics-notes" title="Link to this heading"></a></h3>
<p>The em_extra model is an interface to <cite>G4EmExtraPhysics</cite> that collects a variety of extra electromagnetic models
together. Not all of these are activated by default. BDSIM provides options to turn these components on and off.
See <a class="reference internal" href="#physics-process-options"><span class="std std-ref">Physics Processes</span></a> for more details on the specific options.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p><strong>Option</strong></p></th>
<th class="head"><p><strong>Minimum Geant4 Version</strong></p></th>
<th class="head"><p><strong>Default</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>useLENDGammaNuclear</p></td>
<td><p>10.4</p></td>
<td><p>Off</p></td>
</tr>
<tr class="row-odd"><td><p>useElectroNuclear</p></td>
<td><p>10.4</p></td>
<td><p>On</p></td>
</tr>
<tr class="row-even"><td><p>useMuonNuclear</p></td>
<td><p>10.2</p></td>
<td><p>On</p></td>
</tr>
<tr class="row-odd"><td><p>useGammaToMuMu</p></td>
<td><p>10.3</p></td>
<td><p>Off</p></td>
</tr>
<tr class="row-even"><td><p>usePositronToMuMu</p></td>
<td><p>10.3</p></td>
<td><p>Off</p></td>
</tr>
<tr class="row-odd"><td><p>usePositronToHadrons</p></td>
<td><p>10.3</p></td>
<td><p>Off</p></td>
</tr>
</tbody>
</table>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">option</span><span class="p">,</span> <span class="n">physicsList</span><span class="o">=</span><span class="s2">&quot;em em_extra&quot;</span><span class="p">,</span>
        <span class="n">useMuonNuclear</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">useGammaToMuMu</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
</pre></div>
</div>
<p>The options will always be accepted by BDSIM if an earlier version of Geant4 is used than supported, however,
these will have no effect.</p>
<p><cite>G4EmExtraPhysics</cite> provides a simple interface to increase the cross-section of some processes. This interface
is not used in BDSIM, as it does not propagate the associated weights correctly. Biasing should be done through
the generic biasing interface with the name of the process (described in the following section), as this will
propagate the weights correctly.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>If you used <code class="code docutils literal notranslate"><span class="pre">em_extra</span></code> and <code class="code docutils literal notranslate"><span class="pre">muon</span></code> modular physics list, extreme care should be
taken in combination with the above options that certain processes are not doubly registered,
which would result in double the rates of those processes.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you use the reference physics list <code class="code docutils literal notranslate"><span class="pre">g4FTFP_BERT</span></code>, this will contain the EM extra physics
but this interface to turn on the extra parts is not applicable. In this case, a physics macro
file should be used (see <a class="reference internal" href="#physics-macro-file"><span class="std std-ref">Physics Macro File</span></a>).</p>
</div>
</section>
<section id="geant4-reference-physics-lists">
<span id="physics-geant4-lists"></span><h3>Geant4 Reference Physics Lists<a class="headerlink" href="#geant4-reference-physics-lists" title="Link to this heading"></a></h3>
<p>BDSIM allows use of the Geant4 reference physics lists directly and more details can be found in the Geant4
documentation:</p>
<ul class="simple">
<li><p><a class="reference external" href="http://geant4-userdoc.web.cern.ch/geant4-userdoc/UsersGuides/PhysicsListGuide/html/physicslistguide.html">Physics List Guide</a></p></li>
<li><p><a class="reference external" href="http://geant4-userdoc.web.cern.ch/geant4-userdoc/UsersGuides/PhysicsListGuide/html/reference_PL/index.html">User Case Guide</a></p></li>
</ul>
<p>Notes:</p>
<ul class="simple">
<li><p>Only one Geant4 reference physics list can be used and it cannot be used in combination
with any modular physics list.</p></li>
<li><p>The range cuts specified with BDSIM options apply by default and the option
<code class="code docutils literal notranslate"><span class="pre">g4PhysicsUseBDSIMRangeCuts</span></code> should be set to 0 (‘off’) to avoid this
if required. The defaults are 1 mm, the same as Geant4.</p></li>
<li><p>If the option <code class="code docutils literal notranslate"><span class="pre">minimumKineticEnergy</span></code> is set to a value greater than 0 (the default), a
physics process will be attached to the Geant4 reference physics list to enforce this cut. This
must be 0 <strong>and</strong> the <code class="code docutils literal notranslate"><span class="pre">g4PhysicsUseBDSIMCutsAndLimits</span></code> option off to <strong>not</strong> use the physics
processes to enforce cuts and limits and therefore achieve the exact reference physics list.
The default is that the <code class="code docutils literal notranslate"><span class="pre">minimumKineticEnergy</span></code> option is 0 and therefore not applied.
Also, by default, <code class="code docutils literal notranslate"><span class="pre">g4PhysicsUseBDSIMCutsAndLimits</span></code> is on (1).</p></li>
</ul>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Turning off all limits (<code class="code docutils literal notranslate"><span class="pre">option,</span> <span class="pre">g4PhysicsUseBDSIMCutsAndLimits=0;</span></code>) may result
in tracking warnings. The events should still proceed
as normal, but Geant4 by default requests step lengths of 10 km or more, which often
break the validity of the accelerator tracking routines. This is unavoidable, hence
why we use the limits by default. BDSIM, by default applies step length limits of 110%
the length of each volume. This should make nominally no difference to our results.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Turning off all limits will break the control required to stop primary particles after
a certain number of turns in circular machines. BDSIM will print out a warning about this
with a short pause in running. Note, by default synchrotron radiation is not included
(too many low energy photons to track) so charged particles never lose energy and can
proceed indefinitely in a circular stable accelerator. Each event terminates when all
particles have left the world or have been tracked down to zero energy. In this case,
this never happens and the simulation will continue indefinitely. Hence, why we introduce
a special terminator volume with dynamic user limits to kill all particles of any energy
after the primary particle has completed the desired number of turns.</p>
</div>
<p>The following reference physics lists are included as of Geant4.10.4.p02. These <strong>must</strong> be
prefixed with “g4” in order to work in BDSIM.</p>
<ul class="simple">
<li><p>FTFP_BERT</p></li>
<li><p>FTFP_BERT_TRV</p></li>
<li><p>FTFP_BERT_ATL</p></li>
<li><p>FTFP_BERT_HP</p></li>
<li><p>FTFQGSP_BERT</p></li>
<li><p>FTFP_INCLXX</p></li>
<li><p>FTFP_INCLXX_HP</p></li>
<li><p>FTF_BIC</p></li>
<li><p>LBE</p></li>
<li><p>QBBC</p></li>
<li><p>QGSP_BERT</p></li>
<li><p>QGSP_BERT_HP</p></li>
<li><p>QGSP_BIC</p></li>
<li><p>QGSP_BIC_HP</p></li>
<li><p>QGSP_BIC_AllHP</p></li>
<li><p>QGSP_FTFP_BERT</p></li>
<li><p>QGSP_INCLXX</p></li>
<li><p>QGSP_INCLXX_HP</p></li>
<li><p>QGS_BIC</p></li>
<li><p>Shielding</p></li>
<li><p>ShieldingLEND</p></li>
<li><p>ShieldingM</p></li>
<li><p>NuBeam</p></li>
</ul>
<p>The <strong>optional</strong> following suffixes may be added to specify the electromagnetic physics variant:</p>
<ul class="simple">
<li><p>_EMV</p></li>
<li><p>_EMX</p></li>
<li><p>_EMY</p></li>
<li><p>_EMZ</p></li>
<li><p>_LIV</p></li>
<li><p>_PEN</p></li>
<li><p>__GS</p></li>
<li><p>__LE</p></li>
<li><p>_WVI</p></li>
<li><p>__SS</p></li>
</ul>
<p>Examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">option</span><span class="p">,</span> <span class="n">physicsList</span><span class="o">=</span><span class="s2">&quot;g4QBBC&quot;</span><span class="p">;</span>

<span class="n">option</span><span class="p">,</span> <span class="n">physicsList</span><span class="o">=</span><span class="s2">&quot;g4QBBC_EMV&quot;</span><span class="p">;</span>

<span class="n">option</span><span class="p">,</span> <span class="n">physicsList</span><span class="o">=</span><span class="s2">&quot;g4FTFP_BERT_PEN&quot;</span><span class="p">,</span>
        <span class="n">g4PhysicsUseBDSIMCutsAndLimits</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
</pre></div>
</div>
<p>This last example turns off the minimum kinetic energy and also the maximum step length
limit which is by default 110% the length of the element. If bad tracking behaviour
is experienced (stuck particles etc.) this should be considered.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">option</span><span class="p">,</span> <span class="n">physicsList</span><span class="o">=</span><span class="s2">&quot;g4FTFP_BERT&quot;</span><span class="p">;</span>
</pre></div>
</div>
<p>This following example will enforce a minimum kinetic energy but also limit the maximum step length
(consequently) to 110% the length of the component and provide more robust tracking.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">option</span><span class="p">,</span> <span class="n">physicsList</span><span class="o">=</span><span class="s2">&quot;g4FTFP_BERT&quot;</span><span class="p">,</span>
        <span class="n">minimumKineticEnergy</span><span class="o">=</span><span class="mi">20</span><span class="o">*</span><span class="n">GeV</span><span class="p">;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>“g4” is not case sensitive but the remainder of the string is. The remainder is passed
to the Geant4 physics list that constructs the appropriate physics list and this is
case sensitive.</p>
</div>
</section>
<section id="complete-physics-lists">
<span id="physics-complete-lists"></span><h3>Complete Physics Lists<a class="headerlink" href="#complete-physics-lists" title="Link to this heading"></a></h3>
<p>These are complete physics lists provided for specialist applications. Currently, only one is provided
for crystal channelling physics. These all begin with “complete”.</p>
<p>These cannot be used in combination with any other physics processes.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p><strong>Physics List</strong></p></th>
<th class="head"><p><strong>Description</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>completechannelling</p></td>
<td><p>Modified em option 4 plus channelling as per the Geant4 example
for crystal channelling. The exact same physics as used in their example.</p></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The range cuts specified with BDSIM options to not apply and cannot be used with a ‘complete’
physics list.</p>
</div>
</section>
<section id="proton-diffraction">
<span id="physics-proton-diffraction"></span><h3>Proton Diffraction<a class="headerlink" href="#proton-diffraction" title="Link to this heading"></a></h3>
<p>Since Geant4.10.5, target and projectile diffractive outcomes from hadronic interactions have been turned
off if one of the participants has A &gt; 10. This has the effect that the spectra of high energy protons
passing through targets of materials above Beryllium in the periodic table have a significantly different
spectrum. This is particularly important for particle accelerator applications where diffractive protons
may go some way through an accelerator due to their very small momentum deviation and cause large energy
deposits far from the target.</p>
<p>In the default Geant4, this is therefore quite wrong. Since v11.1 (inclusive) an option has been added
to <code class="code docutils literal notranslate"><span class="pre">G4HadronicParameters::Instance()</span></code> in Geant4 that allows us to turn back on diffraction. BDSIM
provides the option <code class="code docutils literal notranslate"><span class="pre">restoreFTPFDiffractionForAGreater10</span></code> to use this. In versions of Geant4 earlier
than v11.1, this will have no effect and the original Geant4 code must be patched.</p>
<p>Example syntax:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">option</span><span class="p">,</span> <span class="n">restoreFTPFDiffractionForAGreater10</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
</pre></div>
</div>
<p>This only has an effect when the FTFP hadronic model is used. i.e. with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>! the complete reference physics list from Geant4 including em and decay etc.
option, physicsList=&quot;g4FTFP_BERT&quot;;

! the modular hadronic only physics as turned on by BDSIM
option, physicsList=&quot;ftfp_bert&quot;;
</pre></div>
</div>
<p>A comparison is shown below with this option on and off for a 7TeV proton incident on a 40cm
target of carbon. This example can be found in <code class="code docutils literal notranslate"><span class="pre">bdsim/examples/features/processes/protonDiffraction</span></code>.</p>
<figure class="align-center" id="id19">
<a class="reference internal image-reference" href="_images/proton-diffraction-comparison.pdf"><img alt="_images/proton-diffraction-comparison.pdf" src="_images/proton-diffraction-comparison.pdf" style="width: 80%;" /></a>
<figcaption>
<p><span class="caption-text">The relative change in the momentum of protons immmediately after the target.</span><a class="headerlink" href="#id19" title="Link to this image"></a></p>
</figcaption>
</figure>
<figure class="align-center" id="id20">
<a class="reference internal image-reference" href="_images/proton-diffraction-comparison-zoom.pdf"><img alt="_images/proton-diffraction-comparison-zoom.pdf" src="_images/proton-diffraction-comparison-zoom.pdf" style="width: 80%;" /></a>
<figcaption>
<p><span class="caption-text">The relative change in the momentum of protons immmediately after the target. For a
narrow range close to the nominal momentum (<span class="math notranslate nohighlight">\(\Delta P / P = 0\)</span>).</span><a class="headerlink" href="#id20" title="Link to this image"></a></p>
</figcaption>
</figure>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Although, this is referred to proton diffraction this applies to all nucleons
and therefore will affect ion-ion collisions too.</p>
</div>
</section>
</section>
<section id="physics-biasing">
<span id="id10"></span><h2>Physics Biasing<a class="headerlink" href="#physics-biasing" title="Link to this heading"></a></h2>
<p>BDSIM currently provides a few ways to artificially interfere with the physics processes
to make the desired outcome happen more often. In these cases, the goal is to simulate
the correct physical outcome, but more efficiently in the parameters of interest,
i.e. variance reduction.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If any biasing schemes are used, the <code class="code docutils literal notranslate"><span class="pre">weight</span></code> variable in the output
associated with the variable you are using (e.g. <code class="code docutils literal notranslate"><span class="pre">&lt;sampler_name&gt;.x</span></code> and
<code class="code docutils literal notranslate"><span class="pre">&lt;sampler_name&gt;.weight</span></code>) must be used to regain the correct physical result.</p>
</div>
<p>Schemes are:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#physics-bias-cross-section-biasing"><span class="std std-ref">Cross-Section Biasing</span></a></p></li>
<li><p><a class="reference internal" href="#physics-bias-importance-sampling"><span class="std std-ref">Geometric Importance Sampling</span></a></p></li>
<li><p><a class="reference internal" href="#physics-bias-muon-splitting"><span class="std std-ref">Muon Splitting</span></a></p></li>
</ul>
<section id="cross-section-biasing">
<span id="physics-bias-cross-section-biasing"></span><h3>Cross-Section Biasing<a class="headerlink" href="#cross-section-biasing" title="Link to this heading"></a></h3>
<p>The cross-section for a physics process for a specific particle can be artificially altered
by a numerical scaling factor using cross-section biasing (up or down scaling it). This is
done on a per-particle and per-physics-process basis.  The biasing is defined with the
keyword <strong>xsecbias</strong>, to define a bias ‘object’. This can then be attached to various bits
of the geometry or all of it. This is provided with the Geant4 generic biasing feature.</p>
<p>Geant4 automatically includes the reciprocal of the factor as a weighting, which is
recorded in the BDSIM output as “weight” in each relevant piece of data. Any data
used should be multiplied by the weight to achieve the correct physical result.</p>
<p>Generally, one should understand that Geant4 has particle definitions and physics processes
are attached to these. e.g. “protonElastic” is a physics process that’s attached to the
(unique) definition of a proton. There can be many individual proton tracks, but there is
only one proton definition.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This only works with Geant4 version 10.1 or higher. It does not work Geant4.10.3.X series.</p>
</div>
<ol class="arabic simple">
<li><p>Define a bias object with parameters in following table.</p></li>
<li><p>Use <code class="code docutils literal notranslate"><span class="pre">bias</span></code>, <code class="code docutils literal notranslate"><span class="pre">biasMaterial</span></code> or <code class="code docutils literal notranslate"><span class="pre">biasVacuum</span></code> in an element definition naming the bias object.</p></li>
</ol>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p><strong>Parameter</strong></p></th>
<th class="head"><p><strong>Description</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>name</p></td>
<td><p>Biasing process name</p></td>
</tr>
<tr class="row-odd"><td><p>particle</p></td>
<td><p>Particle that will be biased</p></td>
</tr>
<tr class="row-even"><td><p>proc</p></td>
<td><p>Process(es) to be biased</p></td>
</tr>
<tr class="row-odd"><td><p>xsecfact</p></td>
<td><p>Biasing factor(s) for the process(es)</p></td>
</tr>
<tr class="row-even"><td><p>flag</p></td>
<td><p>Flag which particles are biased for the process(es)
(1=all, 2=primaries, 3=secondaries)</p></td>
</tr>
</tbody>
</table>
<ul class="simple">
<li><p>Particle names should be exactly as they are in Geant4 (case-sensitive). The
best way to find these out is to the run a single event with the desired physics
list and the executable option <code class="code docutils literal notranslate"><span class="pre">--printPhysicsProcesses</span></code>. Also the input option
<code class="code docutils literal notranslate"><span class="pre">option,</span> <span class="pre">physicsVerbose=1;</span></code> will show the primary particle and all physics processes
registered to it by name.</p></li>
<li><p>The process name should be exactly as they are in Geant4 (case-sensitive). Similarly,
the best way to find these names is to run a single event with the desired physics
list using the input option <code class="code docutils literal notranslate"><span class="pre">option,</span> <span class="pre">physicsVerbose=1;</span></code> to see all the names of the
physics processes.</p></li>
<li><p>A special particle name “all” will bias all defined particles. (case-sensitive).</p></li>
<li><p>In the case of an <strong>ion</strong> beam, the particle name should be “GenericIon”. The
biasing will apply to all ions, so the flag should be used to carefully select primary
or secondary or all particles. This is because Geant4 uses the concept of a
generic ion as there are so many possible ions.</p></li>
<li><p>Examples can be found in <code class="code docutils literal notranslate"><span class="pre">bdsim/examples/features/processes/5_biasing</span></code>.</p></li>
<li><p>The option <code class="code docutils literal notranslate"><span class="pre">option,</span> <span class="pre">printPhysicsProcesses=1;</span></code> or executable option
<code class="code docutils literal notranslate"><span class="pre">--printPhysicsProcesses</span></code> will print out all particle names and all
the physics processes registered for each particle. This is useful to get
the exact particle names and process names. We recommend running one event
with the desired physics list, or a complete Geant4 one such as
<code class="code docutils literal notranslate"><span class="pre">option,</span> <span class="pre">physicsList=&quot;g4FTFP_BERT&quot;;</span></code> to see all particles and processes.</p></li>
</ul>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">biasDef1</span><span class="p">:</span> <span class="n">xsecBias</span><span class="p">,</span> <span class="n">particle</span><span class="o">=</span><span class="s2">&quot;e-&quot;</span><span class="p">,</span> <span class="n">proc</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">,</span> <span class="n">xsecfact</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">flag</span><span class="o">=</span><span class="mi">3</span><span class="p">;</span>
<span class="n">biasDef2</span><span class="p">:</span> <span class="n">xsecBias</span><span class="p">,</span> <span class="n">particle</span><span class="o">=</span><span class="s2">&quot;e+&quot;</span><span class="p">,</span> <span class="n">proc</span><span class="o">=</span><span class="s2">&quot;eBrem eIoni msc&quot;</span><span class="p">,</span> <span class="n">xsecfact</span><span class="o">=</span><span class="p">{</span><span class="mi">10</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">},</span> <span class="n">flag</span><span class="o">=</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">};</span>
</pre></div>
</div>
<p>The process can also be attached to a specific element using the keywords <code class="code docutils literal notranslate"><span class="pre">biasVacuum</span></code> or
<code class="code docutils literal notranslate"><span class="pre">biasMaterial</span></code> for the biasing to be attached the vacuum volume or everything outside the
vacuum respectively:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>q1: quadrupole, l=1*m, material=&quot;Iron&quot;, biasVacuum=&quot;biasDef1 biasDef2&quot;; ! uses the process biasDef1 and biasDef2
q2: quadrupole, l=0.5*m, biasMaterial=&quot;biasDef2&quot;;
q3: quadrupole, l=20*cm, k1=0.25, bias=&quot;biasDef1&quot;;
</pre></div>
</div>
<ul class="simple">
<li><p><code class="code docutils literal notranslate"><span class="pre">biasVacuum</span></code> applies to “vacuum” parts of beam line elements, i.e. the
inner volume of a beam pipe only in each component.</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">biasMaterial</span></code> applies to all volumes that are not the vacuum. This includes
the beam pipe itself.</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">bias</span></code> applies to both the bias vacuum and material parts.</p></li>
<li><p>If both <code class="code docutils literal notranslate"><span class="pre">bias</span></code> and one or both of <code class="code docutils literal notranslate"><span class="pre">biasVacuum</span></code> and <code class="code docutils literal notranslate"><span class="pre">biasMaterial</span></code> are used
then the effect is cumulative. <code class="code docutils literal notranslate"><span class="pre">bias</span></code> is just a way to add to both vacuum and material.</p></li>
<li><p>The “vacuum” here is conceptual, it is not labelled based on material, e.g. you
could set <cite>beampipeMaterial</cite> to “G4_WATER” to have a water filled beam pipe,
but <code class="code docutils literal notranslate"><span class="pre">biasVaccum</span></code> would apply to this volume.</p></li>
<li><p>If externally provided geometry is used with an <cite>element</cite> beam line element, the ‘vacuum’
<strong>logical</strong> volumes can be labelled as such with <code class="code docutils literal notranslate"><span class="pre">namedVacuumVolumes</span></code> in the individual beam
line element definition. See <a class="reference internal" href="model_construction.html#element"><span class="std std-ref">element</span></a> for more detail.</p></li>
</ul>
<p>Defaults can be set with the options <code class="code docutils literal notranslate"><span class="pre">defaultBiasVacuum</span></code> and <code class="code docutils literal notranslate"><span class="pre">defaultBiasMaterial</span></code>. Only
in the case where a beam line element has no biasing specified will these bias objects be applied.
They will not be mixed with per-element definitions.</p>
<ul class="simple">
<li><p>The world logical volume (only, i.e. excluding any daughters) can be biased with the option
<code class="code docutils literal notranslate"><span class="pre">biasForWorldVolume</span></code>.</p></li>
<li><p>The world daughter volumes that are not beam line components in the case of an externally provided
world geometry file can be biased with the option <code class="code docutils literal notranslate"><span class="pre">biasForWorldContents</span></code>.</p></li>
</ul>
</section>
<section id="geometric-importance-sampling">
<span id="physics-bias-importance-sampling"></span><h3>Geometric Importance Sampling<a class="headerlink" href="#geometric-importance-sampling" title="Link to this heading"></a></h3>
<p>To enable importance sampling, the user must provide both a mass world and a separate importance
sampling world as external geometry files. The mass world file should contain the appropriate
volumes as if you were conducting a standard simulation without importance sampling. The
importance world file should contain the volumes that will be the importance cells only. A
third text file must also be provided which contains a map of the physical volumes that form
the importance cells and their corresponding importance volumes.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p><strong>Parameter</strong></p></th>
<th class="head"><p><strong>Description</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>worldGeometryFile</p></td>
<td><p>Geometry file containing the mass world</p></td>
</tr>
<tr class="row-odd"><td><p>importanceWorldGeometryFile</p></td>
<td><p>Geometry file containing the importance sampling world</p></td>
</tr>
<tr class="row-even"><td><p>importanceVolumeMap</p></td>
<td><p>ASCII file containing a map of the importance world
physical volumes and their corresponding importance values</p></td>
</tr>
</tbody>
</table>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">option</span><span class="p">,</span> <span class="n">worldGeometryFile</span><span class="o">=</span><span class="s2">&quot;gdml:shielding-world.gdml&quot;</span><span class="p">,</span>
        <span class="n">importanceWorldGeometryFile</span><span class="o">=</span><span class="s2">&quot;gdml:importance-cell-world.gdml&quot;</span><span class="p">,</span>
        <span class="n">importanceVolumeMap</span><span class="o">=</span><span class="s2">&quot;importanceValues.dat&quot;</span><span class="p">;</span>
</pre></div>
</div>
<p>An example of the world volume geometry (top), the importance sampling world geometry (middle), and
an importance volume map (bottom) are shown below with an example beamline.</p>
<p>In the output a new branch in the event tree calls “ElossWorldContents” is automatically added
when using importance sampling. This is the global energy deposition hits from any volumes
that were in the externally supplied world - such as shielding blocks. This distinguishes
the energy deposition in the world volume itself (i.e. the air).</p>
<figure class="align-center">
<a class="reference internal image-reference" href="_images/importanceSampling_massWorld.png"><img alt="_images/importanceSampling_massWorld.png" src="_images/importanceSampling_massWorld.png" style="width: 90%;" /></a>
</figure>
<figure class="align-center">
<a class="reference internal image-reference" href="_images/importanceSampling_importanceWorld.png"><img alt="_images/importanceSampling_importanceWorld.png" src="_images/importanceSampling_importanceWorld.png" style="width: 90%;" /></a>
</figure>
<figure class="align-center">
<a class="reference internal image-reference" href="_images/importanceSampling_VolumeMap.png"><img alt="_images/importanceSampling_VolumeMap.png" src="_images/importanceSampling_VolumeMap.png" style="width: 90%;" /></a>
</figure>
<ul class="simple">
<li><p>Both the mass world and importance sampling world must be the same size.</p></li>
<li><p>Both the mass world and importance sampling world must be large enough to encompass the machine
beamline. If not, BDSIM will exit.</p></li>
<li><p>It is down to the user to ensure the importance cells are correctly positioned.</p></li>
<li><p>If a importance cell volume exists in the importance world geometry and is not listed
in the ASCII map file with a importance value, BDSIM will exit.</p></li>
<li><p>The importance sampling world volume has an importance value of 1.</p></li>
</ul>
</section>
<section id="muon-splitting">
<span id="physics-bias-muon-splitting"></span><h3>Muon Splitting<a class="headerlink" href="#muon-splitting" title="Link to this heading"></a></h3>
<p>Muon splitting offers the possibility to understand muon distributions throughout a 3D model a
little better. It works by wrapping several physics processes for several particles. If they
produce a muon in their “post step change”, the splitting is invoked. In this case, the following happens:</p>
<ol class="arabic simple">
<li><p>Any original secondaries (excluding muons) are kept from the original physics process to one side.</p></li>
<li><p>The original muon(s) is/are kept separately.</p></li>
<li><p>The physics process is resampled and asked to do its action again. After each invocation,
any muons produced are kept and the other <em>new</em> secondaries discarded. This continues until
we have the desired number of muons minus 1.</p></li>
<li><p>The original muon(s) plus the new ones are added to the final “post step change”, each with
a weight of original weight / N muons.</p></li>
</ol>
<p>Schematically, this would look like:</p>
<figure class="align-center" id="id21">
<a class="reference internal image-reference" href="_images/muonsplitting.pdf"><img alt="_images/muonsplitting.pdf" src="_images/muonsplitting.pdf" style="width: 70%;" /></a>
<figcaption>
<p><span class="caption-text">Schematic of a <span class="math notranslate nohighlight">\(\pi^+\)</span> decay to a muon and a muon neutrino.</span><a class="headerlink" href="#id21" title="Link to this image"></a></p>
</figcaption>
</figure>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This can safely be used in combination with BDSIM’s cross-section biasing. The weights
are compounded and no special action needs to be taken.</p>
</div>
<p>This is controlled by the option:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">option</span><span class="p">,</span> <span class="n">muonSplittingFactor</span><span class="o">=</span><span class="n">N</span>
</pre></div>
</div>
<p>where N is a positive integer (1 = no splitting). This is the factor multiplying the number of
muons normally produced.</p>
<ul class="simple">
<li><p><code class="code docutils literal notranslate"><span class="pre">muonSplittingFactor</span></code> can range from 1 to 206. The limit of 206 is imposed by the
compiled constant <code class="code docutils literal notranslate"><span class="pre">G4TrackFastVectorSize</span></code> in <code class="code docutils literal notranslate"><span class="pre">G4TrackFastVector.hh</span></code>, which
is Geant4’s expected maximum number of secondary tracks per interaction, which is fair.
If more than this are generated, they will be dumped by Geant4 and not tracked. We have
a factor of 2, because theoretically AnnihiToMuPair could produce 2x muons per occurrence.</p></li>
</ul>
<p>The following full set of options control the splitting:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p><strong>Option</strong></p></th>
<th class="head"><p><strong>Description</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>muonSplittingFactor</p></td>
<td><p>The multiplication factor of muons if split. Postive
integer between 1 and 206.</p></td>
</tr>
<tr class="row-odd"><td><p>muonSplittingThresholdParentEk</p></td>
<td><p>The minimum kinetic energy of the parent particle to
qualify for splitting. Default 0 GeV.</p></td>
</tr>
<tr class="row-even"><td><p>muonSplittingFactor2</p></td>
<td><p>A second multiplication factor of muons if split for
a second higher energy band as defined by the next
option. Positive integer between 1 and 206, and should
be greater or equal to <cite>muonSplittingFactor</cite>.</p></td>
</tr>
<tr class="row-odd"><td><p>muonSplittingThresholdParentEk2</p></td>
<td><p>The minimum kinetic energy of the parent particle for
the second splitting factor to take effect. Should be
greater or equal to <cite>muonSplittingThresholdParentEk</cite>.</p></td>
</tr>
</tbody>
</table>
<p>The splitting can be used with 1 or 2 factors. In the case of 1 factor, only the first one
is used. In the case of <cite>muonSplittingThresholdParentEk</cite> is set, the 1 factor applies above
this energy and the factor is ‘faded-in’ from 0.8 x this value. The factor is linearly
interpolated as a function of kinetic energy and rounded to the nearest integer.</p>
<p>In the case of a second splitting factor and therefore also <cite>muonSplittingThresholdParentEk2</cite>,
a similar linear interpolation procedure is used along with rounding.</p>
<figure class="align-center" id="id22">
<a class="reference internal image-reference" href="_images/splittingfactor1.pdf"><img alt="_images/splittingfactor1.pdf" src="_images/splittingfactor1.pdf" style="width: 70%;" /></a>
<figcaption>
<p><span class="caption-text">Muon splitting factor as a function of kinetic energy with only 1 factor specified
and no kinetic energy threshold used.</span><a class="headerlink" href="#id22" title="Link to this image"></a></p>
</figcaption>
</figure>
<figure class="align-center" id="id23">
<a class="reference internal image-reference" href="_images/splittingfactor1b.pdf"><img alt="_images/splittingfactor1b.pdf" src="_images/splittingfactor1b.pdf" style="width: 70%;" /></a>
<figcaption>
<p><span class="caption-text">Muon splitting factor as a function of kinetic energy with only 1 factor specified
and a kinetic energy threshold specified.</span><a class="headerlink" href="#id23" title="Link to this image"></a></p>
</figcaption>
</figure>
<figure class="align-center" id="id24">
<a class="reference internal image-reference" href="_images/splittingfactor2.pdf"><img alt="_images/splittingfactor2.pdf" src="_images/splittingfactor2.pdf" style="width: 70%;" /></a>
<figcaption>
<p><span class="caption-text">Muon splitting factor as a function of kinetic energy with 2 factors specified as
well as 2 kinetic energy thresholds.</span><a class="headerlink" href="#id24" title="Link to this image"></a></p>
</figcaption>
</figure>
<p><strong>Examples:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">option</span><span class="p">,</span> <span class="n">muonSplittingFactor</span><span class="o">=</span><span class="mi">10</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">option</span><span class="p">,</span> <span class="n">muonSplittingFactor</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
        <span class="n">muonSplittingThresholdParentEk</span><span class="o">=</span><span class="mi">50</span><span class="o">*</span><span class="n">GeV</span><span class="p">,</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">option</span><span class="p">,</span> <span class="n">muonSplittingFactor</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
        <span class="n">muonSplittingThresholdParentEk</span><span class="o">=</span><span class="mi">50</span><span class="o">*</span><span class="n">GeV</span><span class="p">,</span>
        <span class="n">muonSplittingFactor</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
        <span class="n">muonSplittingThresholdParentEk</span><span class="o">=</span><span class="mi">150</span><span class="o">*</span><span class="n">GeV</span><span class="p">;</span>
</pre></div>
</div>
<p>More examples can be found (including cross-section biasing) in <code class="code docutils literal notranslate"><span class="pre">bdsim/examples/features/processes/6_muon</span></code>.</p>
<p>The following processes are wrapped for the following
particles (Geant4 names).</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p><strong>Particle</strong></p></th>
<th class="head"><p><strong>Process</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>e+</p></td>
<td><p>AnnihiToMuPair</p></td>
</tr>
<tr class="row-odd"><td><p>pi+</p></td>
<td><p>Decay</p></td>
</tr>
<tr class="row-even"><td><p>pi-</p></td>
<td><p>Decay</p></td>
</tr>
<tr class="row-odd"><td><p>kaon+</p></td>
<td><p>Decay</p></td>
</tr>
<tr class="row-even"><td><p>kaon-</p></td>
<td><p>Decay</p></td>
</tr>
<tr class="row-odd"><td><p>kaon0L</p></td>
<td><p>Decay</p></td>
</tr>
</tbody>
</table>
<p><strong>Motivation</strong></p>
<p>We want to estimate the muon flux including spectra at a location, probably far from the original
source of beam losses or particles on a target. Muons are comparatively rare, but the numbers
present with real beams (e.g. <span class="math notranslate nohighlight">\(10^9\)</span> particles in a bunch) may produce a non-negligible
muon flux. We want to precisely estimate this through Monte Carlo, but practically, very few
events produce muons. We can enhance muon numbers in our simulation by for example, biasing
the cross-section of the decay process for pions and kaons (to balance hadronic inelastic
interactions), but we still see too few muons.</p>
<p>If we increase the decay cross-section too much, the decays happen over a short distance.
While this produces a lot of muons, it means we only <em>sample</em> muons close spatially to the
upstream part. The particles (e.g. pions, kaons, muons) may travel through material and
magnetic fields before producing muons and ultimately contribute to a different <em>phase space</em>
or distribution in the far away plane.</p>
<p>Therefore, we choose splitting. When a given muon is produced at a location, we resample
the process and repeat it. In the case of 2-body decay, the decay products are produced
back-to-back in the frame of the parent and have a fixed momenta based on their relative
masses. The direction of this back-to-back decay is random. Then, the decay products are
boosted to the lab frame, which can give them different momenta and directions.</p>
<p>Some muons may pass through different material and fields on their way to the point of
interest. With more muons, we sample this better.</p>
<p>We cannot use a factor of say, 1 million and only sample 1 event, because we would only
sample 1 (e.g.) decay in 1 location. We must still sample many locations well to properly
estimate the muon flux.</p>
<figure class="align-center" id="id25">
<a class="reference internal image-reference" href="_images/muon_splitting_comparison_with_divsym.png"><img alt="_images/muon_splitting_comparison_with_divsym.png" src="_images/muon_splitting_comparison_with_divsym.png" style="width: 70%;" /></a>
<figcaption>
<p><span class="caption-text">Comparison of the muon spectrum for the same model with activated muon splitting
and without muon splitting [F. Metzger, <cite>Examination of the RF separated beam
technique at CERN’s M2 beam line</cite>, PhD thesis (in progress)].</span><a class="headerlink" href="#id25" title="Link to this image"></a></p>
</figcaption>
</figure>
<p><strong>Notes:</strong></p>
<ul class="simple">
<li><p>A factor of 1 means no splitting is done.</p></li>
<li><p>Examples in <code class="code docutils literal notranslate"><span class="pre">bdsim/examples/features/processes/6_muon</span></code>.</p></li>
<li><p>The biasing happens <em>everywhere</em> and is not attached to any particle shapes or volumes.</p></li>
<li><p>The biasing happens to all particles that are wrapped, irrespective of their energy or direction.</p></li>
<li><p>A factor of 5-30 is recommended.</p></li>
<li><p>The factor must be an <strong>integer</strong>.</p></li>
<li><p>If no suitable particles or processes are found, no action will be taken. Only the ones
available from the table above are wrapped.</p></li>
<li><p>Decay must be present in the physics list to occur and be wrapped.</p></li>
<li><p>The extra EM physics must be used for positron annihilation (“em_extra”) or as part of a
Geant4 reference physics list (e.g. <code class="code docutils literal notranslate"><span class="pre">g4FTPF_BERT</span></code>).</p></li>
<li><p>A muon might not be produced every time in the final state of the wrapped process. The
wrapper will try up to 10 x muonSplittingFactor to generate the required number. Ultimately,
if it can’t, it will continue with the number it has produced and normalise the weights accordingly.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For positron <strong>AnnihiToMuPair</strong> to work, “EmExtra” physics must be included in the physics
list, but this process must also generally be turned on. This can be done in BDSIM with
the option <code class="code docutils literal notranslate"><span class="pre">usePositronToMuMu</span></code> in the case of a BDSIM modular physics list, or with
a Geant4 physics macro in the case of a Geant4 reference physics list. See
<a class="reference internal" href="#physics-em-extra-notes"><span class="std std-ref">em_extra Physics Notes</span></a> for the former, and <a class="reference internal" href="#physics-macro-file"><span class="std std-ref">Physics Macro File</span></a> for the later.
The relevant command is <code class="code docutils literal notranslate"><span class="pre">/physics_lists/em/PositronToMuons</span> <span class="pre">true</span></code> for the Geant4 physics
macro.</p>
</div>
<p><strong>Pion Decay</strong></p>
<div class="math notranslate nohighlight">
\[\pi^+ \to \mu^+ + \nu_{\mu}\]</div>
<p>Here, the neutrino is kept as it would be originally, but the muon is ‘split’ into N muons. e.g. with a
splitting factor of 100, there would be 100 muons and 1 neutrino. Each of the 100 muons would have a new
weight of 1/100. The produces will be 1x neutrino, 100x muons.</p>
<p><strong>Positron Annihilation</strong></p>
<p>One possible outcome of a high energy positron hitting a solid target is:</p>
<div class="math notranslate nohighlight">
\[e^+ + e^- \mathrm{(in~material)} \to \gamma \mathrm{ (virtual) } \to \mu^+ \mu^-\]</div>
<p>With a splitting factor of 100, this would produce 100x the 2 muons, resulting in 100 <span class="math notranslate nohighlight">\(\mu^+\)</span>
and 100 <span class="math notranslate nohighlight">\(\mu^-\)</span>, each with a weight of 1/100.</p>
</section>
</section>
<section id="options">
<span id="bdsim-options"></span><h2>Options<a class="headerlink" href="#options" title="Link to this heading"></a></h2>
<p>Various simulation details can be controlled through the <cite>option</cite> command. Options are defined
using the following syntax:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">option</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">option_name</span><span class="o">&gt;=&lt;</span><span class="n">value</span><span class="o">&gt;</span><span class="p">;</span>
</pre></div>
</div>
<p>Values accepted can be:</p>
<ul class="simple">
<li><p>a <strong>number</strong> (integer, floating point or scientific notation)</p></li>
<li><p>a <strong>string</strong> with the value enclosed in “double inverted commas”</p></li>
<li><p>a <strong>Boolean</strong> (described as on or off, or true or false): must be 1 or 0.</p></li>
</ul>
<p>Examples (of fictional options):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">option</span><span class="p">,</span> <span class="n">numericalOption</span> <span class="o">=</span> <span class="mi">123</span><span class="p">;</span>
<span class="n">option</span><span class="p">,</span> <span class="n">numericalOption</span> <span class="o">=</span> <span class="mf">1.23e2</span><span class="p">;</span>
<span class="n">option</span><span class="p">,</span> <span class="n">stringOption</span> <span class="o">=</span> <span class="s2">&quot;value&quot;</span><span class="p">;</span>
<span class="n">option</span><span class="p">,</span> <span class="n">booleanOptionOn</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="n">option</span><span class="p">,</span> <span class="n">booleanOptionOff</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</pre></div>
</div>
<p>Multiple options can be defined at once separated by commans and new lines are tolerated. The declaration
should end in a semi-colon. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">option</span><span class="p">,</span> <span class="n">anOption</span> <span class="o">=</span> <span class="mi">123</span><span class="p">,</span> <span class="n">anotherOption</span> <span class="o">=</span> <span class="s2">&quot;bananas&quot;</span><span class="p">;</span>

<span class="n">option</span><span class="p">,</span> <span class="n">anOption</span> <span class="o">=</span> <span class="mi">123</span><span class="p">,</span>
        <span class="n">anotherOption</span> <span class="o">=</span> <span class="s2">&quot;bananas&quot;</span><span class="p">;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>No options are required to be specified to run a BDSIM model. Defaults will be used in
all cases.  However, we do recommend you select an appropriate physics list and beam pipe
radius, as these will have a large impact on the outcome of the simulation.</p>
</div>
<p>Below is a full list of all options in BDSIM. Please also see <a class="reference internal" href="running.html#executable-options"><span class="std std-ref">Executable Options</span></a> for options
that are used on the command line when executing BDSIM. The executable options override whatever
options are specified in the input gmad files.</p>
<p>Common options are duplicated below for convenience as these are the most useful ones. All options
are described in the following sub-sections:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#general-run-options">General Run Options</a></p></li>
<li><p><a class="reference internal" href="#geometry-options">Geometry Options</a></p></li>
<li><p><a class="reference internal" href="#tracking-options">Tracking Options</a></p></li>
<li><p><a class="reference internal" href="#physics-process-options"><span class="std std-ref">Physics Processes</span></a></p></li>
<li><p><a class="reference internal" href="#visualisation">Visualisation</a></p></li>
<li><p><a class="reference internal" href="#output-options">Output Options</a></p></li>
<li><p><a class="reference internal" href="model_customisation.html#one-turn-map"><span class="std std-ref">One Turn Map</span></a></p></li>
<li><p><a class="reference internal" href="#bdsim-options-verbosity"><span class="std std-ref">Print Out Options</span></a></p></li>
<li><p><a class="reference internal" href="#offset-for-main-beam-line">Offset for Main Beam Line</a></p></li>
<li><p><a class="reference internal" href="#scoring-map">Scoring Map</a></p></li>
<li><p><a class="reference internal" href="#id12">Developer Options</a></p></li>
</ul>
<section id="common-options">
<span id="options-common"></span><h3>Common Options<a class="headerlink" href="#common-options" title="Link to this heading"></a></h3>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p><strong>Option</strong></p></th>
<th class="head"><p><strong>Function</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>beampipeRadius</p></td>
<td><p>Default beam pipe inner radius [m]</p></td>
</tr>
<tr class="row-odd"><td><p>beampipeThickness</p></td>
<td><p>Default beam pipe thickness [m]</p></td>
</tr>
<tr class="row-even"><td><p>beampipeMaterial</p></td>
<td><p>Default beam pipe material. Default “stainlessSteel”</p></td>
</tr>
<tr class="row-odd"><td><p>elossHistoBinWidth</p></td>
<td><p>The width of the default energy deposition and
particle loss histogram bins made as BDSIM runs [m]
Default 1.0 m</p></td>
</tr>
<tr class="row-even"><td><p>eventNumberOffset</p></td>
<td><p>Event that the recreation should start from</p></td>
</tr>
<tr class="row-odd"><td><p>hStyle</p></td>
<td><p>Whether default dipole style is H-style vs. C-style
(default false)</p></td>
</tr>
<tr class="row-even"><td><p>ngenerate</p></td>
<td><p>Number of primary particles to simulate</p></td>
</tr>
<tr class="row-odd"><td><p>nturns</p></td>
<td><p>The number of revolutions that the particles are
allowed to complete in a circular accelerator.
Requires –circular executable option to work.</p></td>
</tr>
<tr class="row-even"><td><p>horizontalWidth</p></td>
<td><p>Default accelerator component full width [m] Default
is 0.5 m.</p></td>
</tr>
<tr class="row-odd"><td><p>physicsList</p></td>
<td><p>The physics list to use</p></td>
</tr>
<tr class="row-even"><td><p>printFractionEvents</p></td>
<td><p>How often to print out the event number as a fraction
of the total number of events to simulation (default
is 0.1 (i.e. 10%).  Varies from 0 to 1. -1 for all.</p></td>
</tr>
<tr class="row-odd"><td><p>printFractionTurns</p></td>
<td><p>How often to print out the turn number as a fraction
of the total number of turns to simulation (default
is 0.2 (i.e. 20%).  Varies from 0 to 1. -1 for all.
Will only print out in an event that also prints out.</p></td>
</tr>
<tr class="row-even"><td><p>printPhysicsProcesses</p></td>
<td><p>(Boolean) Print out every particle registered
according to the physics list and for each particle,
print out the name of every physics process
registered to it. Done at the start of a run. Run 1
particle for minimal job to see this output.</p></td>
</tr>
<tr class="row-odd"><td><p>prodCutPhotons</p></td>
<td><p>Standard overall production cuts for photons
(default 1e-3) [m]</p></td>
</tr>
<tr class="row-even"><td><p>prodCutElectrons</p></td>
<td><p>Standard overall production cuts for electrons
(default 1e-3) [m]</p></td>
</tr>
<tr class="row-odd"><td><p>prodCutPositrons</p></td>
<td><p>Standard overall production cuts for positrons
(default 1e-3) [m]</p></td>
</tr>
<tr class="row-even"><td><p>prodCutProtons</p></td>
<td><p>Standard overall production cuts for protons
(default 1e-3) [m]</p></td>
</tr>
<tr class="row-odd"><td><p>removeTemporaryFiles</p></td>
<td><p>Whether to delete temporary files (typically gdml)
when BDSIM exits. Default true.</p></td>
</tr>
<tr class="row-even"><td><p>seed</p></td>
<td><p>The integer seed value for the random number
generator</p></td>
</tr>
<tr class="row-odd"><td><p>stopSecondaries</p></td>
<td><p>Whether to stop secondaries or not (default = false)</p></td>
</tr>
<tr class="row-even"><td><p>worldMaterial</p></td>
<td><p>The default material surrounding the model. This is
by default “G4_AIR”.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="general-run-options">
<span id="options-general-run"></span><h3>General Run Options<a class="headerlink" href="#general-run-options" title="Link to this heading"></a></h3>
<p>For a description of recreating events, see <a class="reference internal" href="running.html#running-recreation"><span class="std std-ref">Recreate Mode</span></a>.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p><strong>Option</strong></p></th>
<th class="head"><p><strong>Function</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>ngenerate</p></td>
<td><p>Number of primary particles to simulate</p></td>
</tr>
<tr class="row-odd"><td><p>nturns</p></td>
<td><p>The number of revolutions particles are allowed to
complete in a circular accelerator - requires
–circular executable option to work.</p></td>
</tr>
<tr class="row-even"><td><p>printFractionEvents</p></td>
<td><p>How often to print out the event number as a fraction
of the total number of events to simulation (default
is 0.1 i.e. 10%.  Varies from 0 to 1. -1 for all.</p></td>
</tr>
<tr class="row-odd"><td><p>printFractionTurns</p></td>
<td><p>How often to print out the turn number as a fraction
of the total number of turns to simulation (default
is 0.2 i.e. 20%.  Varies from 0 to 1. -1 for all.
Will only print out in an event that also prints out.</p></td>
</tr>
<tr class="row-even"><td><p>randomEngine</p></td>
<td><p>Name of which random engine (“hepjames”, “mixmax”).
Default is “hepjames”.</p></td>
</tr>
<tr class="row-odd"><td><p>recreate</p></td>
<td><p>Whether to use recreation mode or not (default 0). If
used as an executable option, this should be a string
with a path to the <code class="code docutils literal notranslate"><span class="pre">recreateFileName</span></code>.</p></td>
</tr>
<tr class="row-even"><td><p>recreateFileName</p></td>
<td><p>Path to BDSIM output file to use for recreation.</p></td>
</tr>
<tr class="row-odd"><td><p>removeTemporaryFiles</p></td>
<td><p>Whether to delete temporary files (typically gdml)
when BDSIM exits. Default true.</p></td>
</tr>
<tr class="row-even"><td><p>seed</p></td>
<td><p>The integer seed value for the random number
generator</p></td>
</tr>
<tr class="row-odd"><td><p>startFromEvent</p></td>
<td><p>Number of event to start from when recreating. 0
counting.</p></td>
</tr>
<tr class="row-even"><td><p>temporaryDirectory</p></td>
<td><p>By default, BDSIM tries <code class="code docutils literal notranslate"><span class="pre">/tmp</span></code>, <code class="code docutils literal notranslate"><span class="pre">/temp</span></code>,
and the current working directory in that order to
create a new temporary directory in. Specify this
option with a path (e.g. “./” for cwd) to override
this behaviour.</p></td>
</tr>
<tr class="row-odd"><td><p>writeSeedState</p></td>
<td><p>Writes the seed state of the last event start in a
text file</p></td>
</tr>
</tbody>
</table>
</section>
<section id="geometry-options">
<span id="options-geometry"></span><h3>Geometry Options<a class="headerlink" href="#geometry-options" title="Link to this heading"></a></h3>
<p>These affect the construction of the 3D model in BDSIM. Tunnel parameters are also
described in <a class="reference internal" href="model_customisation.html#tunnel-geometry"><span class="std std-ref">Tunnel Geometry</span></a>.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p><strong>Option</strong></p></th>
<th class="head"><p><strong>Function</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>apertureType</p></td>
<td><p>Default aperture type for all elements.</p></td>
</tr>
<tr class="row-odd"><td><p>aper1</p></td>
<td><p>Default aper1 parameter (default = 2.5 cm)</p></td>
</tr>
<tr class="row-even"><td><p>aper2</p></td>
<td><p>Default aper2 parameter (default = 2.5 cm)</p></td>
</tr>
<tr class="row-odd"><td><p>aper3</p></td>
<td><p>Default aper3 parameter (default = 2.5 cm)</p></td>
</tr>
<tr class="row-even"><td><p>aper4</p></td>
<td><p>Default aper4 parameter (default = 2.5 cm)</p></td>
</tr>
<tr class="row-odd"><td><p>beampipeRadius</p></td>
<td><p>Default beam pipe inner radius - alias for aper1 [m]</p></td>
</tr>
<tr class="row-even"><td><p>beampipeThickness</p></td>
<td><p>Default beam pipe thickness [m] (default 2.5 mm)</p></td>
</tr>
<tr class="row-odd"><td><p>beampipeMaterial</p></td>
<td><p>Default beam pipe material (default “stainlesssteel”</p></td>
</tr>
<tr class="row-even"><td><p>buildTunnel</p></td>
<td><p>Whether to build a tunnel (default = false)</p></td>
</tr>
<tr class="row-odd"><td><p>buildTunnelStraight</p></td>
<td><p>Whether to build a tunnel, ignoring the beamline and
just in a straight line (default = false).</p></td>
</tr>
<tr class="row-even"><td><p>buildTunnelFloor</p></td>
<td><p>Whether to add a floor to the tunnel</p></td>
</tr>
<tr class="row-odd"><td><p>checkOverlaps</p></td>
<td><p>Whether to run Geant4’s geometry overlap checker
during geometry construction (slower)</p></td>
</tr>
<tr class="row-even"><td><p>coilWidthFraction</p></td>
<td><p>0.05 - 0.98 - fraction of available horizontal space
between pole and yoke that coil will occupy</p></td>
</tr>
<tr class="row-odd"><td><p>coilHeightFraction</p></td>
<td><p>0.05 - 0.98 - fraction of available vertical space
between pole tip and yoke that coil will occupy</p></td>
</tr>
<tr class="row-even"><td><p>dontSplitSBends</p></td>
<td><p>If true, do not split sbends into multiple segments
(default = false).</p></td>
</tr>
<tr class="row-odd"><td><p>emptyMaterial</p></td>
<td><p>This is ‘vacuum’ material where no material is
required. Note: this is not ‘vacuum’ in the beam pipe,
but the lowest density material (G4_GALACTIC) Geant4
can muster, as all materials must have a finite
density. This is used for the gap between
tight-fitting container volumes and objects.</p></td>
</tr>
<tr class="row-even"><td><p>horizontalWidth</p></td>
<td><p>The default full width of a magnet</p></td>
</tr>
<tr class="row-odd"><td><p>hStyle</p></td>
<td><p>Whether default dipole style is H-style vs. C-style
(default false)</p></td>
</tr>
<tr class="row-even"><td><p>ignoreLocalAperture</p></td>
<td><p>If this is true (1), any per-element aperture
definitions will be ignored and the ones specified
in Options will be used.</p></td>
</tr>
<tr class="row-odd"><td><p>ignoreLocalMagnetGeometry</p></td>
<td><p>If this is true (1), any per-element magnet geometry
definitions will be ignored and the ones specified
in Options will be used.</p></td>
</tr>
<tr class="row-even"><td><p>includeIronMagFields</p></td>
<td><p>Whether to include magnetic fields in the magnet
poles</p></td>
</tr>
<tr class="row-odd"><td><p>magnetGeometryType</p></td>
<td><p>The default magnet geometry style to use</p></td>
</tr>
<tr class="row-even"><td><p>outerMaterial</p></td>
<td><p>The default material to use for the yoke of magnet
geometry (default = “iron”)</p></td>
</tr>
<tr class="row-odd"><td><p>preprocessGDML</p></td>
<td><p>Whether to prepend the element name at the front of
every tag in a temporary copy of the GDML file.
loaded. This is to compensate for the Geant4 GDML
loader that cannot load multiple files correctly. On
by default. See <cite>temporaryDirectory</cite> option also.</p></td>
</tr>
<tr class="row-even"><td><p>preprocessGDMLSchema</p></td>
<td><p>Whether to preprocess a copy of the GDML file where
the URL of the GDML schema is changed to a local copy
provided in BDSIM so geometry can be loaded without
internet access. On by default.</p></td>
</tr>
<tr class="row-odd"><td><p>removeTemporaryFiles</p></td>
<td><p>Whether to delete temporary files (typically gdml)
when BDSIM exits (default = true)</p></td>
</tr>
<tr class="row-even"><td><p>samplerDiameter</p></td>
<td><p>Diameter of all samplers [m]. (default = 5 m)</p></td>
</tr>
<tr class="row-odd"><td><p>scalingFieldOuter</p></td>
<td><p>Numerical scaling factor that will be applied to all
magnet outer (i.e. yoke) fields unless they have
their own scalingFieldOuter factor specified in their
element definition. Default 1.0 (no effect).</p></td>
</tr>
<tr class="row-even"><td><p>sensitiveBeamPipe</p></td>
<td><p>Whether the beam pipe records energy loss. This
includes cavities. (default = true)</p></td>
</tr>
<tr class="row-odd"><td><p>sensitiveOuter</p></td>
<td><p>Whether the outer part of each component (other than
the beam pipe records energy loss (default = true)</p></td>
</tr>
<tr class="row-even"><td><p>soilMaterial</p></td>
<td><p>Material for outside tunnel wall (default = “soil”)</p></td>
</tr>
<tr class="row-odd"><td><p>temporaryDirectory</p></td>
<td><p>By default, BDSIM tries <code class="code docutils literal notranslate"><span class="pre">/tmp</span></code>, <code class="code docutils literal notranslate"><span class="pre">/temp</span></code>,
and the current working directory in that order to
create a new temporary directory in. Specify this
option with a path (e.g. “./” for cwd) to override
this behaviour.</p></td>
</tr>
<tr class="row-even"><td><p>thinElementLength</p></td>
<td><p>The length of all thinmultipoles and dipole
fringefields in a lattice (default 1e-7) [m]</p></td>
</tr>
<tr class="row-odd"><td><p>tunnelIsInfiniteAbsorber</p></td>
<td><p>Whether all particles entering the tunnel material
should be killed or not (default = false)</p></td>
</tr>
<tr class="row-even"><td><p>tunnelType</p></td>
<td><p>Which style of tunnel to use - one of:
<cite>circular</cite>, <cite>elliptical</cite>, <cite>square</cite>, <cite>rectangular</cite>,
<cite>ilc</cite>, or <cite>rectaboveground</cite>.</p></td>
</tr>
<tr class="row-odd"><td><p>tunnelAper1</p></td>
<td><p>Tunnel aperture parameter #1 - typically
horizontal [m]</p></td>
</tr>
<tr class="row-even"><td><p>tunnelAper2</p></td>
<td><p>Tunnel aperture parameter #2 - typically
vertical [m]</p></td>
</tr>
<tr class="row-odd"><td><p>tunnelFloorOffset</p></td>
<td><p>The offset of the tunnel floor from the centre of the
tunnel (<strong>not</strong> the beam line)</p></td>
</tr>
<tr class="row-even"><td><p>tunnelMaterial</p></td>
<td><p>Material for tunnel wall</p></td>
</tr>
<tr class="row-odd"><td><p>tunnelMaxSegmentLength</p></td>
<td><p>Maximum permitted length of an automatic tunnel
segment to be built (m). Default 50 m. Min 1 m.</p></td>
</tr>
<tr class="row-even"><td><p>tunnelOffsetX</p></td>
<td><p>Horizontal offset of the tunnel with respect to the
beam line reference trajectory</p></td>
</tr>
<tr class="row-odd"><td><p>tunnelOffsetY</p></td>
<td><p>Vertical offset of the tunnel with respect to the
beam line reference trajectory</p></td>
</tr>
<tr class="row-even"><td><p>tunnelSoilThickness</p></td>
<td><p>Soil thickness outside tunnel wall [m]</p></td>
</tr>
<tr class="row-odd"><td><p>tunnelThickness</p></td>
<td><p>Thickness of tunnel wall [m]</p></td>
</tr>
<tr class="row-even"><td><p>vacuumMaterial</p></td>
<td><p>The material to use for the beam pipe vacuum
(default = “Vacuum”)</p></td>
</tr>
<tr class="row-odd"><td><p>vacuumPressure</p></td>
<td><p>The pressure of the vacuum gas [bar]</p></td>
</tr>
<tr class="row-even"><td><p>vhRatio</p></td>
<td><p>Default vertical to horizontal ratio for dipoles</p></td>
</tr>
<tr class="row-odd"><td><p>worldVolumeMargin</p></td>
<td><p>The margin added in all directions to the world
volume [m]. Default 5m, minimum 2m.</p></td>
</tr>
<tr class="row-even"><td><p>worldMaterial</p></td>
<td><p>The default material surrounding the model. This is
by default air.</p></td>
</tr>
<tr class="row-odd"><td><p>worldGeometryFile</p></td>
<td><p>The filename of the world geometry file. See
<a class="reference internal" href="model_customisation.html#external-world-geometry"><span class="std std-ref">External World Geometry</span></a> for more details.
Default = “”.</p></td>
</tr>
<tr class="row-even"><td><p>worldVacuumVolumeNames</p></td>
<td><p>White space separated list of names as a string of
logical volume names for volumes to be labelled as
<cite>vacuum</cite> for the purpose of biasing.</p></td>
</tr>
<tr class="row-odd"><td><p>autoColourWorldGeometryFile</p></td>
<td><p>Boolean whether to automatically colour geometry
loaded from the worldGeometryFile. Default true.</p></td>
</tr>
<tr class="row-even"><td><p>useOldMultipoleOuterFields</p></td>
<td><p>Boolean whether to use the multipolar yoke fields for
all elements according to pre-V1.7.0 behaviour. Off
by default but here to allow comparison.</p></td>
</tr>
<tr class="row-odd"><td><p>yokeFields</p></td>
<td><p>Whether to include a general multipolar field for
the yoke of each magnet (using a fourth order
Runge-Kutta integrator). Default true. See also
<cite>scalingFieldOuter</cite> option.</p></td>
</tr>
<tr class="row-even"><td><p>yokeFieldsMatchLHCGeometry</p></td>
<td><p>Boolean whether to use yoke fields that are the sum
of two multipole yoke fields with the LHC separation
of 194 mm. Default true. Applies to rbend, sbend,
quadrupole and sextupole.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="tracking-options">
<span id="options-tracking"></span><h3>Tracking Options<a class="headerlink" href="#tracking-options" title="Link to this heading"></a></h3>
<p>These control over the tracking routines used, as well as roughly the speed of the simulation
with various options.</p>
<p>Tracking integrator sets are described in detail in <a class="reference internal" href="dev_tracking.html#integrator-sets"><span class="std std-ref">Integrator Sets</span></a> and
<a class="reference internal" href="dev_tracking.html#integrator-algorithms-section"><span class="std std-ref">Integrator Algorithms</span></a>.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p><strong>Option</strong></p></th>
<th class="head"><p><strong>Function</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>beamPipeIsInfiniteAbsorber</p></td>
<td><p>When turned on, all particles that hit the material
of the beam pipe are killed and the energy recorded as
being deposited there.</p></td>
</tr>
<tr class="row-odd"><td><p>cavityFieldType</p></td>
<td><p>Default cavity field type (‘constantinz’, ‘pillbox’)
to use for all rf elements unless otherwise specified.</p></td>
</tr>
<tr class="row-even"><td><p>collimatorsAreInfiniteAbsorbers</p></td>
<td><p>When turned on, all particles that enter the material
of a collimator (<cite>rcol</cite>, <cite>ecol</cite> and <cite>jcol</cite>) are
killed and the energy recorded as deposited there.</p></td>
</tr>
<tr class="row-odd"><td><p>dEThresholdForScattering</p></td>
<td><p>The energy deposition in GeV treated as the threshold
for a step to be considered a scattering point.
Along step processes such as multiple scattering may
degrade the energy but not be the process that
defined the step, so may not register. Default
1e-11 GeV.</p></td>
</tr>
<tr class="row-even"><td><p>includeFringeFields</p></td>
<td><p>Places thin fringefield elements on the end of bending
magnets with finite poleface angles, and solenoids.
The length of the total element is conserved.
(default = true).</p></td>
</tr>
<tr class="row-odd"><td><p>includeFringeFieldsCavities</p></td>
<td><p>Include thin fringe fields for RF cavities only.
Cavity fringes are not affected by the
includeFringeFields option,
includeFringeFieldsCavities must be explicitly turned
off if no fringes are to be built at all in the model.
(default = true).</p></td>
</tr>
<tr class="row-even"><td><p>integratorSet</p></td>
<td><p>Set of tracking routines to use (“bdsimmatrix”,
“bdsimtwo”, “bdsimmatrixfringescaling”, “geant4”, or
“geant4dp”)</p></td>
</tr>
<tr class="row-odd"><td><p>killNeutrinos</p></td>
<td><p>Whether to always stop tracking neutrinos for
increased efficiency (default = false)</p></td>
</tr>
<tr class="row-even"><td><p>killedParticlesMassAddedToEloss</p></td>
<td><p>Default 0 (off). When a particle is killed its rest
mass will be included in the energy deposition hit.
Relevant when minimumKineticEnergy option or
stopSecondaries is used. This option applies to all
Eloss hits including world, vacuum, global, tunnel.</p></td>
</tr>
<tr class="row-odd"><td><p>maximumStepLength</p></td>
<td><p>Maximum step length [m] (default = 20 m)</p></td>
</tr>
<tr class="row-even"><td><p>maximumTrackingTime</p></td>
<td><p>The maximum time of flight allowed for any particle
before it is killed [s]</p></td>
</tr>
<tr class="row-odd"><td><p>maximumTrackLength</p></td>
<td><p>The maximum length in metres of any track passing
through any geometry in the model (not including the
world volume)</p></td>
</tr>
<tr class="row-even"><td><p>maximumTracksPerEvent</p></td>
<td><p>Any tracks beyond this number will be killed without
regard to their species or kinematics. Ultimately,
this can be used to limit the size of an event. Very
artificial, and should only be used with care.</p></td>
</tr>
<tr class="row-odd"><td><p>minimumKineticEnergy</p></td>
<td><p>A particle below this energy will be killed and the
energy deposition recorded at that location [GeV]</p></td>
</tr>
<tr class="row-even"><td><p>minimumKineticEnergyTunnel</p></td>
<td><p>A particle below this energy in any BDSIM-generated
tunnel sections will be killed and the energy
deposition recorded at that location [GeV]</p></td>
</tr>
<tr class="row-odd"><td><p>minimumRadiusOfCurvature</p></td>
<td><p>Minimum tolerable radius of curvature of a particle,
below which, the energy will be decreased by 2% on
each use of the integrators to prevent infinite
loops - should be just greater than width of beam
pipe [m].</p></td>
</tr>
<tr class="row-even"><td><p>minimumRange</p></td>
<td><p>A particle that would not travel this range
(a distance) in the current material will be cut [m]</p></td>
</tr>
<tr class="row-odd"><td><p>particlesToExcludeFromCuts</p></td>
<td><p>A white space separated string containing PDG IDs for
particles to be excluded from <cite>minimumKineticEnergy</cite>,
<cite>minimumRange</cite>, <cite>maximumTrackingTime</cite>, and
<cite>maximumTrackLength</cite>. e.g. <cite>“13 -13”</cite>.</p></td>
</tr>
<tr class="row-even"><td><p>ptcOneTurnMapFileName</p></td>
<td><p>File name for a one turn map prepared in PTC that is
used in the teleporter to improve the accuracy of
circular tracking. See <a class="reference internal" href="model_customisation.html#one-turn-map"><span class="std std-ref">One Turn Map</span></a>.</p></td>
</tr>
<tr class="row-odd"><td><p>scalingFieldOuter</p></td>
<td><p>Numerical scaling factor that will be applied to all
magnet outer (i.e. yoke) fields unless they have
their own scalingFieldOuter factor specified in their
element definition. Default 1.0 (no effect).</p></td>
</tr>
<tr class="row-even"><td><p>stopSecondaries</p></td>
<td><p>Whether to stop secondaries or not (default = false)</p></td>
</tr>
<tr class="row-odd"><td><p>tunnelIsInfiniteAbsorber</p></td>
<td><p>Whether all particles entering the tunnel material
should be killed or not (default = false)</p></td>
</tr>
</tbody>
</table>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p><strong>Option</strong></p></th>
<th class="head"><p><strong>Function</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>integrateKineticEnergyAlongBeamline</p></td>
<td><p>Integrate changes to the nominal beam energy along
the beamline such as from accelerator and adjust
the design rigidity for normalised fields
accordingly.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="physics-process-options">
<span id="id11"></span><h3>Physics Processes<a class="headerlink" href="#physics-process-options" title="Link to this heading"></a></h3>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p><strong>Option</strong></p></th>
<th class="head"><p><strong>Function</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>biasForWorldVacuum</p></td>
<td><p>In the case of externally provided world geometry and
‘vacuum’ volumes are named using the option
<cite>worldVacuumVolumeNames</cite>, name(s) of bias object(s)
can be given for these volumes.</p></td>
</tr>
<tr class="row-odd"><td><p>biasForWorldVolume</p></td>
<td><p>Name(s) of bias objects to be attached to the world
logical volume only (i.e. not the daughters). White
space separate list in a string.</p></td>
</tr>
<tr class="row-even"><td><p>biasForWorldContents</p></td>
<td><p>Exclusively in the case of externally provided world
geometry, the daughter volumes in the loaded world
volume can be biased with this option. White space
separated list in a string. Does not apply to world
volume itself.</p></td>
</tr>
<tr class="row-odd"><td><p>defaultBiasVacuum</p></td>
<td><p>Name of bias object(s) to be attached to vacuum
volumes by default. White space separate list in a
string, such as “bias1 bias2”.</p></td>
</tr>
<tr class="row-even"><td><p>defaultBiasMaterial</p></td>
<td><p>Name of bias object to be attached to general
material of components outside the vacuum by default</p></td>
</tr>
<tr class="row-odd"><td><p>defaultRangeCut</p></td>
<td><p>The default predicted range at which a particle is
cut. Overwrites other production cuts unless these
are explicitly set (default 1e-3) [m].</p></td>
</tr>
<tr class="row-even"><td><p>geant4PhysicsMacroFileName</p></td>
<td><p>The name of a text macro file with commands that are
suitable for the Geant4 interpreter that will be
executed after the physics list is constructed but
before a run.</p></td>
</tr>
<tr class="row-odd"><td><p>g4PhysicsUseBDSIMCutsAndLimits</p></td>
<td><p>If on, the maximum step length will be limited to
110% of the component length - this makes the
tracking more robust and is the default with a
regular BDSIM physics list. The minimum kinetic
option is also obeyed. Default off.</p></td>
</tr>
<tr class="row-even"><td><p>g4PhysicsUseBDSIMRangeCuts</p></td>
<td><p>If on, this will apply the BDSIM range cut lengths
to the Geant4 physics list used. This is off by
default.</p></td>
</tr>
<tr class="row-odd"><td><p>minimumKineticEnergy</p></td>
<td><p>A particle below this energy will be killed and the
energy deposition recorded at that location. [GeV]
See also, <cite>particlesToExcludeFromCuts</cite>.</p></td>
</tr>
<tr class="row-even"><td><p>minimumKineticEnergyTunnel</p></td>
<td><p>A particle below this energy in any BDSIM-generated
tunnel sections will be killed and the energy
deposition recorded at that location [GeV]</p></td>
</tr>
<tr class="row-odd"><td><p>minimumRange</p></td>
<td><p>A particle that would not travel this range
(a distance) in the current material will be cut [m]</p></td>
</tr>
<tr class="row-even"><td><p>muonSplittingFactor</p></td>
<td><p>An integer of 1 or greater. Number of muons to split
a muon into (biasing) for select processes. See
physics biasing for an explanation. 1 = no effect.
1-206 (depends on Geant4) is acceptable.</p></td>
</tr>
<tr class="row-odd"><td><p>neutronTimeLimit</p></td>
<td><p>Maximum allowed tracking time for a neutron when
using the <cite>neutron_tracking_cut</cite> physics list [s]</p></td>
</tr>
<tr class="row-even"><td><p>neutronKineticEnergyLimit</p></td>
<td><p>Minimum allowed energy for neutrons when using the
<cite>neutron_tracking_cut</cite> physics list [GeV]</p></td>
</tr>
<tr class="row-odd"><td><p>particlesToExcludeFromCuts</p></td>
<td><p>A white space separated string containing PDG IDs for
particles to be excluded from <cite>minimumKineticEnergy</cite>,
<cite>minimumRange</cite>, <cite>maximumTrackingTime</cite>, and
<cite>maximumTrackLength</cite>. e.g. <cite>“13 -13”</cite>.</p></td>
</tr>
<tr class="row-even"><td><p>physicsEnergyLimitLow</p></td>
<td><p>Optional lower energy level for all physics models.
This is usually 990 eV by default in Geant4. The user
may change this if required. Warning, this must
be used only if the user understands how this will
affect the running of Geant4. [GeV]</p></td>
</tr>
<tr class="row-odd"><td><p>physicsEnergyLimitHigh (*)</p></td>
<td><p>Optional upper energy level for all physics models.
This is usually 100 TeV by default in Geant4. The
user may change this if required. Warning, this must
be used only if the user understands how this will
affect the running of Geant4. [GeV]</p></td>
</tr>
<tr class="row-even"><td><p>physicsList</p></td>
<td><p>Which physics lists to use - default tracking only</p></td>
</tr>
<tr class="row-odd"><td><p>physicsVerbose</p></td>
<td><p>Prints out all processes linked to primary particle
and all physics processes registered in general</p></td>
</tr>
<tr class="row-even"><td><p>physicsVerbosity</p></td>
<td><p>Set the physics verbosity for Geant4 (0,1,2).</p></td>
</tr>
<tr class="row-odd"><td><p>prodCutPhotons</p></td>
<td><p>Standard overall production cuts for photons
(default 1e-3) [m]</p></td>
</tr>
<tr class="row-even"><td><p>prodCutElectrons</p></td>
<td><p>Standard overall production cuts for electrons
(default 1e-3) [m]</p></td>
</tr>
<tr class="row-odd"><td><p>prodCutPositrons</p></td>
<td><p>Standard overall production cuts for positrons
(default 1e-3) [m]</p></td>
</tr>
<tr class="row-even"><td><p>prodCutProtons</p></td>
<td><p>Standard overall production cuts for protons
(default 1e-3) [m]</p></td>
</tr>
<tr class="row-odd"><td><p>restoreFTPFDiffractionForAGreater10</p></td>
<td><p>Turn back on diffractive outcomes of hadronic
models. Default is <strong>on</strong>.</p></td>
</tr>
<tr class="row-even"><td><p>stopSecondaries</p></td>
<td><p>Whether to stop secondaries or not (default = false)</p></td>
</tr>
<tr class="row-odd"><td><p>synchRadOn</p></td>
<td><p>Whether to use synchrotron radiation processes</p></td>
</tr>
<tr class="row-even"><td><p>tunnelIsInfiniteAbsorber</p></td>
<td><p>Whether all particles entering the tunnel material
should be killed or not (default = false)</p></td>
</tr>
<tr class="row-odd"><td><p>turnOnCerenkov</p></td>
<td><p>Whether to produce Cherenkov radiation</p></td>
</tr>
<tr class="row-even"><td><p>useElectroNuclear</p></td>
<td><p>Uses electro-nuclear processes when <cite>em_extra</cite> physics
list is used. Default On. Requires Geant4.10.4 or
greater.</p></td>
</tr>
<tr class="row-odd"><td><p>useGammaToMuMu</p></td>
<td><p>Uses gamma to muon pair production process when using
<cite>em_extra</cite> physics list is used. Default Off.
Requires Geant4.10.3 onwards.</p></td>
</tr>
<tr class="row-even"><td><p>useLENDGammaNuclear</p></td>
<td><p>Uses the low-energy neutron data set, as provided by
the environmental variable <cite>G4LENDDATA</cite> when using
the <cite>em_extra</cite> physics list. Boolean. Available in
Geant4.10.4 onwards.</p></td>
</tr>
<tr class="row-odd"><td><p>useMuonNuclear</p></td>
<td><p>Uses muon-nuclear interaction processes when using
<cite>em_extra</cite> physics list. Default On. Requires
Geant4.10.2 onwards.</p></td>
</tr>
<tr class="row-even"><td><p>usePositronToMuMu</p></td>
<td><p>Uses muon pair production from positron annihilation
when using <cite>em_extra</cite> physics list. Default Off.
Requires Geant4.10.3 onwards.</p></td>
</tr>
<tr class="row-odd"><td><p>usePositronToHadrons</p></td>
<td><p>Uses hadron production from positron-electron
annihilation process when using <cite>em_extra</cite> physics
list. Default Off.  Requires Geant4.10.3 onwards.</p></td>
</tr>
<tr class="row-even"><td><p>xrayAllSurfaceRoughness</p></td>
<td><p>The length scale of roughness features for the X-ray
reflection model (from the <cite>xray_reflection</cite> physics
modular list). Default 0, units metres. A typical
value would be 5 nm. This applies to all surfaces.</p></td>
</tr>
</tbody>
</table>
<ul class="simple">
<li><p>(*) If using Geant4.10.7 or upwards, this will also set the high energy limit for the
hadronic physics too. For previous versions of Geant4 it is required to edit the Geant4
source code (G4HadronicParameters.cc).</p></li>
</ul>
</section>
<section id="visualisation">
<h3>Visualisation<a class="headerlink" href="#visualisation" title="Link to this heading"></a></h3>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p><strong>Option</strong></p></th>
<th class="head"><p><strong>Function</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>nSegmentsPerCircle</p></td>
<td><p>the number of facets per 2 <span class="math notranslate nohighlight">\(\pi\)</span> in the
visualiser. Note, this does not affect the accuracy
of the geometry - only the visualisation (default =
50).</p></td>
</tr>
<tr class="row-odd"><td><p>visVerbosity</p></td>
<td><p>(0-5 inclusive) the verbosity level passed into the
Geant4 visualisation system. 0 is the default.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="output-options">
<span id="bdsim-options-output"></span><h3>Output Options<a class="headerlink" href="#output-options" title="Link to this heading"></a></h3>
<p>The particle physics simulation in BDSIM can produce an impressive quantity of output
information. The data describing a full record of every particle and their interaction
would prove too difficult to manage or analyse sensibly. BDSIM records the most useful
information, but provides options to record less or even more data. This is controlled
with the following options.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>These options may increase the output file size by a large amount. Use only the
ones you need.</p>
</div>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p><strong>Option</strong></p></th>
<th class="head"><p><strong>Function</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>apertureImpactsMinimumKE</p></td>
<td><p>Minimum kinetic energy for an aperture impact to be generated (GeV)</p></td>
</tr>
<tr class="row-odd"><td><p>collimatorHitsminimumKE</p></td>
<td><p>Minimum kinetic energy for a collimator hit to be generated (GeV)</p></td>
</tr>
<tr class="row-even"><td><p>elossHistoBinWidth</p></td>
<td><p>The width of the histogram bins [m]</p></td>
</tr>
<tr class="row-odd"><td><p>nperfile</p></td>
<td><p>Number of events to record per output file</p></td>
</tr>
<tr class="row-even"><td><p>outputCompressionLevel</p></td>
<td><p>Number that is 0-9. Compression level that is passed to ROOT’s
TFile. Higher equals more compression but slower writing. 0 is no
compression and 1 minimal. 5 is the default.</p></td>
</tr>
<tr class="row-odd"><td><p>sensitiveOuter</p></td>
<td><p>Whether the outer part of each component (other than the beam
pipe) records energy loss. <cite>storeELoss</cite> is required to be on for
this to work. The user may turn off energy loss from the
beam pipe and retain losses from the magnet outer in combination
with the next option <cite>sensitiveBeamPipe</cite>. Both are stored together
in <cite>Eloss</cite> branch of the Event Tree in the output. Default on.</p></td>
</tr>
<tr class="row-even"><td><p>sensitiveBeamPipe</p></td>
<td><p>Whether the beam pipe records energy loss. This includes cavities.
This can be used in combination with the above option
<cite>sensitiveOuter</cite>, to control which energy loss is recorded.
Energy loss from this option is recorded in the <cite>Eloss</cite> branch
of the Event Tree in the output. Default on.</p></td>
</tr>
<tr class="row-odd"><td><p>storeApertureImpacts</p></td>
<td><p>Create an optional branch called “ApertureImpacts” in the Event
tree in the output that contains coordinates of where the primary
particle exists the beam pipe. Note this could be multiple times.</p></td>
</tr>
<tr class="row-even"><td><p>storeApertureImpactsIons</p></td>
<td><p>If <cite>storeApertureImpacts</cite> is on, the information will be generated
for all secondary ions as well as the primary. No information will
be generated for other particles.</p></td>
</tr>
<tr class="row-odd"><td><p>storeApertureImpactsAll</p></td>
<td><p>If <cite>storeApertureImpacts</cite> is on, the information will be generated
for all particles leaving the beam pipe when this option is turned
on.</p></td>
</tr>
<tr class="row-even"><td><p>storeApertureImpactsHistograms</p></td>
<td><p>Whether to store the primary first aperture impact histogram
<cite>PFirstAI</cite>.  This will automatically be on if
<cite>storeApertureImpacts</cite> is on, and is on by default otherwise.
If both this and <cite>storeApertureImpacts</cite> is off, no aperture
impact hits will be generated and will save memory during the run.</p></td>
</tr>
<tr class="row-odd"><td><p>storeCavityInfo</p></td>
<td><p>With this option on, summary information in the Model Tree about
cavities is stored, including both field and geometry parameters.
Default on.</p></td>
</tr>
<tr class="row-even"><td><p>storeCollimatorHits</p></td>
<td><p>Store hits in per-collimator structures with hits for only primary
particles. With only <cite>storeCollimatorInfo</cite> on, only the
<cite>primaryInteracted</cite> and <cite>primaryStopped</cite> Booleans are stored.</p></td>
</tr>
<tr class="row-odd"><td><p>storeCollimatorHitsIons</p></td>
<td><p>If <cite>storeCollimatorInfo</cite> is on and collimator hits are generated,
<cite>isIon</cite>, <cite>ionA</cite> and <cite>ionZ</cite> variables are filled. Collimator hits
will now also be generated for all ions whether primary or
secondary. Default off.</p></td>
</tr>
<tr class="row-even"><td><p>storeCollimatorHitsAll</p></td>
<td><p>If <cite>storeCollimatorInfo</cite> is on and collimator hits are generated,
hits will be generated for all particles interacting with the
collimators whether primary or secondary and whether ion or not.
Default off.</p></td>
</tr>
<tr class="row-odd"><td><p>storeCollimatorHitsLinks</p></td>
<td><p>If <cite>storeCollimatorHits</cite> is on and collimator hits are generated,
<cite>charge</cite>, <cite>mass</cite>, <cite>rigidity</cite> and <cite>kineticEnergy</cite> variables are
also stored for each collimator hit.</p></td>
</tr>
<tr class="row-even"><td><p>storeCollimatorInfo</p></td>
<td><p>With this option on, summary information in the Model Tree about
only collimators is filled. Collimator structures are created in
the Event Tree of the output for each collimator and prefixed with
“COLL_” and contain hits from (only) primary particles.
Collimator summary histograms are also created and stored. Default
off.</p></td>
</tr>
<tr class="row-odd"><td><p>storeEloss</p></td>
<td><p>Whether to store the energy deposition hits. Default on. By
turning off, <cite>sensitiveBeamPipe</cite> and <cite>sensitiveOuter</cite> have no
effect. Saves run time memory and output file size. See next
option <cite>storeEloss</cite> for combination.</p></td>
</tr>
<tr class="row-even"><td><p>storeElossHistograms</p></td>
<td><p>Whether to store energy deposition histograms <cite>Eloss</cite> and
<cite>ElossPE</cite>. This will automatically be on if <cite>storeEloss</cite> is on.
With <cite>storeEloss</cite> off, this option can be turned on to retain the
energy deposition histograms. If both this and <cite>storeEloss</cite> are
off, no energy deposition hits will be generated saving memory.</p></td>
</tr>
<tr class="row-odd"><td><p>storeElossVacuum</p></td>
<td><p>Whether to store energy deposition from the vacuum volumes as hits
in the <cite>ElossVacuum</cite> branch and the corresponding summary
histograms. Default off.</p></td>
</tr>
<tr class="row-even"><td><p>storeElossVacuumHistograms</p></td>
<td><p>Whether to generate summary histograms of energy deposition in the
vacuum volumes. If <cite>storeElossVacuum</cite> is on, this will be on. The
user may turn off <cite>storeElossVacuum</cite> but turn this on to store
the energy deposition histograms.</p></td>
</tr>
<tr class="row-odd"><td><p>storeElossTunnel</p></td>
<td><p>Whether to store energy deposition hits from the tunnel geometry
in the <cite>ElossTunnel</cite> branch of the Event Tree. Default off.</p></td>
</tr>
<tr class="row-even"><td><p>storeElossTunnelHistograms</p></td>
<td><p>Whether to generate summary histograms of energy deposition in the
tunnel volumes. If <cite>storeElossTunnel</cite> is on, this will be on. The
user may turn off <cite>storeElossTunnel</cite> but turn this on to store
the energy deposition histograms.</p></td>
</tr>
<tr class="row-odd"><td><p>storeElossWorld</p></td>
<td><p>Whether to record energy deposition in the world volume and, in
the case of using Geant4.10.3 or newer, the energy leaving the
world volume as well. Default off.</p></td>
</tr>
<tr class="row-even"><td><p>storeElossWorldIntegral</p></td>
<td><p>Store the total energy deposited in the world in the event summary
for when the hits aren’t wanted but the integral is. Default off.</p></td>
</tr>
<tr class="row-odd"><td><p>storeElossWorldContents</p></td>
<td><p>Whether to record energy deposition in the daughter volumes within
the world volume when supplied as external world geometry.
Default off.</p></td>
</tr>
<tr class="row-even"><td><p>storeElossWorldContentsIntegral</p></td>
<td><p>Store the total energy deposited in the daughter volumes within
the world volume when supplied as external world geometry. For
when the hits aren’t wanted but the integral is. Default off.</p></td>
</tr>
<tr class="row-odd"><td><p>storeElossGlobal</p></td>
<td><p>Global coordinates will be stored for each energy deposition hit
and for each trajectory point. Default off.</p></td>
</tr>
<tr class="row-even"><td><p>storeElossLinks</p></td>
<td><p>For each energy deposition hit, the particle ID, track ID, parent
ID and beam line index will be stored - this is intended to help
‘link’ the energy deposition back to other information. Default
off.</p></td>
</tr>
<tr class="row-odd"><td><p>storeElossLocal</p></td>
<td><p>Local coordinates will be stored for each energy deposition hit
and for each trajectory point. Default off.</p></td>
</tr>
<tr class="row-even"><td><p>storeElossModelID</p></td>
<td><p>Store the beam line index of the object the energy deposition hit
was in. If <cite>storeElossLinks</cite> is on, this will be on irrespective
of this option.</p></td>
</tr>
<tr class="row-odd"><td><p>storeElossPhysicsProcesses</p></td>
<td><p>Store the post step process ID and sub-ID for the step.</p></td>
</tr>
<tr class="row-even"><td><p>storeElossTime</p></td>
<td><p>The time since the start of the event will be stored for each point
of energy deposition and trajectory. Default off.</p></td>
</tr>
<tr class="row-odd"><td><p>storeElossTurn</p></td>
<td><p>Store the turn number of each energy deposition hit. Default off,
but automatically on when using a circular machine with the
(also executable) option <code class="code docutils literal notranslate"><span class="pre">circular</span></code>.</p></td>
</tr>
<tr class="row-even"><td><p>storeElossStepLength</p></td>
<td><p>Stores the step length for each energy deposition hit or not.
Default off.</p></td>
</tr>
<tr class="row-odd"><td><p>storeElossPreStepKineticEnergy</p></td>
<td><p>Stores the kinetic energy of the particle causing energy deposition
as taken from the beginning of the step before it made it. Default
off.</p></td>
</tr>
<tr class="row-even"><td><p>storeMinimalData</p></td>
<td><p>When used, all optional parts of the data are turned off. Any bits
specifically turned on with other options will be respected.</p></td>
</tr>
<tr class="row-odd"><td><p>storeModel</p></td>
<td><p>Whether to store the model information in the output. Default on.</p></td>
</tr>
<tr class="row-even"><td><p>storeParticleData</p></td>
<td><p>Whether to store basic particle information for all particles used
in the simulation under ParticleData in the output. This can be
relatively large when ions are used as there are many thousands
of ion definitions. Default on.</p></td>
</tr>
<tr class="row-odd"><td><p>storePrimaries</p></td>
<td><p>Boolean, true by default. If false, don’t fill the Primary branch
of the Event tree in the output. Useful to minimise file size.</p></td>
</tr>
<tr class="row-even"><td><p>storePrimaryHistograms</p></td>
<td><p>Whether to generate summary histograms of the primary first hit
and loss point versus S coordinate per event. On by default.</p></td>
</tr>
<tr class="row-odd"><td><p>storeSamplerAll</p></td>
<td><p>Convenience option to turn on all optional sampler output.
Equivalent to turning on <cite>storeSamplerCharge</cite>,
<cite>storeSamplerKineticEnergy</cite>, <cite>storeSamplerMass</cite>,
<cite>storeSamplerRigidity</cite>, <cite>storeSamplerIon</cite>. Overrides these
options even if they are explicitly set to off (0).</p></td>
</tr>
<tr class="row-even"><td><p>storeSamplerCharge</p></td>
<td><p>Stores corresponding charge of particle for every entry in sampler</p></td>
</tr>
<tr class="row-odd"><td><p>storeSamplerKineticEnergy</p></td>
<td><p>Stores corresponding kinetic energy of particle for every entry in
sampler.</p></td>
</tr>
<tr class="row-even"><td><p>storeSamplerMass</p></td>
<td><p>Stores corresponding mass (in GeV) of particle for every entry in
the sampler.</p></td>
</tr>
<tr class="row-odd"><td><p>storeSamplerPolarCoords</p></td>
<td><p>Calculate and store the polar coordinates (r, phi) and (rp, phip)
for the sampler data.</p></td>
</tr>
<tr class="row-even"><td><p>storeSamplerRigidity</p></td>
<td><p>Stores the rigidity (in Tm) of particle for every entry in sampler</p></td>
</tr>
<tr class="row-odd"><td><p>storeSamplerIon</p></td>
<td><p>Stores A, Z and Boolean whether the entry is an ion or not as well
as the <cite>nElectrons</cite> variable for possible number of electrons.</p></td>
</tr>
<tr class="row-even"><td><p>samplersSplitLevel</p></td>
<td><p>The ROOT split-level of the branch. Default 0 (unsplit). Set to 1
or 2 to allow columnar access (e.g. with <cite>uproot</cite>).</p></td>
</tr>
<tr class="row-odd"><td><p>modelSplitLevel</p></td>
<td><p>The ROOT split-level of the branch. Default 1. Set to 2
to allow columnar access (e.g. with <cite>uproot</cite>).</p></td>
</tr>
<tr class="row-even"><td><p>uprootCompatible</p></td>
<td><p>The ROOT split-level for the branches samplers and model.
Default 0. Set to 1 will set samplersSplitLevel = 1 and
ModelSplitLevel = 1.</p></td>
</tr>
<tr class="row-odd"><td><p>storeTrajectory</p></td>
<td><p>Whether to store trajectories. If turned on, only the primary
particle(s) trajectory(ies) are stored by default. This is
required for the storage of any other trajectories at all. Note
the combination of all filters along with this is logical OR.</p></td>
</tr>
<tr class="row-even"><td><p>storeTrajectories</p></td>
<td><p>An alias to <cite>storeTrajectory</cite></p></td>
</tr>
<tr class="row-odd"><td><p>writeSeedState</p></td>
<td><p>Writes the seed state of the last event start in a text file</p></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Using <code class="code docutils literal notranslate"><span class="pre">samplersSplitLevel</span></code> &gt; 0 could lead to increasing simulation time in the case of many samplers
and, therefore the optics computation.</p>
</div>
</section>
<section id="trajectory-filtering-options">
<span id="options-trajectory-filtering"></span><h3>Trajectory Filtering Options<a class="headerlink" href="#trajectory-filtering-options" title="Link to this heading"></a></h3>
<p>These options control, if <code class="code docutils literal notranslate"><span class="pre">storeTrajectory=1;</span></code>, which tracks trajectories should be prepared for.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p><strong>Option</strong></p></th>
<th class="head"><p><strong>Function</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>storeTrajectoryDepth</p></td>
<td><p>The depth of the particle tree to store the trajectories to. 0 is
the primary, 1 is the first generation of secondaries, etc. -1
can be used to store all (i.e. to infinite depth).</p></td>
</tr>
<tr class="row-odd"><td><p>storeTrajectoryELossSRange</p></td>
<td><p>Ranges in curvilinear S coordinate that if a particular track
causes energy deposition in this range, its trajectory will be
stored. The value should be a string inside which are pairs of
numbers separated by a colon and ranges separated by whitespace
such as “0.3:1.23 45.6:47.6”. (m)</p></td>
</tr>
<tr class="row-even"><td><p>storeTrajectoryEnergyThreshold</p></td>
<td><p>The threshold <strong>kinetic</strong> energy for storing trajectories.
Only particles starting with a kinetic energy greater than this
will have trajectories stored for them. (GeV)</p></td>
</tr>
<tr class="row-odd"><td><p>storeTrajectoryParticle</p></td>
<td><p>The Geant4 name of particle(s) to only store trajectories for.
This is case sensitive. Multiple particle names can be used with
a space between them. e.g. “proton pi-“.</p></td>
</tr>
<tr class="row-even"><td><p>storeTrajectoryParticleID</p></td>
<td><p>The PDG ID of the particle(s) to only store trajectories for.
Multiple particle IDs can be supplied with a space between them.
e.g. “11 12 22 13”. Note, the anti-particles must be individually
specified.</p></td>
</tr>
<tr class="row-odd"><td><p>storeTrajectorySecondaryParticles</p></td>
<td><p>Mark a trajectory for storage if it is not a primary particle.</p></td>
</tr>
<tr class="row-even"><td><p>storeTrajectorySamplerID</p></td>
<td><p>If a trajectory reaches the name of these samplers, store that
trajectory. This value supplied should be a whitespace separated
string such as “cd1 qf32x”. If the same element exists multiple
times, all matches will be stored.</p></td>
</tr>
<tr class="row-odd"><td><p>storeTrajectoryTransportationSteps</p></td>
<td><p>On by default. If true, include steps in the trajectories that
are created by transportation only. When a particle crosses a
boundary, this forces a step in geant4 and therefore another
trajectory point. Legacy option is <code class="code docutils literal notranslate"><span class="pre">trajNoTransportation</span></code>
that is opposite to this option.</p></td>
</tr>
<tr class="row-even"><td><p>trajectoryConnect (*)</p></td>
<td><p>Stores all the trajectories that connect a trajectory to be
stored all the way to the primary particle. For example, if the
filters from other trajectory options are to store only muons
with an energy greater than 10 GeV, the few trajectories stored
would appear unrelated. This option forces the storage of only
the trajectories of any particles (irrespective of filters) that
lead to the muon in question.</p></td>
</tr>
<tr class="row-odd"><td><p>trajectoryFilterLogicAND</p></td>
<td><p>False by default. If set to true (=1) only particles that match
all of the specified filters will be stored. This is opposite to
the more inclusive OR logic used where a trajectory will be stored
if matches any of the specified filters.</p></td>
</tr>
<tr class="row-even"><td><p>trajCutGTZ</p></td>
<td><p>Only stores trajectories whose <em>global</em> z-coordinate is greater
than this value in metres [m].</p></td>
</tr>
<tr class="row-odd"><td><p>trajCutLTR</p></td>
<td><p>Only stores trajectories whose <em>global</em> radius is from the start
position (sqrt(x^2, y^2)).</p></td>
</tr>
</tbody>
</table>
</section>
<section id="trajectory-storage-options">
<span id="options-trajectory-storage"></span><h3>Trajectory Storage Options<a class="headerlink" href="#trajectory-storage-options" title="Link to this heading"></a></h3>
<p>These options control what information or variables are written to file <strong>for</strong> a given trajectory
that has passed the filters above.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p><strong>Option</strong></p></th>
<th class="head"><p><strong>Function</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>storeTrajectoryAllVariables</p></td>
<td><p>Override and turn on <cite>storeTrajectoryIon</cite>, <cite>storeTrajectoryLocal</cite>,
<cite>storeTrajectoryKineticEnergy</cite>, <cite>storeTrajectoryMomentumVector</cite>,
<cite>storeTrajectoryProcesses</cite>, <cite>storeTrajectoryTime</cite>, and
<cite>storeTrajectoryLinks</cite>.</p></td>
</tr>
<tr class="row-odd"><td><p>storeTrajectoryIon</p></td>
<td><p>Store <cite>isIon</cite>, <cite>ionA</cite>, <cite>ionZ</cite> and <cite>nElectrons</cite> variables.</p></td>
</tr>
<tr class="row-even"><td><p>storeTrajectoryKineticEnergy</p></td>
<td><p>Store <cite>kineticEnergy</cite> for each step. Default True.</p></td>
</tr>
<tr class="row-odd"><td><p>storeTrajectoryLocal</p></td>
<td><p>Store <cite>xyz</cite> and <cite>pxpypz</cite> local coordinate variables.</p></td>
</tr>
<tr class="row-even"><td><p>storeTrajectoryLinks</p></td>
<td><p>Store <cite>charge</cite>, <cite>kineticEnergy</cite>, <cite>turnsTaken</cite>, <cite>mass</cite> and
<cite>rigidity</cite> variables for each step.</p></td>
</tr>
<tr class="row-odd"><td><p>storeTrajectoryMaterial</p></td>
<td><p>Store an integer ID for the material of the material at that point
in the trajectory. The ID can be looked up in the Model tree to
get the name of the material.</p></td>
</tr>
<tr class="row-even"><td><p>storeTrajectoryMomentumVector</p></td>
<td><p>Store <cite>PXPYPZ</cite>, momentum (not unit) 3-vector in GeV for each step.
Default False.</p></td>
</tr>
<tr class="row-odd"><td><p>storeTrajectoryProcesses</p></td>
<td><p>Store <cite>preProcessTypes</cite>, <cite>preProcessSubTypes</cite>, <cite>postProcessTypes</cite>,
<cite>postProcessSubTypes</cite>, the Geant4 integer process IDs for pre and
post step points. Default False.</p></td>
</tr>
<tr class="row-even"><td><p>storeTrajectoryStepPoints (*)</p></td>
<td><p>Integer number of step points to store for each trajectory that is
chosen to be stored. Should be greater than or equal to 1. -1 can
be used to mean ‘all’ step points. Storing
1 will mean only the first creation point is stored. Caution, this
will break any references to step index such as parentStepIndex in
other trajectories. It is purely a last storage filtering step.</p></td>
</tr>
<tr class="row-odd"><td><p>storeTrajectoryStepPointLast (*)</p></td>
<td><p>Boolean. If true, and used in combination with the option
<cite>storeTrajectoryStepPoints</cite>, the end point of the trajectory is
also stored.</p></td>
</tr>
<tr class="row-even"><td><p>storeTrajectoryTime</p></td>
<td><p>Store <cite>T</cite>, time in ns for each step. Default False.</p></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>(*) If the option <code class="code docutils literal notranslate"><span class="pre">storeTrajectoryStepPoints</span></code> (as well as possibly
<code class="code docutils literal notranslate"><span class="pre">storeTrajectoryStepPointLast</span></code>) are used, then the <code class="code docutils literal notranslate"><span class="pre">trajectoryConnect</span></code> option may
not work as intended. Although the correct trajectories for connection will be prepared, they
will be cut short by when writing to the output according to the number of step points desired.
Therefore, the connection point (and trajectory point index) may not be valid.</p>
</div>
</section>
<section id="print-out-options">
<span id="bdsim-options-verbosity"></span><h3>Print Out Options<a class="headerlink" href="#print-out-options" title="Link to this heading"></a></h3>
<p>The following options control the level of print out both from BDSIM and from Geant4. Note, excessive
amounts of output will cause a simulation to run slowly and should only be used for understanding a
particular physics outcome if really desired or not understood. It is recommended to print out as little
as possible and then work ‘up’ to more print out as required.</p>
<p>BDSIM generally prints out the most minimal information for its purpose. The physics tables printed out can be
lengthy, but are an important set of information for a given simulation.</p>
<p>Some of the following options are available through executable options (with different names). See
<a class="reference internal" href="running.html#executable-options"><span class="std std-ref">Executable Options</span></a> for more details.</p>
<p>Recommendations:</p>
<ul class="simple">
<li><p><cite>--verboseSteppingLevel=2</cite> to see one line per entry / exit of a volume to see where a particle is going.</p></li>
<li><p>“Tracking” refers to a particle track which is essentially one particle being put through the simulation.</p></li>
<li><p>Stepping is the incremental step of each particle trajectory through the simulation.</p></li>
<li><p>Event is the minimal unit of simulation - usually in BDSIM this is the propagation of 1 primary particle.</p></li>
<li><p>Run is a group of events where the physics and geometry remained the same.</p></li>
</ul>
<p>The options listed below are list roughly in terms of the simulation hierarchy.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p><strong>Option</strong></p></th>
<th class="head"><p><strong>Type</strong></p></th>
<th class="head"><p><strong>Description</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>verbose</p></td>
<td><p>Boolean</p></td>
<td><p>Whether general verbosity is on - some extra print out.
This highlights general construction steps of the
geometry; print out any field definitions defined in the
parser; a summary of all modular physics lists activated
or not.</p></td>
</tr>
<tr class="row-odd"><td><p>verboseRunLevel</p></td>
<td><p>integer</p></td>
<td><p>(0-5) level of Geant4 run level print out. The same as
<cite>-\-verboseRun=X</cite> executable option.</p></td>
</tr>
<tr class="row-even"><td><p>verboseEventBDSIM</p></td>
<td><p>Boolean</p></td>
<td><p>Extra print out identifying the start and end of event
action as well as the allocator pool sizes. Print out
the size of each hits collection if it exists at all. The
same as <cite>-\-verboseEventBDSIM</cite> executable option.</p></td>
</tr>
<tr class="row-odd"><td><p>verboseEventStart</p></td>
<td><p>integer</p></td>
<td><p>Event index to start print out according to
<cite>verboseEventBDSIM</cite>. Zero counting.</p></td>
</tr>
<tr class="row-even"><td><p>verboseEventContinueFor</p></td>
<td><p>integer</p></td>
<td><p>Number of events to continue print out event information
according to <cite>verboseEventBDSIM</cite>. -1 means all subsequent
events.</p></td>
</tr>
<tr class="row-odd"><td><p>verboseEventLevel</p></td>
<td><p>integer</p></td>
<td><p>(0-5) level of Geant4 event level print out for all
events.</p></td>
</tr>
<tr class="row-even"><td><p>verboseSteppingBDSIM</p></td>
<td><p>Boolean</p></td>
<td><p>Extra print out for all steps of all particles from BDSIM
for events in the range according to <cite>verboseSteppingEventStart</cite>
and <cite>verboseSteppingEventContinueFor</cite>. Default is all events.</p></td>
</tr>
<tr class="row-odd"><td><p>verboseSteppingLevel</p></td>
<td><p>integer</p></td>
<td><p>(0-5) level of Geant4 print out per step of each particle. This
done according to the range of <cite>verboseSteppingEventStart, and
`verboseSteppingEventContinueFor</cite>. Default is all events and all
particles.</p></td>
</tr>
<tr class="row-even"><td><p>verboseSteppingEventStart</p></td>
<td><p>integer</p></td>
<td><p>Event offset (zero counting) to start stepping print out
according to <cite>verboseSteppingLevel</cite>.</p></td>
</tr>
<tr class="row-odd"><td><p>verboseSteppingEventContinueFor</p></td>
<td><p>integer</p></td>
<td><p>Number of events to continue print out stepping information for
according to <cite>verboseSteppingLevel</cite>.</p></td>
</tr>
<tr class="row-even"><td><p>verboseSteppingPrimaryOnly</p></td>
<td><p>Boolean</p></td>
<td><p>If true, only print out stepping information for the primary.</p></td>
</tr>
<tr class="row-odd"><td><p>verboseImportanceSampling</p></td>
<td><p>integer</p></td>
<td><p>(0-5) level of importance sampling related print out.</p></td>
</tr>
<tr class="row-even"><td><p>verboseStep</p></td>
<td><p>Boolean</p></td>
<td><p>Whether to use the verbose stepping action for every
step. Note, this is a lot of output.</p></td>
</tr>
<tr class="row-odd"><td><p>verboseSteppingLevel</p></td>
<td><p>integer</p></td>
<td><p>(0-5) level of Geant4 stepping level print out. The same
as <cite>-\-verbose_G4stepping=X</cite> executable option.</p></td>
</tr>
<tr class="row-even"><td><p>verboseTrackingLevel</p></td>
<td><p>integer</p></td>
<td><p>(0-5) level of Geant4 tracking level print out. The same
as <cite>-\-verbose_G4tracking=X</cite> executable option.</p></td>
</tr>
<tr class="row-odd"><td><p>verboseSensitivity</p></td>
<td><p>Boolean</p></td>
<td><p>If true, print out the name of the sensitivte detector attached
to every single volume in the model once fully constructed.</p></td>
</tr>
</tbody>
</table>
<p>Examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">option</span><span class="p">,</span> <span class="n">verboseEventStart</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
        <span class="n">verboseEventLevel</span><span class="o">=</span><span class="mi">2</span><span class="p">;</span>
</pre></div>
</div>
<p>This will print out verbose stepping information for the primary particle (default is only the primary)
for the 4th event onwards (3 in 0 counting) with a verbose stepping level of 2 showing individual volumes. This
example is in <code class="code docutils literal notranslate"><span class="pre">bdsim/examples/features/options/verboseEvent-primaries.gmad</span></code>. This will print out for
every event after this.  Another example is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">option</span><span class="p">,</span> <span class="n">verboseSteppingEventStart</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
        <span class="n">verboseSteppingLevel</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="n">verboseSteppingEventContinueFor</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">verboseSteppingPrimaryOnly</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
</pre></div>
</div>
<p>This will print out verbose stepping information for all particles starting from the 4th event for 1 event.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">bdsim</span> <span class="o">--</span><span class="n">file</span><span class="o">=</span><span class="n">sm</span><span class="o">.</span><span class="n">gmad</span> <span class="o">--</span><span class="n">batch</span> <span class="o">--</span><span class="n">ngenerate</span><span class="o">=</span><span class="mi">10</span> <span class="o">--</span><span class="n">verboseSteppingLevel</span><span class="o">=</span><span class="mi">2</span> <span class="o">--</span><span class="n">verboseSteppingEventStart</span><span class="o">=</span><span class="mi">3</span> \\
      <span class="o">--</span><span class="n">verboseSteppingEventContinueFor</span><span class="o">=</span><span class="mi">1</span> <span class="o">--</span><span class="n">verboseSteppingPrimaryOnly</span>
</pre></div>
</div>
<p>This will print out the volume name for each step of the primary particle (only) for event #3 (the 4th event).</p>
</section>
<section id="offset-for-main-beam-line">
<span id="beamline-offset"></span><h3>Offset for Main Beam Line<a class="headerlink" href="#offset-for-main-beam-line" title="Link to this heading"></a></h3>
<p>The following options may be used to offset the main beam line with respect to the world
volume, which is the outermost coordinate system.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The beam definition moves with the beamline. It is ‘attached’ or relative
to the start of the beamline. Consider introducing a <cite>transform3d</cite> element
at the start if you want to offset the beamline but not the beam.</p>
</div>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p><strong>Option</strong></p></th>
<th class="head"><p><strong>Function</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>beamlineX</p></td>
<td><p>Offset in x</p></td>
</tr>
<tr class="row-odd"><td><p>beamlineY</p></td>
<td><p>Offset in y</p></td>
</tr>
<tr class="row-even"><td><p>beamlineZ</p></td>
<td><p>Offset in z</p></td>
</tr>
<tr class="row-odd"><td><p>beamlinePhi</p></td>
<td><p>Euler angle phi for rotation</p></td>
</tr>
<tr class="row-even"><td><p>beamlineTheta</p></td>
<td><p>Euler angle theta for rotation</p></td>
</tr>
<tr class="row-odd"><td><p>beamlinePsi</p></td>
<td><p>Euler angle psi for rotation</p></td>
</tr>
<tr class="row-even"><td><p>beamlineAxisX</p></td>
<td><p>Axis angle rotation x-component of unit vector</p></td>
</tr>
<tr class="row-odd"><td><p>beamlineAxisY</p></td>
<td><p>Axis angle rotation y-component of unit vector</p></td>
</tr>
<tr class="row-even"><td><p>beamlineAxisZ</p></td>
<td><p>Axis angle rotation z-component of unit vector</p></td>
</tr>
<tr class="row-odd"><td><p>beamlineAngle</p></td>
<td><p>Axis angle to rotate about unit vector.</p></td>
</tr>
<tr class="row-even"><td><p>beamlineAxisAngle</p></td>
<td><p>Boolean whether to use axis angle rotation scheme (default false)</p></td>
</tr>
<tr class="row-odd"><td><p>beamlineS</p></td>
<td><p>S offset of start of beamline (default 0)</p></td>
</tr>
</tbody>
</table>
<p>Two styles of rotation can be used: either a set of three Euler angles, or the axis angle
rotation scheme where a <strong>unit</strong> vector is provided in <span class="math notranslate nohighlight">\(x,y,z\)</span> and an angle to
rotate about it. These variables are used to construct a <code class="code docutils literal notranslate"><span class="pre">G4RotationMatrix</span></code>
directly, which is also the same as a <code class="code docutils literal notranslate"><span class="pre">CLHEP::HepRotation</span></code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Geant4 uses a right-handed coordinate system and <span class="math notranslate nohighlight">\(m\)</span> and <span class="math notranslate nohighlight">\(rad\)</span> are
the default units for offsets and angles in BDSIM.</p>
</div>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">option</span><span class="p">,</span> <span class="n">beamlineX</span> <span class="o">=</span> <span class="mi">3</span><span class="o">*</span><span class="n">m</span><span class="p">,</span>
        <span class="n">beamlineY</span> <span class="o">=</span> <span class="mi">20</span><span class="o">*</span><span class="n">cm</span><span class="p">,</span>
        <span class="n">beamlineZ</span> <span class="o">=</span> <span class="o">-</span><span class="mi">30</span><span class="o">*</span><span class="n">m</span><span class="p">,</span>
        <span class="n">beamlineAxisAngle</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">beamlineAxisY</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">beamlineAngle</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">;</span>
</pre></div>
</div>
<p>This offsets the beam line by (3,0.2,-30) m and rotates about the unit vector (0,1,0) (i.e. in the
horizontal plane - x,z) by 0.2 rad.</p>
</section>
<section id="scoring-map">
<span id="scoring-map-description"></span><h3>Scoring Map<a class="headerlink" href="#scoring-map" title="Link to this heading"></a></h3>
<p>BDSIM provides the capability to create one 3D histogram of energy deposition hits irrespective
of the geometry. The hits are only created where the geometry exists and are sensitive.
The histogram is independent of the geometry.</p>
<ul class="simple">
<li><p>The user should ideally set all parameters to specify the desire ranges, otherwise be
aware of the default values.</p></li>
<li><p>BDSIM will exit with a warning if zero range is found in any dimension as this means
nothing will be histogrammed and there is no point in continuing.</p></li>
</ul>
<p>An example can be found in <code class="code docutils literal notranslate"><span class="pre">bdsim/examples/features/io/1_rootevent/sc_scoringmap.gmad</span></code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This is called a scoring map for historical reasons but it does not limit the step
length in the way a typical Geant4 scoring map would. This only histograms energy
deposition data.</p>
</div>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p><strong>Option</strong></p></th>
<th class="head"><p><strong>Default</strong></p></th>
<th class="head"><p><strong>Function</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>useScoringMap</p></td>
<td><p>0</p></td>
<td><p>Whether to create a scoring map</p></td>
</tr>
<tr class="row-odd"><td><p>nbinsx</p></td>
<td><p>1</p></td>
<td><p>Number of bins in global X</p></td>
</tr>
<tr class="row-even"><td><p>nbinsy</p></td>
<td><p>1</p></td>
<td><p>Number of bins in global Y</p></td>
</tr>
<tr class="row-odd"><td><p>nbinsz</p></td>
<td><p>1</p></td>
<td><p>Number of bins in global Z</p></td>
</tr>
<tr class="row-even"><td><p>nbinse</p></td>
<td><p>1</p></td>
<td><p>Number of bins in Energy</p></td>
</tr>
<tr class="row-odd"><td><p>xmin</p></td>
<td><p>-0.5</p></td>
<td><p>Lower global X limit (m)</p></td>
</tr>
<tr class="row-even"><td><p>xmax</p></td>
<td><p>0.5</p></td>
<td><p>Upper global X limit (m)</p></td>
</tr>
<tr class="row-odd"><td><p>ymin</p></td>
<td><p>-0.5</p></td>
<td><p>Lower global Y limit (m)</p></td>
</tr>
<tr class="row-even"><td><p>ymax</p></td>
<td><p>0.5</p></td>
<td><p>Upper global Y limit (m)</p></td>
</tr>
<tr class="row-odd"><td><p>zmin</p></td>
<td><p>0</p></td>
<td><p>Lower global Z limit (m)</p></td>
</tr>
<tr class="row-even"><td><p>zmax</p></td>
<td><p>1</p></td>
<td><p>Upper global Z limit (m)</p></td>
</tr>
<tr class="row-odd"><td><p>emin</p></td>
<td><p>1e-12</p></td>
<td><p>Lower Energy limit (GeV)</p></td>
</tr>
<tr class="row-even"><td><p>emax</p></td>
<td><p>1e4</p></td>
<td><p>Upper Energy limit (GeV)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="developer-options">
<span id="id12"></span><h3>Developer Options<a class="headerlink" href="#developer-options" title="Link to this heading"></a></h3>
<p>These are documented here, but use with caution, as they lead to undesirable behaviour and
should only be used with understanding.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p><strong>Option</strong></p></th>
<th class="head"><p><strong>Description</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>chordStepMinimum</p></td>
<td><p>Minimum step size</p></td>
</tr>
<tr class="row-odd"><td><p>deltaChord</p></td>
<td><p>Chord finder precision</p></td>
</tr>
<tr class="row-even"><td><p>deltaIntersection</p></td>
<td><p>Boundary intersection precision</p></td>
</tr>
<tr class="row-odd"><td><p>deltaOneStep</p></td>
<td><p>Set position error acceptable in an integration step</p></td>
</tr>
<tr class="row-even"><td><p>lengthSafety</p></td>
<td><p>Element overlap safety (caution!)</p></td>
</tr>
<tr class="row-odd"><td><p>maximumEpsilonStep</p></td>
<td><p>Maximum relative error acceptable in stepping</p></td>
</tr>
<tr class="row-even"><td><p>minimumEpsilonStep</p></td>
<td><p>Minimum relative error acceptable in stepping</p></td>
</tr>
<tr class="row-odd"><td><p>maximumEpsilonStepThin</p></td>
<td><p>Similar to maximumEpsilonStep but for thin objects</p></td>
</tr>
<tr class="row-even"><td><p>minimumEpsilonStepThin</p></td>
<td><p>Similar to minimumEpsilonStep but for thin objects</p></td>
</tr>
<tr class="row-odd"><td><p>sampleElementsWithPoleface</p></td>
<td><p>Default false. Samplers are not to be attached to elements with
poleface rotations, as the sampler will overlap with the mass world
geometry, resulting in incorrect tracking. This only occurs in
integrator sets which construct the poleface geometry, namely
<code class="code docutils literal notranslate"><span class="pre">bdsimtwo</span></code>, <code class="code docutils literal notranslate"><span class="pre">geant4</span></code>, and <code class="code docutils literal notranslate"><span class="pre">geant4dp</span></code>. This option
overrides this, allowing samplers to be attached. This option will
not affect the default integrator set, <code class="code docutils literal notranslate"><span class="pre">bdsimmatrix</span></code>.</p></td>
</tr>
<tr class="row-even"><td><p>teleporterFullTransform</p></td>
<td><p>Default true. Whether to use the newer teleporter offset method
that uses a G4Transform3D to apply both an offset and a rotation.
The newer method works in any 3D orientation whereas the old one
only works with the beam line starting along unit Z (i.e. no
beam line offset or rotation.</p></td>
</tr>
<tr class="row-odd"><td><p>beam, offsetSampleMean=1</p></td>
<td><p>Default false. If true, this will remove the sample mean from the
bunch distribution to match the central values. This is useful for
optical function calculation. BDSIM is not currently able to
reproduce results when this option is used and coordinates will
be different for each run, or even when using -\-recreate.  Only
suitable for large (&gt;100) numbers of particles. Note: this isn’t
an option, but part of the beam command. This cannot be used with
the visualiser.</p></td>
</tr>
<tr class="row-even"><td><p>backupStepperMomLimit</p></td>
<td><p>Default = 0.1. Fractional unit momentum limit beyond which the
matrix integrator reverts back to a backup stepper, generally RK4.
Every bdsim integrator that applies matrix-style stepping will
check Zp &lt; (1-limit), and often (Xp &gt; limit) &amp; (Yp &gt; limit).
Changing this limit will affect tracking of large angle particles.</p></td>
</tr>
<tr class="row-odd"><td><p>buildPoleFaceGeometry</p></td>
<td><p>Default = true. Build bending magnet pole face geometry when using
the geant4 integrator sets. This option doesn’t affect the
behaviour of matrix integrator sets where angled face geometry is
never constructed.</p></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="output-at-a-surface-samplers">
<span id="sampler-output"></span><h2>Output at a Surface - Samplers<a class="headerlink" href="#output-at-a-surface-samplers" title="Link to this heading"></a></h2>
<p>BDSIM provides a ‘sampler’ as a means to record the particle distribution at a
point in the model as defined by a plane, the surface of a cylinder, or the
surface of a sphere. Data is recorded in the frame of the sampler.</p>
<ul class="simple">
<li><p>A <strong>sampler</strong> records the kinematic variables of a single particle passing through a surface</p></li>
<li><p><strong>Scoring</strong> refers to the accumulation of a quantity (e.g. dose) for a volume (see <a class="reference internal" href="#scoring"><span class="std std-ref">Scoring</span></a>)</p></li>
</ul>
<p>Samplers may have the following forms:</p>
<ol class="arabic simple">
<li><p>a <strong>plane</strong></p></li>
<li><p>a <strong>cylinder</strong></p></li>
<li><p>a <strong>sphere</strong>.</p></li>
</ol>
<p>The plane is the most commonly used and can be ‘attached’ to an already defined beam line
element and records all the particles passing through a plane at the <strong>exit</strong> face of
that element. The cylinder can be attached to a beam line element also.</p>
<p>A spherical sampler can only be placed through a samplerplacement.</p>
<p>A sampler will record <strong>any particles</strong> passing through that plane in <strong>any direction</strong>.
The plane sampler is practically defined in the Geant4 model built by BDSIM as a box
5 x 5 m that is 1 nm thick. The user may consider it an infinitely thin plane.</p>
<p>Samplers are built in a parallel world and are normally invisible. They can ‘overlap’
existing geometry but we should avoid having faces of shapes coincident as this may
affect tracking (‘co-planar’ faces).</p>
<section id="attaching-a-plane-sampler-to-a-beamline-element">
<span id="sampler-syntax"></span><h3>Attaching a Plane Sampler to a Beamline Element<a class="headerlink" href="#attaching-a-plane-sampler-to-a-beamline-element" title="Link to this heading"></a></h3>
<p>They are defined using the following syntax:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sample</span><span class="p">,</span> <span class="nb">range</span><span class="o">=&lt;</span><span class="n">element_name</span><span class="o">&gt;</span><span class="p">;</span>
</pre></div>
</div>
<p>where <cite>element_name</cite> is the name of the element you wish to sample. Depending on the
output format chosen, the element name may be recorded in the output (‘rootevent’ output only).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Samplers <strong>can only</strong> be defined <strong>after</strong> the main sequence has been defined
using the <strong>use</strong> command (see <a class="reference internal" href="model_construction.html#the-use-command"><span class="std std-ref">use - Defining which Line to Use</span></a>). Failure to do
so will result in an error and BDSIM will exit.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Samplers record <strong>all</strong> particles impinging on them (i.e. both forwards and
backwards). Even secondary particles that may originate from further along the
lattice are recorded. They have no material so they do not absorb or affect
particles, only witness them.</p>
</div>
<p>To place a sampler before an item, attach it to the previous item. If however,
you wish to record the coordinates with another name rather than the name of the
element before, you can define a marker; place it in the sequence; and then define
a sampler that uses that marker:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">d1</span><span class="p">:</span> <span class="n">drift</span><span class="p">,</span> <span class="n">l</span><span class="o">=</span><span class="mf">2.4</span><span class="o">*</span><span class="n">m</span><span class="p">;</span>
<span class="n">d2</span><span class="p">:</span> <span class="n">drift</span><span class="p">,</span> <span class="n">l</span><span class="o">=</span><span class="mi">1</span><span class="o">*</span><span class="n">m</span><span class="p">;</span>
<span class="n">interestingplane</span><span class="p">:</span> <span class="n">marker</span><span class="p">;</span>
<span class="n">l1</span><span class="p">:</span> <span class="n">line</span><span class="o">=</span><span class="p">(</span><span class="n">d1</span><span class="p">,</span><span class="n">d1</span><span class="p">,</span><span class="n">interestingplane</span><span class="p">,</span><span class="n">d2</span><span class="p">,</span><span class="n">d1</span><span class="p">);</span>
<span class="n">use</span><span class="p">,</span><span class="n">period</span><span class="o">=</span><span class="n">l1</span><span class="p">;</span>

<span class="n">sample</span><span class="p">,</span> <span class="nb">range</span> <span class="o">=</span> <span class="n">interestingplane</span><span class="p">;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If an element with an attached sampler is followed by a marker with an attached sampler,
the BDSIM output will not contain sampler data for the element as it would be identical to
that of the marker.</p>
</div>
<p>When an element is defined multiple times in the line (such as “d1” in the above example),
samplers will be attached to all instances. If you wish to sample only one specific
instance, the following syntax can be used:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sample</span><span class="p">,</span> <span class="nb">range</span><span class="o">=&lt;</span><span class="n">element_name</span><span class="o">&gt;</span><span class="p">[</span><span class="n">index</span><span class="p">];</span>
</pre></div>
</div>
<p>To attach samplers after all elements:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sample</span><span class="p">,</span> <span class="nb">all</span><span class="p">;</span>
</pre></div>
</div>
<p>And to attach samplers after all elements of a specific type:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sample</span><span class="p">,</span> <span class="o">&lt;</span><span class="nb">type</span><span class="o">&gt;</span><span class="p">;</span>
</pre></div>
</div>
<p>e.g.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sample</span><span class="p">,</span> <span class="n">quadrupole</span><span class="p">;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If a sampler is placed at the very beginning of the lattice, it may appear
that only approximately half of the primary particles seem to pass through it. This
is the correct behaviour, as unlike an optics program such as MAD-X, the sampler
represents a thin plane in 3D space in BDSIM. If the beam distribution has some
finite extent in <em>z</em> or <em>t</em>, particles may start beyond this first sampler and
never pass through it.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The record of the primary particle coordinates in the output (“Primary”) may
resemble a sampler but it is just a record of the initial coordinates. It is
not a sampler and cannot record other secondary particles.</p>
</div>
<section id="plane-sampler-dimensions">
<span id="sampler-dimensions"></span><h4>Plane Sampler Dimensions<a class="headerlink" href="#plane-sampler-dimensions" title="Link to this heading"></a></h4>
<p>The sampler is represented by a box solid that is 1 nm thick along z and 5m wide
transversely in x and y. If a smaller or larger capture area for the samplers is required,
the option <em>samplerDiameter</em> may be specified in the input gmad.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">option</span><span class="p">,</span> <span class="n">samplerDiameter</span><span class="o">=</span><span class="mi">3</span><span class="o">*</span><span class="n">m</span><span class="p">;</span>
</pre></div>
</div>
<p>This affects all plane samplers.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For a very low energy lattice with large angle bends, the default samplerDiameter
may cause geometrical overlap warnings from Geant4. This situation is difficult to
avoid automatically, but easy to remedy by setting the samplerDiameter to a lower
value. We recommend reducing <code class="code docutils literal notranslate"><span class="pre">samplerDiameter</span></code> for low energy or strongly
curving accelerators.</p>
</div>
</section>
</section>
<section id="attaching-a-cylindrical-sampler-to-a-beamline-element">
<h3>Attaching a Cylindrical Sampler to a Beamline Element<a class="headerlink" href="#attaching-a-cylindrical-sampler-to-a-beamline-element" title="Link to this heading"></a></h3>
<p>A cylindrical sampler places a thin cylinder around a beamline element that records hits
in a cylindrical coordinate system about the z axis of that component. The syntax is the
same as a plane sampler except for the command <code class="code docutils literal notranslate"><span class="pre">csample</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">csample</span><span class="p">,</span> <span class="nb">range</span><span class="o">=&lt;</span><span class="n">element_name</span><span class="o">&gt;</span><span class="p">[</span><span class="n">index</span><span class="p">];</span>
</pre></div>
</div>
<p>e.g.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">d1</span><span class="p">:</span> <span class="n">drift</span><span class="p">,</span> <span class="n">l</span><span class="o">=</span><span class="mi">1</span><span class="o">*</span><span class="n">m</span><span class="p">;</span>
<span class="n">l1</span><span class="p">:</span> <span class="n">line</span><span class="o">=</span><span class="p">(</span><span class="n">d1</span><span class="p">);</span>
<span class="n">use</span><span class="p">,</span> <span class="n">l1</span><span class="p">;</span>

<span class="n">csample</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="n">d1</span><span class="p">;</span>
</pre></div>
</div>
<p>Details:</p>
<ul class="simple">
<li><p>The radius of the sampler is set automatically to fit the component and <strong>cannot</strong>
be controlled. If control is required, it is better to use a <cite>samplerplacement</cite> and
make it with respect to the beamline element.</p></li>
<li><p>A cylindrical sampler does not match pole-face rotations of magnets.</p></li>
<li><p>Particle filters can similarly be used as with a plane sampler.</p></li>
<li><p>The output sampler structure uses cylindrical coordinates.</p></li>
</ul>
<p>See <a class="reference internal" href="#sampler-coordinate-systems"><span class="std std-ref">Sampler Coordinate Systems</span></a> for details about the coordinates.</p>
</section>
<section id="filtering-particles-to-record">
<span id="sampler-filtering"></span><h3>Filtering Particles To Record<a class="headerlink" href="#filtering-particles-to-record" title="Link to this heading"></a></h3>
<p>It is possible to only record certain particles in a sampler. These are specified via their
Particle Data Group (“PDG”) integer ID number. PDG IDs are discussed here <a class="reference internal" href="#beam-particle-type"><span class="std std-ref">Beam Particle Type</span></a>. An
example is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sample</span><span class="p">,</span> <span class="nb">range</span><span class="o">=&lt;</span><span class="n">element_name</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">partID</span><span class="o">=</span><span class="p">{</span><span class="mi">11</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">14</span><span class="p">};</span>
<span class="n">csample</span><span class="p">,</span> <span class="nb">range</span><span class="o">=&lt;</span><span class="n">element_name</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">partID</span><span class="o">=</span><span class="p">{</span><span class="mi">11</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">14</span><span class="p">};</span>
</pre></div>
</div>
<p>Anti-particles must be explicitly specified:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sample</span><span class="p">,</span> <span class="nb">range</span><span class="o">=&lt;</span><span class="n">element_name</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">partID</span><span class="o">=</span><span class="p">{</span><span class="mi">11</span><span class="p">,</span><span class="o">-</span><span class="mi">11</span><span class="p">};</span>
</pre></div>
</div>
<p>This can be applied to all samplers as well (csample alternative shown).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sample</span><span class="p">,</span> <span class="nb">all</span><span class="p">,</span> <span class="n">partID</span><span class="o">=</span><span class="p">{</span><span class="mi">13</span><span class="p">,</span><span class="o">-</span><span class="mi">13</span><span class="p">};</span>
<span class="n">csample</span><span class="p">,</span> <span class="nb">all</span><span class="p">,</span> <span class="n">partID</span><span class="o">=</span><span class="p">{</span><span class="mi">13</span><span class="p">,</span><span class="o">-</span><span class="mi">13</span><span class="p">};</span>
</pre></div>
</div>
<p>Any sampler specified after this will be overwritten.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sample</span><span class="p">,</span> <span class="nb">all</span><span class="p">,</span> <span class="n">partID</span><span class="o">=</span><span class="p">{</span><span class="mi">13</span><span class="p">,</span><span class="o">-</span><span class="mi">13</span><span class="p">};</span>
<span class="n">sample</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="n">d1</span><span class="p">,</span> <span class="n">partID</span><span class="o">=</span><span class="p">{</span><span class="mi">11</span><span class="p">,</span><span class="o">-</span><span class="mi">11</span><span class="p">};</span>
</pre></div>
</div>
<p>Here, all samplers apart from the one attached to “d1” would record only particles
with PDG ID 13 and -13. The sampler attached to “d1” would record only 11 and -11 PDG ID
particles.</p>
</section>
<section id="sampler-visualisation">
<span id="id13"></span><h3>Sampler Visualisation<a class="headerlink" href="#sampler-visualisation" title="Link to this heading"></a></h3>
<p>The samplers are normally invisible and are built in a parallel world geometry in Geant4. To
visualise them, the following command should be used in the visualiser:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">bds</span><span class="o">/</span><span class="n">samplers</span><span class="o">/</span><span class="n">view</span>
</pre></div>
</div>
<p>The samplers will appear in semi-transparent green, as well as the curvilinear geometry used
for coordinate transforms (cylinders).</p>
</section>
<section id="output-at-an-arbitrary-plane-user-placed-sampler">
<span id="user-sampler-placement"></span><h3>Output at an Arbitrary Plane - User Placed Sampler<a class="headerlink" href="#output-at-an-arbitrary-plane-user-placed-sampler" title="Link to this heading"></a></h3>
<p>The user may place a sampler anywhere in the model with any orientation. This is called a
<cite>samplerplacement</cite>. The sampler may have the following forms:</p>
<ul class="simple">
<li><p>A <strong>plane</strong> sampler (circular or rectangular shape)</p></li>
<li><p>A <strong>cylinder</strong> sampler</p></li>
<li><p>A <strong>sphere</strong> sampler</p></li>
</ul>
<p>A <cite>samplerplacement</cite> will record all particles travelling in <strong>any direction</strong> through it.
A branch in the Event output will be created with the name of the <cite>samplerplacement</cite>. The
user may define an arbitrary number of <cite>samplerplacement</cite> s.  A <cite>samplerplacement</cite> is defined
with the following syntax:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">s1</span><span class="p">:</span> <span class="n">samplerplacement</span><span class="p">,</span> <span class="n">referenceElement</span><span class="o">=</span><span class="s2">&quot;d1&quot;</span><span class="p">,</span>
                      <span class="n">referenceElementNumber</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                      <span class="n">x</span><span class="o">=</span><span class="mi">20</span><span class="o">*</span><span class="n">cm</span><span class="p">,</span> <span class="n">y</span><span class="o">=-</span><span class="mi">1</span><span class="o">*</span><span class="n">cm</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">30</span><span class="o">*</span><span class="n">cm</span><span class="p">,</span>
                      <span class="n">axisAngle</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">axisY</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">angle</span><span class="o">=</span><span class="n">pi</span><span class="o">/</span><span class="mi">4</span><span class="p">,</span>
                      <span class="n">aper1</span><span class="o">=</span><span class="mi">10</span><span class="o">*</span><span class="n">cm</span><span class="p">;</span>
</pre></div>
</div>
<p>This defines a circular (by default) plane sampler with radius 10 cm positioned with respect to
the 2nd instance of the d1 element (zero counting) in the main beam line with a rotation
about the unit Y axis of <span class="math notranslate nohighlight">\(\pi / 4\)</span>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>samplerplacements have no S coordinate, so the S variable will always be -1 m in
the output (the default un-physical value for easy filtering).</p>
</div>
<section id="types-and-shapes">
<span id="sampler-types-and-shapes"></span><h4>Types and Shapes<a class="headerlink" href="#types-and-shapes" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p>The default is a plane sampler.</p></li>
</ul>
<p>The following types (exact name to be used in the <code class="code docutils literal notranslate"><span class="pre">samplerType</span></code> parameter) of sampler can be used:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p><strong>samplerType</strong></p></th>
<th class="head"><p><strong>Description</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>plane</p></td>
<td><p>A flat plane (circular[default] or rectangular) for recording
in local Cartesian coordinates.</p></td>
</tr>
<tr class="row-odd"><td><p>cylinder</p></td>
<td><p>A thin cylinder for recording in cylindrical coordinates the
same as a csampler.</p></td>
</tr>
<tr class="row-even"><td><p>cylinderforward</p></td>
<td><p>Similar to a cylinder but rotated so <cite>z</cite> is by default aligned
with Cartesian <cite>y</cite> and <cite>phi</cite> = 0  is aligned with Cartesian <cite>z</cite>.
It only responds to <cite>sweepAnglePhi</cite>.</p></td>
</tr>
<tr class="row-odd"><td><p>sphere</p></td>
<td><p>A thin sphere for recording in spherical coordinates.</p></td>
</tr>
<tr class="row-even"><td><p>sphereforward</p></td>
<td><p>Similar to sphere but rotated so that <cite>theta</cite>, <cite>phi</cite> = 0
corresponds to <cite>z</cite> in Cartesian coordinates. It only responds
to <cite>sweepAnglePhi</cite> and <cite>sweepAngleTheta</cite>.</p></td>
</tr>
</tbody>
</table>
<ul class="simple">
<li><p><cite>cylinderforward</cite>: is also a full cylinder by default, but in the case of control over
the range in angle of the cylinder, only the sweep angle is specified and it is expanded
symmetrically about the forward point.</p></li>
<li><p><cite>sphereforward</cite>: is also a full sphere by default, but in the case of control over
the range in angles of the sphere, only the sweep angles are specified and they are expanded
symmetrically about the forward point.</p></li>
</ul>
</section>
<section id="plane-shape">
<h4>Plane Shape<a class="headerlink" href="#plane-shape" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p>Default <cite>circular</cite>. Control the radius with <code class="code docutils literal notranslate"><span class="pre">aper1</span></code>.</p></li>
</ul>
<p>To control the plane sampler shape, the variable <code class="code docutils literal notranslate"><span class="pre">shape</span></code> should be specified. Currently,
either <cite>circular</cite> or <cite>rectangular</cite> are accepted. The parameters <cite>aper1</cite> and <cite>aper2</cite> can
be used to control the shape with the same meaning as beam pipe apertures.</p>
<ul class="simple">
<li><p><code class="code docutils literal notranslate"><span class="pre">aper1</span></code> and <code class="code docutils literal notranslate"><span class="pre">aper2</span></code> are the <strong>half</strong> dimensions of a rectangle - horizontal
and vertical respectively.</p></li>
</ul>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">s2</span><span class="p">:</span> <span class="n">samplerplacement</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="mi">40</span><span class="o">*</span><span class="n">m</span><span class="p">,</span>
                      <span class="n">shape</span><span class="o">=</span><span class="s2">&quot;rectangular&quot;</span><span class="p">,</span>
                      <span class="n">aper1</span><span class="o">=</span><span class="mi">40</span><span class="o">*</span><span class="n">m</span><span class="p">,</span> <span class="n">aper2</span><span class="o">=</span><span class="mi">40</span><span class="o">*</span><span class="n">m</span><span class="p">;</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>In the case of <cite>rectangular</cite> <strong>both</strong> <cite>aper1</cite> and <cite>aper2</cite> must be specified.</p>
</div>
</section>
<section id="cylinder-shape">
<h4>Cylinder Shape<a class="headerlink" href="#cylinder-shape" title="Link to this heading"></a></h4>
<p>There are two types of cylindrical sampler: a <cite>cylinder</cite> and <cite>cylinderforward</cite>. The later
is orientated more conveniently so <cite>z</cite> is by default aligned with Cartesian <cite>y</cite> and <cite>phi</cite> = 0
is aligned with Cartesian <cite>z</cite>. In both cases, the default is to make a complete cylinder of
<span class="math notranslate nohighlight">\(2\pi\)</span>. Optionally, parameters can be specified to reduce this to a fraction of that.</p>
<p>Geometry parameters for <code class="code docutils literal notranslate"><span class="pre">samplerType=&quot;cylinder&quot;</span></code>:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p><strong>Parameter</strong></p></th>
<th class="head"><p><strong>Description</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><cite>aper1</cite></p></td>
<td><p>radius of the cylinder (m)</p></td>
</tr>
<tr class="row-odd"><td><p><cite>aper2</cite></p></td>
<td><p>half length in z of the cylinder (m)</p></td>
</tr>
<tr class="row-even"><td><p><cite>startAnglePhi</cite></p></td>
<td><p>Optional start angle for cylinder shape (rad)</p></td>
</tr>
<tr class="row-odd"><td><p><cite>sweepAnglePhi</cite></p></td>
<td><p>Optional sweep angle for cylinder shape (rad)</p></td>
</tr>
</tbody>
</table>
<p>Geometry parameters for <code class="code docutils literal notranslate"><span class="pre">samplerType=&quot;cylinderforward&quot;</span></code>:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p><strong>Parameter</strong></p></th>
<th class="head"><p><strong>Description</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><cite>aper1</cite></p></td>
<td><p>radius of the cylinder (m)</p></td>
</tr>
<tr class="row-odd"><td><p><cite>aper2</cite></p></td>
<td><p>half length in z of the cylinder (m)</p></td>
</tr>
<tr class="row-even"><td><p><cite>sweepAnglePhi</cite></p></td>
<td><p>Optional sweep angle for cylinder shape (rad)</p></td>
</tr>
</tbody>
</table>
<p>This only responds to <cite>sweepAnglePhi</cite> and it spread out symmetrically from the forward direction.</p>
<p>Examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">s3</span><span class="p">:</span> <span class="n">samplerplacement</span><span class="p">,</span> <span class="n">samplerType</span><span class="o">=</span><span class="s2">&quot;cylinder&quot;</span><span class="p">,</span> <span class="n">aper1</span><span class="o">=</span><span class="mi">20</span><span class="o">*</span><span class="n">cm</span><span class="p">,</span> <span class="n">aper2</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">m</span><span class="p">;</span>
<span class="n">s4</span><span class="p">:</span> <span class="n">samplerplacement</span><span class="p">,</span> <span class="n">samplerType</span><span class="o">=</span><span class="s2">&quot;cylinder&quot;</span><span class="p">,</span> <span class="n">aper1</span><span class="o">=</span><span class="mi">20</span><span class="o">*</span><span class="n">cm</span><span class="p">,</span> <span class="n">aper2</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">m</span><span class="p">,</span> <span class="n">startAnglePhi</span><span class="o">=-</span><span class="n">pi</span><span class="o">/</span><span class="mi">6</span><span class="p">,</span> <span class="n">sweepAnglePhi</span><span class="o">=</span><span class="n">pi</span><span class="o">/</span><span class="mi">3</span><span class="p">;</span>
<span class="n">s5</span><span class="p">:</span> <span class="n">samplerplacement</span><span class="p">,</span> <span class="n">samplerType</span><span class="o">=</span><span class="s2">&quot;cylinderforward&quot;</span><span class="p">,</span> <span class="n">aper1</span><span class="o">=</span><span class="mi">20</span><span class="o">*</span><span class="n">cm</span><span class="p">,</span> <span class="n">aper2</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">m</span><span class="p">,</span> <span class="n">sweepAnglePhi</span><span class="o">=</span><span class="n">pi</span><span class="o">/</span><span class="mi">3</span><span class="p">;</span>
</pre></div>
</div>
<ul class="simple">
<li><p>More examples can be found in <code class="code docutils literal notranslate"><span class="pre">bdsim/examples/features/sampler/*gmad</span></code>.</p></li>
</ul>
</section>
<section id="sphere-shape">
<h4>Sphere Shape<a class="headerlink" href="#sphere-shape" title="Link to this heading"></a></h4>
<p>There are two types of spherical sampler: a <cite>sphere</cite> and <cite>sphereforward</cite>. The later
is orientated more conveniently so Cartesian <cite>z</cite> is by default aligned with <cite>phi</cite> = 0
and <cite>theta</cite> = 0. In both cases, the default is to make a complete sphere. Optionally,
parameters can be specified to reduce this to a fraction of that.</p>
<p>Geometry parameters for <code class="code docutils literal notranslate"><span class="pre">samplerType=&quot;sphere&quot;</span></code>:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p><strong>Parameter</strong></p></th>
<th class="head"><p><strong>Description</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><cite>aper1</cite></p></td>
<td><p>radius of the sphere (m)</p></td>
</tr>
<tr class="row-odd"><td><p><cite>startAngleTheta</cite></p></td>
<td><p>Optional polar start angle for sphere shape (rad)</p></td>
</tr>
<tr class="row-even"><td><p><cite>sweepAngleTheta</cite></p></td>
<td><p>Optional polar sweep angel for sphere shape (rad)</p></td>
</tr>
<tr class="row-odd"><td><p><cite>startAnglePhi</cite></p></td>
<td><p>Optional azimuthal start angle for cylinder shape (rad)</p></td>
</tr>
<tr class="row-even"><td><p><cite>sweepAnglePhi</cite></p></td>
<td><p>Optional azimuthal sweep angle for cylinder shape (rad)</p></td>
</tr>
</tbody>
</table>
<p>Geometry parameters for <code class="code docutils literal notranslate"><span class="pre">samplerType=&quot;sphereforward&quot;</span></code>:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p><strong>Parameter</strong></p></th>
<th class="head"><p><strong>Description</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><cite>aper1</cite></p></td>
<td><p>radius of the sphere (m)</p></td>
</tr>
<tr class="row-odd"><td><p><cite>sweepAngleTheta</cite></p></td>
<td><p>Optional polar sweep angel for sphere shape (rad)</p></td>
</tr>
<tr class="row-even"><td><p><cite>sweepAnglePhi</cite></p></td>
<td><p>Optional azimuthal sweep angle for cylinder shape (rad)</p></td>
</tr>
</tbody>
</table>
<p>This only responds to <cite>sweepAnglePhi</cite> and it spread out symmetrically from the forward direction.</p>
<p>Examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">s6</span><span class="p">:</span> <span class="n">samplerplacement</span><span class="p">,</span> <span class="n">samplerType</span><span class="o">=</span><span class="s2">&quot;sphere&quot;</span><span class="p">,</span> <span class="n">aper1</span><span class="o">=</span><span class="mi">20</span><span class="o">*</span><span class="n">cm</span><span class="p">;</span>
<span class="n">s7</span><span class="p">:</span> <span class="n">samplerplacement</span><span class="p">,</span> <span class="n">samplerType</span><span class="o">=</span><span class="s2">&quot;sphere&quot;</span><span class="p">,</span> <span class="n">aper1</span><span class="o">=</span><span class="mi">20</span><span class="o">*</span><span class="n">cm</span><span class="p">,</span>
                      <span class="n">startAnglePhi</span><span class="o">=-</span><span class="n">pi</span><span class="o">/</span><span class="mi">6</span><span class="p">,</span> <span class="n">sweepAnglePhi</span><span class="o">=</span><span class="n">pi</span><span class="o">/</span><span class="mi">3</span><span class="p">,</span>
                                  <span class="n">startAngleTheta</span><span class="o">=</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="o">-</span><span class="n">pi</span><span class="o">/</span><span class="mi">6</span><span class="p">,</span> <span class="n">sweepAngleTheta</span><span class="o">=</span><span class="n">pi</span><span class="o">/</span><span class="mi">3</span><span class="p">;</span>
<span class="n">s8</span><span class="p">:</span> <span class="n">samplerplacement</span><span class="p">,</span> <span class="n">samplerType</span><span class="o">=</span><span class="s2">&quot;sphereforward&quot;</span><span class="p">,</span> <span class="n">aper1</span><span class="o">=</span><span class="mi">20</span><span class="o">*</span><span class="n">cm</span><span class="p">,</span>
                      <span class="n">sweepAnglePhi</span><span class="o">=</span><span class="n">pi</span><span class="o">/</span><span class="mi">3</span><span class="p">,</span> <span class="n">sweepAngleTheta</span><span class="o">=</span><span class="n">pi</span><span class="o">/</span><span class="mi">6</span><span class="p">;</span>
</pre></div>
</div>
<ul class="simple">
<li><p>More examples can be found in <code class="code docutils literal notranslate"><span class="pre">bdsim/examples/features/sampler/*gmad</span></code>.</p></li>
</ul>
</section>
<section id="placement">
<h4>Placement<a class="headerlink" href="#placement" title="Link to this heading"></a></h4>
<p>A <cite>samplerplacement</cite> may be placed in 3 ways.</p>
<ol class="arabic simple">
<li><p>In global Cartesian coordinates (x,y,z + rotation).</p></li>
<li><p>In curvilinear coordinates (s,x,y + rotation).</p></li>
<li><p>In curvilinear coordinates with respect to a beam line element by name (s,x,y + rotation).</p></li>
</ol>
<p>The strategy is automatically determined based on the parameters set. The full list of
parameters is described below, but the required ones for each scenario are described in
<a class="reference internal" href="model_customisation.html#placements"><span class="std std-ref">Placements</span></a>.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>This sampler can nominally overlap with any geometry. However, the user
should <strong>avoid</strong> co-planar overlaps with other geometry. e.g. do not place
one just at the end of an element or perfectly aligned with the face of an
object. This will cause bad tracking and overlaps. This is a limitation of
Geant4. The user placed samplers are slightly thicker than normal ones
to help avoid this problem.</p>
</div>
</section>
<section id="parameters">
<h4>Parameters<a class="headerlink" href="#parameters" title="Link to this heading"></a></h4>
<p>The <cite>samplerplacement</cite> object accepts a number of parameters similar to other parts of BDSIM.
These include a subset of the aperture parameters (see <a class="reference internal" href="model_customisation.html#aperture-parameters"><span class="std std-ref">Aperture Parameters</span></a>) and the position
information from the <cite>placements</cite>. The full list of accepted parameters is given below.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p><strong>Parameter</strong></p></th>
<th class="head"><p><strong>Description</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>samplerType</p></td>
<td><p>One of ‘plane’ (default), ‘cylinder’, ‘cylinderforward’, ‘sphere’,
‘sphereforward’ (see <a class="reference internal" href="#sampler-types-and-shapes"><span class="std std-ref">Types and Shapes</span></a>)</p></td>
</tr>
<tr class="row-odd"><td><p>x</p></td>
<td><p>Offset in global x</p></td>
</tr>
<tr class="row-even"><td><p>y</p></td>
<td><p>Offset in global y</p></td>
</tr>
<tr class="row-odd"><td><p>z</p></td>
<td><p>Offset in global z</p></td>
</tr>
<tr class="row-even"><td><p>s</p></td>
<td><p>Curvilinear s coordinate (global | local depending on parameters)</p></td>
</tr>
<tr class="row-odd"><td><p>phi</p></td>
<td><p>Euler angle phi for rotation</p></td>
</tr>
<tr class="row-even"><td><p>theta</p></td>
<td><p>Euler angle theta for rotation</p></td>
</tr>
<tr class="row-odd"><td><p>psi</p></td>
<td><p>Euler angle psi for rotation</p></td>
</tr>
<tr class="row-even"><td><p>axisX</p></td>
<td><p>Axis angle rotation x-component of unit vector</p></td>
</tr>
<tr class="row-odd"><td><p>axisY</p></td>
<td><p>Axis angle rotation y-component of unit vector</p></td>
</tr>
<tr class="row-even"><td><p>axisZ</p></td>
<td><p>Axis angle rotation z-component of unit vector</p></td>
</tr>
<tr class="row-odd"><td><p>angle</p></td>
<td><p>Axis angle, angle to rotate about unit vector</p></td>
</tr>
<tr class="row-even"><td><p>axisAngle</p></td>
<td><p>Boolean whether to use axis angle rotation scheme (default false)</p></td>
</tr>
<tr class="row-odd"><td><p>sensitive</p></td>
<td><p>Whether the geometry records energy deposition (default true)</p></td>
</tr>
<tr class="row-even"><td><p>referenceElement</p></td>
<td><p>Name of element to place geometry with respect to (string)</p></td>
</tr>
<tr class="row-odd"><td><p>referenceElementNumber</p></td>
<td><p>Occurrence of <cite>referenceElement</cite> to place with respect to if it
is used more than once in the sequence. Zero counting.</p></td>
</tr>
<tr class="row-even"><td><p>apertureType</p></td>
<td><p>The shape for a plane sampler desired as described using the
aperture syntax of BDSIM. Currently, only <cite>circular</cite> and
<cite>rectangular</cite> are supported. <cite>circular</cite> is the default.</p></td>
</tr>
<tr class="row-odd"><td><p>shape</p></td>
<td><p>An intuitive alias to <cite>apertureType</cite> for plane sampler shape.</p></td>
</tr>
<tr class="row-even"><td><p>aper1</p></td>
<td><p>Aperture parameter #1.</p></td>
</tr>
<tr class="row-odd"><td><p>aper2</p></td>
<td><p>Aperture parameter #2.</p></td>
</tr>
<tr class="row-even"><td><p>aper3</p></td>
<td><p>Aperture parameter #3.</p></td>
</tr>
<tr class="row-odd"><td><p>aper4</p></td>
<td><p>Aperture parameter #4.</p></td>
</tr>
<tr class="row-even"><td><p>startAnglePhi</p></td>
<td><p>The starting angle in <span class="math notranslate nohighlight">\(\phi\)</span> for the cylinder or sphere
surface. Can range from <span class="math notranslate nohighlight">\([-2\pi \to 2\pi]\)</span>.</p></td>
</tr>
<tr class="row-odd"><td><p>sweepAnglePhi</p></td>
<td><p>The distance in <span class="math notranslate nohighlight">\(\phi\)</span> to go from the start point. Can range
from <span class="math notranslate nohighlight">\((0 \to 2\pi]\)</span>.</p></td>
</tr>
<tr class="row-even"><td><p>startAngleTheta</p></td>
<td><p>The starting angle in <span class="math notranslate nohighlight">\(\theta\)</span> for the sphere surface. Can
range from <span class="math notranslate nohighlight">\([0 \to \pi]\)</span>.</p></td>
</tr>
<tr class="row-odd"><td><p>sweepAngleTheta</p></td>
<td><p>The distance in <span class="math notranslate nohighlight">\(\theta\)</span> to go from the start point. Can
range from <span class="math notranslate nohighlight">\((0 \to \pi]\)</span>.</p></td>
</tr>
<tr class="row-even"><td><p>partID</p></td>
<td><p>List of integers for PDG IDs for which particles to record only.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="examples">
<h4>Examples<a class="headerlink" href="#examples" title="Link to this heading"></a></h4>
<p>The following are examples of <cite>samplerplacement</cite>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">s1</span><span class="p">:</span> <span class="n">samplerplacement</span><span class="p">,</span> <span class="n">referenceElement</span><span class="o">=</span><span class="s2">&quot;d1&quot;</span><span class="p">,</span>
                      <span class="n">referenceElementNumber</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                      <span class="n">x</span><span class="o">=</span><span class="mi">20</span><span class="o">*</span><span class="n">cm</span><span class="p">,</span> <span class="n">y</span><span class="o">=-</span><span class="mi">1</span><span class="o">*</span><span class="n">cm</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">30</span><span class="o">*</span><span class="n">cm</span><span class="p">,</span>
                      <span class="n">axisAngle</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">axisY</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">angle</span><span class="o">=</span><span class="n">pi</span><span class="o">/</span><span class="mi">4</span><span class="p">,</span>
                      <span class="n">aper1</span><span class="o">=</span><span class="mi">10</span><span class="o">*</span><span class="n">cm</span><span class="p">;</span>
</pre></div>
</div>
<p>This places a circular sampler called “s1” with respect to the 2nd instance of the beam line
element “d1”. The x,y,s are offsets from the centre of this element along the direction of
travel of the beam. The sampler is rotated about the unit Y axis (again with respect to the
centre of the beam line element rotation) by an angle of <span class="math notranslate nohighlight">\(\pi / 4\)</span>. The sampler will
be circular (by default) with a radius of 10 cm.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">s2</span><span class="p">:</span> <span class="n">samplerplacement</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mf">0.2</span><span class="o">*</span><span class="n">m</span><span class="p">,</span> <span class="n">y</span><span class="o">=-</span><span class="mi">1</span><span class="o">*</span><span class="n">cm</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="mf">30.123</span><span class="o">*</span><span class="n">m</span><span class="p">,</span>
                      <span class="n">axisAngle</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">axisY</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">angle</span><span class="o">=-</span><span class="n">pi</span><span class="o">/</span><span class="mi">6</span><span class="p">,</span>
                      <span class="n">aper1</span><span class="o">=</span><span class="mi">10</span><span class="o">*</span><span class="n">cm</span><span class="p">,</span> <span class="n">aper2</span><span class="o">=</span><span class="mi">5</span><span class="o">*</span><span class="n">cm</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="s2">&quot;rectangular&quot;</span><span class="p">;</span>
</pre></div>
</div>
<p>This will place a sampler called “s2” in global Cartesian coordinates approximately 30 m
forward from the centre of model. The placement rotation is done in the global coordinate
system. The sampler shape is rectangular and is 20 cm wide and 10 cm tall.</p>
</section>
<section id="user-sampler-visualisation">
<h4>User Sampler Visualisation<a class="headerlink" href="#user-sampler-visualisation" title="Link to this heading"></a></h4>
<p>Samplers are by default invisible. To visualise the samplerplacement, all samplers should be
visualised as described in <a class="reference internal" href="#sampler-visualisation"><span class="std std-ref">Sampler Visualisation</span></a>. It is recommended to tick and untick
the desired element to see it appear and disappear repeatedly.</p>
</section>
</section>
</section>
<section id="scoring">
<span id="id14"></span><h2>Scoring<a class="headerlink" href="#scoring" title="Link to this heading"></a></h2>
<p>Scoring is the ability to record integrals (or ‘scores’) of certain information such as the
dose or flux in a 3D histogram for some part of the 3D model. This is done as it is much less
information than storing all the ‘hits’ from each step of each particle in each event as well
as a useful way to measure a given quantity per unit volume.</p>
<p>A scoring mesh is a 3D grid (mesh) created in a parallel geometry that can safely overlap with other
geometry in the model. Although in a parallel world, the steps of a particle through the 3D geometry
are limited by the boundary of the mesh. This means that no step covers more than one cell or
bin in the mesh and therefore there’s no ambiguity over proportioning some quantity (like
energy deposition) in one step or another. The figure below shows the regular “mass world”
view of a quadrupole, and also a wire-frame view of the same quadrupole with the normally invisible
scoring mesh in a parallel world.</p>
<figure class="align-center" id="id26">
<a class="reference internal image-reference" href="_images/scoring-mass-world.png"><img alt="_images/scoring-mass-world.png" src="_images/scoring-mass-world.png" style="width: 50%;" /></a>
<figcaption>
<p><span class="caption-text">“Mass world” view of a quadrupole.</span><a class="headerlink" href="#id26" title="Link to this image"></a></p>
</figcaption>
</figure>
<figure class="align-center" id="id27">
<a class="reference internal image-reference" href="_images/scoring-wireframe.png"><img alt="_images/scoring-wireframe.png" src="_images/scoring-wireframe.png" style="width: 50%;" /></a>
<figcaption>
<p><span class="caption-text">Wire-frame view of the same quadrupole but with a scoring mesh visualised (grey).</span><a class="headerlink" href="#id27" title="Link to this image"></a></p>
</figcaption>
</figure>
<p>Conceptually creating a scoring mesh is split into two key definitions in the input:</p>
<ol class="arabic simple">
<li><p>A <a class="reference internal" href="#scorer"><span class="std std-ref">Scorer</span></a> to define what information is recorded</p></li>
<li><p>A <a class="reference internal" href="#scoring-mesh"><span class="std std-ref">Scorer Mesh</span></a> to define the 3D grid and histogram where information is recorded.</p></li>
</ol>
<p>e.g.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">allParticleDose</span><span class="p">:</span> <span class="n">scorer</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;depositeddose&quot;</span><span class="p">;</span>
<span class="n">collimatorDose</span><span class="p">:</span> <span class="n">scorermesh</span><span class="p">,</span> <span class="n">scoreQuantity</span><span class="o">=</span><span class="s2">&quot;allParticleDose&quot;</span><span class="p">,</span>
                <span class="n">nx</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">ny</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">nz</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">xsize</span><span class="o">=</span><span class="mi">50</span><span class="o">*</span><span class="n">cm</span><span class="p">,</span> <span class="n">ysize</span><span class="o">=</span><span class="mi">50</span><span class="o">*</span><span class="n">cm</span><span class="p">,</span> <span class="n">zsize</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">m</span><span class="p">,</span>
                <span class="n">referenceElement</span><span class="o">=</span><span class="s2">&quot;col1&quot;</span><span class="p">;</span>
</pre></div>
</div>
<ul class="simple">
<li><p>The mesh does not affect the physics of the simulation but is used to record or
‘score’ one or more quantities.</p></li>
<li><p>Because the steps are limited by the boundaries and all the physics processes are
checked for each step, the presence of a scoring mesh will make the simulation
a little bit slower.</p></li>
<li><p>Each mesh creates a 3D histogram in the output for each quantity for each event.</p></li>
<li><p>Each mesh is a 3D mesh of cuboids where each has the same dimensions.</p></li>
<li><p>All scorers include the weight associated with the particle, which is only different from
1 if biasing is used. This ensures the correct physical result is always obtained.</p></li>
<li><p>As the histogram is per-event, the quantity stored is per-event also. So, if there
is one proton fired per-event, then the quantity for deposited dose is J / kg / proton.</p></li>
<li><p>Examples can be found in <code class="code docutils literal notranslate"><span class="pre">bdsim/examples/features/scoring</span></code>.</p></li>
</ul>
<section id="sampler-coordinate-systems">
<span id="id15"></span><h3>Sampler Coordinate Systems<a class="headerlink" href="#sampler-coordinate-systems" title="Link to this heading"></a></h3>
<p>Each sampler type records different variables depending on its geometry. The hits recorded
are always in the frame of that sampler object. The coordinates for each shape are as follows:</p>
<p><strong>plane</strong></p>
<ul class="simple">
<li><p><cite>x</cite>, <cite>y</cite>, <cite>z</cite></p></li>
</ul>
<p><strong>cylindrical</strong></p>
<ul class="simple">
<li><p><cite>z</cite>, <cite>r</cite>, <span class="math notranslate nohighlight">\(\phi\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(\phi\)</span> : <span class="math notranslate nohighlight">\([0 \to 2\pi]\)</span></p></li>
</ul>
<p><strong>spherical</strong></p>
<ul class="simple">
<li><p><cite>r</cite>, <span class="math notranslate nohighlight">\(\theta\)</span>, <span class="math notranslate nohighlight">\(\phi\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(\theta\)</span> : polar angle <span class="math notranslate nohighlight">\([0 \to \pi]\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(\phi\)</span> : azimuthal angle <span class="math notranslate nohighlight">\([0 \to 2\pi]\)</span></p></li>
</ul>
<p>Generally:</p>
<ul class="simple">
<li><p>In cylindrical coordinates <cite>z</cite> and <cite>phi</cite> are recorded as well as <cite>rp</cite>, <cite>zp</cite> and <cite>phip</cite>.</p></li>
<li><p><cite>r</cite> is not recorded for either cylindrical or spherical coordinates because it is the
same for every hit. This information is recorded in the Model part of the output with
the sampler name as it is a constant.</p></li>
<li><p>Positive <cite>z</cite> is along the direction of the beam by default.</p></li>
<li><p>For cylindrical coordinates, <cite>phi</cite> = 0 corresponds to a point at positive
<span class="math notranslate nohighlight">\(x = r, y = 0\)</span> and increases clockwise looking along the direction of the beam.</p></li>
</ul>
</section>
<section id="scorer">
<span id="id16"></span><h3>Scorer<a class="headerlink" href="#scorer" title="Link to this heading"></a></h3>
<p>A <cite>scorer</cite> defines a quantity to be recorded. The syntax is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">name</span><span class="p">:</span> <span class="n">scorer</span><span class="p">,</span> <span class="n">parameter</span><span class="o">=</span><span class="n">value</span><span class="p">,</span> <span class="n">parameter2</span><span class="o">=</span><span class="n">value</span><span class="p">;</span>
</pre></div>
</div>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p><strong>Parameter</strong></p></th>
<th class="head"><p><strong>Required</strong></p></th>
<th class="head"><p><strong>Description</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>type</p></td>
<td><p>Yes</p></td>
<td><p>Which quantity to score - see below</p></td>
</tr>
<tr class="row-odd"><td><p>particleName</p></td>
<td><p>No</p></td>
<td><p>Name of particle in Geant4 to only apply
scoring to (only one)</p></td>
</tr>
<tr class="row-even"><td><p>particlePDGID</p></td>
<td><p>No</p></td>
<td><p>PDG ID of particle to only apply scoring to
(only one)</p></td>
</tr>
<tr class="row-odd"><td><p>minimumKineticEnergy</p></td>
<td><p>No</p></td>
<td><p>Minimum kinetic energy of particles to be
included in scoring (GeV)</p></td>
</tr>
<tr class="row-even"><td><p>maximumKineticEnergy</p></td>
<td><p>No</p></td>
<td><p>Maximum kinetic energy of particles to be
included in scoring (GeV)</p></td>
</tr>
<tr class="row-odd"><td><p>minimumTime</p></td>
<td><p>No</p></td>
<td><p>Minimum time coordinate of particles to be
included in scoring (s)</p></td>
</tr>
<tr class="row-even"><td><p>maximumTime</p></td>
<td><p>No</p></td>
<td><p>Maximum time coordinate of particles to be
included in scoring (s)</p></td>
</tr>
<tr class="row-odd"><td><p>conversionFactorFile</p></td>
<td><p>No</p></td>
<td><p>File name of conversion factor file to be used
in calculation</p></td>
</tr>
<tr class="row-even"><td><p>conversionFactorPath</p></td>
<td><p>No</p></td>
<td><p>Path to set of files per particle to be used
in calculation</p></td>
</tr>
<tr class="row-odd"><td><p>materialToInclude</p></td>
<td><p>No</p></td>
<td><p>A space separated list of materials to be
scored. Any materials not matching this will
be ignored. (string, case sensitive).</p></td>
</tr>
<tr class="row-even"><td><p>materialToExclude</p></td>
<td><p>No</p></td>
<td><p>A space separated list of materials to be
excluded from scoring. (string, case
sensitive).</p></td>
</tr>
<tr class="row-odd"><td><p>scoreWorldVolumeOnly</p></td>
<td><p>No</p></td>
<td><p>Whether to only record information from the
world volume only. This means that a mesh can
overlap a piece of geometry but not score from
that specific geometry allowing tight fitting
scoring.</p></td>
</tr>
<tr class="row-even"><td><p>scorePrimariesOnly</p></td>
<td><p>No</p></td>
<td><p>If true, only score the quantity for the
the primary particle(s) with Parent ID == 0.</p></td>
</tr>
</tbody>
</table>
<section id="scorer-types">
<span id="id17"></span><h4>Scorer Types<a class="headerlink" href="#scorer-types" title="Link to this heading"></a></h4>
<p>The following are accepted scorer types.</p>
<ul class="simple">
<li><p>As the histogram is per-event, the quantity stored is per-event also. So, if there
is one proton fired per-event, then the quantity for depositeddose is J / kg / proton.</p></li>
</ul>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p><strong>Scorer Type</strong></p></th>
<th class="head"><p><strong>Units</strong></p></th>
<th class="head"><p><strong>Description</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>cellcharge</p></td>
<td><p>e-</p></td>
<td><p>The charge deposited in the cell</p></td>
</tr>
<tr class="row-odd"><td><p>cellflux(*)</p></td>
<td><p><span class="math notranslate nohighlight">\(cm^{-2}\)</span></p></td>
<td><p>The flux (step length / cell volume)</p></td>
</tr>
<tr class="row-even"><td><p>cellfluxscaled</p></td>
<td><p><span class="math notranslate nohighlight">\(cm^{-2}\)</span></p></td>
<td><p>The flux (step length / cell volume) multiplied
a factor as a function of kinetic energy as
specified in the <code class="code docutils literal notranslate"><span class="pre">conversionFactorFile</span></code>.
Default factor is 1.0.</p></td>
</tr>
<tr class="row-odd"><td><p>cellfluxscaledperparticle</p></td>
<td><p><span class="math notranslate nohighlight">\(cm^{-2}\)</span></p></td>
<td><p>Similar to <cite>cellfluxscaled</cite> but per particle
species. Specify <code class="code docutils literal notranslate"><span class="pre">conversionFilePath</span></code> to
files (see below). Default factor is 0 for all
particles and energies.</p></td>
</tr>
<tr class="row-even"><td><p>depositeddose</p></td>
<td><p>Gray (J/kg)</p></td>
<td><p>The dose (energy deposited per unit mass)</p></td>
</tr>
<tr class="row-odd"><td><p>depositedenergy</p></td>
<td><p>GeV</p></td>
<td><p>The deposited energy in the cell</p></td>
</tr>
<tr class="row-even"><td><p>population</p></td>
<td><p>NA</p></td>
<td><p>The number of particles passing through the cell</p></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>(*) It is possible to score the differential flux by using the scorer type cellflux4D which adds a binning along the energy axis.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>(*) To score quantities such as the ambient dose equivalent, the scorer type <cite>cellfluxscaledperparticle</cite>
should be used, however conversion factors must be supplied (see <a class="reference internal" href="#scorer-conversion-factor-file"><span class="std std-ref">Conversion Factor File</span></a>)
to ensure the ambient dose is calculated correctly and in the correct units.</p>
</div>
</section>
<section id="conversion-factor-file">
<span id="scorer-conversion-factor-file"></span><h4>Conversion Factor File<a class="headerlink" href="#conversion-factor-file" title="Link to this heading"></a></h4>
<p>The conversion factor file is a text file (optionally compressed with gzip, but not tar)
that contains two columns separated by white space. Currently, linear interpolation is
used between points in kinetic energy using the Geant4 <cite>G4PhysicsOrderedFreeVector</cite> class.</p>
<p>Columns are:</p>
<ol class="arabic simple">
<li><p>Kinetic energy in <strong>MeV</strong></p></li>
<li><p>Numerical factor</p></li>
</ol>
<p>Below is an example contents:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mf">5.0e-02</span>       <span class="mf">2.97e-09</span>
<span class="mf">1.0e-01</span>       <span class="mf">1.52e-09</span>
<span class="mf">2.0e-01</span>       <span class="mf">9.99e-10</span>
<span class="mf">5.0e-01</span>       <span class="mf">7.86e-10</span>
<span class="mf">1.0e+00</span>       <span class="mf">6.41e-10</span>
<span class="mf">5.0e+00</span>       <span class="mf">7.65e-10</span>
<span class="mf">1.0e+01</span>       <span class="mf">8.39e-10</span>
<span class="mf">1.0e+02</span>       <span class="mf">8.22e-10</span>
<span class="mf">1.0e+03</span>       <span class="mf">9.96e-10</span>
<span class="mf">1.0e+04</span>       <span class="mf">1.20e-09</span>
</pre></div>
</div>
<p>Here, a quantity in the scorer will be multiplied by 2.97e-9 for a particle with an energy
of 0.05 MeV.</p>
<p>Conversion factor files for <code class="code docutils literal notranslate"><span class="pre">cellfluxscaledperparticle</span></code> can be one of:</p>
<ul class="simple">
<li><p><code class="code docutils literal notranslate"><span class="pre">protons.dat</span></code></p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">neutrons.dat</span></code></p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">photons.dat</span></code></p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">electrons.dat</span></code></p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">positrons.dat</span></code></p></li>
</ul>
<p>At least 1 must be specified.  Any particles without a conversion factor are scored as 0.</p>
</section>
</section>
<section id="scorer-mesh">
<span id="scoring-mesh"></span><h3>Scorer Mesh<a class="headerlink" href="#scorer-mesh" title="Link to this heading"></a></h3>
<p>For <code class="code docutils literal notranslate"><span class="pre">scorermesh</span></code>, the syntax is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">name</span><span class="p">:</span> <span class="n">scorermesh</span><span class="p">,</span> <span class="n">parameter</span><span class="o">=</span><span class="n">value</span><span class="p">,</span> <span class="o">...</span> <span class="p">;</span>
</pre></div>
</div>
<p>Where <code class="code docutils literal notranslate"><span class="pre">name</span></code> is the name of the mesh desired and <code class="code docutils literal notranslate"><span class="pre">parameter</span></code> and <code class="code docutils literal notranslate"><span class="pre">value</span></code> are
example parameter and value pairs. The following parameters may be specified.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p><strong>Parameter</strong></p></th>
<th class="head"><p><strong>Required</strong></p></th>
<th class="head"><p><strong>Description</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>scoreQuantity</p></td>
<td><p>Yes</p></td>
<td><p>The name of the scorer object(s) to be used</p></td>
</tr>
<tr class="row-odd"><td><p>geometryType</p></td>
<td><p>No</p></td>
<td><p>Scorer mesh geometry type (box or cylindrical)
(default box)</p></td>
</tr>
<tr class="row-even"><td><p>nx</p></td>
<td><p>Yes</p></td>
<td><p>Number of cells in local x dimension</p></td>
</tr>
<tr class="row-odd"><td><p>ny</p></td>
<td><p>Yes</p></td>
<td><p>Number of cells in local y dimension</p></td>
</tr>
<tr class="row-even"><td><p>nz</p></td>
<td><p>Yes</p></td>
<td><p>Number of cells in local z dimension</p></td>
</tr>
<tr class="row-odd"><td><p>nr</p></td>
<td><p>Yes(*)</p></td>
<td><p>Number of cells in local r</p></td>
</tr>
<tr class="row-even"><td><p>nphi</p></td>
<td><p>Yes(*)</p></td>
<td><p>Number of cells in local phi</p></td>
</tr>
<tr class="row-odd"><td><p>ne</p></td>
<td><p>Yes(**)</p></td>
<td><p>Number of cells in energy dimension</p></td>
</tr>
<tr class="row-even"><td><p>xsize</p></td>
<td><p>Yes</p></td>
<td><p>Full width in local x dimension (m)</p></td>
</tr>
<tr class="row-odd"><td><p>ysize</p></td>
<td><p>Yes</p></td>
<td><p>Full width in local y dimension (m)</p></td>
</tr>
<tr class="row-even"><td><p>zsize</p></td>
<td><p>Yes</p></td>
<td><p>Full width in local z dimension (m)</p></td>
</tr>
<tr class="row-odd"><td><p>rsize</p></td>
<td><p>Yes(*)</p></td>
<td><p>Full width in local r dimension (m)</p></td>
</tr>
<tr class="row-even"><td><p>eScale</p></td>
<td><p>Yes(**)</p></td>
<td><p>Energy axis scoring type (linear, log, user)</p></td>
</tr>
<tr class="row-odd"><td><p>eLow</p></td>
<td><p>Yes(**)</p></td>
<td><p>Low limit value for the energy axis binning</p></td>
</tr>
<tr class="row-even"><td><p>eHigh</p></td>
<td><p>Yes(**)</p></td>
<td><p>High limit value for the energy axis binning</p></td>
</tr>
<tr class="row-odd"><td><p>eBinsEdgesFilenamePath</p></td>
<td><p>Yes(**)</p></td>
<td><p>Path to the energy bin edges .txt file(***)</p></td>
</tr>
<tr class="row-even"><td><p>referenceElement</p></td>
<td><p>No</p></td>
<td><p>Name of beam line element to place with
respect to</p></td>
</tr>
<tr class="row-odd"><td><p>referenceElementNumber</p></td>
<td><p>No</p></td>
<td><p>Occurrence of <cite>referenceElement</cite> to place
with respect to if it used more than once in
sequence - zero counting</p></td>
</tr>
<tr class="row-even"><td><p>s</p></td>
<td><p>No</p></td>
<td><p>curvilinear s coordinate (global | local
depending on parameters used</p></td>
</tr>
<tr class="row-odd"><td><p>x</p></td>
<td><p>No</p></td>
<td><p>Offset in (global or local) x</p></td>
</tr>
<tr class="row-even"><td><p>y</p></td>
<td><p>No</p></td>
<td><p>Offset in (global or local) y</p></td>
</tr>
<tr class="row-odd"><td><p>z</p></td>
<td><p>No</p></td>
<td><p>Offset in global z</p></td>
</tr>
<tr class="row-even"><td><p>phi</p></td>
<td><p>No</p></td>
<td><p>Euler angle phi for rotation</p></td>
</tr>
<tr class="row-odd"><td><p>theta</p></td>
<td><p>No</p></td>
<td><p>Euler angle theta for rotation</p></td>
</tr>
<tr class="row-even"><td><p>psi</p></td>
<td><p>No</p></td>
<td><p>Euler angle psi for rotation</p></td>
</tr>
<tr class="row-odd"><td><p>axisX</p></td>
<td><p>No</p></td>
<td><p>Axis angle rotation x-component of unit vector</p></td>
</tr>
<tr class="row-even"><td><p>axisY</p></td>
<td><p>No</p></td>
<td><p>Axis angle rotation y-component of unit vector</p></td>
</tr>
<tr class="row-odd"><td><p>axisZ</p></td>
<td><p>No</p></td>
<td><p>Axis angle rotation z-component of unit vector</p></td>
</tr>
<tr class="row-even"><td><p>angle</p></td>
<td><p>No</p></td>
<td><p>Axis angle, angle to rotate about unit vector</p></td>
</tr>
<tr class="row-odd"><td><p>axisAngle</p></td>
<td><p>No</p></td>
<td><p>Boolean whether to use the axis angle rotation
scheme (default false)</p></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>(*) Those options are required if the geometryType “cylindrical” has been chosen.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>(**) The option eScale is required when defining a scorermesh for a cellflux4d scorer.
If the eScale types “linear” or “log” are used, the options ne, eLow and eHigh are required.
If the eScale type “user” is used, the option eBinsEdgesFilenamePath is required.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>(***) Each energy bin edge value must be written on a separate line in a .txt file in GeV.
An example can be found in <code class="code docutils literal notranslate"><span class="pre">bdsim/examples/features/scoring</span></code>.</p>
</div>
<p>The placement parameters are the exact same as those used in general geometry placements -
see <a class="reference internal" href="model_customisation.html#placements"><span class="std std-ref">Placements</span></a> for the 3 possible ways to make placements easily in BDSIM.</p>
<ul class="simple">
<li><p>Multiple quantities may be specified in <cite>scoreQuantity</cite> if the names are separated by a space
inside the string.</p></li>
</ul>
</section>
<section id="scoring-examples">
<h3>Scoring Examples<a class="headerlink" href="#scoring-examples" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>Examples can be found in <code class="code docutils literal notranslate"><span class="pre">bdsim/examples/features/scoring</span></code>.</p></li>
</ul>
<p>Example 1:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">neutronPopulation</span><span class="p">:</span> <span class="n">scorer</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;population&quot;</span><span class="p">,</span> <span class="n">particleName</span><span class="o">=</span><span class="s2">&quot;neutron&quot;</span><span class="p">;</span>

<span class="n">meshAir</span><span class="p">:</span> <span class="n">scorermesh</span><span class="p">,</span> <span class="n">nx</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">ny</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">nz</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">xsize</span><span class="o">=</span><span class="mi">40</span><span class="o">*</span><span class="n">cm</span><span class="p">,</span> <span class="n">ysize</span><span class="o">=</span><span class="mi">20</span><span class="o">*</span><span class="n">cm</span><span class="p">,</span> <span class="n">zsize</span><span class="o">=</span><span class="mi">20</span><span class="o">*</span><span class="n">cm</span><span class="p">,</span>
                     <span class="n">scoreQuantity</span><span class="o">=</span><span class="s2">&quot;neutronPopulation&quot;</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="mf">20.75</span><span class="o">*</span><span class="n">m</span><span class="p">;</span>
</pre></div>
</div>
<p>This defines a scoring mesh that counts the population of neutrons in a 40 x 20 x 20 cm mesh
with 40 x 20 x 20 cells (so each cell is 1 x 1 x 1 cm) that is aligned to global Cartesian
x, y, z and displaced in z by 20.75 m.</p>
<p>Example 2:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">neutronPopulation</span><span class="p">:</span> <span class="n">scorer</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;population&quot;</span><span class="p">,</span> <span class="n">particleName</span><span class="o">=</span><span class="s2">&quot;neutron&quot;</span><span class="p">;</span>

<span class="n">protonAmbient</span><span class="p">:</span> <span class="n">scorer</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;cellfluxscaledperparticle&quot;</span><span class="p">,</span>
                       <span class="n">particleName</span><span class="o">=</span><span class="s2">&quot;proton&quot;</span><span class="p">,</span>
                       <span class="n">minimumKineticEnergy</span><span class="o">=</span><span class="mi">20</span><span class="o">*</span><span class="n">MeV</span><span class="p">,</span>
                       <span class="n">maximumKineticEnergy</span><span class="o">=</span><span class="mi">1</span><span class="o">*</span><span class="n">GeV</span><span class="p">,</span>
                       <span class="n">minimumTime</span><span class="o">=</span><span class="mi">0</span><span class="o">*</span><span class="n">s</span><span class="p">,</span>
                       <span class="n">maximumTime</span><span class="o">=</span><span class="mi">1</span><span class="o">*</span><span class="n">s</span><span class="p">,</span>
                       <span class="n">conversionFactorFile</span><span class="o">=</span><span class="s2">&quot;h10protons.txt&quot;</span><span class="p">;</span>

<span class="n">meshAir</span><span class="p">:</span> <span class="n">scorermesh</span><span class="p">,</span> <span class="n">nx</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">ny</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">nz</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">xsize</span><span class="o">=</span><span class="mi">40</span><span class="o">*</span><span class="n">cm</span><span class="p">,</span> <span class="n">ysize</span><span class="o">=</span><span class="mi">20</span><span class="o">*</span><span class="n">cm</span><span class="p">,</span> <span class="n">zsize</span><span class="o">=</span><span class="mi">20</span><span class="o">*</span><span class="n">cm</span><span class="p">,</span>
                     <span class="n">scoreQuantity</span><span class="o">=</span><span class="s2">&quot;neutronPopulation protonAmbient&quot;</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="mf">20.75</span><span class="o">*</span><span class="n">m</span><span class="p">;</span>
</pre></div>
</div>
<p>In this example, a similar mesh as Example 1 is used, but two 3D histograms are made. One for
the neutron population and one for the ambient dose (using the “h10protons.txt” conversion
file) for protons between 20 MeV and 1 GeV in kinetic energy and that exist between 0 s
(the start of the simulation) and 1 s in time of flight.</p>
<p>Example 3:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">neutron_flux_4D</span><span class="p">:</span> <span class="n">scorer</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;cellflux4d&quot;</span><span class="p">,</span>
                       <span class="n">particleName</span><span class="o">=</span><span class="s2">&quot;neutron&quot;</span><span class="p">;</span>

<span class="n">meshAir_4D_linear</span><span class="p">:</span> <span class="n">scorermesh</span><span class="p">,</span> <span class="n">nx</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">ny</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">nz</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">ne</span><span class="o">=</span> <span class="mi">100</span><span class="p">,</span> <span class="n">xsize</span><span class="o">=</span><span class="mi">40</span><span class="o">*</span><span class="n">cm</span><span class="p">,</span> <span class="n">ysize</span><span class="o">=</span><span class="mi">20</span><span class="o">*</span><span class="n">cm</span><span class="p">,</span> <span class="n">zsize</span><span class="o">=</span><span class="mi">20</span><span class="o">*</span><span class="n">cm</span><span class="p">,</span> <span class="n">eScale</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span>
                   <span class="n">eLow</span><span class="o">=</span><span class="mf">1e-12</span><span class="o">*</span><span class="n">GeV</span><span class="p">,</span><span class="n">eHigh</span><span class="o">=</span><span class="mi">1</span><span class="o">*</span><span class="n">GeV</span><span class="p">,</span>
                   <span class="n">scoreQuantity</span><span class="o">=</span><span class="s2">&quot;neutron_flux_4D&quot;</span><span class="p">,</span>
                   <span class="n">z</span><span class="o">=</span><span class="mf">20.75</span><span class="o">*</span><span class="n">m</span><span class="p">;</span>

<span class="n">meshAir_4D_log</span><span class="p">:</span> <span class="n">scorermesh</span><span class="p">,</span> <span class="n">nx</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">ny</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">nz</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">ne</span><span class="o">=</span> <span class="mi">100</span><span class="p">,</span> <span class="n">xsize</span><span class="o">=</span><span class="mi">40</span><span class="o">*</span><span class="n">cm</span><span class="p">,</span> <span class="n">ysize</span><span class="o">=</span><span class="mi">20</span><span class="o">*</span><span class="n">cm</span><span class="p">,</span> <span class="n">zsize</span><span class="o">=</span><span class="mi">20</span><span class="o">*</span><span class="n">cm</span><span class="p">,</span> <span class="n">eScale</span><span class="o">=</span><span class="s2">&quot;log&quot;</span><span class="p">,</span>
                <span class="n">eLow</span><span class="o">=</span><span class="mf">1e-3</span><span class="o">*</span><span class="n">GeV</span><span class="p">,</span><span class="n">eHigh</span><span class="o">=</span><span class="mi">1</span><span class="o">*</span><span class="n">GeV</span><span class="p">,</span>
                <span class="n">scoreQuantity</span><span class="o">=</span><span class="s2">&quot;neutron_flux_4D&quot;</span><span class="p">,</span>
                <span class="n">z</span><span class="o">=</span><span class="mf">20.75</span><span class="o">*</span><span class="n">m</span><span class="p">;</span>

<span class="n">meshAir_4d_variable</span><span class="p">:</span> <span class="n">scorermesh</span><span class="p">,</span> <span class="n">nx</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">ny</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">nz</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">xsize</span><span class="o">=</span><span class="mi">40</span><span class="o">*</span><span class="n">cm</span><span class="p">,</span> <span class="n">ysize</span><span class="o">=</span><span class="mi">20</span><span class="o">*</span><span class="n">cm</span><span class="p">,</span> <span class="n">zsize</span><span class="o">=</span><span class="mi">20</span><span class="o">*</span><span class="n">cm</span><span class="p">,</span> <span class="n">eScale</span><span class="o">=</span><span class="s2">&quot;user&quot;</span><span class="p">,</span>
                     <span class="n">eBinsEdgesFilenamePath</span><span class="o">=</span><span class="s2">&quot;./eBins.txt&quot;</span><span class="p">,</span>
                     <span class="n">scoreQuantity</span><span class="o">=</span><span class="s2">&quot;neutron_flux_4D&quot;</span><span class="p">,</span>
                     <span class="n">z</span><span class="o">=</span><span class="mf">20.75</span><span class="o">*</span><span class="n">m</span><span class="p">;</span>
</pre></div>
</div>
<p>In this example, three 4D meshes similar to the mesh of the Example 1 are used with each of them using a different scaling type for the energy axis.
They respectively use the “linear”, “log” and “user” type. The file “eBins.txt” is required by the “user” scaling type for the energy bin edges definition.</p>
<p>Column of the eBins.txt file is:</p>
<ol class="arabic simple">
<li><p>Kinetic energy in <strong>GeV</strong></p></li>
</ol>
<p>Below is an example contents :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mf">0.001</span>
<span class="mf">0.02</span>
<span class="mf">0.2</span>
<span class="mf">0.5</span>
<span class="mf">1.0</span>
</pre></div>
</div>
</section>
<section id="visualising-a-scoring-mesh">
<h3>Visualising a Scoring Mesh<a class="headerlink" href="#visualising-a-scoring-mesh" title="Link to this heading"></a></h3>
<p>Scoring meshes are by default invisible because 1) they are not constructed by Geant4 until the
start of a run and 2) they are in a parallel world and have to be explicitly viewed. To visualise
a mesh:</p>
<ol class="arabic simple">
<li><p>Start BDSIM interactively (without <code class="code docutils literal notranslate"><span class="pre">--batch</span></code>)</p></li>
<li><p>Run 1 event <code class="code docutils literal notranslate"><span class="pre">/run/beamOn</span> <span class="pre">1</span></code></p></li>
<li><p>Draw parallel worlds <code class="code docutils literal notranslate"><span class="pre">/vis/drawVolume</span> <span class="pre">worlds</span></code></p></li>
<li><p>Use the tick boxes in the scene tree to turn off other parallel worlds such as the
curvilinear ones, and also ideally set the view to wireframe with the wireframe button
on the top row of icons.</p></li>
</ol>
</section>
<section id="visualising-scoring-data">
<h3>Visualising Scoring Data<a class="headerlink" href="#visualising-scoring-data" title="Link to this heading"></a></h3>
<p>Quantities from a scoring mesh are stored per-event in the output (in the default ROOT event output
this is in the vector <code class="code docutils literal notranslate"><span class="pre">Event.Histos.histograms3D</span></code>). Each histogram can of course be accessed
individually by loading the data in ROOT or Python (see <a class="reference internal" href="output_analysis.html#output-user-analysis"><span class="std std-ref">User Analysis</span></a>). However, the
best way is to merge the histograms per-event into an average. This can be done with rebdsimHistoMerge.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">bdsim</span> <span class="o">--</span><span class="n">file</span><span class="o">=</span><span class="n">scoring</span><span class="o">-</span><span class="nb">filter</span><span class="o">-</span><span class="n">material</span><span class="o">-</span><span class="n">include</span><span class="o">.</span><span class="n">gmad</span> <span class="o">--</span><span class="n">outfile</span><span class="o">=</span><span class="n">d1</span> <span class="o">--</span><span class="n">batch</span> <span class="o">--</span><span class="n">ngenerate</span><span class="o">=</span><span class="mi">100</span>
<span class="n">rebdsimHistoMerge</span> <span class="n">d1</span><span class="o">.</span><span class="n">root</span> <span class="n">d1</span><span class="o">-</span><span class="n">histos</span><span class="o">.</span><span class="n">root</span>
<span class="n">root</span> <span class="o">-</span><span class="n">l</span> <span class="n">d1</span><span class="o">-</span><span class="n">histos</span><span class="o">.</span><span class="n">root</span>
<span class="o">&gt;</span> <span class="n">TBrowser</span> <span class="n">tb</span><span class="p">;</span>
</pre></div>
</div>
<ul class="simple">
<li><p>ROOT’s TBrowser does not show 3D histograms by default. In the top left, the “Draw Option” drop
down menu should be set to “lego2” for example, then re-click on the 3D histogram as shown below.</p></li>
</ul>
<figure class="align-center" id="id28">
<a class="reference internal image-reference" href="_images/scoring-root-file-view.png"><img alt="_images/scoring-root-file-view.png" src="_images/scoring-root-file-view.png" style="width: 95%;" /></a>
<figcaption>
<p><span class="caption-text">View of a ROOT TBrowser showing an average 3D histogram from a scoring mesh using
the “lego2” visualisation option. This is based on 100 events from the example
<cite>scoring-filter-material-include.gmad</cite>. Here a material filter is used to score only
the coils of a quadrupole - the 8 coils can be seen lying in 8 clusters in an
x,y plane with z (along the beam line) being vertically.</span><a class="headerlink" href="#id28" title="Link to this image"></a></p>
</figcaption>
</figure>
</section>
</section>
<section id="controlling-simulation-speed">
<span id="id18"></span><h2>Controlling Simulation Speed<a class="headerlink" href="#controlling-simulation-speed" title="Link to this heading"></a></h2>
<p>The particle showers created in high energy particle interactions with matter can lead to a
very large number of particles being produced in an event. These in turn each take time to
track through the model and the computational time per event increases. When simulating a
very high-energy scale, the user may not be interested in very low-energy particles, however
these may dominate the simulation time.</p>
<p>To improve efficiency, there are several options the user can adjust. These however may reduce
the accuracy of the results obtained and must be used cautiously and only where required.</p>
<section id="range-cuts">
<h3>Range Cuts<a class="headerlink" href="#range-cuts" title="Link to this heading"></a></h3>
<p>The production range cuts are the recommended method from Geant4, who strongly advocate
these over energy-based tracking cuts. These produce the most accurate results while
reducing simulation time. Approximately, these are the length a secondary must travel
before interacting. If the secondary would not travel further than this (depending on
the secondary species, physics lists, material and energy), the secondary will not
be produced. These can be set globally or for a <em>region</em> (see <a class="reference internal" href="model_customisation.html#regions"><span class="std std-ref">Regions</span></a>) that is attached
to individual volumes through the “region” parameter for that accelerator element. In
fact, a range cut always exists in Geant4 (to prevent infrared divergence) and is by
default 0.7 mm.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rangecut</span><span class="o">=</span><span class="mi">3</span><span class="o">*</span><span class="n">cm</span><span class="p">;</span>
<span class="n">option</span><span class="p">,</span> <span class="n">prodCutPhotons</span>   <span class="o">=</span> <span class="n">rangecut</span><span class="p">,</span>
        <span class="n">prodCutElectrons</span> <span class="o">=</span> <span class="n">rangecut</span><span class="p">,</span>
        <span class="n">prodCutPositrons</span> <span class="o">=</span> <span class="n">rangecut</span><span class="p">,</span>
        <span class="n">defaultRangeCut</span>  <span class="o">=</span> <span class="n">rangecut</span><span class="p">;</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The range cut should <strong>not</strong> be longer than the typical dimension of the objects
(i.e. a range cut of 1 km is likely to produce very rough energy deposition
around boundaries).</p>
</div>
</section>
<section id="minimum-kinetic-energy">
<h3>Minimum Kinetic Energy<a class="headerlink" href="#minimum-kinetic-energy" title="Link to this heading"></a></h3>
<p>The user may specify a minimum kinetic energy, below which any particle will be killed.
This may break conservation of energy if used aggressively. The default is 0 eV, as all
particles are tracked to zero energy (allowing for the above range cuts).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">option</span><span class="p">,</span> <span class="n">minimumKineticEnergy</span><span class="o">=</span><span class="mi">10</span><span class="o">*</span><span class="n">MeV</span><span class="p">;</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>This will affect the location of energy deposition - i.e. the curve of
energy deposition of a particle showering in a material will be different.</p>
</div>
<p>Certain particles can be excluded from this using <code class="code docutils literal notranslate"><span class="pre">option,</span> <span class="pre">particlesToExcludeFromCuts=&quot;1</span> <span class="pre">2</span> <span class="pre">3&quot;;</span></code>
where 1, 2, 3 are the PDG IDs of the particles to be excluded separated by white space in a string.
For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">option</span><span class="p">,</span> <span class="n">minimumKineticEnergy</span><span class="o">=</span><span class="mi">1</span><span class="o">*</span><span class="n">GeV</span><span class="p">,</span>
        <span class="n">particlesToExcludeFromCuts</span><span class="o">=</span><span class="s2">&quot;13 -13&quot;</span><span class="p">;</span>
</pre></div>
</div>
<p>This will remove all particles below 1 GeV kinetic energy apart from muons (both charges) which will
be tracked down to zero energy.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The option <cite>particlesToExcludeFromCuts</cite> applies to the options <cite>minimumKineticEnergy</cite>,
<cite>minimumRange</cite>, <cite>maximumTrackingTime</cite>, and <cite>maximumTrackLength</cite>.</p>
</div>
</section>
<section id="minimum-range">
<h3>Minimum Range<a class="headerlink" href="#minimum-range" title="Link to this heading"></a></h3>
<p>The user may specify a minimum range for a particle to travel. Any particles with step
sizes proposed below this will be killed. Again, this can break energy conservation
if used aggressively.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">option</span><span class="p">,</span> <span class="n">minimumRange</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">cm</span><span class="p">;</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>This will affect the location of energy deposition - i.e. the curve of
energy deposition of a particle showering in a material will be different.</p>
</div>
</section>
</section>
<section id="dipole-behaviour">
<span id="bend-tracking-behaviour"></span><h2>Dipole Behaviour<a class="headerlink" href="#dipole-behaviour" title="Link to this heading"></a></h2>
<section id="fringe-field-integral-behaviour">
<h3>Fringe Field Integral Behaviour<a class="headerlink" href="#fringe-field-integral-behaviour" title="Link to this heading"></a></h3>
<p>Fringe fields can be specified for dipole magnets through the parameters <cite>hgap</cite>, <cite>fint</cite> and <cite>fintx</cite>.
<cite>fint</cite> is the fringe field integral, as described in <a class="reference internal" href="dev_tracking.html#dipole-fringe-integrator"><span class="std std-ref">BDSIM Dipole Fringe</span></a> for the entrance
face of the dipole. <cite>fintx</cite> is for the same, but for the exit face. Even when there is no pole face
rotation, there is still a small fringe field effect.</p>
<p>If <cite>fint</cite> is specified but <cite>fintx</cite> is not, <cite>fintx</cite> will default to the same value as <cite>fint</cite>. If,
however, <cite>fintx</cite> is set to 0, it will in fact be 0 and will not take the value of <cite>fint</cite>. This is
the same default behaviour as MAD-X. MAD-X will write out a value of <cite>fintx</cite> as -1 in this case in
any output. BDSIM will write out the value used, even if it’s equal to 0.</p>
</section>
<section id="pole-face-rotations">
<h3>Pole Face Rotations<a class="headerlink" href="#pole-face-rotations" title="Link to this heading"></a></h3>
<p>The <cite>bdsimtwo</cite> integrator set (see <a class="reference internal" href="dev_tracking.html#integrator-sets"><span class="std std-ref">Integrator Sets</span></a>) provides tracking through a uniform
magnetic field in a dipole. The field exists wherever the magnet exists; in the case of pole
face rotations on the end of a dipole, the magnet is constructed with the appropriate angled face.
The field therefore also has a hard edge with exactly no field immediately outside the magnet volume.</p>
<p>The tracking routine for dipoles in the <cite>bdsimtwo</cite> integrator set (see <a class="reference internal" href="dev_tracking.html#bdsim-dipole-rodrigues2"><span class="std std-ref">BDSIM Dipole Rodrigues 2</span></a>)
tracks the particle using the analytical helical solution in a pure magnetic field in Cartesian
coordinates. This however does not agree with the tracking provided by MAD-X. We therefore provide
an equivalent to MAD-X in <cite>bdsimmatrix</cite> integrator set (the default). The vertical focussing provided
by the fringe field is the same in both cases.</p>
<p>The difference between the two is negligible for small pole face angles - for example, the LHC lattice
shows no difference between the integrator sets (~14mrad bending angle and very low pole face angles).
However, with higher angle bends and stronger pole face angles (maximum is up to 45 degrees), the
difference is non-negligible.</p>
<p>The integrator for dipoles in <cite>bdsimtwo</cite> is computationally faster and should be used for lattices
like the LHC, where speed matters and the pole faces are not a strong feature.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To provide equivalent tracking to MAD-X with the <cite>bdsimmatrix</cite> integrator set, the
magnet geometry is constructed with flat ends (i.e. always an sbend). Rbends are constructed
as sbends with additional poleface rotation angles equal to half the bend angle. Instead of
constructing the poleface geometry, the effect of a poleface rotation is applied in a thin
fringefield magnet (1 micron thick by default) at the beginning (for non-zero e1) or at the
end (for non-zero e2) of the dipole. In future, this will be decoupled to allow both the
physical angled faces in the model as well as accurate tracking, using the MAD-X style matrix
integrators.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The dipole fringe matrix used for poleface rotations and fringe field tracking
(see <a class="reference internal" href="dev_tracking.html#dipole-fringe-integrator"><span class="std std-ref">BDSIM Dipole Fringe</span></a>) has no terms that are momentum dependent, therefore to match
MAD-X, the dipole fringe integrator in the <cite>bdsimmatrix</cite> set does not normalise the fringe kick to
the particle’s momentum. This of course means that the fringe’s effect on the beam optics is independent
of energy spread. As a particle’s bending radius should depend on its momentum, the user can instead
use the <cite>bdsimmatrixfringescaling</cite> integrator set which is identical to the <cite>bdsimmatrix</cite> set except
for the dipole fringe integrator which does normalises to momentum on a per-particle basis. This integrator
set would therefore produce a slightly different optic performance if the beam has an energy spread and may
not match MAD-X.</p>
</div>
</section>
<section id="large-angle-bends">
<h3>Large Angle Bends<a class="headerlink" href="#large-angle-bends" title="Link to this heading"></a></h3>
<p>For a model that includes large angle bends (for example &gt; 0.1rad), the user should consider reducing
the sampler diameter (see <a class="reference internal" href="#sampler-dimensions"><span class="std std-ref">Plane Sampler Dimensions</span></a> and <a class="reference internal" href="#options-geometry"><span class="std std-ref">Geometry Options</span></a>). This is because
the default 5m width of a sampler may cause overlaps between samplers, or each sampler may record
particles from multiple positions in the beam line.</p>
<p>One other point is that the parallel geometry used for curvilinear transforms (the “curvilinear world”)
may overlap with other curvilinear elements earlier in the beam line. The size of the curvilinear
world <cite>cylinders</cite> is based on the samplerDiameter and reducing the samplerDiameter will reduce its size.
There is some automatic provision for this in BDSIM where the sampler diameter is automatically reduced
when large angle bends are present in the lattice, but this is based on a heuristic, rather than direct
overlap checks.</p>
<p>In short, we recommend running with <code class="code docutils literal notranslate"><span class="pre">option,</span> <span class="pre">checkOverlaps=1;</span></code> once to verify there are no
problems for a machine with large angle bends. If there are any overlaps, reduce the sampler diameter
to the typical full width of a magnet.</p>
</section>
<section id="dipole-scaling">
<h3>Dipole Scaling<a class="headerlink" href="#dipole-scaling" title="Link to this heading"></a></h3>
<p>When scaling a dipole, BDSIM internally scales the dipole field and therefore scales the bending radius as the
machine’s nominal rigidity remains unchanged. This same field is also used in the dipole fringes for particle
transport through the element, therefore the magnitude of the fringe kick should also scale due to its dependence
on the bending radius.</p>
<p>The default integrator set, <cite>bdsimmatrix</cite>, however, is designed to match the behaviour of MAD-X and MAD-8 where
the standard fringe matrix has no energy dependent terms (see <a class="reference internal" href="dev_tracking.html#dipole-fringe-integrator"><span class="std std-ref">BDSIM Dipole Fringe</span></a>). The same kick is
therefore applied to every charged particle irrespective of its momentum.</p>
<p>As the kick would be calculated from the scaled bending radius, whilst it would be physically accurate for the
particle, it would not match MAD which would apply the kick as if the particle were nominal. In the <cite>bdsimmatrix</cite>
integrator set we therefore undo any scaling in the fringes and apply the nominal kick that MAD would.</p>
<p>Should the user need or wish to scale the fringes then they should user the <cite>bdsimmatrixfringescaling</cite> integrator
set which is identical to the default <cite>bdsimmatrix</cite> set except for the fringe integrator. This integrator calculates
the bending radius on a per particle basis, accounting for both scaled field and any energy deviation.</p>
<p>Should the model be designed to scale a field by a factor <cite>N</cite> to account for a factor <cite>N</cite> change in central momentum,
then the behaviour of the fringe kick would be the same as the <cite>bdsimmatrix</cite> fringe integrator, as the field scaling
would counteract the momentum deviation and the bending radius should be calculated as nominal for that magnet. The
result may not entirely match that if using the <cite>bdsimmatrix</cite> set due to the aforementioned effect of energy spread.</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="model_construction.html" class="btn btn-neutral float-left" title="Model Construction" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="model_customisation.html" class="btn btn-neutral float-right" title="Model Customisation" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright Beam Delivery Simulation (BDSIM) Copyright (c) Royal Holloway, University of London, 2001 - 2025.
      <span class="lastupdated">Last updated on Jun 13, 2025.
      </span></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
    <!-- Theme Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-JYMKZHVZJ2"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-JYMKZHVZJ2', {
          'anonymize_ip': false,
      });
    </script> 

</body>
</html>