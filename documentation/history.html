<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Version History &mdash; BDSIM 1.7.7.develop documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="_static/graphviz.css?v=fd3f3429" />

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js?v=5d32c60e"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="_static/documentation_options.js?v=106dc6df"></script>
        <script src="_static/doctools.js?v=9a2dae69"></script>
        <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Developer Documentation" href="developer.html" />
    <link rel="prev" title="Support" href="support.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            BDSIM
              <img src="_static/bdsim-logo-small.jpg" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                1.7.7.develop
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">User Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="licence.html">Licence &amp; Disclaimer</a></li>
<li class="toctree-l1"><a class="reference internal" href="authorship.html">Authorship</a></li>
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="running.html">Running BDSIM</a></li>
<li class="toctree-l1"><a class="reference internal" href="input_syntax.html">Input Syntax</a></li>
<li class="toctree-l1"><a class="reference internal" href="model_construction.html">Model Construction</a></li>
<li class="toctree-l1"><a class="reference internal" href="model_control.html">Model Control</a></li>
<li class="toctree-l1"><a class="reference internal" href="model_customisation.html">Model Customisation</a></li>
<li class="toctree-l1"><a class="reference internal" href="model_conversion.html">Model Conversion</a></li>
<li class="toctree-l1"><a class="reference internal" href="externalgeometry.html">External Geometry Formats</a></li>
<li class="toctree-l1"><a class="reference internal" href="output.html">Output</a></li>
<li class="toctree-l1"><a class="reference internal" href="output_analysis.html">Output Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="python_utilities.html">Python Utilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="visualisation.html">Visualisation</a></li>
<li class="toctree-l1"><a class="reference internal" href="interfacing.html">Interfacing</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Examples &amp; Tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="support.html">Support</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer Guide</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Version History</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#planned-development">Planned Development</a></li>
<li class="toctree-l2"><a class="reference internal" href="#v1-8-0-2025-xx-xx">v1.8.0 - 2025 / XX / XX</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#new-features">New Features</a></li>
<li class="toctree-l3"><a class="reference internal" href="#new-options">New Options</a></li>
<li class="toctree-l3"><a class="reference internal" href="#general-updates">General Updates</a></li>
<li class="toctree-l3"><a class="reference internal" href="#bug-fixes">Bug Fixes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#output-changes">Output Changes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#output-class-versions">Output Class Versions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#utilities">Utilities</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#v1-7-7-2024-01-29">V1.7.7 - 2024 / 01 / 29</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1">New Features</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id2">General Updates</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id3">Bug Fixes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id4">Output Changes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id5">Output Class Versions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#v1-7-6-2023-10-18">V1.7.6 - 2023 / 10 / 18</a></li>
<li class="toctree-l2"><a class="reference internal" href="#v1-7-5-2023-10-03">v1.7.5 - 2023 / 10 / 03</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id6">General Updates</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id7">Bug Fixes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#v1-7-4-2023-08-25">V1.7.4 - 2023 / 08 / 25</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id8">New Features</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id9">General Updates</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id10">Bug Fixes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#v1-7-3-2023-08-11">V1.7.3 - 2023 / 08 / 11</a></li>
<li class="toctree-l2"><a class="reference internal" href="#v1-7-2-2023-08-11">V1.7.2 - 2023 / 08 / 11</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id11">General Updates</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id12">Bug Fixes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#v1-7-1-2023-07-20">V1.7.1 - 2023 / 07 / 20</a></li>
<li class="toctree-l2"><a class="reference internal" href="#v1-7-0-2023-07-11">V1.7.0 - 2023 / 07 / 11</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id13">New Features</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id14">General Updates</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id15">Bug Fixes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id16">Output Changes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id17">Output Class Versions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id18">Utilities</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#v1-6-0-2021-06-16">V1.6.0 - 2021 / 06 / 16</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id19">New Features</a></li>
<li class="toctree-l3"><a class="reference internal" href="#general">General</a></li>
<li class="toctree-l3"><a class="reference internal" href="#build-changes">Build Changes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id20">Bug Fixes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id21">Output Changes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id22">Output Class Versions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id23">Utilities</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#v1-5-1-2020-12-21">V1.5.1 - 2020 / 12 / 21</a></li>
<li class="toctree-l2"><a class="reference internal" href="#v1-5-0-2020-12-16">V1.5.0 - 2020 / 12 / 16</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#build-system">Build System</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id24">New Features</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id25">General</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id26">Bug Fixes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id27">Output Changes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id28">Output Class Versions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id29">Utilities</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#v1-4-0-2020-06-08">V1.4.0 - 2020 / 06 / 08</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#expected-changes-to-results">Expected Changes To Results</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id30">New Features</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id31">General</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id32">Bug Fixes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id33">Output Changes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id34">Output Class Versions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id35">Utilities</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#v1-3-3-2019-05-21">V1.3.3 - 2019 / 05 / 21</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id36">Bug Fixes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#v1-3-2-2019-04-20">V1.3.2 - 2019 / 04 / 20</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id37">New Features</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id38">General</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id39">Bug Fixes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id40">Utilities</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#v1-3-1-2019-03-05">V1.3.1 - 2019 / 03 / 05</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id41">Bug Fixes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#v1-3-2019-02-27">V1.3 - 2019 / 02 / 27</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id42">Expected Changes To Results</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id43">New Features</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id44">General</a></li>
<li class="toctree-l3"><a class="reference internal" href="#materials">Materials</a></li>
<li class="toctree-l3"><a class="reference internal" href="#developer-changes">Developer Changes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id45">Bug Fixes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id46">Output Changes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id47">Output Class Versions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id48">Utilities</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#v1-2-2018-08-26">V1.2 - 2018 / 08 / 26</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#highlights">Highlights</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id49">New Features</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id50">General</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id51">Output Changes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id52">Bug Fixes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id53">Utilities</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#v1-1-2018-05-23">V1.1 - 2018 / 05 / 23</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id54">New Features</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id55">General</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id56">Bug Fixes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id57">Utilities</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#v1-0-2018-04-10">V1.0 - 2018 / 04 / 10</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id58">Highlights</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id59">New Features</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id60">Output Changes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#analysis-changes">Analysis Changes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id61">General</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id62">Bug Fixes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id63">Utilities</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#v0-993-2017-12-11">V0.993 - 2017 / 12 / 11</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id64">New Features</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id65">Bug Fixes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id66">Output Changes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id67">General</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id68">Utilities</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#v0-992-2017-07-26">V0.992 - 2017 / 07 / 26</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id69">New Features</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id70">Bug Fixes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id71">General</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id72">Utilities</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#v0-991-2017-07-04">V0.991 - 2017 / 07 / 04</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id73">Bug Fixes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id74">General</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id75">Utilities</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#v0-99-2017-06-09">V0.99 - 2017 / 06 / 09</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id76">New Features</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#fields-integrators">Fields &amp; Integrators</a></li>
<li class="toctree-l4"><a class="reference internal" href="#geometry">Geometry</a></li>
<li class="toctree-l4"><a class="reference internal" href="#output-analysis">Output &amp; Analysis</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id77">Bug Fixes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id78">General</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id79">Utilities</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#v0-95-2016-11-07">V0.95 - 2016 / 11 / 07</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id80">New Features</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id81">Bug Fixes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id82">General</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id83">Utilities</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#v0-94-2016-09-13">V0.94 - 2016 / 09 / 13</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id84">New Features</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#analysis">Analysis</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id85">Geometry</a></li>
<li class="toctree-l4"><a class="reference internal" href="#output">Output</a></li>
<li class="toctree-l4"><a class="reference internal" href="#parser">Parser</a></li>
<li class="toctree-l4"><a class="reference internal" href="#physics">Physics</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id86">Bug Fixes</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id87">Geometry</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id88">Output</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id89">Physics</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id90">General</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id91">Utilities</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#v0-93-2016-08-24">V0.93 - 2016 / 08 / 24</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id92">New Features</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id93">Analysis</a></li>
<li class="toctree-l4"><a class="reference internal" href="#build">Build</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id94">Geometry</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id95">Output</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id96">Parser</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id97">Physics</a></li>
<li class="toctree-l4"><a class="reference internal" href="#tracking">Tracking</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id98">General</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id99">Bug Fixes</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id100">Geometry</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id101">Parser</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id102">Physics</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id103">Tracking</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id104">General</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id105">Utilities</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#v0-92-2016-03-29">V0.92 - 2016 / 03 / 29</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id106">New Features</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id107">Geometry</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id108">Output</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id109">Parser</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id110">Physics</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id111">Bug fixes</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id112">Geometry</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id113">Parser</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id114">Physics</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id115">General</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id116">Utilities</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#v0-91-2015-12-17">V0.91 - 2015 / 12 / 17</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id117">New Features</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id118">Geometry</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id119">Output</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id120">Parser</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id121">Physics</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id122">Tracking</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id123">Bug fixes</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id124">Geometry</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id125">Parser</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id126">Physics</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id127">Tracking</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id128">General</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id129">Utilities</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#v0-9-2015-11-10">V0.9 - 2015 / 11 / 10</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id130">New Features</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id131">Bug fixes</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id132">Geometry</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id133">Physics</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id134">Parser</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id135">Tracking</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id136">General</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id137">Utilities</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#v0-8-2015-08-10">V0.8 - 2015 / 08 / 10</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id138">New Features</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id139">Bug fixes</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id140">Geometry</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id141">Physics</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id142">Output</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id143">Parser</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id144">General</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#v0-702-2015-07-28-hotfix">V0.702 2015 / 07 / 28 - Hotfix</a></li>
<li class="toctree-l2"><a class="reference internal" href="#v0-701-2015-07-02-hotfix">V0.701 2015 / 07 / 02 - Hotfix</a></li>
<li class="toctree-l2"><a class="reference internal" href="#v0-7-2015-06-30">V0.7 - 2015 / 06 / 30</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id145">New Features</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id146">Bug fixes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#v0-65-2015-04-10">V0.65 - 2015 / 04 / 10</a></li>
<li class="toctree-l2"><a class="reference internal" href="#v0-64-2015-02-16">V0.64 - 2015 / 02 / 16</a></li>
<li class="toctree-l2"><a class="reference internal" href="#v0-63-2015-02-06">V0.63 - 2015 / 02 / 06</a></li>
<li class="toctree-l2"><a class="reference internal" href="#v0-62-2014-08-07">V0.62 - 2014 / 08 / 07</a></li>
<li class="toctree-l2"><a class="reference internal" href="#v0-61-2014-08-05">V0.61 - 2014 / 08 / 05</a></li>
<li class="toctree-l2"><a class="reference internal" href="#v0-6-2013-12-02">v0.6 - 2013 / 12 / 02</a></li>
<li class="toctree-l2"><a class="reference internal" href="#v0-5-2008-11-08">v0.5 - 2008 / 11 / 08</a></li>
<li class="toctree-l2"><a class="reference internal" href="#v0-4-2008-02-26">v0.4 - 2008 / 02 / 26</a></li>
<li class="toctree-l2"><a class="reference internal" href="#v0-3-2007-01-26">v0.3 - 2007 / 01 / 26</a></li>
<li class="toctree-l2"><a class="reference internal" href="#v0-2-2006-05-18">v0.2 - 2006 / 05 / 18</a></li>
<li class="toctree-l2"><a class="reference internal" href="#v0-1-2006-02-22">v0.1 - 2006 / 02 / 22</a></li>
<li class="toctree-l2"><a class="reference internal" href="#beta-2005-05-01">beta - 2005 / 05 / 01</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="developer.html">Developer Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="model_description.html">Model Description</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">BDSIM</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Version History</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/history.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="version-history">
<h1>Version History<a class="headerlink" href="#version-history" title="Link to this heading"></a></h1>
<section id="planned-development">
<h2>Planned Development<a class="headerlink" href="#planned-development" title="Link to this heading"></a></h2>
<p>Below is a brief list of planned developments for the next version. Please get in touch
if you’d like to give us feedback or help in the development.  See <a class="reference internal" href="support.html#support-section"><span class="std std-ref">Support</span></a>.</p>
<ul class="simple">
<li><p>Multiple beam line tracking.</p></li>
<li><p>Restructure code into more C++ libraries rather than just analysis and ‘bdsim’.</p></li>
<li><p>Interpolated aperture shapes between any two shapes.</p></li>
<li><p>Tapered aperture for all elements.</p></li>
<li><p>Beam pipe sections to fill gaps between changes in aperture.</p></li>
<li><p>Any aperture shape can be used for both the inside and the outside of a collimator.</p></li>
</ul>
</section>
<section id="v1-8-0-2025-xx-xx">
<h2>v1.8.0 - 2025 / XX / XX<a class="headerlink" href="#v1-8-0-2025-xx-xx" title="Link to this heading"></a></h2>
<p>The BDSIM source code has moved to Github and is available here: <a class="reference external" href="https://github.com/bdsim-collaboration/bdsim">https://github.com/bdsim-collaboration/bdsim</a></p>
<p>This move was done due to better provision of testing resources and interfaces. All issues
should now be launched here. A more modern approach of pull-requests is being used and
more publicly accessible and complete continuous integration is now used. This was done
to maintain the expected high quality of the code.</p>
<ul class="simple">
<li><p>For models with acceleration, the rigidity and synchronous time are now calculated
along the beamline and pre-calculated <strong>scaling factors are no longer needed</strong>.</p></li>
</ul>
<section id="new-features">
<h3>New Features<a class="headerlink" href="#new-features" title="Link to this heading"></a></h3>
<p><strong>Analysis</strong></p>
<ul class="simple">
<li><p>New <code class="code docutils literal notranslate"><span class="pre">CreateEmptyBdskimFile</span></code> in the <code class="code docutils literal notranslate"><span class="pre">DataDummyClass</span></code> to give this function in pybdsim
for easy customised skimming in Python.</p></li>
</ul>
<p><strong>Fields</strong></p>
<ul class="simple">
<li><p>The <cite>rf</cite> beamline element now has the parameter <code class="code docutils literal notranslate"><span class="pre">cavityFieldType</span></code> to specify which
field model to use rather than specifying <code class="code docutils literal notranslate"><span class="pre">fieldVacuum</span></code> and a corresponding field
definition.</p></li>
<li><p>The option <code class="code docutils literal notranslate"><span class="pre">cavityFieldType</span></code> may be used to set the default field model for all <cite>rf</cite>
elements.</p></li>
<li><p>The “rfcavity” field is now “rfpillbox”.</p></li>
</ul>
<p><strong>General</strong></p>
<ul class="simple">
<li><p><code class="code docutils literal notranslate"><span class="pre">autoColour=1</span></code> now works for all collimators and target elements. If turned on, the
colour of the element in the visualiser will be given by the material.</p></li>
<li><p>GDML exports from BDSIM now include auxiliary colour information that can be handled by
pyg4ometry and also be BDSIM if the same file is loaded in again.</p></li>
</ul>
<p><strong>Physics</strong></p>
<ul class="simple">
<li><p>New <code class="code docutils literal notranslate"><span class="pre">ionisation</span></code> modular physics list for only the ionisation process for the most
common particles.</p></li>
</ul>
</section>
<section id="new-options">
<h3>New Options<a class="headerlink" href="#new-options" title="Link to this heading"></a></h3>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p><strong>Option</strong></p></th>
<th class="head"><p><strong>Function</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>cavityFieldType</p></td>
<td><p>Default cavity field type (‘constantinz’, ‘pillbox’)
to use for all rf elements unless otherwise specified.</p></td>
</tr>
<tr class="row-odd"><td><p>integrateKineticEnergyAlongBeamline</p></td>
<td><p>Integrate changes to the nominal beam energy along
the beamline such as from accelerator and adjust
the design rigidity for normalised fields
accordingly.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="general-updates">
<h3>General Updates<a class="headerlink" href="#general-updates" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>The interface for custom components has changed due to the new beamline integral class and object.
The example has been updated accordingly.</p></li>
<li><p>Internally, beamline elements are now cached based on both their name (basic reuse of components)
but also the nominal rigidity at that point in the beamline. This is because if, say, a quadrupole
is used later in the beamline after acceleration with the same <cite>k1</cite>, the actual field gradient
is different and so the component must be uniquely constructed to have a different field.</p></li>
<li><p>The time coordinate is now loaded and applied to each particle when loading a BDSIM output
sampler as a distribution.</p></li>
<li><p>An exception will now be thrown if a field map is loaded containing NAN or +-INF values. In
the past, these would be simply loaded and propagated through to tracking resulting in a stuck
particle in Geant4.</p></li>
</ul>
</section>
<section id="bug-fixes">
<h3>Bug Fixes<a class="headerlink" href="#bug-fixes" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>Fix rebdsim’s Spectra command preparing the wrong variables when used on a cylindrical
or spherical sampler where the variable is “totalEnergy” and not “energy”.</p></li>
<li><p>Fix a bug where rebdsim would crash if a Spectra command was used on a cylindrical or
spherical sampler. This was caused by loading the data into the wrong class.</p></li>
<li><p>The pill-box field was fixed where it should have no <cite>z</cite> dependence whereas it did previously.</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">--exportGeometryTo</span></code> executable option used to build up relative paths with respect to the
input file and not the executable location. This has been fixed to be relative to the executable
location. Noticeable if executing BDSIM from a different directory from the main input file.</p></li>
<li><p>Fixed the loading of samplers with DataLoader (used when using <code class="code docutils literal notranslate"><span class="pre">pybdsim.Data.Load</span></code>) when
no model tree was stored. The samplers would not be identified in the past.</p></li>
<li><p>Fix the <code class="code docutils literal notranslate"><span class="pre">Event.Trajectory.pxpypz</span></code> variable in the output. It was implemented
incorrectly in code and was not the correct data. It is now components of the momentum
vector (absolute) in GeV/c in a frame local to that element as it should be.</p></li>
</ul>
</section>
<section id="output-changes">
<h3>Output Changes<a class="headerlink" href="#output-changes" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>The synchronous time at the middle of an element (<code class="code docutils literal notranslate"><span class="pre">midT</span></code>); the momentum at the
beginning of an element (<code class="code docutils literal notranslate"><span class="pre">staP</span></code>); and the kinetic energy at the beginning of
an element (<code class="code docutils literal notranslate"><span class="pre">staEk</span></code>) have all been added to the model tree in the output as
calculated by BDSIM as it now integrates the time and acceleration / decceleration
along the beamline.</p></li>
</ul>
</section>
<section id="output-class-versions">
<h3>Output Class Versions<a class="headerlink" href="#output-class-versions" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>Data Version 10.</p></li>
</ul>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p><strong>Class</strong></p></th>
<th class="head"><p><strong>Changed</strong></p></th>
<th class="head"><p><strong>Old Version</strong></p></th>
<th class="head"><p><strong>New Version</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>BDSOutputROOTEventAperture</p></td>
<td><p>N</p></td>
<td><p>1</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-odd"><td><p>BDSOutputROOTEventBeam</p></td>
<td><p>N</p></td>
<td><p>6</p></td>
<td><p>6</p></td>
</tr>
<tr class="row-even"><td><p>BDSOutputROOTEventCavityInfo</p></td>
<td><p>N</p></td>
<td><p>1</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-odd"><td><p>BDSOutputROOTEventCollimator</p></td>
<td><p>N</p></td>
<td><p>1</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-even"><td><p>BDSOutputROOTEventCollimatorInfo</p></td>
<td><p>N</p></td>
<td><p>2</p></td>
<td><p>2</p></td>
</tr>
<tr class="row-odd"><td><p>BDSOutputROOTEventCoords</p></td>
<td><p>N</p></td>
<td><p>3</p></td>
<td><p>3</p></td>
</tr>
<tr class="row-even"><td><p>BDSOutputROOTEventHeader</p></td>
<td><p>N</p></td>
<td><p>5</p></td>
<td><p>5</p></td>
</tr>
<tr class="row-odd"><td><p>BDSOutputROOTEventHistograms</p></td>
<td><p>N</p></td>
<td><p>4</p></td>
<td><p>4</p></td>
</tr>
<tr class="row-even"><td><p>BDSOutputROOTEventInfo</p></td>
<td><p>N</p></td>
<td><p>7</p></td>
<td><p>7</p></td>
</tr>
<tr class="row-odd"><td><p>BDSOutputROOTEventLoss</p></td>
<td><p>N</p></td>
<td><p>5</p></td>
<td><p>5</p></td>
</tr>
<tr class="row-even"><td><p>BDSOutputROOTEventLossWorld</p></td>
<td><p>N</p></td>
<td><p>1</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-odd"><td><p>BDSOutputROOTEventModel</p></td>
<td><p>Y</p></td>
<td><p>6</p></td>
<td><p>7</p></td>
</tr>
<tr class="row-even"><td><p>BDSOutputROOTEventOptions</p></td>
<td><p>N</p></td>
<td><p>8</p></td>
<td><p>8</p></td>
</tr>
<tr class="row-odd"><td><p>BDSOutputROOTEventRunInfo</p></td>
<td><p>N</p></td>
<td><p>3</p></td>
<td><p>3</p></td>
</tr>
<tr class="row-even"><td><p>BDSOutputROOTEventSampler</p></td>
<td><p>N</p></td>
<td><p>5</p></td>
<td><p>5</p></td>
</tr>
<tr class="row-odd"><td><p>BDSOutputROOTEventSamplerC</p></td>
<td><p>N</p></td>
<td><p>1</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-even"><td><p>BDSOutputROOTEventSamplerS</p></td>
<td><p>N</p></td>
<td><p>1</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-odd"><td><p>BDSOutputROOTEventTrajectory</p></td>
<td><p>N</p></td>
<td><p>5</p></td>
<td><p>5</p></td>
</tr>
<tr class="row-even"><td><p>BDSOutputROOTEventTrajectoryPoint</p></td>
<td><p>N</p></td>
<td><p>6</p></td>
<td><p>6</p></td>
</tr>
<tr class="row-odd"><td><p>BDSOutputROOTParticleData</p></td>
<td><p>N</p></td>
<td><p>1</p></td>
<td><p>1</p></td>
</tr>
</tbody>
</table>
</section>
<section id="utilities">
<h3>Utilities<a class="headerlink" href="#utilities" title="Link to this heading"></a></h3>
<p>These are no longer included directly with BDSIM but are available through pip. At the time
of writing, the corresponding versions of each utility are:</p>
<ul class="simple">
<li><p>pybdsim v3.3.2</p></li>
<li><p>pymadx v2.0.1</p></li>
<li><p>pymad8 v2.0.1</p></li>
<li><p>pytransport v2.0.1</p></li>
</ul>
</section>
</section>
<section id="v1-7-7-2024-01-29">
<h2>V1.7.7 - 2024 / 01 / 29<a class="headerlink" href="#v1-7-7-2024-01-29" title="Link to this heading"></a></h2>
<p>Reminder: the Python utilities (pybdsim, pymadx, pymad8, pytransport) are published and
updated through pip and are not distributioned with BDSIM itself.</p>
<section id="id1">
<h3>New Features<a class="headerlink" href="#id1" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>Introduced X-ray reflection from Geant4 11.2 onwards.</p></li>
</ul>
<p><strong>New beam command options:</strong></p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p><strong>Option</strong></p></th>
<th class="head"><p><strong>Function</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>eventGeneratorWarnSkippedParticles</p></td>
<td><p>1 (true) by default. Print a small warning for each
event if any particles loaded were skipped or there
were none suitable at all and the event was skipped.</p></td>
</tr>
</tbody>
</table>
<p><strong>New options:</strong></p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p><strong>Option</strong></p></th>
<th class="head"><p><strong>Function</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>visVerbosity</p></td>
<td><p>(0-5 inclusive) the verbosity level passed into the
Geant4 visualisation system. 0 is the default.</p></td>
</tr>
<tr class="row-odd"><td><p>xrayAllSurfaceRoughness</p></td>
<td><p>The length scale of roughness features for the X-ray
reflection model (from the <cite>xray_reflection</cite> physics
modular list). Default 0, units metres. A typical
value would be 5 nm. This applies to all surfaces.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="id2">
<h3>General Updates<a class="headerlink" href="#id2" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>Update copyright year throughout code.</p></li>
<li><p>Updated format for <code class="code docutils literal notranslate"><span class="pre">makematerialfile</span></code> program for exporting NIST information to pyg4ometry.</p></li>
<li><p>Improved error messages for bad scorer mesh definition.</p></li>
<li><p>Improved description in manual of physics list recommendation.</p></li>
<li><p>Reduced printout for the visualisation.</p></li>
</ul>
</section>
<section id="id3">
<h3>Bug Fixes<a class="headerlink" href="#id3" title="Link to this heading"></a></h3>
<p>Hot-fix for issue #377. A tracking issue appeared in thin elements due to a too small maximum value for the
relative error, epsilonStep, resulting in incorrect kicks being applied. This occurred only when BDSIM is compiled
against versions of Geant4 11.0 onwards. The maximum value is now set separately for thick and thin volumes.</p>
<ul class="simple">
<li><p>Fix for C++20 compilation for ROOT installations that now have C++20 on LCG.</p></li>
<li><p>Fix for parser rounding of double values put into integer parameters.</p></li>
<li><p>Fix overwriting of ROOT_INCLUDE_PATH environmental variable if it already existed in <code class="code docutils literal notranslate"><span class="pre">bdsim.sh</span></code>.</p></li>
<li><p>Fix obeying the Geant4 default visualiser for 11.2 onwards.</p></li>
</ul>
<p>In the parser, it is possible to do some simple calculations and use these variables
as input to parameters. For example, calculating the number of bins in a mesh. When
the parameter type was an integer, but a floating point number was given (perhaps from
the calculation or from writing a “.0” after a number), the floating point double would
be put into an integer and you may get unexpected rounding errors. e.g. 29.999999999997 becomes 29
instead of the 30 that was expected. This has been fixed by rounding to the nearest integer
only when using a double into a integer parameter.</p>
</section>
<section id="id4">
<h3>Output Changes<a class="headerlink" href="#id4" title="Link to this heading"></a></h3>
<p>Only the options have changed which are stored to file also. These are backwards compatible
and no issues are expected with loading older data.</p>
</section>
<section id="id5">
<h3>Output Class Versions<a class="headerlink" href="#id5" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>Data Version 9.</p></li>
</ul>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p><strong>Class</strong></p></th>
<th class="head"><p><strong>Changed</strong></p></th>
<th class="head"><p><strong>Old Version</strong></p></th>
<th class="head"><p><strong>New Version</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>BDSOutputROOTEventAperture</p></td>
<td><p>N</p></td>
<td><p>1</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-odd"><td><p>BDSOutputROOTEventBeam</p></td>
<td><p>N</p></td>
<td><p>6</p></td>
<td><p>6</p></td>
</tr>
<tr class="row-even"><td><p>BDSOutputROOTEventCavityInfo</p></td>
<td><p>N</p></td>
<td><p>1</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-odd"><td><p>BDSOutputROOTEventCollimator</p></td>
<td><p>N</p></td>
<td><p>1</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-even"><td><p>BDSOutputROOTEventCollimatorInfo</p></td>
<td><p>N</p></td>
<td><p>2</p></td>
<td><p>2</p></td>
</tr>
<tr class="row-odd"><td><p>BDSOutputROOTEventCoords</p></td>
<td><p>N</p></td>
<td><p>3</p></td>
<td><p>3</p></td>
</tr>
<tr class="row-even"><td><p>BDSOutputROOTEventHeader</p></td>
<td><p>N</p></td>
<td><p>5</p></td>
<td><p>5</p></td>
</tr>
<tr class="row-odd"><td><p>BDSOutputROOTEventHistograms</p></td>
<td><p>N</p></td>
<td><p>4</p></td>
<td><p>4</p></td>
</tr>
<tr class="row-even"><td><p>BDSOutputROOTEventInfo</p></td>
<td><p>N</p></td>
<td><p>7</p></td>
<td><p>7</p></td>
</tr>
<tr class="row-odd"><td><p>BDSOutputROOTEventLoss</p></td>
<td><p>N</p></td>
<td><p>5</p></td>
<td><p>5</p></td>
</tr>
<tr class="row-even"><td><p>BDSOutputROOTEventLossWorld</p></td>
<td><p>N</p></td>
<td><p>1</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-odd"><td><p>BDSOutputROOTEventModel</p></td>
<td><p>N</p></td>
<td><p>6</p></td>
<td><p>6</p></td>
</tr>
<tr class="row-even"><td><p>BDSOutputROOTEventOptions</p></td>
<td><p>Y</p></td>
<td><p>8</p></td>
<td><p>7</p></td>
</tr>
<tr class="row-odd"><td><p>BDSOutputROOTEventRunInfo</p></td>
<td><p>N</p></td>
<td><p>3</p></td>
<td><p>3</p></td>
</tr>
<tr class="row-even"><td><p>BDSOutputROOTEventSampler</p></td>
<td><p>N</p></td>
<td><p>5</p></td>
<td><p>5</p></td>
</tr>
<tr class="row-odd"><td><p>BDSOutputROOTEventSamplerC</p></td>
<td><p>N</p></td>
<td><p>1</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-even"><td><p>BDSOutputROOTEventSamplerS</p></td>
<td><p>N</p></td>
<td><p>1</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-odd"><td><p>BDSOutputROOTEventTrajectory</p></td>
<td><p>N</p></td>
<td><p>5</p></td>
<td><p>5</p></td>
</tr>
<tr class="row-even"><td><p>BDSOutputROOTEventTrajectoryPoint</p></td>
<td><p>N</p></td>
<td><p>6</p></td>
<td><p>6</p></td>
</tr>
<tr class="row-odd"><td><p>BDSOutputROOTParticleData</p></td>
<td><p>N</p></td>
<td><p>1</p></td>
<td><p>1</p></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="v1-7-6-2023-10-18">
<h2>V1.7.6 - 2023 / 10 / 18<a class="headerlink" href="#v1-7-6-2023-10-18" title="Link to this heading"></a></h2>
<p>Hot-fix for muon splitting. When muon splitting occurred it turned on a flag in the G4VParticleChange
object belonging to the physics process in Geant4 as required to give each particle unique weights
(as non-muon secondaries are not split). However, most processes in Geant4 reuse the same object and
do not reset this with each initialisation of a track so it remains in place. Also, the same G4Decay
process object is registered to different particle definitions. When decay happens for another particle
after this (for a particle that is not in the muon splitting), the flag results in the weights not being
transferred to the new secondaries.</p>
<p>In short, particles that were not in the list (pi+, pi-, e+, kaon+, kaon-, kaon0L) that had an incoming
weight from other biasing would have their weights reset to 1, only after splitting had occurred once
in that run. And for every subsequent event.</p>
<ul class="simple">
<li><p>It is not required to set <code class="code docutils literal notranslate"><span class="pre">beam,</span> <span class="pre">distrFileLoop=1</span></code> if <code class="code docutils literal notranslate"><span class="pre">beam,</span> <span class="pre">distrFileLoopNTimes</span></code> is set
to a value greater than 1 for any file-based input distributions.</p></li>
</ul>
</section>
<section id="v1-7-5-2023-10-03">
<h2>v1.7.5 - 2023 / 10 / 03<a class="headerlink" href="#v1-7-5-2023-10-03" title="Link to this heading"></a></h2>
<section id="id6">
<h3>General Updates<a class="headerlink" href="#id6" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>The ability to purposively override the (good) default maximum step length in a
field map is provided in a field definition. Normally, the maximum step length is
limited to 1x the minimum grid spacing of a field map in any dimension. Larger
steps result in the field only being evaluated on that length scale and therefore
giving a possibly wrong numerical integration of the field. However, in specific
high-energy cases, it is a useful optimisation to increase this length. This must
be used with knowledge and caution though.</p></li>
</ul>
</section>
<section id="id7">
<h3>Bug Fixes<a class="headerlink" href="#id7" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>Weights for primaries were not loaded from file when using a <code class="code docutils literal notranslate"><span class="pre">bdsimsampler</span></code> distribution.
Previously, they were all weight 1 by default. This affects any second stage simulation where
biasing was used in the first stage.</p></li>
<li><p>CMake fix for HepMC3 for versions greater than 3.1.1.</p></li>
<li><p>Fix <code class="code docutils literal notranslate"><span class="pre">geant4Version</span></code> in the header output as it didn’t contain the patch number
as Geant4’s string for this is a little inconsistent.</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">BDSOutputROOTEventTrajectory</span></code> copy constructor did not copy the <cite>mass</cite> variable.</p></li>
</ul>
</section>
</section>
<section id="v1-7-4-2023-08-25">
<h2>V1.7.4 - 2023 / 08 / 25<a class="headerlink" href="#v1-7-4-2023-08-25" title="Link to this heading"></a></h2>
<section id="id8">
<h3>New Features<a class="headerlink" href="#id8" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>Spectra by momentum: <code class="code docutils literal notranslate"><span class="pre">SpectraMomentum</span></code> in rebdsim.</p></li>
</ul>
</section>
<section id="id9">
<h3>General Updates<a class="headerlink" href="#id9" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>Fix manual description of 3D histograms in rebdsim. Should be <code class="code docutils literal notranslate"><span class="pre">z:y:x</span></code> for 3D histogram
variables. <code class="code docutils literal notranslate"><span class="pre">y:x</span></code> for 2D, and <code class="code docutils literal notranslate"><span class="pre">x</span></code> for 1D histograms.</p></li>
</ul>
</section>
<section id="id10">
<h3>Bug Fixes<a class="headerlink" href="#id10" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>Fix S coordinate of primaries in the output if a negative <code class="code docutils literal notranslate"><span class="pre">option,</span> <span class="pre">beamlineS</span></code>
was used. It would previously always be 0.</p></li>
<li><p>Fix print out in terminal of how many events have been completed when using a file-based
beam distribution. It would always be each event instead of the usual 10%, which may have
slowed down simulations or inflated log files.</p></li>
</ul>
</section>
</section>
<section id="v1-7-3-2023-08-11">
<h2>V1.7.3 - 2023 / 08 / 11<a class="headerlink" href="#v1-7-3-2023-08-11" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p>Hotfix - undo recent optimisation for histograms as it accidentally affected the mean
in non-simple (i.e. per-entry average) histograms.</p></li>
</ul>
</section>
<section id="v1-7-2-2023-08-11">
<h2>V1.7.2 - 2023 / 08 / 11<a class="headerlink" href="#v1-7-2-2023-08-11" title="Link to this heading"></a></h2>
<section id="id11">
<h3>General Updates<a class="headerlink" href="#id11" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>Determine extents of any container solid loaded from an external geometry file.</p></li>
</ul>
</section>
<section id="id12">
<h3>Bug Fixes<a class="headerlink" href="#id12" title="Link to this heading"></a></h3>
<p><strong>Installation</strong></p>
<ul class="simple">
<li><p>Fix compilation when BDSIM is compiled with GDML on but the Geant4 used does not
have GDML compiled into it. This would result in a compilation error rather than
a CMake error at configuration time.</p></li>
</ul>
<p><strong>Geometry</strong></p>
<ul class="simple">
<li><p>A placement where the outermost solid was an extruded solid would cause the extents
not to be determined properly and therefore the maximum step size to be set to 1 micron,
which would result in very slow running events. Fixed by automatically determining the
size of any potential solid given from externally loaded geometry.</p></li>
<li><p>Generic BLM shapes now have consistent user limits for tracking applied as other volumes.</p></li>
<li><p>Do not allocate a G4UserLimits object for every placement that wasn’t used.</p></li>
</ul>
<p><strong>Visualisation</strong></p>
<ul class="simple">
<li><p><cite>shield</cite> component now obeys <cite>colour</cite> property correctly.</p></li>
</ul>
</section>
</section>
<section id="v1-7-1-2023-07-20">
<h2>V1.7.1 - 2023 / 07 / 20<a class="headerlink" href="#v1-7-1-2023-07-20" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p>Fix NANs appearing in merged histograms from rebdsimCombine where histograms were empty.</p></li>
<li><p>Fix wrong number of entries in per-entry histograms (e.g. per-event histograms)
from rebdsim.</p></li>
<li><p>Fix crash from Geant4 GDML writer when exporting GDML geometry from BDSIM where
a directory is included in the destination file path but it does not exist.</p></li>
</ul>
</section>
<section id="v1-7-0-2023-07-11">
<h2>V1.7.0 - 2023 / 07 / 11<a class="headerlink" href="#v1-7-0-2023-07-11" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p>The input parser will now reject any duplicate object names (e.g. a field with the same name),
whereas it didn’t before. In the past, multiple objects would be created ignoring their name.
However, after the input is loaded, BDSIM itself may look through the objects for one matching
a name. In this case, the one it finds may be ambiguous or unexpected. The code was revised to
purposively protect against this. This was always the case with beam line elements, but now it
is also the case with all objects defined in the parser.</p></li>
<li><p>The input parser will now reject any variable names that are the same as an option name as
this is a common mistake where we put a semi-colon before another option then it has no effect.</p></li>
<li><p>GGMAD Geometry format is now deprecated. This was not maintained for a long time and with
pyg4ometry and GDML we support much better geometry. The code is old and hard to maintain
and really needs to be rewritten. The functionality was broken in making BDSIM compatible
with all the changes to string handling in Geant4 V11.</p></li>
<li><p>New executable options <code class="code docutils literal notranslate"><span class="pre">--reference</span></code> and <code class="code docutils literal notranslate"><span class="pre">--citation</span></code> to display the citation
in Bibtex syntax to cite BDSIM easily.</p></li>
<li><p>The default yoke fields have changed and are on average stronger (and more correct). See below.</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">gradient</span></code> in the <code class="code docutils literal notranslate"><span class="pre">rf</span></code> component has the units of <strong>V/m</strong> and not MV/m as was
written in the manual. Any rf component in an existing model that is defined with a <code class="code docutils literal notranslate"><span class="pre">gradient</span></code> but
without units should be updated to include units of MV/m. The documentation has been fixed and is correct
and consistent. The units for <code class="code docutils literal notranslate"><span class="pre">E</span></code> have also been clarified as volts and that this voltage is assumed
across the length of the element <code class="code docutils literal notranslate"><span class="pre">l</span></code>.</p></li>
<li><p>File looping is no longer the default for filed-based input distributions. The default behaviour
is now <strong>to match the length</strong> of the input distribution file.</p></li>
</ul>
<section id="id13">
<h3>New Features<a class="headerlink" href="#id13" title="Link to this heading"></a></h3>
<p>(topics alphabetically)</p>
<p><strong>Analysis</strong></p>
<ul class="simple">
<li><p>New Spectra command for rebdsim to make very flexible sets of spectra automatically. See
<a class="reference internal" href="output_analysis.html#spectra-definition"><span class="std std-ref">Spectra</span></a> for more information.</p></li>
<li><p>rebdsim will now default to <cite>&lt;inputfilename&gt;_ana.root</cite> if no outputfile name is specified.</p></li>
<li><p>Similarly, rebdsimHistoMerge will default to <cite>&lt;inputfilename&gt;_histos.root</cite>; rebdsimOptics to
<cite>&lt;intputfilename&gt;_optics.root</cite> and bdskim to <cite>&lt;inputfilename&gt;_skimmed.root</cite>.</p></li>
<li><p>bdsimCombine will now produce an extra tree in the output called “EventCombineInfo” that
contains an index to which file the event came from.</p></li>
<li><p>New <code class="code docutils literal notranslate"><span class="pre">VerboseSpectra</span></code> option to print out the full definitions of all spectra histograms
as automatically generated by rebdsim.</p></li>
<li><p>New <code class="code docutils literal notranslate"><span class="pre">total</span></code> keyword for spectra definition to get all particles in one histogram for
the usual <cite>total</cite> envelope. The word “total” is used to distinguish it from “all” which means
a unique histogram for each PDG ID found in the data.</p></li>
</ul>
<p><strong>Beam</strong></p>
<ul class="simple">
<li><p>New bunches feature allows offset in time for different bunches at a given repetition rate
or period with a certain number of events at a fixed bunch index generated. See <a class="reference internal" href="model_control.html#beam-bunches"><span class="std std-ref">Bunches and Time Offset</span></a>.</p></li>
<li><p>The <cite>square</cite> bunch distribution can now have an uncorrelated <cite>Z</cite> distribution with time by
explicitly specifying <cite>envelopeZ</cite>. If unspecified, the original behaviour remains.</p></li>
<li><p>New bunch distribution type <cite>halosigma</cite> that samples a flat halo distribution
flat in terms of sigma. This is useful for re-weighting distributions based on
the particle’s distance from the core in terms of sigma.</p></li>
<li><p>The <cite>halo</cite> distribution now has an outer position cut in both X and Y axes, specified
by <cite>haloXCutOuter</cite> and <cite>haloYCutOuter</cite> respectively. Similar inner and outer cuts of the X and Y
momentum are also now possible, specified by same options as the position cuts but with a <cite>p</cite>
after the axis, e.g <cite>haloXpCutOuter</cite>.</p></li>
<li><p>The radius of the transverse momentum distribution of a circular beam no longer has to be finite.
This is useful for generation of an idealised pencil beam.</p></li>
<li><p>All neutrinos can be used as beam particles now (useful for visualisation of neutrino lines).</p></li>
<li><p>The <cite>eventgenerator</cite> and <cite>bdsimsampler</cite> distributions now have <cite>eventGeneratorNEventsSkip</cite>
in the beam command to allow skipping into the file.</p></li>
<li><p>Consistency between features between <cite>eventgenerator</cite> and <cite>bdsimsampler</cite> distribution.</p></li>
<li><p>A new executable option <cite>–distrFileLoopNTimes=&lt;N&gt;</cite> allows you to repeat an input file <cite>N</cite>
times while matching the length to replay the same input coordinates from a distribution
file with different physics easily.</p></li>
</ul>
<p><strong>Components</strong></p>
<ul class="simple">
<li><p>A new <cite>ct</cite> keyword has been implemented to allow the conversion of DICOM CT images into
voxelized geometries.</p></li>
<li><p>New <cite>rfx</cite> and <cite>rfy</cite> components for transverse RF fields.</p></li>
<li><p>New <cite>target</cite> beam line component. We could always create a block of material with a closed
<cite>rcol</cite> but this is more intuitive.</p></li>
</ul>
<p><strong>Fields</strong></p>
<ul class="simple">
<li><p>New ability to use any “pure” field (i.e. one from equations inside BDSIM) as a field
and attach it to placements, or beam line geometry, as well as query it to generate
an external field map.</p></li>
<li><p>New ability to query a 3D model for the field and export a field map.</p></li>
<li><p>New program bdsinterpolator to interpolate a field map and export it without
any handling by Geant4.</p></li>
<li><p>New field drawing facility in the visualiser to draw query objects.</p></li>
<li><p>Field map reflections have been introduced allowing symmetry to be exploited.
See <a class="reference internal" href="model_customisation.html#fields-transforms"><span class="std std-ref">Field Reflections and Transforms</span></a>.</p></li>
<li><p>“linearmag” interpolation added.</p></li>
<li><p>New ability to arbitrarily scale the yoke fields.</p></li>
<li><p>New <cite>modulator</cite> object to modulate RF components (see <a class="reference internal" href="model_customisation.html#field-modulators"><span class="std std-ref">Modulators</span></a>).</p></li>
<li><p><cite>reflectxydipole</cite> added flip in Fz for y &lt; 0.</p></li>
</ul>
<p><strong>General</strong></p>
<ul class="simple">
<li><p>New <code class="code docutils literal notranslate"><span class="pre">--versionGit</span></code> executable option to get the git SHA1 code as well as the version number.</p></li>
<li><p>New <code class="code docutils literal notranslate"><span class="pre">--E0=number</span></code>, <code class="code docutils literal notranslate"><span class="pre">--Ek0=number</span></code>, and <code class="code docutils literal notranslate"><span class="pre">--P0=number</span></code> executable options are
introduced to permit overriding the energy of the beam.</p></li>
<li><p>New executable option <code class="code docutils literal notranslate"><span class="pre">--geant4PhysicsMacroFileName</span></code> to control the physics macro from the
command line. Useful when BDSIM is executed from a different directory from the main GMAD input
file and with a relatively complex model.</p></li>
<li><p>New Docker script in <code class="code docutils literal notranslate"><span class="pre">bdsim/building/docker/build-centos-bdsim.sh</span></code> and updated
instructions on how to run Docker. This is a container system where a complete
environment build on Centos7 will be built locally and works on Mac, Linux, Windows. It
typically takes about 6Gb of space and is a great alternative to a virtual machine. An
XWindows server is required for the visualiser. See <a class="reference internal" href="installation.html#docker"><span class="std std-ref">Docker</span></a>.</p></li>
<li><p>New materials (Inermet170, Inermet176, Inermet180, Copper-Diamond, MoGr).</p></li>
<li><p>Nicer visualisation colours for charged particles. Green for neutrals is by default now at
20% opacity as there are usually so many gammas.</p></li>
<li><p>New units: <cite>mV</cite>, <cite>GV</cite>, <cite>nrad</cite>, <cite>THz</cite>.</p></li>
<li><p>New <code class="code docutils literal notranslate"><span class="pre">verboseSensitivity</span></code> option to print out the sensitive detector by name at every
level of the hierarhcy.</p></li>
</ul>
<p><strong>Geometry</strong></p>
<ul class="simple">
<li><p>An <code class="code docutils literal notranslate"><span class="pre">element</span></code> beam line component now works with <code class="code docutils literal notranslate"><span class="pre">angle</span></code> as a parameter and
the sign convention has been changed to match the bends as per MADX where a positive angle
corresponds to a displacement in negative <cite>x</cite> in a right handed coordinate system with the
beamline built along <cite>z</cite>. Drifts on either side will now match the element if <cite>e1</cite> and <cite>e2</cite>
(traditionally pole-face angles) are given for the element.</p></li>
<li><p>The length <code class="code docutils literal notranslate"><span class="pre">l</span></code> for <code class="code docutils literal notranslate"><span class="pre">element</span></code> is now treated as the chord length rather than the
arc length. This has no effect for straight components, but makes it easier to use angled
elements.</p></li>
<li><p>When loading geometry (e.g. a GDML file) to be used as a placement, you can now remove the
outermost volume (e.g. the ‘world’ of that file) and place all the contents in the BDSIM
world with the compound transforms: relative to the former outermost logical volume and also
the placements transform in the world. This works by making the outer volume into a G4AssemblyVolume.</p></li>
<li><p>Ability to inspect G4EllipticalTube for extents as a container volume of imported GDML geometry
as required for NA62.</p></li>
<li><p>Ability to read GDML auxiliary information for the tag “colour” to provide colour information
in the GDML file.</p></li>
<li><p>Beam pipe aperture may now be defined by a series of x,y points in a text file for an
arbitrary shaped beam pipe. This may also be used as the default one.</p></li>
<li><p>New <code class="code docutils literal notranslate"><span class="pre">rhombus</span></code> aperture type.</p></li>
</ul>
<p><strong>Physics</strong></p>
<ul class="simple">
<li><p>New option <code class="code docutils literal notranslate"><span class="pre">restoreFTPFDiffractionForAGreater10</span></code> to turn back on nucleon diffraction
in hadronic physics for Geant4 v11.1 onwards. See <a class="reference internal" href="model_control.html#physics-proton-diffraction"><span class="std std-ref">Proton Diffraction</span></a>. This
is <strong>on</strong> by default.</p></li>
<li><p>New muon-splitting biasing scheme.</p></li>
<li><p>New “radioactivation” physics list.</p></li>
<li><p>New “gamma_to_mumu” physics list.</p></li>
<li><p>New “annihi_to_mumu” physics list.</p></li>
<li><p>New “muon_inelastic” physics list.</p></li>
<li><p>New option for excluding certain particles from cuts, e.g. exclude muons from the
minimumKineticEnergy option. See <code class="code docutils literal notranslate"><span class="pre">particlesToExcludeFromCuts</span></code> in <a class="reference internal" href="model_control.html#options-tracking"><span class="std std-ref">Tracking Options</span></a>.</p></li>
</ul>
<p><strong>Sensitivity &amp; Output</strong></p>
<ul class="simple">
<li><p>Add an option <code class="code docutils literal notranslate"><span class="pre">uprootCompatible</span></code> to read the output file with uproot. If set to 1,
it corresponds to have <code class="code docutils literal notranslate"><span class="pre">samplersSplitLevel=1</span></code> and <code class="code docutils literal notranslate"><span class="pre">modelSplitLevel=2</span></code>.</p></li>
<li><p>Samplers now have the parameter <code class="code docutils literal notranslate"><span class="pre">partID={11,-11}</span></code>, which for example can be used
to filter only which particles are recorded in a given sampler. See <a class="reference internal" href="model_control.html#sampler-filtering"><span class="std std-ref">Filtering Particles To Record</span></a>.
This also applies to sampler placements.</p></li>
<li><p>New <strong>spherical</strong> and <strong>cylindrical</strong> samplers.  See <a class="reference internal" href="model_control.html#sampler-types-and-shapes"><span class="std std-ref">Types and Shapes</span></a>.</p></li>
<li><p>The <code class="code docutils literal notranslate"><span class="pre">csample</span></code> command now works correctly and has been re-implemented for all beamline
components.</p></li>
<li><p>A sampler in a BDSIM ROOT output file can now be used as an input beam distribution for
another simulation.  See <a class="reference internal" href="model_control.html#beam-bdsimsampler"><span class="std std-ref">bdsimsampler</span></a>.</p></li>
<li><p>Solenoid sheet / cylinder field has been added and is used by default on the solenoid yoke geometry.</p></li>
<li><p>Scoring of the differential flux (3D mesh + energy spectrum per cell) following either a linear,
logarithmic or user-defined energy axis scale (requires Boost).</p></li>
<li><p>New scorer type: cellflux4d.</p></li>
<li><p>New type of scorermesh geometry: cylindrical.</p></li>
<li><p>Materials are now stored for each trajectory step point (optionally) as described
by an integer ID.</p></li>
<li><p>New trajectory filter option to store only secondary particles. Can be used in combination
with particle type to select only secondary particles that may be the same type of particle
as the primary particle. The option is <code class="code docutils literal notranslate"><span class="pre">storeTrajectorySecondaryParticles</span></code>. The bitset
for which filter was passed has been accordingly extended from 9 bits to 10 bits and the new
filter is the the last one. This is reflected in the file header that stores the names of the
filters.</p></li>
<li><p>New options <code class="code docutils literal notranslate"><span class="pre">storeElossWorldIntegral</span></code> and <code class="code docutils literal notranslate"><span class="pre">storeElossworldContentsIntegral</span></code> that can
be used alone to store only the single total energy deposition (including weights) in the world and
world contents (in case of an externally provided world volume) without storing all the individual
hits that would use a lot of disk space.</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">storeSamplerKineticEnergy</span></code> is now on by default.</p></li>
</ul>
</section>
<section id="id14">
<h3>General Updates<a class="headerlink" href="#id14" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>The <cite>userfile</cite> distribution now doesn’t count comment lines for <cite>nlinesSkip</cite> - only valid data lines.</p></li>
<li><p>When using the minimum kinetic energy option, tracks are now stopped in the stacking action
rather than being allowed to be tracked for a single step. This should vastly improve the
speed of some events with large numbers of tracks.</p></li>
<li><p>The minimum kinetic energy option is printed out if used now as it is important.</p></li>
<li><p>The default yoke fields have been revised. The equation for the field is the same, but the
normalisation to the pure vacuum field at the pole-tip has been fixed and improved. This
leads to the removal of very high peak values close to the hypothetical current sources
between poles and also generally increases the average field magnitude in the yoke. This makes
a smooth transition from the vacuum field to the yoke field and is more correct. Specifically,
the contribution from each current source is evaluated half way between each current source
for the purpose of normalisation. The new option <code class="code docutils literal notranslate"><span class="pre">useOldMultipoleOuterFields=1</span></code> is
available to regain the old behaviour. This will be removed in the next version beyond this one.</p></li>
<li><p>Compatibility with Geant4 V11.</p></li>
<li><p>Optional dependency on Boost libraries (at least V1.71.0) for 4D histograms.</p></li>
<li><p>The option <code class="code docutils literal notranslate"><span class="pre">scintYieldFactor</span></code> has no effect from Geant4 V11 onwards.</p></li>
<li><p>The executable option <code class="code docutils literal notranslate"><span class="pre">--geant4Macro</span></code> (for a post-visualisation macro)
has been renamed to <code class="code docutils literal notranslate"><span class="pre">--geant4MacroFileName</span></code> to be the same as the option in
the input GMAD file. The old one is still accepted for backwards compatibility.</p></li>
<li><p>The userfile distribution will tolerate <cite>!</cite> to denote a comment line to match GMAD syntax now.
It will also tolerate any white-space before either <cite>#</cite> or <cite>!</cite> to mark a comment line,
whereas previously it would only identify a comment if the very first character
of the line was <cite>#</cite>.</p></li>
<li><p>BDSGeometryComponent class refactored to permit a G4AssemblyVolume as the container
for a piece of geometry. It’s in addition to a logical volume.</p></li>
<li><p>A <cite>dump</cite> element may now be specified without a length and will by default be 1 mm long.</p></li>
<li><p>The visualiser command <code class="code docutils literal notranslate"><span class="pre">/bds/beamline/goto</span></code> now accepts an optional integer as a second
argument to specify the instance of a beam line element in the line to go to. i.e. if the same
beam line element is reused, you can select an individual one to go to.</p></li>
<li><p>Tolerate “electron”, “positron” and “photon” for beam particle names and substitute in the
Geant4 names (e.g. “e-“).</p></li>
<li><p>Print out extent of loaded world when using an external geometry file.</p></li>
<li><p><strong>EMD</strong> physics has a minimum applicable kinetic energy of 1 MeV to prevent crashes in Geant4.</p></li>
<li><p>Optional executable argument added to ptc2bdsim to control ROOT split-level of sampler branches. Same
functionality as the BDSIM option <code class="code docutils literal notranslate"><span class="pre">samplersSplitLevel</span></code>.</p></li>
<li><p>The green colour for collimators and the new target component has been adjusted very slightly
to be a little brighter.</p></li>
<li><p>Parser error messages for samplers have been improved to give line numbers and exact
strings in quotes.</p></li>
<li><p>Samplers, sampler placements and their parallel world have been change to have a nullptr (no)
material. The parallel world material should not make a difference for the setup in BDSIM, but
now it is explicitly forbidden from having any effect by it being nullptr.</p></li>
<li><p>The material print out (<code class="code docutils literal notranslate"><span class="pre">bdsim</span> <span class="pre">--materials</span></code>) now includes aliases.</p></li>
<li><p>When using <cite>autoScale</cite> for a field map attached to the yoke of a magnet, the calculated scaling
factor is now always print out for feedback.</p></li>
<li><p>The visualiser command <cite>/bds/beamline/list</cite> now prints the S middle coordinate in metres.</p></li>
</ul>
</section>
<section id="id15">
<h3>Bug Fixes<a class="headerlink" href="#id15" title="Link to this heading"></a></h3>
<p>(topics alphabetically)</p>
<p><strong>Analysis</strong></p>
<ul>
<li><p>rebdsim will now explicitly exit if a duplicate histogram name is detected whereas it didn’t before.</p></li>
<li><p>If an electron was used as the beam particle, the mass might not be set correctly for optics analysis
(only) resulting in wrong results for sub-relativistic electron optics.</p></li>
<li><p>Fix spectra in rebdsim when used with a selection. The selection would be built up wrongly and wouldn’t
work in the past.</p></li>
<li><p>Fix warning when using sampler data in analysis in Python:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">input_line_154</span><span class="p">:</span><span class="mi">2</span><span class="p">:</span><span class="mi">36</span><span class="p">:</span> <span class="n">warning</span><span class="p">:</span> <span class="n">instantiation</span> <span class="n">of</span> <span class="n">variable</span> <span class="s1">&#39;BDSOutputROOTEventSampler&lt;float&gt;::particleTable&#39;</span> <span class="n">required</span> <span class="n">here</span><span class="p">,</span> <span class="n">but</span> <span class="n">no</span>
  <span class="n">definition</span> <span class="ow">is</span> <span class="n">available</span> <span class="p">[</span><span class="o">-</span><span class="n">Wundefined</span><span class="o">-</span><span class="n">var</span><span class="o">-</span><span class="n">template</span><span class="p">]</span>
<span class="n">BDSOutputROOTEventSampler</span><span class="o">&lt;</span><span class="nb">float</span><span class="o">&gt;</span><span class="p">::</span><span class="n">particleTable</span><span class="p">;</span>
                               <span class="o">^</span>
<span class="o">.../</span><span class="n">bdsim</span><span class="o">-</span><span class="n">develop</span><span class="o">-</span><span class="n">install</span><span class="o">/</span><span class="nb">bin</span><span class="o">/../</span><span class="n">include</span><span class="o">/</span><span class="n">bdsim</span><span class="o">/</span><span class="n">BDSOutputROOTEventSampler</span><span class="o">.</span><span class="n">hh</span><span class="p">:</span><span class="mi">135</span><span class="p">:</span><span class="mi">37</span><span class="p">:</span> <span class="n">note</span><span class="p">:</span> <span class="n">forward</span> <span class="n">declaration</span> <span class="n">of</span> <span class="n">template</span> <span class="n">entity</span> <span class="ow">is</span> <span class="n">here</span>
<span class="n">static</span> <span class="n">BDSOutputROOTParticleData</span><span class="o">*</span> <span class="n">particleTable</span><span class="p">;</span>
                                <span class="o">^</span>
<span class="n">input_line_154</span><span class="p">:</span><span class="mi">2</span><span class="p">:</span><span class="mi">36</span><span class="p">:</span> <span class="n">note</span><span class="p">:</span> <span class="n">add</span> <span class="n">an</span> <span class="n">explicit</span> <span class="n">instantiation</span> <span class="n">declaration</span> <span class="n">to</span> <span class="n">suppress</span> <span class="n">this</span> <span class="n">warning</span> <span class="k">if</span>
<span class="s1">&#39;BDSOutputROOTEventSampler&lt;float&gt;::particleTable&#39;</span> <span class="ow">is</span> <span class="n">explicitly</span> <span class="n">instantiated</span> <span class="ow">in</span> <span class="n">another</span>
<span class="n">translation</span> <span class="n">unit</span>
<span class="n">BDSOutputROOTEventSampler</span><span class="o">&lt;</span><span class="nb">float</span><span class="o">&gt;</span><span class="p">::</span><span class="n">particleTable</span><span class="p">;</span>
</pre></div>
</div>
</li>
<li><p>Fix print out of event numbers in rebdsim being analysed when <code class="code docutils literal notranslate"><span class="pre">EventStart</span></code> and <code class="code docutils literal notranslate"><span class="pre">EventEnd</span></code> are
specified. Also the print out rate given the possibly reduced number of events.</p></li>
<li><p>Fixed possible NANs in the merged output histograms if histograms were supplied with 0 entries.</p></li>
</ul>
<p><strong>Beam</strong></p>
<ul class="simple">
<li><p>The <cite>userfile</cite> distribution now doesn’t count comment lines for <cite>nlinesSkip</cite> - only valid data lines.</p></li>
<li><p>Fix infinite looping in the <cite>userfile</cite> distribution if <cite>nlinesIgnore</cite> or <cite>nlinesSkip</cite> were longer
than the number of lines in the file.</p></li>
<li><p>Fixed generation of circular beam distribution type. The beam previously was circular but was non-uniform with a strong
peak at the centre. The distribution is now uniform in x, y, xp &amp; yp.</p></li>
<li><p>Fixed generation of ring beam distribution type. Similarly to the circular distribution, the beam had a higher density
of particles towards the ring’s inner radius. The distribution is now uniform in x &amp; y.</p></li>
<li><p>Fixed recreation when using a <cite>ptc</cite> distribution as the file wouldn’t advance to the correct entry.</p></li>
<li><p>The <cite>square</cite> distribution now has uncorrelated <cite>z</cite> and <cite>t</cite>. You can restore the old behaviour with
the new beam parameter: <code class="code docutils literal notranslate"><span class="pre">beam,</span> <span class="pre">zFromT=1;</span></code> that only works for this distribution.</p></li>
<li><p>General fix for use of static interfaces of the random number generator through instances. Uniform
flat distributions were constructed but always the static interface to the static generator was
used making it confusing. This has been fixed to explicitly use the static interface and not
construct and interface. The exact same results are produced reproducibly.</p></li>
<li><p>Fixed “antiproton” as a beam particle. Should really be “anti_proton” for Geant4 to find
the particle definition. Manual updated accordingly.</p></li>
<li><p>Fixed “kaon0L” as a beam particle. Also allow “kaon0S” and “kaon0”.</p></li>
<li><p>Fixed beam offset with S when using negative <cite>beamlineS</cite> option for generally offsetting the
S coordinate (as a variable in all data).</p></li>
</ul>
<p><strong>Biasing</strong></p>
<ul class="simple">
<li><p>Fixed huge amount of print out for bias objects attached to a whole beam line. Now, bias
objects are only constructed internally for a unique combination of biases from the input.
Less print out and (marginally) lower memory usage.</p></li>
</ul>
<p><strong>Fields</strong></p>
<ul class="simple">
<li><p>Fix time units of BDSIM-format field maps that included time in any dimension. Previously,
they were always in 0.1s instead of 1s.</p></li>
<li><p>Fix field maps being wrong if a GDML file was used multiple times with different fields.</p></li>
<li><p>Fix BDSIM-format field map loading with <code class="code docutils literal notranslate"><span class="pre">loopOrder&gt;</span> <span class="pre">tzyx</span></code> in the header. It was not
loaded correctly before. Also, there are corresponding fixes in the pybdsim package.</p></li>
<li><p>Fix lack of yoke fields for rbends.</p></li>
<li><p>Fix lack of yoke fields and also orientation of fields in (thick) hkickers and vkicker magnets.</p></li>
<li><p>Fix LHC ‘other’ beam pipe field which was not offset to the correct position. Mostly a fault for
quadrupoles where the field appeared in effect as a distorted dipole field (i.e. very off-axis quadrupole field).</p></li>
<li><p>Fix field interpolation manual figures. Z component was transposed.</p></li>
<li><p>Fixed example field map generation scripts to not use tar as we don’t support loading
of tar.gz (only gzipped or uncompressed) files (historical hangover).</p></li>
<li><p>Fixed field map interpolation and plotting scripts as well as make use of improvements
in pybdsim.</p></li>
<li><p>Fix a bug in field map loading where a space was before the “!” character the columns
wouldn’t be parsed correctly.</p></li>
<li><p>Fix BDSIM field map format <code class="code docutils literal notranslate"><span class="pre">loopOrder</span></code> documentation. The variable can be either <cite>xyzt</cite> or <cite>tzyx</cite>.</p></li>
<li><p>The quadrupole field in an sbend or rbend with a k1 value specified was a factor of 1e6 too
low due to the placement of units. The integrator for tracking (which ignores the field) was
correct and still is, but the back up field used for non-paraxial particles had the wrong
effective k1.</p></li>
<li><p>Fix B field for the rf cavity field (<cite>BDSFieldEMRFCavity</cite> class). The direction of the vector was wrong
due to a wrong translation from radial to Cartesian coordinates. Previously there was no variation in local
<cite>z</cite>, which was wrong and has now been corrected.</p></li>
</ul>
<p><strong>Geometry</strong></p>
<ul class="simple">
<li><p>Fix length of rbends being changed when specifying both <cite>B</cite> and <cite>angle</cite> and using a differet beam
particle from the design particle. The input length would be ignored and the arc length recalculated
based on the design beam particle.</p></li>
<li><p>Fix caching of loaded geometry. A loaded piece of geometry will be reloaded (and possibly preprocessed)
if loaded in another beam line component to ensure we generate a unique set of logical volumes. This
fixes field maps, biasing, range cuts, regions and more being wrong if the same GDML file was reused
in different components. However, this can be explicitly circumvented with the new parameter
<code class="code docutils literal notranslate"><span class="pre">dontReloadGeometry</span></code> in a placement.</p></li>
<li><p>Fix a bug where BDSIM would exit complaining about a conflicting material after loading a GDML
file containing a material with the same name as one predefined in BDSIM.</p></li>
<li><p>If a multipole has a zero-length, it will be converted in a thin multipole.</p></li>
<li><p>Fixed issue where thin multipole &amp; thinrmatrix elements would cause overlaps when located next to a dipole
with pole face rotations. Issue #306.</p></li>
<li><p>Fix missing magnet coil end pieces despite being available space when the sequence
is a magnet, drift, element, or the reverse.</p></li>
<li><p>Fix overlaps with various parameter combinations for an octagonal beam / aperture shape.</p></li>
<li><p>Fixed issued where sections of an angled dipole were shorter than their containers, resulting in visual gaps
in the geometry.</p></li>
<li><p>Compilation fixes in AWAKE module for Geant4.11.1.0.</p></li>
<li><p>Fix possible gap in angled geometry for <cite>rectellipse</cite> and <cite>lhc</cite> aperture types with strongly angled pole faces.</p></li>
<li><p>Fix erroneous error about beam pipe being too big for a magnet when no magnet geometry was selected.</p></li>
</ul>
<p><strong>Link</strong></p>
<ul class="simple">
<li><p>Fix nullptr materials for samplers in mass world. Have to explicitly use function to make it valid for developers.</p></li>
</ul>
<p><strong>Output</strong></p>
<ul class="simple">
<li><p>Fix the wrong value being stored in PrimaryFirstHist.postStepProcessType which was in fact SubType again.</p></li>
<li><p>When storing trajectories, it was possible if store transportation steps was
purposively turned off that the first step point may not be stored. So, the pre-step
was the creation of the particle and the post step was an interaction (i.e. not
transportation). Previously, this step would not be stored breaking the indexing
for parent step index.</p></li>
</ul>
<p><strong>Physics Lists</strong></p>
<ul class="simple">
<li><p><code class="code docutils literal notranslate"><span class="pre">em_extra</span></code>, <code class="code docutils literal notranslate"><span class="pre">muon</span></code>, and <code class="code docutils literal notranslate"><span class="pre">muon_inelastic</span></code> modular physics lists are now mutually exclusive.</p></li>
</ul>
<p><strong>Parser</strong></p>
<ul class="simple">
<li><p>The input parser will now reject any duplicate object names (e.g. a field with the same name),
whereas it didn’t before. In the past, multiple objects would be created ignoring their name.
However, after the input is loaded, BDSIM itself may look through the objects for one matching
a name. In this case, the one it finds may be ambiguous or unexpected. The code was revised to
purposively protect against this. This was always the case with beam line elements, but now it
is also the case with all objects defined in the parser.</p></li>
<li><p>Fix extension of all parser objects (i.e. not beam line elements), which was broken. Extension
is the access and update of a variable inside a defined object such as a field or scorer.</p></li>
<li><p>Fix parser <code class="code docutils literal notranslate"><span class="pre">print</span></code> command for all objects in the parser. Previously, only beam line elements
would work with this command or variables in the input GMAD.</p></li>
<li><p>The parser will reject any variable name that is the same as an option name. When editing
option in input, a really common (hidden) error is that there’s a semi-colon after an option.
Therefore, the next option gets interpreted as a new constant or variable resulting in it
having no effect at all. The parser will not prevent this from happening by complaining.</p></li>
<li><p>Fixed ambiguous warning about variable redefinition.</p></li>
</ul>
<p><strong>Sensitivity</strong></p>
<ul class="simple">
<li><p>Fix a bug where a sampler before a dump wouldn’t record any output.</p></li>
<li><p>Fix a bug where when turning off sensitive outers of magnets, an ‘outer’ loaded from
an external geometry file such as GDML would remain sensitive.</p></li>
</ul>
<p><strong>Tracking</strong></p>
<ul class="simple">
<li><p>When using the minimum kinetic energy option, tracks are now stopped in the stacking action
rather than being allowed to be tracked for a single step. This should vastly improve the
speed of some events with large numbers of tracks.</p></li>
<li><p>Fix lack of user limits for RF cavity geometry.</p></li>
<li><p>Fix maximum step length user limit for externally loaded geometry.</p></li>
<li><p>Fix logic of building thin dipole fringe elements when using non-matrix integrator sets. As the
rotated poleface geometry will be constructed in such circumstances, the thin integrated pole face kick
is now not be applied as well. If finite fringe field quantities are specified, the thin elements will be built
but will only apply the fringe kicks and not the pole face effects. If using a non-matrix integrator set
and the option <code class="code docutils literal notranslate"><span class="pre">buildPoleFaceGeometry</span></code> is specified as false, thin pole face kicks will be applied.</p></li>
<li><p>Fix calculation of the z position in the quadrupole integrator. Previously the step always advanced along z by the
step length h regardless of the step’s direction. Now, it advances along z by the projection of the step h onto
the z axis. This change will only produce a noticeable impact on particles with a large transverse momentum,
particularly those in low energy machines.</p></li>
<li><p>Fix dipole integrator track when K1 is negative. The overall strength parameter calculated for the integrator matrices
was incorrect when K1 &lt; 0.</p></li>
</ul>
<p><strong>Visualisation</strong></p>
<ul class="simple">
<li><p>GDML auto-colouring now works for G4 materials correctly. The name searching was broken. As a
reminder, any material without a specific colour will default to a shade of grey according to
its density. The auto-colouring is also fixed when preprocessing is used (the default).</p></li>
<li><p>Fix visualisation of loaded GDML container volume.</p></li>
</ul>
<p><strong>General</strong></p>
<ul class="simple">
<li><p>Fix double deletion bug for particle definition when using the Link version of BDSIM.</p></li>
<li><p>Fix <cite>distrFile</cite> not being found when used as an executable option in the case where the
current working directory, the main input gmad file and the distribution file were all in
different places.</p></li>
<li><p>Fix userfile distribution not finding ions by pdgid.</p></li>
<li><p>“RINDEX” and “ABSLENGTH” optical parameters were fixed for the material properties
definition of material “ups923a”.</p></li>
<li><p>“FASTCOMPONENT”, “FASTTIMECONSTANT”, and “YIELDRATIO” material properties for various optical
materials have no effect when BDSIM is compiled with respect to Geant4 V11 onwards.</p></li>
<li><p>Fix uncaught Geant4 exceptions by introducing our own exception handler to intercept
the Geant4 one and throw our own, safely handled exceptions a la standard C++.</p></li>
<li><p>Fix a bug where a particle could be misidentified as an ion and end up being a proton.
An example would be “pion+” which doesn’t match the correct “pi+” name in Geant4 but
would pass through and become a proton despite its name.</p></li>
<li><p>Fix runtime exception with Geant4 V11.1.0 for default options applied in BDSIM from all
previous versions of Geant4 for epsilon max / min in all fields.</p></li>
</ul>
</section>
<section id="id16">
<h3>Output Changes<a class="headerlink" href="#id16" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>Add angle of the element in the Model Tree.</p></li>
<li><p>Add <cite>samplerSPosition</cite> in the Model Tree.</p></li>
<li><p>Add <cite>pvName</cite> and <cite>pvNameWPointer</cite> to the Model Tree.</p></li>
<li><p>Trajectories now have the variable <cite>depth</cite> for which level of the tree that trajectory is.</p></li>
<li><p>Trajectories now have the variable <cite>materialID</cite>, which is an integer ID for each material
for a given model. In the Model tree, a map of this integer to the name is stored. An integer
is used to save space as it is stored for every step of each trajectory stored.</p></li>
<li><p>Model tree now has two maps for material ID to name and vica-versa.</p></li>
<li><p>Cavity info is now optionally stored in the Model Tree which includes rf element parameters and
cavity geometry parameters. Default true.</p></li>
</ul>
</section>
<section id="id17">
<h3>Output Class Versions<a class="headerlink" href="#id17" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>Data Version 8.</p></li>
</ul>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p><strong>Class</strong></p></th>
<th class="head"><p><strong>Changed</strong></p></th>
<th class="head"><p><strong>Old Version</strong></p></th>
<th class="head"><p><strong>New Version</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>BDSOutputROOTEventAperture</p></td>
<td><p>N</p></td>
<td><p>1</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-odd"><td><p>BDSOutputROOTEventBeam</p></td>
<td><p>Y</p></td>
<td><p>5</p></td>
<td><p>6</p></td>
</tr>
<tr class="row-even"><td><p>BDSOutputROOTEventCavityInfo</p></td>
<td><p>Y</p></td>
<td><p>NA</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-odd"><td><p>BDSOutputROOTEventCollimator</p></td>
<td><p>N</p></td>
<td><p>1</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-even"><td><p>BDSOutputROOTEventCollimatorInfo</p></td>
<td><p>Y</p></td>
<td><p>2</p></td>
<td><p>2</p></td>
</tr>
<tr class="row-odd"><td><p>BDSOutputROOTEventCoords</p></td>
<td><p>N</p></td>
<td><p>3</p></td>
<td><p>3</p></td>
</tr>
<tr class="row-even"><td><p>BDSOutputROOTEventHeader</p></td>
<td><p>Y</p></td>
<td><p>4</p></td>
<td><p>5</p></td>
</tr>
<tr class="row-odd"><td><p>BDSOutputROOTEventHistograms</p></td>
<td><p>Y</p></td>
<td><p>3</p></td>
<td><p>4</p></td>
</tr>
<tr class="row-even"><td><p>BDSOutputROOTEventInfo</p></td>
<td><p>Y</p></td>
<td><p>6</p></td>
<td><p>7</p></td>
</tr>
<tr class="row-odd"><td><p>BDSOutputROOTEventLoss</p></td>
<td><p>N</p></td>
<td><p>5</p></td>
<td><p>5</p></td>
</tr>
<tr class="row-even"><td><p>BDSOutputROOTEventLossWorld</p></td>
<td><p>N</p></td>
<td><p>1</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-odd"><td><p>BDSOutputROOTEventModel</p></td>
<td><p>Y</p></td>
<td><p>5</p></td>
<td><p>6</p></td>
</tr>
<tr class="row-even"><td><p>BDSOutputROOTEventOptions</p></td>
<td><p>Y</p></td>
<td><p>6</p></td>
<td><p>7</p></td>
</tr>
<tr class="row-odd"><td><p>BDSOutputROOTEventRunInfo</p></td>
<td><p>N</p></td>
<td><p>3</p></td>
<td><p>3</p></td>
</tr>
<tr class="row-even"><td><p>BDSOutputROOTEventSampler</p></td>
<td><p>N</p></td>
<td><p>5</p></td>
<td><p>5</p></td>
</tr>
<tr class="row-odd"><td><p>BDSOutputROOTEventSamplerC</p></td>
<td><p>Y</p></td>
<td><p>NA</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-even"><td><p>BDSOutputROOTEventSamplerS</p></td>
<td><p>Y</p></td>
<td><p>NA</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-odd"><td><p>BDSOutputROOTEventTrajectory</p></td>
<td><p>Y</p></td>
<td><p>4</p></td>
<td><p>5</p></td>
</tr>
<tr class="row-even"><td><p>BDSOutputROOTEventTrajectoryPoint</p></td>
<td><p>Y</p></td>
<td><p>5</p></td>
<td><p>6</p></td>
</tr>
<tr class="row-odd"><td><p>BDSOutputROOTParticleData</p></td>
<td><p>N</p></td>
<td><p>1</p></td>
<td><p>1</p></td>
</tr>
</tbody>
</table>
</section>
<section id="id18">
<h3>Utilities<a class="headerlink" href="#id18" title="Link to this heading"></a></h3>
<p>These are no longer included directly with BDSIM but are available through pip. At the time
of writing, the corresponding versions of each utility are:</p>
<ul class="simple">
<li><p>pybdsim v3.3.2</p></li>
<li><p>pymadx v2.0.1</p></li>
<li><p>pymad8 v2.0.1</p></li>
<li><p>pytransport v2.0.1</p></li>
</ul>
</section>
</section>
<section id="v1-6-0-2021-06-16">
<h2>V1.6.0 - 2021 / 06 / 16<a class="headerlink" href="#v1-6-0-2021-06-16" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p>Public CVMFS build now available. See <a class="reference internal" href="installation.html#cvmfs-build"><span class="std std-ref">CentOS 7 with CVMFS Access</span></a>.</p></li>
<li><p>HepJames is still the default random number generator, but you can now choose MixMax.</p></li>
</ul>
<section id="id19">
<h3>New Features<a class="headerlink" href="#id19" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>New executable option <code class="code docutils literal notranslate"><span class="pre">--version</span></code> for the bdsim executable that returns the version number.</p></li>
<li><p>New skimming tool called <code class="code docutils literal notranslate"><span class="pre">bdskim</span></code> is included for skimming raw data. See <a class="reference internal" href="output_analysis.html#bdskim-tool"><span class="std std-ref">bdskim - Skimming Tool</span></a>.</p></li>
<li><p>New combination tool called <code class="code docutils literal notranslate"><span class="pre">bdsimCombine</span></code> is included to merge raw data files
and skimmed data files alike. See <a class="reference internal" href="output_analysis.html#bdsim-combine-tool"><span class="std std-ref">bdsimCombine - Combine BDSIM Output Files</span></a>.</p></li>
<li><p>New ability to choose random number generator. Previously, BDSIM always used CLHEP’s HepJamesRandom
class. In more recent versions of Geant4, CLHEP’s MixMax class is now the default. For now, BDSIM
still uses HepJamesRandom as the default, but the user can select MixMax with the option <code class="code docutils literal notranslate"><span class="pre">randomEngine</span></code>.</p></li>
<li><p>Few new variants of stainless steel at different temperatures as materials as well as RHC1000 plastic.</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">fieldAll</span></code> can be specified for a geometry placement allowing a field to be attached to all volumes
in that placement of geometry.</p></li>
<li><p>Sub-fields can now be used with E field maps.</p></li>
<li><p>BDSIM components can now be used in placements to place a single component anywhere in the world.</p></li>
<li><p>The <code class="code docutils literal notranslate"><span class="pre">transform3d</span></code> beam line element now accepts axis angle parameters.</p></li>
<li><p>Bias objects can now be attached to the world volume (e.g. the air) specifically.</p></li>
<li><p>Bias objects can now be attached to the daughter volumes of the world when you load
an external GDML world.</p></li>
<li><p>By default now, the rest mass of an <strong>artificially killed particle</strong> is <strong>not</strong> included in the
Eloss.energy hit recorded. If this is desired, as was the old behaviour in previous versions,
then the option <code class="code docutils literal notranslate"><span class="pre">killedParticlesMassAddedToEloss=1</span></code> can be used.</p></li>
<li><p>More granular control over information stored in trajectories. Trajectories can use a lot of disk
space so it’s important to allow this control so we store only what we need for every step of every
trajectory chosen for storage.</p></li>
<li><p>New beam / bunch distributions <code class="code docutils literal notranslate"><span class="pre">compositespacedirectionenergy</span></code> and <code class="code docutils literal notranslate"><span class="pre">box</span></code>. The first
allows mixing of distributions for spatial, directional and energy / time rather than the usual
coupled phase space of the <cite>composite</cite> distribution (e.g. x,xp and y,yp). <cite>box</cite> is uniform in
all dimensions.</p></li>
<li><p>A generic beam line <code class="code docutils literal notranslate"><span class="pre">element</span></code> type can now be marked as a collimator for the purpose of
collimator histograms and summary information with the element definition <code class="code docutils literal notranslate"><span class="pre">markAsCollimator=1</span></code>.</p></li>
<li><p>More colours for default material colours.</p></li>
<li><p>New units accepted in input (PeV, PJ, GJ, MJ, kJ, J, mJ, uJ, nJ, pJ). J=1, GeV=1.</p></li>
<li><p>New visualisation command <code class="code docutils literal notranslate"><span class="pre">/bds/samplers/view</span></code> to easily view samplers.</p></li>
<li><p>New custom physics list interface to <code class="code docutils literal notranslate"><span class="pre">BDSIMClass</span></code> - see <a class="reference internal" href="interfacing.html#interfacing-custom-physics"><span class="std std-ref">Custom Physics List</span></a>.</p></li>
<li><p>“ModelTree” is now copied over when using <cite>rebdsimCombine</cite> to combine multiple <cite>rebdsim</cite>
output files.</p></li>
<li><p>New options:</p></li>
</ul>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p><strong>Option</strong></p></th>
<th class="head"><p><strong>Function</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>biasForWorldVacuum</p></td>
<td><p>In the case of externally provided world geometry and
‘vacuum’ volumes are named using the option
<cite>worldVacuumVolumeNames</cite>, name(s) of bias object(s)
can be given for these volumes.</p></td>
</tr>
<tr class="row-odd"><td><p>biasForWorldVolume</p></td>
<td><p>Name(s) of bias objects to be attached to the world
logical volume only (i.e. not the daughters). White
space separate list in a string.</p></td>
</tr>
<tr class="row-even"><td><p>biasForWorldContents</p></td>
<td><p>Exclusively in the case of externally provided world
geometry, the daughter volumes in the loaded world
volume can be biased with this option. White space
separated list in a string. Does not apply to world
volume itself.</p></td>
</tr>
<tr class="row-odd"><td><p>dEThresholdForScattering</p></td>
<td><p>The energy deposition in GeV treated as the threshold
for a step to be considered a scattering point.
Along step processes such as multiple scattering may
degrade the energy but not be the process that
defined the step, so may not register. Default
1e-11 GeV.</p></td>
</tr>
<tr class="row-even"><td><p>killedParticlesMassAddedToEloss</p></td>
<td><p>Default 0 (off). When a particle is killed its rest
mass will be included in the energy deposition hit.
Relevant when minimumKineticEnergy option or
stopSecondaries is used.</p></td>
</tr>
<tr class="row-odd"><td><p>randomEngine</p></td>
<td><p>Name of which random engine (“hepjames”, “mixmax”).
Default is “hepjames”.</p></td>
</tr>
<tr class="row-even"><td><p>storeTrajectoryAllVariables</p></td>
<td><p>Override and turn on <cite>storeTrajectoryIon</cite>,
<cite>storeTrajectoryLocal</cite>,
<cite>storeTrajectoryKineticEnergy</cite>,
<cite>storeTrajectoryMomentumVector</cite>,
<cite>storeTrajectoryProcesses</cite>, <cite>storeTrajectoryTime</cite>,
and <cite>storeTrajectoryLinks</cite>.</p></td>
</tr>
<tr class="row-odd"><td><p>storeTrajectoryMomentumVector</p></td>
<td><p>Store <cite>PXPYPZ</cite>, momentum (not unit) 3-vector in GeV
for each step. Default False</p></td>
</tr>
<tr class="row-even"><td><p>storeTrajectoryKineticEnergy</p></td>
<td><p>For the trajectories that are stored (according to
the filters), store <cite>kineticEnergy</cite> for each step.
Default True.</p></td>
</tr>
<tr class="row-odd"><td><p>storeTrajectoryProcesses</p></td>
<td><p>Store <cite>preProcessTyps</cite>, <cite>preProcessSubTypes</cite>,
<cite>postProcessTypes</cite>, <cite>postProcessSubTypes</cite>, the Geant4
integer process IDs for pre and post step points.
Default False.</p></td>
</tr>
<tr class="row-even"><td><p>storeTrajectoryTime</p></td>
<td><p>Store <cite>T</cite>, time in ns for each step. Default False.</p></td>
</tr>
<tr class="row-odd"><td><p>temporaryDirectory</p></td>
<td><p>By default, BDSIM tries <code class="code docutils literal notranslate"><span class="pre">/tmp</span></code>, <code class="code docutils literal notranslate"><span class="pre">/temp</span></code>,
and the current working directory in that order to
create a new temporary directory in. Specify this
option with a path (e.g. “./” for cwd) to override
this behaviour.</p></td>
</tr>
<tr class="row-even"><td><p>tunnelMaxSegmentLength</p></td>
<td><p>Maximum permitted length of an automatic tunnel
segment to be built (m). Default 50 m. Min 1 m.</p></td>
</tr>
<tr class="row-odd"><td><p>worldVacuumVolumeNames</p></td>
<td><p>White space separated list of names as a string of
logical volume names for volumes to be labelled as
<cite>vacuum</cite> for the purpose of biasing.</p></td>
</tr>
</tbody>
</table>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p><strong>Option</strong></p></th>
<th class="head"><p><strong>Description</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>storeApertureImpactsHistograms</p></td>
<td><p>Whether to generate the primary first aperture impact histogram
<cite>PFirstAI</cite>, on by default.</p></td>
</tr>
<tr class="row-odd"><td><p>samplersSplitLevel</p></td>
<td><p>The ROOT splitlevel of the branch. Default 0 (unsplit). Set to 1
or 2 to allow columnar access (e.g. with <cite>uproot</cite>).</p></td>
</tr>
</tbody>
</table>
</section>
<section id="general">
<h3>General<a class="headerlink" href="#general" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>The parser no longer builds a static library by default to save space and it responds to the
option of <code class="code docutils literal notranslate"><span class="pre">BDSIM_BUILD_STATIC_LIBS</span></code> as the main libraries do. The parser library name
has changed from “libgmadSharedLib” to “libgmad” and the static one is “libgmad-static”.</p></li>
<li><p>LHC dipole geometry now applies also to rbends as well as sbends.</p></li>
<li><p>LHC dipole geometry now applies to hkickers and vkickers. In both cases the poles are like
a normal LHC dipole (e.g. no “vertical” kicker geometry).</p></li>
<li><p>In the case a rectellipse aperture is used but the parameters are such that the resultant
shape would be an ellipse only, then elliptical solids are used to avoid overly complex
Boolean solids and produce more efficient geometry. Such use of rectellipse as a default
is common for the LHC. In the case where the result would be a circle, again, specific
solids are used for optimisation of geometry. Applies to both straight and angled beam pipes.
All done completely automatically internally.</p></li>
<li><p>The print out of materials now lists the vacuum density in g/cm3 rather than g/m3, as is more common.</p></li>
<li><p>The name of the bunch distribution is always print out in the terminal print out now.</p></li>
<li><p>Clarified trajectory options in manual a bit - two tables, one for filtering, one for storage.</p></li>
<li><p>Document option <code class="code docutils literal notranslate"><span class="pre">maximumTracksPerEvent</span></code>.</p></li>
<li><p>The directory <code class="code docutils literal notranslate"><span class="pre">bdsim/examples/ILC</span></code> has been removed as this is an old unmaintained example
that didn’t work. This is in an effort to reduce the size of the examples and code repository generally.</p></li>
<li><p>The default visualisation macro is now called “bdsim_default_vis.mac” so as not to be confused with
the commonly named vis.mac, which makes it ambiguous as to which one is really being used.</p></li>
<li><p>The visualisation macro path has the current working directory now as the last directory to search
after the installation directory.</p></li>
<li><p>Test program written for output Model tree functions.</p></li>
</ul>
</section>
<section id="build-changes">
<h3>Build Changes<a class="headerlink" href="#build-changes" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>The event display executable “edbdsim” is not build by default with the CMake option
<code class="code docutils literal notranslate"><span class="pre">USE_EVENT_DISPLAY</span></code> set to <code class="code docutils literal notranslate"><span class="pre">OFF</span></code> by default as this isn’t maintained or finished.</p></li>
<li><p>The CMake options have all been changed to start with <code class="code docutils literal notranslate"><span class="pre">USE_</span></code>.</p></li>
<li><p>The ROOTSYS print out and option in BDSIM’s CMake has been removed as this wasn’t in fact
used as a hint to CMake. The user should use <code class="code docutils literal notranslate"><span class="pre">-DROOT_DIR=/path/to/root</span></code> on the command
line (standard CMake practice) if they want to specify a specific ROOT installation.</p></li>
<li><p>Many Geant4 options for Qt and X11 have been marked as advanced to clean up the BDSIM ccmake
list of options.</p></li>
<li><p>The BDSIMConfig.cmake in the installation now contains all the compilation options but prefixed
with <code class="code docutils literal notranslate"><span class="pre">BDS_</span></code>, for example, <code class="code docutils literal notranslate"><span class="pre">BDS_USE_HEPMC3</span></code>.</p></li>
<li><p>If building a CMake project with respect to a BDSIM installation (i.e. using BDSIM), the variable
<code class="code docutils literal notranslate"><span class="pre">BDSIM_INCLUDE_DIR</span></code> now correctly includes “bdsim” at the end.</p></li>
<li><p>The bdsim.sh in the installation directory should now be portable and also work with zsh as well as bash.</p></li>
<li><p>Test executable programs are no longer built by default and must be explicitly turned on
with the CMake option <code class="code docutils literal notranslate"><span class="pre">BDSIM_BUILD_TEST_PROGRAMS</span></code>.</p></li>
</ul>
</section>
<section id="id20">
<h3>Bug Fixes<a class="headerlink" href="#id20" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>The options <code class="code docutils literal notranslate"><span class="pre">defaultBiasVacuum</span></code> and <code class="code docutils literal notranslate"><span class="pre">defaultBiasMaterial</span></code> didn’t work - this has been fixed.
The biasing wasn’t attached to the volumes.</p></li>
<li><p>Clarify message when loading a field map and header variables such as “nx” and “ny” were not
specified and therefore defaulted to 0, which is invalid. Also, complain if these are purposively
assigned to values less than 1.</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">lhcdetailed</span></code> beam pipe now <strong>ignores</strong> <code class="code docutils literal notranslate"><span class="pre">beampipeMaterial</span></code> and uses the LHC specific
materials as 2K.</p></li>
<li><p>LHC magnet geometry provided with <code class="code docutils literal notranslate"><span class="pre">magnetGeometryType=&quot;lhcleft&quot;</span></code> or “lhcright” has corrected
materials now at 2K. If using this geometry style, the <code class="code docutils literal notranslate"><span class="pre">outerMaterial</span></code> global option as well
as the per-element parameter will be ignored and the correct LHC materials used as per the LHC
arc magnets.</p></li>
<li><p>Fix LHC dipole fields which were on the wrong side for positive bend angles. This occurred due to
a conflict with the logic of by default setting the yoke on the inner side of a bend for C-shaped
dipole yokes.</p></li>
<li><p>Fixed field in LHC magnet geometry second beam pipe. Now a duplicate of the vacuum field but with
the opposite sign (for dipoles and quadrupoles).</p></li>
<li><p>Warnings fixed if using LHC style geometry with a 0 angle bend from more recent versions of Geant4
that complain about using a G4CutTubs when a G4Tubs is sufficient. The geometry was still valid, but
is now marginally more efficient and the warnings are no longer present.</p></li>
<li><p>Loaded GDML is now always visible. Geant4 would make the loaded GDML outermost volume invisible
because GDML is designed for only one file as the world.</p></li>
<li><p>BDSIM will correctly complain when no file is given for a field map. This is a common mistake
when using both E and B fields. Previously, the code could segfault.</p></li>
<li><p>Fix transforms for when an E or EM field was used in a component that was offset or tilted with
respect to the beam line. The field would not correctly be aligned to the component. B fields were fine.</p></li>
<li><p>User limits (minimum kinetic energy for example) weren’t attached to placement geometry.</p></li>
<li><p>Fix factor of 10 in field map strength for BDSIM-format field maps if the field components were not
in the usual x, y, z order. i.e. X,Y,BY,BX,BZ would result in the field being a factor of 10 stronger.</p></li>
<li><p>Fix S coordinate for energy deposition hit of a secondary particle that is killed. In the case where
secondaries were killed, the S coordinate of that energy deposition hit would have been wrong.</p></li>
<li><p>The curvilinear world and bridge world volumes and extra start and finish volumes are now
consistent in their diameter.</p></li>
<li><p>The <cite>userfile</cite> distribution would accept possibly conflicting information in coordinates such as
E and Ek and P. It will now prevent this as it was ambiguous. In practice the order was just how
it was read in the code, which was E, Ek, then P. Similarly for <cite>S</cite> and <cite>z</cite>.</p></li>
<li><p>Fixed units on <code class="code docutils literal notranslate"><span class="pre">Event.Trajectory.energyDeposit</span></code>, which was in MeV and should be in GeV. Now in GeV.</p></li>
<li><p>Fix possibly wrong overlap warning in a crystal collimator when using a cylinder or torus
geometry. The overlap was calculated using the possibly large offset of the particular solid.</p></li>
<li><p><cite>PrimaryFirstHit</cite> and <cite>PrimaryLastHit</cite> are now filled for all primary particles when there are
multiple removing the ambiguity of which one was recorded (no trackID etc was filled).</p></li>
<li><p>If particles were killed in the world volume and <code class="code docutils literal notranslate"><span class="pre">storeElossWorld</span></code> was on, the kinetic energy
of the tracks killed would not previously be added to the output. This has been fixed.</p></li>
<li><p>Fix processing of a track in BDSSDEnergyDepositionGlobal that would have segfaulted if used.</p></li>
<li><p>Fix recreation beam parameters which weren’t loaded correctly. Provided the same input file was use, this
wasn’t a problem or noticeable. However, if a beam specific executable option such as
<code class="code docutils literal notranslate"><span class="pre">--distrFile</span></code> was used, it would not be recreated properly. This has been fixed.</p></li>
<li><p>Fix recreation when using trajectory storage options and AND logic.</p></li>
<li><p>Fix possible scenario where range cuts weren’t set in a recreation.</p></li>
<li><p>Fix filtering of trajectories when using <cite>storeTrajectoryTransportationSteps</cite> and <cite>trajectoryFilterLogicAND</cite>
together, which would result in no trajectories being stored.</p></li>
<li><p>Fix uninitialised variable in BDSBunch.</p></li>
<li><p>Fix energy being 1000x too big in the halo bunch distribution since the previous version. Units were multiplied
through twice.</p></li>
<li><p>Fix float / double casts in sampler output.</p></li>
<li><p>Fix possible bad access by indexing beyond range of array in dipole fringe integrator.</p></li>
<li><p>The maximum step length in a muon spoiler is now 1/20th of the length whereas before it was the full length.
This step limit applies only in the ‘yoke’ (i.e. the outer part) of the spoiler and not in the pipe part.</p></li>
<li><p>The trajectory function <code class="code docutils literal notranslate"><span class="pre">BDSOutputROOTEventTrajectory::primaryProcessPoint</span></code> only returned the process
point the track was created by on the parent trajectory, not the primary. It is now fixed.</p></li>
<li><p>The various trajectory functions now have been made tolerant of bad indices (e.g. negative numbers or parent
used in a non-parent sense) and also of the now optional parts of the trajectory data.</p></li>
<li><p>Fix Issue 297 where optics were incorrect due an uninitialised variable incorrectly setting dipole fringes
to be zero strength.</p></li>
<li><p>Fix possibly misidentified PrimaryFirstHit beam line elements (coordinates were always correct)
that could in the case of some particles be either the very first step into the accelerator from
air or the element before the expected one.</p></li>
<li><p>Fix build with a modern compiler (e.g. GCC9) of ROOT and BDSIM. Specifically, if ROOT was compiled
with C++14 or 17 the C++ standard for BDSIM is matched to that rather than the default C++11.</p></li>
<li><p>Fixed the implementation of <code class="code docutils literal notranslate"><span class="pre">BDSOutputROOTEventModel::findNearestElement</span></code>.</p></li>
</ul>
</section>
<section id="id21">
<h3>Output Changes<a class="headerlink" href="#id21" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p><code class="code docutils literal notranslate"><span class="pre">Event.Trajectory.energyDeposit</span></code> now in GeV - was previously actually MeV, so 1000x bigger value.</p></li>
<li><p>Trajectory variables <cite>PXPYPZ</cite>, <cite>T</cite>, <cite>preProcessTyps</cite>, <cite>preProcessSubTypes</cite>, <cite>postProcessTypes</cite>,
<cite>postProcessSubTypes</cite> are now <strong>off</strong> by default. These can be turned on in the output via new options
listed above and in the options section. Expect a slight reduction in data file size when storing
trajectories with default options.</p></li>
<li><p>Trajectory variable <cite>kineticEnergy</cite> is now <strong>on</strong> by default.</p></li>
<li><p><cite>PrimaryFirstHit</cite> and <cite>PrimaryLastHit</cite> now have all primaries filled in, in the case there are multiple
such as when using an event generator file.</p></li>
<li><p><cite>trackID</cite>, <cite>partID</cite>, <cite>postProcessType</cite>, <cite>postProcessSubType</cite> and <cite>preStepKineticEnergy</cite> are
now all filled for the <cite>PrimaryFirstHit</cite> and <cite>PrimaryLastHit</cite> branches.</p></li>
<li><p>New event summary variables <cite>energyWorldExitKinetic</cite> and <cite>energyImpactingApertureKinetic</cite>.</p></li>
<li><p>A new vector of set variable names is stored in the options and beam trees in the output
to ensure we recreate a simulation correctly.</p></li>
<li><p>The trajectory filter bitset has been shortened by 1 to remove “transportation” as a filter.
This was incorrectly used to filter the storage of complete trajectories.</p></li>
<li><p>The class BDSOutputROOTEventTrajectoryPoint now has the member <cite>stepIndex</cite> to indicate the index
of the step represented on the trajectory.</p></li>
</ul>
</section>
<section id="id22">
<h3>Output Class Versions<a class="headerlink" href="#id22" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>Data Version 7.</p></li>
</ul>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p><strong>Class</strong></p></th>
<th class="head"><p><strong>Changed</strong></p></th>
<th class="head"><p><strong>Old Version</strong></p></th>
<th class="head"><p><strong>New Version</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>BDSOutputROOTEventAperture</p></td>
<td><p>N</p></td>
<td><p>1</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-odd"><td><p>BDSOutputROOTEventBeam</p></td>
<td><p>Y</p></td>
<td><p>4</p></td>
<td><p>5</p></td>
</tr>
<tr class="row-even"><td><p>BDSOutputROOTEventCollimator</p></td>
<td><p>N</p></td>
<td><p>1</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-odd"><td><p>BDSOutputROOTEventCollimatorInfo</p></td>
<td><p>N</p></td>
<td><p>1</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-even"><td><p>BDSOutputROOTEventCoords</p></td>
<td><p>N</p></td>
<td><p>3</p></td>
<td><p>3</p></td>
</tr>
<tr class="row-odd"><td><p>BDSOutputROOTEventHeader</p></td>
<td><p>N</p></td>
<td><p>4</p></td>
<td><p>4</p></td>
</tr>
<tr class="row-even"><td><p>BDSOutputROOTEventHistograms</p></td>
<td><p>N</p></td>
<td><p>3</p></td>
<td><p>3</p></td>
</tr>
<tr class="row-odd"><td><p>BDSOutputROOTEventInfo</p></td>
<td><p>Y</p></td>
<td><p>5</p></td>
<td><p>6</p></td>
</tr>
<tr class="row-even"><td><p>BDSOutputROOTEventLoss</p></td>
<td><p>N</p></td>
<td><p>5</p></td>
<td><p>5</p></td>
</tr>
<tr class="row-odd"><td><p>BDSOutputROOTEventLossWorld</p></td>
<td><p>N</p></td>
<td><p>1</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-even"><td><p>BDSOutputROOTEventModel</p></td>
<td><p>N</p></td>
<td><p>5</p></td>
<td><p>5</p></td>
</tr>
<tr class="row-odd"><td><p>BDSOutputROOTEventOptions</p></td>
<td><p>Y</p></td>
<td><p>5</p></td>
<td><p>6</p></td>
</tr>
<tr class="row-even"><td><p>BDSOutputROOTEventRunInfo</p></td>
<td><p>N</p></td>
<td><p>3</p></td>
<td><p>3</p></td>
</tr>
<tr class="row-odd"><td><p>BDSOutputROOTEventSampler</p></td>
<td><p>N</p></td>
<td><p>5</p></td>
<td><p>5</p></td>
</tr>
<tr class="row-even"><td><p>BDSOutputROOTEventTrajectory</p></td>
<td><p>N</p></td>
<td><p>4</p></td>
<td><p>4</p></td>
</tr>
<tr class="row-odd"><td><p>BDSOutputROOTEventTrajectoryPoint</p></td>
<td><p>Y</p></td>
<td><p>4</p></td>
<td><p>5</p></td>
</tr>
<tr class="row-even"><td><p>BDSOutputROOTParticleData</p></td>
<td><p>N</p></td>
<td><p>1</p></td>
<td><p>1</p></td>
</tr>
</tbody>
</table>
</section>
<section id="id23">
<h3>Utilities<a class="headerlink" href="#id23" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>pybdsim v2.4.0</p></li>
<li><p>pymadx v1.8.2</p></li>
<li><p>pymad8 v1.6.1</p></li>
<li><p>pytransport v1.5.0</p></li>
</ul>
</section>
</section>
<section id="v1-5-1-2020-12-21">
<h2>V1.5.1 - 2020 / 12 / 21<a class="headerlink" href="#v1-5-1-2020-12-21" title="Link to this heading"></a></h2>
<p>Hotfix for tapered elliptical collimators (<cite>ecol</cite>). The apertures would differ at the few percent
level due to the calculation of the obscure parameterisation of the solid used in Geant4.</p>
</section>
<section id="v1-5-0-2020-12-16">
<h2>V1.5.0 - 2020 / 12 / 16<a class="headerlink" href="#v1-5-0-2020-12-16" title="Link to this heading"></a></h2>
<section id="build-system">
<h3>Build System<a class="headerlink" href="#build-system" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>CMake 3.1 now required.</p></li>
<li><p>CMake CXX Standard now used (C++11) instead of individual compiler flags.</p></li>
</ul>
</section>
<section id="id24">
<h3>New Features<a class="headerlink" href="#id24" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>Scoring meshes and scorers have been introduced that allow 3D scoring meshes to be used and
created per event 3D histograms for various quantities. Ability to score multiple quantities,
per particle, with material exclusion are included. See <a class="reference internal" href="model_control.html#scoring"><span class="std std-ref">Scoring</span></a> for details on usage.</p></li>
<li><p>More granular control over output and a minimal output option.</p></li>
<li><p>Both the design and beam particle may now be specified by either <code class="code docutils literal notranslate"><span class="pre">energy</span></code> (total),
<code class="code docutils literal notranslate"><span class="pre">kineticEnergy</span></code>, <code class="code docutils literal notranslate"><span class="pre">momentum</span></code> in the case of the design particle, or <code class="code docutils literal notranslate"><span class="pre">E0</span></code>,
<code class="code docutils literal notranslate"><span class="pre">Ek0</span></code> and <code class="code docutils literal notranslate"><span class="pre">P0</span></code> in the case of the optional beam particle if different from
the design one. This makes input of the desired beam easier but also permits easy specification
of different particle species beams with the same momentum for example.</p></li>
<li><p>Either <code class="code docutils literal notranslate"><span class="pre">sigmaE</span></code>, <code class="code docutils literal notranslate"><span class="pre">sigmaEk</span></code> or <code class="code docutils literal notranslate"><span class="pre">sigmaP</span></code> can be used for bunch distributions
that use <code class="code docutils literal notranslate"><span class="pre">sigmaE</span></code> nominally.</p></li>
<li><p>Normalised emittance can now be used for <cite>gausstwiss</cite> and <cite>halo</cite> distributions with the parameters
<code class="code docutils literal notranslate"><span class="pre">emitnx</span></code> and <code class="code docutils literal notranslate"><span class="pre">emitny</span></code>.</p></li>
<li><p>Loaded geometry can now be auto-coloured by BDSIM whereas before it would all appear very light grey.
The colouring has a few specific ones, but is mostly grey by density, and the opacity is also varied
depending on the state of the material. The parameter <code class="code docutils literal notranslate"><span class="pre">autoColour</span></code> can be used with the
generic beam line element as well as placements and magnet outer geometry and is on by default.</p></li>
<li><p>BLMs now must use a <code class="code docutils literal notranslate"><span class="pre">scoreQuantity</span></code> to name a scorer object to decide what they record
as opposed to previously just recording energy deposition.</p></li>
<li><p>BLMs now have a parameter <code class="code docutils literal notranslate"><span class="pre">bias</span></code> that allows a cross-section biasing object to be attached
to all logical volumes in that BLM.</p></li>
<li><p>Cubic is now the default interpolation for fields and is automatically matched to the number
of dimensions in the field map file.</p></li>
<li><p>The interpolation for fields need only be specified by name and will be matched to the number
of dimensions generally. e.g. ‘cubic’ instead of ‘cubic2d’. The older names are still accepted but
if BDSIM will give an error if the wrong dimension is used.</p></li>
<li><p>LHC yoke fields that are the sum of two multipole yoke fields. Works for rbend, sbend, quadrupole
and sextupole. Default on and controlled by the new option <code class="code docutils literal notranslate"><span class="pre">yokeFieldsMatchLHCGeometry</span></code>.</p></li>
<li><p>Ability to filter out unstable particles with no default decay table in Geant4 when loading event
generator files for a beam - now the default behaviour and controllable with the beam parameter
<code class="code docutils literal notranslate"><span class="pre">removeUnstableWithoutDecay</span></code>.</p></li>
<li><p>Interpolator types for fields don’t need the dimension as a suffix any longer. e.g. ‘cubic’ is now
sufficient instead of one of ‘cubic1d’, ‘cubic2d’, ‘cubic3d’, ‘cubic4d’. It is now automatically
determined from the dimensions of the field type. Old syntax is still accepted.</p></li>
<li><p>A field may now have a <code class="code docutils literal notranslate"><span class="pre">magneticSubField</span></code> where a smaller field is overlaid on top of a main
field providing the ability to place a smaller more detailed magnetic field map on top of a larger
(perhaps coarser) one. The boundaries exist separately.</p></li>
<li><p>Variable bin widths may be used in rebdsim analysis configurations as supplied by an external text file
in any dimension.</p></li>
<li><p>A histogram for the primary first impact in <cite>S</cite> is now generated by default, similar to <cite>ELoss</cite>.  This
is controlled with the new option <cite>storeApertureImpactsHistograms</cite>.</p></li>
<li><p>Ability to store only detailed production point of certain kinds of particles through new options
for the trajectory storage.</p></li>
<li><p>New ability to run a Geant4 macro before a run. Useful to adjust physics list parameters in Geant4
reference physics lists such as extra muon processes in the EM extra physics list.</p></li>
<li><p>New options:</p></li>
</ul>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p><strong>Option</strong></p></th>
<th class="head"><p><strong>Description</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>autoColourWorldGeometryFile</p></td>
<td><p>Boolean whether to automatically colour geometry loaded from the
worldGeometryFile. Default true.</p></td>
</tr>
<tr class="row-odd"><td><p>beamPipeIsInfiniteAbsorber</p></td>
<td><p>When turned on, all particles that hit the material of the beam
pipe are killed and the energy recorded as being deposited there.</p></td>
</tr>
<tr class="row-even"><td><p>geant4PhysicsMacroFileName</p></td>
<td><p>The name of a text macro file with commands that are suitable for
the Geant4 interpreter that will be executed after the physics
list is constructed but before a run.</p></td>
</tr>
<tr class="row-odd"><td><p>outputCompressionLevel</p></td>
<td><p>Number that is 0-9. Compression level that is passed to ROOT’s
TFile. Higher equals more compression but slower writing. 0 is no
compression and 1 minimal. 5 is the default.</p></td>
</tr>
<tr class="row-even"><td><p>physicsVerbosity</p></td>
<td><p>Set the physics verbosity for Geant4 (0,1,2).</p></td>
</tr>
<tr class="row-odd"><td><p>storeApertureImpactsHistograms</p></td>
<td><p>Whether to generate the primary first aperture impact histogram
<cite>PFirstAI</cite>, on by default.</p></td>
</tr>
<tr class="row-even"><td><p>storeElossPhysicsProcesses</p></td>
<td><p>Store the post step process ID and sub-ID for the step.</p></td>
</tr>
<tr class="row-odd"><td><p>storeMinimalData</p></td>
<td><p>When used, all optional parts of the data are turned off. Any bits
specifically turned on with other options will be respected.</p></td>
</tr>
<tr class="row-even"><td><p>storeParticleData</p></td>
<td><p>Control whether the basic particle data is stored in the output
for all particles used or not. Renamed from <cite>storeGeant4Data</cite>.</p></td>
</tr>
<tr class="row-odd"><td><p>storePrimaries</p></td>
<td><p>Boolean, true by default. If false, don’t fill the Primary branch
of the Event tree in the output. Useful to minimise file size.</p></td>
</tr>
<tr class="row-even"><td><p>storePrimaryHistograms</p></td>
<td><p>Whether to generate summary histograms of the primary first hit
and loss point versus S coordinate per event. On by default.</p></td>
</tr>
<tr class="row-odd"><td><p>storeTrajectoryStepPoints</p></td>
<td><p>Integer number of step points to store for each trajectory that is
chosen to be stored. Should be greater than 1. Storing 1 will mean
only the first creation point is stored.</p></td>
</tr>
<tr class="row-even"><td><p>storeTrajectoryStepPointLast</p></td>
<td><p>Boolean. If true, and used in combination with the option
<cite>storeTrajectoryStepPoints</cite>, the end point of the trajectory is
also stored.</p></td>
</tr>
<tr class="row-odd"><td><p>yokeFieldsMatchLHCGeometry</p></td>
<td><p>Boolean whether to use yoke fields that are the sum of two
multipole yoke fields with the LHC separation of 194 mm. Default
true. Applies to rbend, sbend, quadrupole and sextupole.</p></td>
</tr>
<tr class="row-even"><td><p>storeApertureImpactsHistograms</p></td>
<td><p>Whether to generate the primary first aperture impact histogram
<cite>PFirstAI</cite>, on by default.</p></td>
</tr>
<tr class="row-odd"><td><p>samplersSplitLevel</p></td>
<td><p>The ROOT splitlevel of the branch. Default 0 (unsplit). Set to 1
or 2 to allow columnar access (e.g. with <cite>uproot</cite>).</p></td>
</tr>
</tbody>
</table>
</section>
<section id="id25">
<h3>General<a class="headerlink" href="#id25" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>The maximum step length in a field map is by default now the minimum spatial distance in the field
map loaded. Previously, it was the full length of the element the field map was attached to. The user
can still set the <code class="code docutils literal notranslate"><span class="pre">maximumStepLength</span></code> parameter in the field definition to reduce this further,
but the minimum of the numbers supplied will be used.</p></li>
<li><p>Previously, the absolute minimum “maximum step length” in a field map was 1mm. This has been reduced
to 1 micron. This is irrespective of what the user specifies in the field description.</p></li>
<li><p>Shared library now the default for BDSIM. The CMake option <code class="code docutils literal notranslate"><span class="pre">BDSIM_BUILD_STATIC_LIBS</span></code>
allows the static library to be compiled too (in addition to the shared one).</p></li>
<li><p>rebdsimCombine will exit if the first argument, which is meant to be the single output file, contains
an asterisk (*), as it is likely the arguments are in the wrong order.</p></li>
<li><p>BDSIM will exit if the option <code class="code docutils literal notranslate"><span class="pre">minimumKineticEnergy</span></code> is set to a value higher than the kinetic
energy of the beam particle. This takes into account the possibly different kinetic energy of the beam
particle versus the design particle. Such a combination of options would result in all primary particles
being immediately killed and not tracked through the model.</p></li>
<li><p>Linear and cubic interpolation implementation has be switched from hard coded types to templates. No
difference in results, but this makes the code usable elsewhere.</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">composite</span></code> distribution now defaults to <code class="code docutils literal notranslate"><span class="pre">reference</span></code> distribution for each dimension, so
if a given dimension isn’t specified it’ll be the default.</p></li>
<li><p>Warn the user if a sampler placement is renamed due to a beam line sampler already having that name.</p></li>
<li><p>PDG Particle ID token when defining the columns in a <code class="code docutils literal notranslate"><span class="pre">userfile</span></code> distribution has been changed from “pt” to
“pdgid”. “pt” is no longer a valid token.</p></li>
<li><p>When loading multiple GDML files, a material specified may have the same name in different files butt
be different. This could result in the incorrect material being used in the second file. We have this
issue with geometry (solids and logical volumes) also, hence our GDML pre-processing. We now cache the
names of the materials and warn if a duplicate is defined. Normally, this would pass through without
error and result in possibly the other material being found by Geant4.</p></li>
</ul>
</section>
<section id="id26">
<h3>Bug Fixes<a class="headerlink" href="#id26" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>Tolerate “-” character in rebdsim input and output file names written inside the analysis configuration
file. In the past, only the part up to this character was used.</p></li>
<li><p>Fix loading of a visualisation macro (<code class="code docutils literal notranslate"><span class="pre">--vis_mac=vis.mac</span></code>) when the file was called vis.mac and was
in the current directory. Previously, the bdsim default one would always be used. Fixed by appending the
current working directory to the macro search path for Geant4.</p></li>
<li><p>Fixed inspection of G4CutTubs extent in BDSGeometryInspector that was used when a GDML file was loaded
with a G4CutTubs as the container (outermost) solid.</p></li>
<li><p>Fixed bug in dipole fringe scaling with the <cite>bdsimmatrixfringescaling</cite> integrator set where the particle
bending radius was scaled twice and arguments were passed into the base stepper in the wrong order.</p></li>
<li><p>Dipole fringes now apply the fringe kick and dipole transport in the correct order depending on if the fringe
is at the entrance or exit of the dipole.</p></li>
<li><p>Fix wrong variable name print out for halo beam distribution.</p></li>
<li><p>Improve cryptic error for wrongly specified composite beam distribution.</p></li>
<li><p>Units for <code class="code docutils literal notranslate"><span class="pre">kineticEnergy</span></code> and <code class="code docutils literal notranslate"><span class="pre">rigidity</span></code> variables in the trajectory output were fixed.</p></li>
<li><p>Throw an error if a sampler placement has a conflicting name with something already in the output rather
than potentially just overwrite it or it not appear properly.</p></li>
<li><p>Fix the field from E and EM fields when they were offset with respect to a beam line element.</p></li>
<li><p>Fixed bug when not storing primaries using the option <cite>storePrimaries</cite> where the primary branch was added to
the sampler list and therefore appeared empty in the output. This consequently caused rebdsimOptics to segfault.</p></li>
<li><p>Fix tapering in an <code class="code docutils literal notranslate"><span class="pre">ecol</span></code>, which wouldn’t be tapered in v1.4.</p></li>
<li><p>Fix calculation of minimum geometry radius in magnets for G4CutTubs used for intersection
(to give the angled faces), which was dominated by the horizontal size. In cases with magnets
that were taller than they were wide and with extremely strong bending angles or pole faces
this could have produced geometry Geant4 would complain about. Fixed in
<code class="code docutils literal notranslate"><span class="pre">BDSMagnetOuter::MinimumIntersectionRadius()</span></code>.</p></li>
</ul>
</section>
<section id="id27">
<h3>Output Changes<a class="headerlink" href="#id27" title="Link to this heading"></a></h3>
<p>These are very important changes to take note of:</p>
<ul class="simple">
<li><p>A new option <code class="code docutils literal notranslate"><span class="pre">storeMinimalData</span></code> has been introduced that turns off all optional parts of the data
reducing the file size. Options that explicitly turn on parts of the data will be respected.</p></li>
<li><p>If optional information is <strong>not</strong> stored, the branches in the Event Tree will <strong>not</strong> be written to
keep the data structure as simple as possible. The analysis and DataLoader classes are tolerant of this.</p></li>
<li><p>The PrimaryGlobal variables are now all capital (e.g. <code class="code docutils literal notranslate"><span class="pre">X</span></code> instead of <code class="code docutils literal notranslate"><span class="pre">x</span></code>) to be consistent
that they are global coordinates and not local coordinates.</p></li>
<li><p>The class <code class="code docutils literal notranslate"><span class="pre">BDSOutputROOTGeant4Data</span></code> has been renamed to <code class="code docutils literal notranslate"><span class="pre">BDSOutputROOTParticleData</span></code> to be
clearer. The analysis <cite>DataLoader</cite> class will not be able to load this branch in older data. In this case,
the version of BDSIM used to create the data should be used, or the data inspected directly as required -
the previous data will always be readable by ROOT. The members of the class and the functionality are
exactly the same, but the ROOT dictionary generation feature to allow renaming of a class doesn’t seem
to work in practicality.</p></li>
<li><p>Samplers now have a variable <cite>p</cite> which is the momentum of the particle in GeV.</p></li>
<li><p>Model tree now has scoring mesh global placement transforms and names stored to aid visualisation later on.</p></li>
<li><p>The various storage Boolean options for the BDSOutputROOTEventLoss class have been removed from
the output as these are only needed at run time and are not needed as a copy for each event in the output.
The options preserve what was stored and it is not expected that these change between events so this
was completely unnecessary and wasteful.</p></li>
<li><p>Units for <code class="code docutils literal notranslate"><span class="pre">kineticEnergy</span></code>, <code class="code docutils literal notranslate"><span class="pre">rigidity</span></code> and <code class="code docutils literal notranslate"><span class="pre">mass</span></code> variables in the trajectory output were
fixed. These were previously in Geant4 units but are now consistent with those in the rest of the output
such as samplers and are GeV and Tm.</p></li>
<li><p>In <code class="code docutils literal notranslate"><span class="pre">BDSOutputROOTEventTrajectory</span></code> and <code class="code docutils literal notranslate"><span class="pre">BDSOutputROOTEventTrajectoryPoint</span></code> classes, the track ID
variables have been changed to be unsigned int type.</p></li>
<li><p>New variables in header for whether the BDSIM output file is a skimmed file or not - future proofing for
upcoming skimming program.</p></li>
</ul>
</section>
<section id="id28">
<h3>Output Class Versions<a class="headerlink" href="#id28" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>Data Version 6.</p></li>
</ul>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p><strong>Class</strong></p></th>
<th class="head"><p><strong>Changed</strong></p></th>
<th class="head"><p><strong>Old Version</strong></p></th>
<th class="head"><p><strong>New Version</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>BDSOutputROOTEventAperture</p></td>
<td><p>N</p></td>
<td><p>1</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-odd"><td><p>BDSOutputROOTEventBeam</p></td>
<td><p>N</p></td>
<td><p>4</p></td>
<td><p>4</p></td>
</tr>
<tr class="row-even"><td><p>BDSOutputROOTEventCoords</p></td>
<td><p>Y</p></td>
<td><p>2</p></td>
<td><p>3</p></td>
</tr>
<tr class="row-odd"><td><p>BDSOutputROOTEventCollimator</p></td>
<td><p>N</p></td>
<td><p>1</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-even"><td><p>BDSOutputROOTEventCollimatorInfo</p></td>
<td><p>N</p></td>
<td><p>1</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-odd"><td><p>BDSOutputROOTEventHeader</p></td>
<td><p>Y</p></td>
<td><p>3</p></td>
<td><p>4</p></td>
</tr>
<tr class="row-even"><td><p>BDSOutputROOTEventHistograms</p></td>
<td><p>N</p></td>
<td><p>3</p></td>
<td><p>3</p></td>
</tr>
<tr class="row-odd"><td><p>BDSOutputROOTEventInfo</p></td>
<td><p>N</p></td>
<td><p>5</p></td>
<td><p>5</p></td>
</tr>
<tr class="row-even"><td><p>BDSOutputROOTEventLoss</p></td>
<td><p>Y</p></td>
<td><p>4</p></td>
<td><p>5</p></td>
</tr>
<tr class="row-odd"><td><p>BDSOutputROOTEventLossWorld</p></td>
<td><p>N</p></td>
<td><p>1</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-even"><td><p>BDSOutputROOTEventModel</p></td>
<td><p>Y</p></td>
<td><p>4</p></td>
<td><p>5</p></td>
</tr>
<tr class="row-odd"><td><p>BDSOutputROOTEventOptions</p></td>
<td><p>N</p></td>
<td><p>5</p></td>
<td><p>5</p></td>
</tr>
<tr class="row-even"><td><p>BDSOutputROOTEventRunInfo</p></td>
<td><p>N</p></td>
<td><p>3</p></td>
<td><p>3</p></td>
</tr>
<tr class="row-odd"><td><p>BDSOutputROOTEventSampler</p></td>
<td><p>Y</p></td>
<td><p>4</p></td>
<td><p>5</p></td>
</tr>
<tr class="row-even"><td><p>BDSOutputROOTEventTrajectory</p></td>
<td><p>Y</p></td>
<td><p>3</p></td>
<td><p>4</p></td>
</tr>
<tr class="row-odd"><td><p>BDSOutputROOTEventTrajectoryPoint</p></td>
<td><p>Y</p></td>
<td><p>3</p></td>
<td><p>4</p></td>
</tr>
<tr class="row-even"><td><p>BDSOutputROOTGeant4Data (*)</p></td>
<td><p>N</p></td>
<td><p>2</p></td>
<td><p>2</p></td>
</tr>
<tr class="row-odd"><td><p>BDSOutputROOTParticleData</p></td>
<td><p>Y</p></td>
<td><p>NA</p></td>
<td><p>1</p></td>
</tr>
</tbody>
</table>
<ul class="simple">
<li><p>(*) deprecated in favour of the renamed class BDSOutputROOTParticleData</p></li>
</ul>
</section>
<section id="id29">
<h3>Utilities<a class="headerlink" href="#id29" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>pybdsim v2.3.0</p></li>
<li><p>pymadx v1.8.1</p></li>
<li><p>pymad8 v1.6.0</p></li>
<li><p>pytransport v1.4.0</p></li>
</ul>
</section>
</section>
<section id="v1-4-0-2020-06-08">
<h2>V1.4.0 - 2020 / 06 / 08<a class="headerlink" href="#v1-4-0-2020-06-08" title="Link to this heading"></a></h2>
<section id="expected-changes-to-results">
<h3>Expected Changes To Results<a class="headerlink" href="#expected-changes-to-results" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>Any wirescanner elements should be updated to use <code class="code docutils literal notranslate"><span class="pre">wireAngle</span></code> instead of <code class="code docutils literal notranslate"><span class="pre">angle</span></code> for
their rotation angle. Not doing this will result in different angles and therefore results.</p></li>
<li><p>Fix for field maps with rotations (multiples of <span class="math notranslate nohighlight">\(\pi/2\)</span> were ok). The field will now be correct
but this may be different from previous releases.</p></li>
<li><p>Field maps now pick up the tilt from the element, so a separate tilt isn’t required in the field
definition as was in the past to make the field align with a tilted element. In this case, the field
definition tilt should be removed and the field will be orientated to the component it’s attached to.</p></li>
<li><p>PrimaryFirstHit location on wire scanners will now be more accurate, where it might have missed it before.</p></li>
<li><p>Default range cut from BDSIM will not be enforced if using a Geant4 physics list. It will only be set if
specified in the user input.</p></li>
<li><p>Neutrinos are no longer killed by default. They can be turned off (for optimisation purposes) with
the option <code class="code docutils literal notranslate"><span class="pre">option,</span> <span class="pre">killNeutrinos=1;</span></code>.</p></li>
<li><p>The default when using the <code class="code docutils literal notranslate"><span class="pre">option,</span> <span class="pre">storeTrajectories=1;</span></code> is to only store the primary trajectory,
which will vastly reduce the data size. See output changes below for further details.</p></li>
<li><p>Trajectory option <code class="code docutils literal notranslate"><span class="pre">storeTrajectoryELossSRange</span></code> is now in metres and not millimetres.</p></li>
<li><p>Reference coordinates <cite>X0</cite>, <cite>Y0</cite>, <cite>Z0</cite>, <cite>Xp</cite>, <cite>Yp</cite> are now added to the userfile distribution
coordinates if specified. (<cite>Zp</cite> was already added).</p></li>
<li><p>Polarity of dipole yoke fields was fixed so particles slightly outside the beam pipe will be deflected
in a different (but now correct) direction.</p></li>
<li><p>Merged <strong>simple</strong> histograms (only simple ones) from using rebdsimCombine are now truly the sum, whereas
in the past they were the mean.</p></li>
<li><p>Note a change of sign to the left crystal angle. A positive angle and also bendingAngleAxisY rotates
both left and right crystals away from the centre of the collimator. Will only affect the left crystal
as compared to previous behaviour.</p></li>
</ul>
</section>
<section id="id30">
<h3>New Features<a class="headerlink" href="#id30" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>BDSIM no longer requires a beam line to be built! You can simply make a placement or even an empty world.</p></li>
<li><p>Restructured “Model Description” section in the manual as it was growing overly big and difficult to use.</p></li>
<li><p>New units: <cite>twopi</cite>, <cite>halfpi</cite> and <cite>PeV</cite>.</p></li>
<li><p>New bunch distribution <cite>sphere</cite> to generate random directions at a given point.</p></li>
<li><p><cite>S0</cite> for bunch offset in curvilinear frame now a documented feature of the bunch.</p></li>
<li><p>Improved event level verbosity.</p></li>
<li><p>All verbosity options now documented, including corresponding executable options.</p></li>
<li><p>BDSIM will now exit if invalid ranges and bins are specified for the single 3D
energy deposition (‘scoring’) histogram that can be specified via options.</p></li>
<li><p>New verbose event stepping options. See <a class="reference internal" href="model_control.html#bdsim-options-verbosity"><span class="std std-ref">Print Out Options</span></a> for more details.</p></li>
<li><p>New beam loss monitors (BLMs) with <code class="code docutils literal notranslate"><span class="pre">blm</span></code> command (See <a class="reference internal" href="model_construction.html#detectors-blms"><span class="std std-ref">Beam Loss Monitors</span></a>).</p></li>
<li><p>New executable option <code class="code docutils literal notranslate"><span class="pre">--distrFileNLinesSkip</span></code> for the number of lines to skip into
a distribution file.</p></li>
<li><p>New executable option <code class="code docutils literal notranslate"><span class="pre">--nturns</span></code> to control the number of turns in a circular machine.</p></li>
<li><p>Support for partially stripped ions in output samplers.</p></li>
<li><p>Optional linking to HepMC3 for event generator output file loading. Can load any format
HepMC3 can load.</p></li>
<li><p>Filters for event generator particles loaded with HepMC3.</p></li>
<li><p>Ability to print out all particles and physics processes to be helpful for finding Geant4
names for biasing. See new options below.</p></li>
<li><p><cite>kaon-</cite>, <cite>kaon+</cite> or <cite>kaon0L</cite> may now be used as beam particles.</p></li>
<li><p>The beam particle may now be specified by its PDG integer ID rather than by name.</p></li>
<li><p>A new physics list called “all_particles” has been introduced to construct all particles
only but no physics processes. Useful for an exotic beams where only tracking is required.</p></li>
<li><p>New <cite>tilt</cite> parameter for the beam command to apply a rotation about unit Z after the coordinates
are generated as an easy method to introduce coupling.  Note, this is in the beam command.</p></li>
<li><p>The userfile bunch distribution now supports the column “S” to allow specification of curvilinear
coordinates as input.</p></li>
<li><p>Field maps are now automatically tilted when attached to a tilted beam line element, whereas
they weren’t before.</p></li>
<li><p>RF cavity fringe fields have been implemented and are on by default. They are controlled with
the <cite>includeFringeFieldsCavities</cite> option. The <cite>includeFringeFields</cite> option does not affect cavity fringes.</p></li>
<li><p>Revised executable options for verbosity. These are now the exact same as the input options. Old
options are still functional but undocumented.</p></li>
<li><p>Added the ability to attach a BLM flush to the side of a component
with option <cite>side</cite>, including the possibility of introducing an additional gap with <cite>sideOffset</cite>.</p></li>
<li><p>New internal region class allows better setting of defaults when defining custom regions. Previously,
these would just be the default in the class if they weren’t specified, which was 0. The global ones
will now take precedence as will the value <cite>defaultRangeCut</cite> in the <cite>cutsregion</cite> declaration.</p></li>
<li><p>Added the ability to attach a BLM flush to the side of a component
with option <cite>side</cite>, including the possibility of introducing an additional gap with <cite>sideOffset</cite>.</p></li>
<li><p>New options <cite>apertureImpactsMinimumKE</cite> and <cite>collimatorHitsMinimumKE</cite> to control the minimum kinetic
energy a particle must have for either an aperture impact or collimator hit respectively to
be generated.</p></li>
<li><p>A generic element now has the ability to label (classify) volumes as ‘vacuum’ for the purposes of
biasing where we split geometry into ‘vacuum’ and (general) ‘material’, e.g. yoke. See <a class="reference internal" href="model_construction.html#element"><span class="std std-ref">element</span></a>
for details and the <code class="code docutils literal notranslate"><span class="pre">namedVacuumVolumes</span></code> parameter.</p></li>
<li><p>New options:</p></li>
</ul>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p><strong>Option</strong></p></th>
<th class="head"><p><strong>Description</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>apertureImpactsMinimumKE</p></td>
<td><p>Minimum kinetic energy for an aperture impact to be generated (GeV)</p></td>
</tr>
<tr class="row-odd"><td><p>collimatorHitsminimumKE</p></td>
<td><p>Minimum kinetic energy for a collimator hit to be generated (GeV)</p></td>
</tr>
<tr class="row-even"><td><p>includeFringeFieldsCavities</p></td>
<td><p>Include thin fringe fields for RF cavities only, on by default.
Cavity fringes are not affected by the includeFringeFields option,
includeFringeFieldsCavities must be explicitly turned off if no
fringes are to be built at all in the model.</p></td>
</tr>
<tr class="row-odd"><td><p>preprocessGDMLSchema</p></td>
<td><p>Whether to preprocess a copy of the GDML file where the URL of
the GDML schema is changed to a local copy provided in BDSIM so
geometry can be loaded without internet access. On by default.</p></td>
</tr>
<tr class="row-even"><td><p>printPhysicsProcesses</p></td>
<td><p>Print out all defined particles according to the physics list and
the names of all defined physics processes for that particle.</p></td>
</tr>
<tr class="row-odd"><td><p>storeApertureImpacts</p></td>
<td><p>Create an optional branch called “ApertureImpacts” in the Event
tree in the output that contains coordinates of where the primary
particle exists the beam pipe. Note this could be multiple times.</p></td>
</tr>
<tr class="row-even"><td><p>storeApertureImpactsIons</p></td>
<td><p>If <cite>storeApertureImpacts</cite> is on, the information will be generated
for all secondary ions as well as the primary. No information will
be generated for other particles.</p></td>
</tr>
<tr class="row-odd"><td><p>storeApertureImpactsAll</p></td>
<td><p>If <cite>storeApertureImpacts</cite> is on, the information will be generated
for all particles leaving the beam pipe when this option is turned
on.</p></td>
</tr>
<tr class="row-even"><td><p>storeCollimatorHits</p></td>
<td><p>Store collimator hits for primary particles. This is addition to
the basic <cite>primaryInteracted</cite> and <cite>primaryStopped</cite> variables.</p></td>
</tr>
<tr class="row-odd"><td><p>storeCollimatorHtisLinks</p></td>
<td><p><cite>storeCollimatorLinks</cite> has been renamed to this (backwards
compatible.</p></td>
</tr>
<tr class="row-even"><td><p>storeTrajectoryIon</p></td>
<td><p>For the trajectories that are stored (according to the filters),
store <cite>isIon</cite>, <cite>ionA</cite>, <cite>ionZ</cite> and <cite>nElectrons</cite> variables.</p></td>
</tr>
<tr class="row-odd"><td><p>storeTrajectoryLocal</p></td>
<td><p>For the trajectories that are stored (according to the filters),
store <cite>xyz</cite> and <cite>pxpypz</cite> local coordinate variables.</p></td>
</tr>
<tr class="row-even"><td><p>storeTrajectoryLinks</p></td>
<td><p>For the trajectories that are stored (according to the filters),
store <cite>charge</cite>, <cite>kineticEnergy</cite>, <cite>turnsTaken</cite>, <cite>mass</cite> and
<cite>rigidity</cite> variables for each step.</p></td>
</tr>
<tr class="row-odd"><td><p>storeTrajectoryTransportationSteps</p></td>
<td><p>On by default. Renamed and opposite logic to
<cite>trajNoTransportation</cite> option.</p></td>
</tr>
<tr class="row-even"><td><p>trajectoryFilterLogicAND</p></td>
<td><p>False by default. If set to true (=1) only particles that match
of the specified filters will be stored. This is opposite to the
more inclusive OR logic used where a trajectory will be stored if
matches any of the specified filters.</p></td>
</tr>
<tr class="row-odd"><td><p>verboseRunLevel</p></td>
<td><p>(0-5) level of Geant4 run level print out. The same as
<cite>-\-verboseRun=X</cite> executable option.</p></td>
</tr>
<tr class="row-even"><td><p>verboseEventBDSIM</p></td>
<td><p>Extra print out identifying the start and end of event
action as well as the allocator pool sizes. Print out
the size of each hits collection if it exists at all. The
same as <cite>-\-verboseEventBDSIM</cite> executable option.</p></td>
</tr>
<tr class="row-odd"><td><p>verboseEventStart</p></td>
<td><p>Event index to start print out according to
<cite>verboseEventBDSIM</cite>. Zero counting.</p></td>
</tr>
<tr class="row-even"><td><p>verboseEventContinueFor</p></td>
<td><p>Number of events to continue print out event information
according to <cite>verboseEventBDSIM</cite>. -1 means all subsequent
events.</p></td>
</tr>
<tr class="row-odd"><td><p>verboseEventLevel</p></td>
<td><p>(0-5) level of Geant4 event level print out for all events.</p></td>
</tr>
<tr class="row-even"><td><p>verboseSteppingBDSIM</p></td>
<td><p>Extra print out for all steps of all particles from BDSIM
for events in the range according to <cite>verboseSteppingEventStart</cite>
and <cite>verboseSteppingEventContinueFor</cite>. Default is all events.</p></td>
</tr>
<tr class="row-odd"><td><p>verboseSteppingLevel</p></td>
<td><p>(0-5) level of Geant4 print out per step of each particle. This
done according to the range of <cite>verboseSteppingEventStart</cite>, and
<cite>verboseSteppingEventContinueFor</cite>. Default is all events and all
particles.</p></td>
</tr>
<tr class="row-even"><td><p>verboseSteppingEventStart</p></td>
<td><p>Event offset (zero counting) to start stepping print out
according to <cite>verboseSteppingLevel</cite>.</p></td>
</tr>
<tr class="row-odd"><td><p>verboseSteppingEventContinueFor</p></td>
<td><p>Number of events to continue print out stepping information for
according to <cite>verboseSteppingLevel</cite>.</p></td>
</tr>
<tr class="row-even"><td><p>verboseSteppingPrimaryOnly</p></td>
<td><p>If true, only print out stepping information for the primary.</p></td>
</tr>
<tr class="row-odd"><td><p>verboseImportanceSampling</p></td>
<td><p>(0-5) level of importance sampling related print out.</p></td>
</tr>
<tr class="row-even"><td><p>verboseStep</p></td>
<td><p>Whether to use the verbose stepping action for every
step. Note, this is a lot of output.</p></td>
</tr>
<tr class="row-odd"><td><p>verboseSteppingLevel</p></td>
<td><p>(0-5) level of Geant4 stepping level print out. The same
as <cite>-\-verbose_G4stepping=X</cite> executable option.</p></td>
</tr>
<tr class="row-even"><td><p>verboseTrackingLevel</p></td>
<td><p>(0-5) level of Geant4 tracking level print out. The same
as <cite>-\-verbose_G4tracking=X</cite> executable option.</p></td>
</tr>
</tbody>
</table>
<ul class="simple">
<li><p>Previous verbosity options are still valid but now undocumented. This change is to make the naming consistent
in lowerCamelCase and to make executable options consistent with input gmad options.</p></li>
</ul>
</section>
<section id="id31">
<h3>General<a class="headerlink" href="#id31" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>Installation support for AFS has been dropped since this is reaching end of life at CERN and may builds
there are unmaintained or now on cvmfs.</p></li>
<li><p>Executable verbosity options, now accepted in input gmad.</p></li>
<li><p>Valid default ranges for general single 3D energy deposition ‘scoring’ histogram
available through options. Now 1m in x,y,z with 1 bin.</p></li>
<li><p>wirescanner element now uses <code class="code docutils literal notranslate"><span class="pre">wireAngle</span></code> for the rotation angle and not <code class="code docutils literal notranslate"><span class="pre">angle</span></code>.</p></li>
<li><p>wirescanner element now requires a material to be specified as this makes a large difference
to the expected result. This should be specified.</p></li>
<li><p>Sampler hits now store rigidity, mass and charge as these are only correct from the G4DynamicParticle
and cannot be reliably or easily back-calculated afterwards based on the particle definition (PDG ID)
for partially stripped ions. This storage marginally increases the memory usage per sampler hit, so
a small increase in memory (RAM) usage may be observed for very large numbers of sampler hits.</p></li>
<li><p>Crystals in crystal collimators are now sensitive as collimators and produce the special collimator
hit information in the output. The crystal channelling process is ignored as a step defining process
for generating unique hits in the crystal.</p></li>
<li><p>All processes of type <cite>G4ProcessType::fNotDefined</cite> are excluded from generating collimator specific hits.</p></li>
<li><p>The option <cite>storeCollimatorInfo</cite> now does not store collimator hits for primary particles but only
the Boolean variables <cite>primaryInteracted</cite> and <cite>primaryStopped</cite> as well as <cite>totalEnergyDeposited</cite> in
each per-collimator branch in Event. This allows greater control over the amount of information stored.
The primary hits can be turned on as well with the option <cite>storeCollimatorHits</cite>.</p></li>
<li><p>Remove use of exit(1) throughout the code.</p></li>
<li><p>Element variables “blmLocZ” and “blmLocTheta” were old and removed. These will be rejected in any
element definition from now on.</p></li>
<li><p>The generic beam line “element” will now be inspected for end piece coil placement on the edge of magnets
and these will be placed if the pro or preceding geometry is small enough. Previously, coils would only be
placed if (strictly) drifts were on either side of the magnet.</p></li>
<li><p>When using a Geant4 reference physics list the default is to use BDSIM’s ranges. This can be turned off,
but shouldn’t interfere if no ranges are set. This has been changed as the <cite>defaultRangeCut</cite> would be enforced
in the past even if not set explicitly by the user, causing BDSIM’s default 1 mm range to be used.</p></li>
<li><p><cite>option, checkOverlaps=1;</cite> now checks the internal structure of any loaded GDML geometry. Previously,
only the placement of the container volume of the loaded geometry was checked to see if it overlaps
with any other geometry, but nothing internally.</p></li>
<li><p>Neutrinos are no longer killed by default. They can be turned off (for optimisation purposes) with
the option <code class="code docutils literal notranslate"><span class="pre">option,</span> <span class="pre">killNeutrinos=1;</span></code>.</p></li>
<li><p>Rectellipse beam pipe will now use elliptical beam pipe without the use of Boolean solids in cases
where the parameters result in this. This makes therefore a marginally simpler model and avoids
abusing unnecessary Booleans in Geant4 due to the way people use the rectellipse for everything.</p></li>
<li><p>Revised calculation of octagonal beam pipe points such that each side is uniformly thick exactly
equalling beam pipe thickness. This is an improvement over the previous algorithm for this.</p></li>
<li><p>Descriptions of the elements rmatrix and thinrmatrix have been added to the manual.</p></li>
<li><p>Maximum step size calculation for RF cavities has been improved to use 2.5% of the minimum of
the wavelength (based on the frequency of the cavity and only valid when non-zero frequency)
and the length of the element.</p></li>
<li><p>Degrader wedges are no longer connected with geometry to prevent overlaps. Degrader can now be fully open
when using the element parameter <code class="code docutils literal notranslate"><span class="pre">degraderOffset</span></code>.</p></li>
</ul>
</section>
<section id="id32">
<h3>Bug Fixes<a class="headerlink" href="#id32" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>Fix polarity for dipole yoke fields. The field in the yokes had the opposite polarity to that
of the beam pipe resulting in particles slightly missing the beam pipe being deflected in the
wrong direction.</p></li>
<li><p>Fix phase offset based on postiion in lattice for RF cavities. Only noticeable when the phase
was set to provie zero acceleration (<span class="math notranslate nohighlight">\(pi/2\)</span>) and it was slightly off causing a gain or
loss in energy.</p></li>
<li><p>Fixed formula in manual for standard error on the mean calculation. The implementation in code
was correct and has not changed.</p></li>
<li><p>Fix thick multipole element where the field was 1M times too strong because of the omission of units.</p></li>
<li><p>Fix Issue #272 where there could be a possible segfault due to the beam particle definition being
updated when multiple different particles were used for a <cite>userfile</cite> distribution.</p></li>
<li><p>Errors in 2D and 3D merged histograms from events were 0 always. The mean was corrected, but the error
was not filled correctly - this has been fixed.</p></li>
<li><p>Merged <strong>simple</strong> histograms (only simple ones) from using rebdsimCombine are now truly the sum, whereas
in the past they were the mean.</p></li>
<li><p>Fix for potential segfault when analysing collimator information branches in event tree. Dependent
on number of collimators analysed causing std::vector to reallocate and invalidate address of
pointers as required by ROOT.</p></li>
<li><p>Fix for warnings about unknown collimator branch names when loading data with DataLoader class.</p></li>
<li><p>Fixed warnings about exiting when Geant4 geometry in closed state in the event
of a warning being produced and BDSIM exiting. Now correctly intercept and re-throw
the exception.</p></li>
<li><p>Fix a bug where setting a rotation angle for a wire scanner would result in energy deposition
S coordinates all being -1. This was because the <code class="code docutils literal notranslate"><span class="pre">angle</span></code> parameter is assumed to only
ever be for bends and BDSIM reduces the sampler and curvilinear world (used for coordinate
transforms) diameter given the maximum bending angle of bends in the whole lattice. This is
required to avoid overlaps before construction. The new parameter <code class="code docutils literal notranslate"><span class="pre">wireAngle</span></code> is used
instead.</p></li>
<li><p>Fix wire scanner sensitivity. The wire was never sensitive.</p></li>
<li><p>Fix generic element sensitivity. It never produced energy deposition.</p></li>
<li><p>Partial fix for aggressive looping particle killing in Geant4.10.5. For electrons and positrons,
and the beam particle, the looping threshold has be lowered to 1 keV. Ongoing investigation.</p></li>
<li><p>Fix missing previous single 3D scoring map (3D histogram of machine energy deposition)
being missing from the run histograms.</p></li>
<li><p>The rigidity was corrected for partially stripped ions in the sampler output.</p></li>
<li><p>The initial kinetic energy of partially stripped ions was slightly inflated due to subtracting
the nuclear mass not including the mass of the electrons. The magnetic fields were however
calculated correctly and this resulted in incorrect behaviour. This has been since fixed.</p></li>
<li><p>Fix a bug where if a userfile with different particle types was used and <cite>-\-generatePrimariesOnly</cite>
was used the phase space coordinates would be correct but the mass, charge, rigidity would be
written wrongly to the output. The particle definition is now updated correctly in the special
case of generating primaries only where the Geant4 kernel isn’t used.</p></li>
<li><p>Fix a possible segfault when an ion beam is used for as well as the <cite>-\-generatePrimariesOnly</cite>
excutable option.</p></li>
<li><p>Ion variables are now correctly written to the Primary branch of the Event tree in the case of using
an ion beam with <cite>-\-generatePrimariesOnly</cite>.</p></li>
<li><p>Fix crystal channelling biasing that was broken with commit #66a6809. This was introduced between
v1.3.1 and v1.3.2. It resulted in the channelling working but the cross-section biasing not being
applied and therefore the rest of the physics processes acting as if the block was amorphous.</p></li>
<li><p>Fix crystal positioning in <cite>crystalcol</cite>. Previously, the crystal centre was placed at <cite>xsize</cite> but
it should be in the inside edge to match other collimators. The inside of the edge is now aligned
to <cite>xsize</cite>.</p></li>
<li><p>Note a change of sign to the left crystal angle. A positive angle and also bendingAngleAxisY rotates
both left and right crystals away from the centre of the collimator. Will only affect the left crystal
as compared to previous behaviour.</p></li>
<li><p>Fix <cite>e1</cite>, <cite>e2</cite>, <cite>hgap</cite>, <cite>fint</cite>, <cite>fintx</cite>, <cite>fintk2</cite>, <cite>fintxk2</cite> not being filled in Model tree output.
They’re now filled correctly.</p></li>
<li><p>Fix generic biasing for protons when an ion is used as the beam, or when GenericIon is available in
the physics list and also biased. Previously, the proton would not be biased but instead only the
ions would be.</p></li>
<li><p>Fix Event.Summary.memoryUsageMb which was always 0. Also now correct units on linux and Mac. Was previously
a factor of 1048 too big on linux.</p></li>
<li><p>Fix scaling of relativistic beta in the dipolequadrupole integrator, the particle design beta was
always was used before regardless of dipole scaling.</p></li>
<li><p>Fix phase term in rf field when frequency is 0. When frequency is 0, the field should be constant and
maximal, however, it was constant but still modulated by the phase of the incoming particle.</p></li>
<li><p>Fix for default value of “energy” (actually energy loss) in the trajectory branch of the Event tree
where the default value was -1 whereas it should be 0.</p></li>
<li><p>Fix missing geometrical margins in undulator.</p></li>
<li><p>Fix small occasional overlap with rectellipse beam pipe with yoke of magnets.</p></li>
<li><p>Fix a lack of warning when there were too many columns supplied to a rebdsim analysis configuration
input text file.</p></li>
<li><p>Fix a bug where the PrimaryFirstHit or PrimayrLastHit S coordinate may appear to jump back and forth
or be discontinuous or wrong. This was fixed by using a more robust directional lookup in the geometry
on boundaries. Although with the exact same coordinates, Geant4’s navigation internally can ‘stick’
to surfaces and it’s more robust to use a navigator search with a direction of motion included. For
the primary trajectory we did a repeated point-only lookup, leading to occasionally the calculated S
position from the centre of the element being wrong. Even if the primary trajectory isn’t stored, a
light version is used to identify the primary first and last hit points. This only happened in very
specific circumstances and depended on the physics list used.</p></li>
<li><p>Fix for incorrect curvilinear transforms resulting in wrong S coordinate. This was caused when the
geometry search fell back to the curvilinear bridge world instead of the regular curvilinear world.
The transform was used from the regular curvilinear world though, which would be the transform from
the last lookup. This only affected a small fraction of cases with steps on boundaries on samplers in
between elements. Most tracking routines do not depend on S / z, so there is little effect to tracking.</p></li>
<li><p>Fix for field map rotation when using a tilt in the field. If the field was tilted by a multiple of
<span class="math notranslate nohighlight">\(\pi/2\)</span>, you would not notice. For small finite tilts, the field vector would be rotated wrongly
due to a double transform.</p></li>
<li><p>Fix a bug where the local coordinates of PrimaryFirstHit and PrimaryLastHit were always zero.</p></li>
<li><p>Fix a bug where the turn number of PrimaryFirstHit and PrimaryLastHit was always zero.</p></li>
<li><p>Fix sampler variables <cite>theta</cite>, <cite>phi</cite> and <cite>phip</cite> being -1 when it should be 0 for 0 angle particles
due to a mistake in the identification of possible nans or infinite numbers.</p></li>
<li><p>Fix check that the RF cavity horizontalWidth is larger than the cavity model radius when a cavity model
is specified for that element.</p></li>
<li><p>Correctly identify primary first hits on wire scanner wires. Due to the often very thin geometric
nature of wires, a step through the wire is usually defined by transportation and not by a discrete
physics process. However, the kinetic energy and momentum direction often change due to along-step
processes that are not identified easily in Geant4. We now detect these changes and correctly identify
the primary as impacting the wire as the PrimaryFirstHit location.</p></li>
<li><p>Fixed a bug where the terminator and teleporters would overlap with the tunnel.</p></li>
<li><p>Fixed two sources of overlaps which may appear when using <cite>lhcleft</cite> or <cite>lhcright</cite> magnet geometries.</p></li>
<li><p>Fixed a bug where the <cite>lhcright</cite> transverse extent was set incorrectly.</p></li>
<li><p>Placements with respect to thin multipoles would not work. Thin multipoles were always made uniquely
where sometimes they didn’t have to be - this has been fixed. Also, the searching algorithm has been
improved to deal with any uniquely built components, such as rf cavities.</p></li>
<li><p>Small memory leaks reported by Coverity.</p></li>
<li><p>Unintialised variables reported by Coverity.</p></li>
<li><p>Fix erroneous warnings with jcol that would prevent it being built. These were due to double
parameter checks from a base class that don’t appy.</p></li>
<li><p>Fix Event.Summary.primaryAbsorbedInCollimator flag not identifying absorption in jcols correctly.</p></li>
<li><p>Fix naming of placements so multiple placements of the same geometry are uniquely shown in the visualiser.</p></li>
<li><p>Fix for test in <cite>shield</cite> element where the beam pipe wasn’t built because it was compared to half the <cite>xsize</cite>
instead of all of it. The beam pipe thickness was also not taken into account and now is.</p></li>
<li><p>Fix potential overlap with octagonal beam pipes caused by incorrect determination of the radius
required for the magnet poles to not hit the beam pipe.</p></li>
<li><p>Fixed naming bug in magnets where the beam pipe container, magnet outer container and overall container
logical volumes would have the same name. This would cause problems when exporting BDSIM geometry to
GDML and then trying to reload it somewhere. Each are now named uniquely.</p></li>
<li><p>Fix potential compilation problem with some compilers for “ambiguous overload of abs”.</p></li>
<li><p>Fix bug where <cite>distrFile</cite> executable option would not print out if set at the start of BDSIM.</p></li>
<li><p>Fix print out for biasing that would incorrectly say “all particles” for biasing primary particles only.
The message has also changed so as not to be confused with particle species.</p></li>
<li><p>Fix the extension of any list type parameters in beam line elements when they’re extended or redefined -
such as updating the <cite>knl</cite> parameter of a multipole. Previously the parser would not understand this syntax.</p></li>
<li><p>Fix survey writing for models with placement beam lines to now write those beam lines in separate files
named as the survey name appended with the placement name. Previously the survey file was overwritten for
every secondary beam lines so only the final beam line placement was recorded.</p></li>
<li><p>Fixed parallel transport integrator for non-paraxial particles (e.g. secondaries from elsewhere) that would
be parallel transported to the end of the element regardless of particle entry position or direction of travel.
Non-paraxial particles are now tracked through as if the element were a drift. In the case of rmatrix elements,
this change does not affect the behaviour of the rmatrix in the centre of the element, only the parallel transport
through the thick sections of the element.</p></li>
<li><p>Fix segfault in rebdsimOptics when supplying a BDSIM root file in which only primaries are generated, the model
isn’t constructed in this case so it isn’t written, therefore can’t be copied to the rebdsimOptics output.</p></li>
<li><p>Fix wrongly sized container volume for ggmad geometry for Cons and Tubs solids as well as reported extents that
would cause overlaps with neighbouring elements.</p></li>
<li><p>Fix crash from Geant4 when the same sequence was placed multiple times (multiple beam line visualisation) due
to degenerate naming of parallel worlds.</p></li>
<li><p>Fix segfault in rebdsimOptics when the output file name is the same as the input file name. The two files names
must now be different.</p></li>
<li><p>Fix potentially bad geometry being built with exceptionally tightly bent dipoles with a short length. The
check on length, angle and horizontalWidth was symmetric whereas for C-shaped poled dipoles the yoke can
be shifted.</p></li>
<li><p>Fix a bug where if the <code class="code docutils literal notranslate"><span class="pre">samplerDiameter</span></code> option was made incredibly small, the linked curvilinear
volumes would also be shrunk and therefore result in a lack of transforms in incorrect fields and therefore
tracking. The size of curvilinear world cylinders for field transforms is now determined independently.</p></li>
<li><p>Fix possible overlaps reported in curvilinear transform volumes when a beam line with very strong bends
is used. The volumes are built with more tolerance and also with a look behind previous in the beam line
to avoid large volumes inbetween bends that migh overlap in a sequence of bends.</p></li>
<li><p><cite>rcol</cite> no longer warns about the entrance and exit x-y ratio to be the same (only ecol does), which had no effect.</p></li>
</ul>
</section>
<section id="id33">
<h3>Output Changes<a class="headerlink" href="#id33" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>In the output, <cite>Event.Trajectory.trajectories</cite> is now <cite>Event.Trajectory.XYZ</cite> to better reflect
what it is.  Similarly, <cite>momenta</cite> is now <cite>PXPYPZ</cite>. Capitals denote the global coordinates.</p></li>
<li><p>The default behaviour with <cite>option, storeTrajectories=1;</cite> is now to <strong>only</strong> store the primary
trajectory whereas it was all before. This vastly reduces the data size.</p></li>
<li><p>The default option <code class="code docutils literal notranslate"><span class="pre">storeTrajectoryDepth</span></code> is now 0, representing only the primary whereas
this was 1e5 before. -1 will mean ‘all’. This in effect fixes a misunderstanding where trajectory
options would not appear to have any effect unless the depth was set to 0.</p></li>
<li><p>A new data member “filters” has been added to the Trajectory branch of the Event tree. This has
bits (std::bitset&lt;N&gt;) that are 1 or 0 representing whether an individual trajectory matched each
filter. This allows a mix of trajectories to be disentangled.</p></li>
<li><p>In the analysis class <code class="code docutils literal notranslate"><span class="pre">analysis/Run.hh</span></code>, the member variables <cite>Summary</cite> and <cite>Histos</cite>
now start with capital letters to match the layout on file.</p></li>
<li><p>Samplers now have a new variable called <cite>nElectrons</cite> that is the number of electrons on a
partially stripped ion (if it is one) passing through the sampler. This is filled alongside
the other ion information.</p></li>
<li><p>Samplers now have a new variable called <cite>theta</cite> included in polar coordinates (optional), which
is the angle with respect to the local z axis. i.e. <span class="math notranslate nohighlight">\(tan^{-1}(r^{\prime}/z^{\prime})\)</span>.</p></li>
<li><p><cite>isIon</cite>, <cite>ionA</cite> and <cite>ionZ</cite> are now non-zero when a Hydrogen ion with one or two electrons
passes through a sampler.</p></li>
<li><p>All extra coordinates are now recorded in the Primary sampler structure no matter if these
are turned on or not for the samplers.</p></li>
<li><p>New Event.Summary variable <cite>cpuTime</cite>, which is the duration of the event in CPU time in seconds.</p></li>
<li><p><cite>e1</cite>, <cite>e2</cite>, <cite>hgap</cite>, <cite>fint</cite>, <cite>fintx</cite>, <cite>fintk2</cite>, <cite>fintxk2</cite> variables in Model tree are now filled
correctly.</p></li>
<li><p>BDSOutputROOTEventCoords member variables are now all vectors instead of single numbers. This
is to allow the possibility of more than one primary particle as is possible when loading a
file from an event generator.</p></li>
<li><p>New BDSOutputROOTEventAperture class.</p></li>
<li><p>Consistency on <cite>isIon</cite> behaviour. A proton is not an ion, but a proton with bound electrons is.</p></li>
<li><p>The variable <code class="code docutils literal notranslate"><span class="pre">duration</span></code> in Event.Summary and Run.Summary is now <code class="code docutils literal notranslate"><span class="pre">durationWall</span></code> to more
accurately reflect the difference between this and the new variable <code class="code docutils literal notranslate"><span class="pre">durationCPU</span></code> for CPU time.</p></li>
<li><p>The header class BDSOutputROOTEventHeader now has variables that store which files were analysed
in the case of rebdsim and which files were combined in the case of rebdsimCombine.</p></li>
<li><p>New variable <code class="code docutils literal notranslate"><span class="pre">nTracks</span></code> in Event.Summary which is the number of tracks created in that event.</p></li>
</ul>
</section>
<section id="id34">
<h3>Output Class Versions<a class="headerlink" href="#id34" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>Data Version 5.</p></li>
</ul>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p><strong>Class</strong></p></th>
<th class="head"><p><strong>Changed</strong></p></th>
<th class="head"><p><strong>Old Version</strong></p></th>
<th class="head"><p><strong>New Version</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>BDSOutputROOTEventAperture</p></td>
<td><p>Y</p></td>
<td><p>NA</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-odd"><td><p>BDSOutputROOTEventBeam</p></td>
<td><p>Y</p></td>
<td><p>3</p></td>
<td><p>4</p></td>
</tr>
<tr class="row-even"><td><p>BDSOutputROOTEventCoords</p></td>
<td><p>Y</p></td>
<td><p>1</p></td>
<td><p>2</p></td>
</tr>
<tr class="row-odd"><td><p>BDSOutputROOTEventCollimator</p></td>
<td><p>N</p></td>
<td><p>1</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-even"><td><p>BDSOutputROOTEventCollimatorInfo</p></td>
<td><p>N</p></td>
<td><p>1</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-odd"><td><p>BDSOutputROOTEventHeader</p></td>
<td><p>Y</p></td>
<td><p>2</p></td>
<td><p>3</p></td>
</tr>
<tr class="row-even"><td><p>BDSOutputROOTEventHistograms</p></td>
<td><p>Y</p></td>
<td><p>2</p></td>
<td><p>3</p></td>
</tr>
<tr class="row-odd"><td><p>BDSOutputROOTEventInfo</p></td>
<td><p>Y</p></td>
<td><p>4</p></td>
<td><p>5</p></td>
</tr>
<tr class="row-even"><td><p>BDSOutputROOTEventLoss</p></td>
<td><p>N</p></td>
<td><p>3</p></td>
<td><p>4</p></td>
</tr>
<tr class="row-odd"><td><p>BDSOutputROOTEventLossWorld</p></td>
<td><p>N</p></td>
<td><p>1</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-even"><td><p>BDSOutputROOTEventModel</p></td>
<td><p>N</p></td>
<td><p>4</p></td>
<td><p>4</p></td>
</tr>
<tr class="row-odd"><td><p>BDSOutputROOTEventOptions</p></td>
<td><p>Y</p></td>
<td><p>4</p></td>
<td><p>5</p></td>
</tr>
<tr class="row-even"><td><p>BDSOutputROOTEventRunInfo</p></td>
<td><p>Y</p></td>
<td><p>2</p></td>
<td><p>3</p></td>
</tr>
<tr class="row-odd"><td><p>BDSOutputROOTEventSampler</p></td>
<td><p>Y</p></td>
<td><p>3</p></td>
<td><p>4</p></td>
</tr>
<tr class="row-even"><td><p>BDSOutputROOTEventTrajectory</p></td>
<td><p>Y</p></td>
<td><p>2</p></td>
<td><p>3</p></td>
</tr>
<tr class="row-odd"><td><p>BDSOutputROOTEventTrajectoryPoint</p></td>
<td><p>Y</p></td>
<td><p>2</p></td>
<td><p>3</p></td>
</tr>
<tr class="row-even"><td><p>BDSOutputROOTGeant4Data</p></td>
<td><p>N</p></td>
<td><p>2</p></td>
<td><p>2</p></td>
</tr>
</tbody>
</table>
</section>
<section id="id35">
<h3>Utilities<a class="headerlink" href="#id35" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>pybdsim v2.2.0</p></li>
<li><p>pymadx v1.8.0</p></li>
<li><p>pymad8 v1.6.0</p></li>
<li><p>pytransport v1.4.0</p></li>
</ul>
</section>
</section>
<section id="v1-3-3-2019-05-21">
<h2>V1.3.3 - 2019 / 05 / 21<a class="headerlink" href="#v1-3-3-2019-05-21" title="Link to this heading"></a></h2>
<section id="id36">
<h3>Bug Fixes<a class="headerlink" href="#id36" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>Hot fix for fields not attached to thin elements such as dipole fringes or thin multipoles. This bug
crept in through a modification to avoid Geant4 getting stuck with strong fields in very narrow gaps
between layers of geometry in beam pipes, resulting in subsequent bad tracking due to the bad state of
Geant4 navigators internally. Regression testing has subsequently been introduced to protect against
this kind of bugging going unnoticed in future.</p></li>
</ul>
</section>
</section>
<section id="v1-3-2-2019-04-20">
<h2>V1.3.2 - 2019 / 04 / 20<a class="headerlink" href="#v1-3-2-2019-04-20" title="Link to this heading"></a></h2>
<section id="id37">
<h3>New Features<a class="headerlink" href="#id37" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>Can now use any particle available through the physics list for a beam particle.</p></li>
<li><p>Generic cross-section biasing can now be used for any particle, including ions.</p></li>
</ul>
</section>
<section id="id38">
<h3>General<a class="headerlink" href="#id38" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>Tested with Geant4.10.5.p01</p></li>
<li><p>Geometry navigators are reset at the beginning of a run now in a similar way to the start of
an event to ensure independence between runs - future proofing.</p></li>
<li><p>For Geant4.10.5, we now use the ‘low’ looping particle thresholds for tracking.</p></li>
<li><p>The ‘vacuum’ field is now not applied to the container volume of a beam pipe. However, it is
still applied to the vacuum and beam pipe volumes. This makes the tracking more robust against
stuck particles in the extremely small gap between volumes.</p></li>
<li><p>The yoke magnetic field now uses a wrapped G4ClassicalRK4 integrator. This wrapper acts as
a drift for short (&lt; 1um) steps. This makes tracking more robust for secondaries in the yoke.</p></li>
<li><p>Improve testing for user bunch distribution for robustness.</p></li>
<li><p>Increase transverse length safety margin between beam pipes and magnet volumes for safety.</p></li>
<li><p>Translate bunch coordinates in global coordinates backwards by 1x length safety to avoid
starting on a volume boundary at the start of the event. This is 1nm so will not affect
tracking results. The local coordinates in the output are identically the same.</p></li>
</ul>
</section>
<section id="id39">
<h3>Bug Fixes<a class="headerlink" href="#id39" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>Fix strong recreation when using user file supplied bunch distribution. The file was
always read from the beginning in the past. Now the correct coordinates will be
read and the event is correctly reproduced.</p></li>
<li><p>Fix userinterface example given changes to sensitive detector manager - simple edit.</p></li>
<li><p>Fix calculated phase offset for rfcavity in the beam line. This was peak at the
end of the element rather at the middle.</p></li>
<li><p>Fix possible segfault if event aborted due to extra collimator hit information.</p></li>
<li><p>Fix user file beam loader for anomalous particle coordinates generated once at the end
of a file if the end of the file was a blank line. It would result in all zero coordinates
and beam energy x1000 for the first particle generated after the end of the file was reached.</p></li>
<li><p>Fix abort of event if unknown particle ID specified in user file beam loader.</p></li>
<li><p>Fix user file distribution file loading for comment lines, incomplete lines and empty
(white space) lines.</p></li>
<li><p>Fix phase offset calculation for rf cavities with respect to nominal value. Phase would have
been smaller than intended. It was scaled to <span class="math notranslate nohighlight">\(1/2\pi\)</span> instead of <span class="math notranslate nohighlight">\(2\pi\)</span>.</p></li>
<li><p>Fix ambiguity in manual for rf cavities. Time is generally in seconds in BDSIM, however the
rf cavity took nanoseconds. A time offset of <cite>1*ns</cite> in the input gmad would result in double
units.</p></li>
<li><p>Fix warning when loading an output file with data loader class when the file was created
without storing primary coordinates. The warning was related to the PrimaryGlobal branch.</p></li>
<li><p>Fix warnings and artificial killing of particles by high looping particle thresholds for
Geant4.10.5, which are default. Use the ‘low’ looping thresholds by default. Issue #268.</p></li>
<li><p>Fix stuck particles by attaching the vacuum field in a beam pipe to every volume in the
beam pipe apart from the container volume to avoid navigation problems in very thin gaps. Issue #268.</p></li>
<li><p>Remove half-implemented integrator types in internal dictionaries.</p></li>
<li><p>Fixed model-model example conversion Python scripts as these were specific to the developer’s computer.</p></li>
<li><p>Fix coil end-piece placement with respect to main magnet body - now includes required length safety
gap to avoid possible navigation issues with large sized models.</p></li>
<li><p>Fix for exotic particle beams. Can now use any particle available in the physics list.
Particle definitions now constructed earlier than in the regular physics list call.</p></li>
<li><p>Fix bad tracking in undulators caused by nan values in field caused by querying the field
at arbitrarily large positions. Limited the range of validity of the field to the beam pipe. The
field is now no longer attached to the magnets outside the beam pipe.</p></li>
<li><p>Biasing was not attached to components that were found to be unique in construction - i.e. an
rbend back-to-back with another rbend will not have fringe fields in the middle at the join, so
is considered a unique construction. This would result in these not having biasing attached.</p></li>
</ul>
</section>
<section id="id40">
<h3>Utilities<a class="headerlink" href="#id40" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>pybdsim v2.1.0</p></li>
<li><p>pymadx v1.7.1</p></li>
<li><p>pymad8 v1.5.0</p></li>
<li><p>pytransport v1.3.0</p></li>
</ul>
</section>
</section>
<section id="v1-3-1-2019-03-05">
<h2>V1.3.1 - 2019 / 03 / 05<a class="headerlink" href="#v1-3-1-2019-03-05" title="Link to this heading"></a></h2>
<section id="id41">
<h3>Bug Fixes<a class="headerlink" href="#id41" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>Fix transform3d element where offsets were not working.</p></li>
</ul>
</section>
</section>
<section id="v1-3-2019-02-27">
<h2>V1.3 - 2019 / 02 / 27<a class="headerlink" href="#v1-3-2019-02-27" title="Link to this heading"></a></h2>
<section id="id42">
<h3>Expected Changes To Results<a class="headerlink" href="#id42" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>The density of the surrounding air has changed very slightly to that of the standard
G4_AIR one.</p></li>
<li><p>Energy deposition in vacuum is now separated into a separate branch and is not mixed
with general Eloss. Therefore, less energy deposition will be seen in the Eloss branch.</p></li>
<li><p>The minimum kinetic energy option will now be respected when using a Geant4 reference
physics list, whereas it wasn’t before.</p></li>
<li><p>The range cuts can now be applied when using a Geant4 reference physics list if the
option <code class="code docutils literal notranslate"><span class="pre">g4PhysicsUseBDSIMRangeCuts</span></code> is turned on (=1). Previously, these had no
effect with a Geant4 reference physics list.</p></li>
</ul>
</section>
<section id="id43">
<h3>New Features<a class="headerlink" href="#id43" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>Support for Geant4.10.5.</p></li>
<li><p>New environment script in <code class="code docutils literal notranslate"><span class="pre">&lt;bdsim-install-dir&gt;/bin/bdsim.sh</span></code> to make running BDSIM easier.</p></li>
<li><p>All Geant4 reference physics lists are now available.</p></li>
<li><p>New beam pipe aperture for the CLIC post collision line.</p></li>
<li><p>New jaw collimator element “jcol” with two blocks in the horizontal plane.</p></li>
<li><p>New wire scanner element “wirescanner” with cylindrical wire in a beam pipe.</p></li>
<li><p>Completed CMake to allow user applications based on BDSIM to easily link against it.</p></li>
<li><p>New <code class="code docutils literal notranslate"><span class="pre">dump</span></code> beam line element that is an infinite absorber. This prevents simulations
running for a long time when particles may hit the air at the end of the beam line.</p></li>
<li><p>BDSIM as a class for interfacing. Ability to add custom beam line components.
See <a class="reference internal" href="interfacing.html#interfacing-section"><span class="std std-ref">Interfacing</span></a>.</p></li>
<li><p>New samplerplacement object that defines an arbitrarily placed sampler in the world that
may overlap with anything (see <a class="reference internal" href="model_control.html#user-sampler-placement"><span class="std std-ref">Output at an Arbitrary Plane - User Placed Sampler</span></a>).</p></li>
<li><p>New importance sampling implementation when using a user-supplied world geometry. (see
<a class="reference internal" href="model_control.html#physics-bias-importance-sampling"><span class="std std-ref">Geometric Importance Sampling</span></a>.</p></li>
<li><p>New options:</p></li>
</ul>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p><strong>Option</strong></p></th>
<th class="head"><p><strong>Description</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>collimatorsAreInfiniteAbosrbers</p></td>
<td><p>When turned on, all particles that enter the material of a
collimator (<cite>rcol</cite>, <cite>ecol</cite> and <cite>jcol</cite>) are killed and the energy
recorded as deposited there.</p></td>
</tr>
<tr class="row-odd"><td><p>geant4Macro</p></td>
<td><p>Fun an optional macro in the visualiser once it’s started.</p></td>
</tr>
<tr class="row-even"><td><p>g4PhysicsUseBDSIMCutsAndLimits</p></td>
<td><p>If on, the maximum step length will be limited to 110% of the
component length - this makes the tracking more robust and is
the default with a regular BDSIM physics list. The minimum
kinetic option is also obeyed. Default off.</p></td>
</tr>
<tr class="row-odd"><td><p>g4PhysicsUseBDSIMRangeCuts</p></td>
<td><p>If on, this will apply the BDSIM range cut lengths to the Geant4
physics list used. This is off by default.</p></td>
</tr>
<tr class="row-even"><td><p>ignoreLocalMagnetGeometry</p></td>
<td><p>If turned on, this option means that only the magnet geometry
from options will be used. Similar to <cite>ignoreLocalAperture</cite>.</p></td>
</tr>
<tr class="row-odd"><td><p>importanceVolumeMap</p></td>
<td><p>File path for text file that maps importance values to volumes.</p></td>
</tr>
<tr class="row-even"><td><p>importanceWorldGeometryFile</p></td>
<td><p>File path for the externally provided geometry that will be used
as the parallel world for the importance sampling.</p></td>
</tr>
<tr class="row-odd"><td><p>physicsEnergyLimitLow</p></td>
<td><p>Control minimum energy for all physics models. (advanced)</p></td>
</tr>
<tr class="row-even"><td><p>physicsEnergyLimitHigh</p></td>
<td><p>Control maximum energy for all physics models. (advanced)</p></td>
</tr>
<tr class="row-odd"><td><p>minimumKineticEnergyTunnel</p></td>
<td><p>Any particles below this energy (in GeV by default) will be
artificially killed in all BDSIM-generated tunnel segments.</p></td>
</tr>
<tr class="row-even"><td><p>storeCollimatorInfo</p></td>
<td><p>Store collimator structure with primary hits per collimator.</p></td>
</tr>
<tr class="row-odd"><td><p>storeCollimatorHitsAll</p></td>
<td><p>If <cite>storeCollimatorInfo</cite> is on and collimator hits are
generated, hits will be generated for all particles interacting
with the collimators whether primary or secondary and whether
ion or not.</p></td>
</tr>
<tr class="row-even"><td><p>storeCollimatorHitsIons</p></td>
<td><p>If <cite>storeCollimatorInfo</cite> is on and collimator hits are
generated, <cite>isIon</cite>, <cite>ionA</cite> and <cite>ionZ</cite> variables are filled.
Collimator hits will now also be generated for all ions.</p></td>
</tr>
<tr class="row-odd"><td><p>storeCollimatorHitsLinks</p></td>
<td><p>If <cite>storeCollimatorInfo</cite> is on and collimator hits are
generated, extra information is stored for each collimator hit.</p></td>
</tr>
<tr class="row-even"><td><p>storeEloss</p></td>
<td><p>Ability to completely turn off generation of energy deposition
hits to save memory usage and output file size. Default on.</p></td>
</tr>
<tr class="row-odd"><td><p>storeElossModelID</p></td>
<td><p>Control whether the beam line index is stored in the energy
loss output. More granular than <code class="code docutils literal notranslate"><span class="pre">storeElossLinks</span></code>.</p></td>
</tr>
<tr class="row-even"><td><p>storeElossTurn</p></td>
<td><p>Control whether energy deposition turn number is saved.</p></td>
</tr>
<tr class="row-odd"><td><p>storeElossVacuum</p></td>
<td><p>Control whether energy deposition in the residual gas in the
beam pipe ‘vacuum’ is recorded.</p></td>
</tr>
<tr class="row-even"><td><p>storeElossWorld</p></td>
<td><p>Turn on generation of energy deposition in the world volume
(i.e. the air) as well as record energy leaving the simulation.
Default off.</p></td>
</tr>
<tr class="row-odd"><td><p>storeElossWorldContents</p></td>
<td><p>Turn on generation and storage of energy deposition in any
included with the externally provided world geometry. Off by
default but turned on automatically when using importance
sampling. Allows the user to distinguish energy deposition in
the air as stored in ElossWorld from the contents of the world.</p></td>
</tr>
<tr class="row-even"><td><p>storeSamplerAll</p></td>
<td><p>Conveniently store all optional sampler data with one option.</p></td>
</tr>
<tr class="row-odd"><td><p>storeSamplerKineticEnergy</p></td>
<td><p>Store kinetic energy in the sampler output.</p></td>
</tr>
<tr class="row-even"><td><p>storeSamplerPolarCoords</p></td>
<td><p>Store the polar coordinates (r, phi and rp, phip) in the
sampler output.</p></td>
</tr>
<tr class="row-odd"><td><p>tunnelIsInfiniteAbsorber</p></td>
<td><p>When turned on, any BDSIM-generated tunnel segments will absorb
and kill any particle of any energy. Used to speed up the
simulation. Default off.</p></td>
</tr>
<tr class="row-even"><td><p>worldGeometryFile</p></td>
<td><p>External geometry file for world geometry.</p></td>
</tr>
</tbody>
</table>
<ul class="simple">
<li><p>Access to data version in DataLoader in analysis.</p></li>
<li><p>External geometry can be supplied as the world volume with the option
<code class="code docutils literal notranslate"><span class="pre">worldGeometryFile</span></code>.</p></li>
<li><p>New complete physics list for crystal channelling to achieve the correct result.</p></li>
<li><p>New ability to specify a different beam particle that is different from the design
particle used for magnetic field strength calculations (<code class="code docutils literal notranslate"><span class="pre">beamParticleName</span></code>).</p></li>
<li><p>Specify the particle assumed for the user file distribution that can be different from
the design particle.</p></li>
<li><p>New option to use a one turn map generated from MAD-X PTC to correct
multi-turn tracking for circular machines.</p></li>
<li><p>New option <code class="code docutils literal notranslate"><span class="pre">geant4Macro</span></code> and executable option <code class="code docutils literal notranslate"><span class="pre">--geant4Macro</span></code> to run an optional
macro in the visualiser once it’s started.</p></li>
<li><p>A warning will print if a user-defined material is more dense than 100g/cm3 as this is much higher
than any naturally occurring material (on Earth). The simulation will still proceed.</p></li>
<li><p>New optional collimator output structure in event made per collimator with prefix
“COLL_”. Controlled by new option <code class="code docutils literal notranslate"><span class="pre">collimatorInfo</span></code>.</p></li>
<li><p>New mini-summary of collimators in Model tree when <code class="code docutils literal notranslate"><span class="pre">collimatorInfo</span></code> option is used.</p></li>
<li><p>New parameter for collimator elements <code class="code docutils literal notranslate"><span class="pre">minimumKineticEnergy</span></code> that allows the user to kill
particles below a certain kinetic energy in a collimator.</p></li>
</ul>
</section>
<section id="id44">
<h3>General<a class="headerlink" href="#id44" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>All collimators now require a material to be specified and the default copper has
been removed. This is because it strongly affects the results obtained and defaults
should not be relied upon for this.</p></li>
<li><p>The turn number for energy deposition hits is now automatically stored if
a circular model is used.</p></li>
<li><p>The <cite>sensitiveBeamlineComponents</cite> option has now been renamed to <cite>sensitiveOuter</cite>
to better reflect its functionality. The old option is still accepted.</p></li>
<li><p>The <cite>tunnelSensitive</cite> option has now been renamed to <cite>storeElossTunnel</cite> to be
more consistent with the other sensitivity options. The old option is still
accepted.</p></li>
<li><p>The generic beam line element <cite>element</cite> now supports angle and the beam line
will be curved by this amount.</p></li>
<li><p>The world volume is now sensitive and can record energy deposition. Geant4.10.3 upwards
is required to record both this information and the energy leaving the world
as this requires G4MultiSensitiveDetector.</p></li>
<li><p>New tests for testing backwards compatibility of analysis tool with previous data version.</p></li>
<li><p>“Model Preparation” is now “Model Conversion” in the manual to be clearer.</p></li>
<li><p>Visualisation now uses macro search path to look for visualisation macro in the installation
directory then the build directory of BDSIM.</p></li>
<li><p>In recreate mode, there is explicit print out about when the seed is set and if if was successfully
loaded from the output file.</p></li>
<li><p>The Cherenkov example has now been updated to show 3 materials (air, water, YAG).</p></li>
<li><p>Fixes from static code analysis for virtual functions called in constructors of factories,
shadow member variables and initialisation of crystal variables in parser.</p></li>
<li><p>Significant reduction in use of the singleton pattern for beam pipe, magnet yoke,
tunnel and geometry factories.</p></li>
<li><p>Reduced memory usage for energy deposition hits by removing unused numbers stored each time.</p></li>
<li><p>Reduced memory usage for energy deposition hits when not using extra variables such as the ‘links’.</p></li>
</ul>
</section>
<section id="materials">
<h3>Materials<a class="headerlink" href="#materials" title="Link to this heading"></a></h3>
<ul>
<li><p>The materials construction in src/BDSMaterials.cc was checked through thoroughly.</p></li>
<li><p>“air” is now G4_AIR instead of custom BDSIM air (similar composition). The old air is now “airbdsim”.</p></li>
<li><p>The refractive index data for optical and cherenkov physics has been added on top of G4_AIR
as well as “airbdsim”.</p></li>
<li><p>“airbdsim” now has a density of 1.225mg/cm3.</p></li>
<li><p>“bp_carbonmonoxide” material now has correct pressure (previously near infinite).</p></li>
<li><p>Fixed double density for the following materials. They would have been extremely dense.</p>
<blockquote>
<div><ul class="simple">
<li><p>“berylliumcopper”</p></li>
<li><p>“stainless_steel_304L”</p></li>
<li><p>“stainless_steel_304L_87K”</p></li>
<li><p>“stainless_steel_316LN”</p></li>
<li><p>“stainless_steel_316LN_87K”</p></li>
<li><p>“tungsten_heavy_alloy”</p></li>
<li><p>“fusedsilica”</p></li>
<li><p>“n-bk7”</p></li>
<li><p>“yag”</p></li>
<li><p>“pet”</p></li>
<li><p>“lhc_rock”</p></li>
</ul>
</div></blockquote>
</li>
<li><p>“niobium” is now “niobium_2k” to better reflect the unusual temperature.</p></li>
<li><p>“nbti” is now “nbti_4k” to better reflect the unusual temperature.</p></li>
<li><p>“waterCkov” has been removed. “water” or “G4_WATER” (the same) should be used. The refractive
index data has been added to G4_WATER material.</p></li>
</ul>
</section>
<section id="developer-changes">
<h3>Developer Changes<a class="headerlink" href="#developer-changes" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>The BDSGeometryComponent base class now has the ability to specify which
sensitive detector should be attached in a map using the BDSSDType enum. There is no default
sensitive detector (previously general energy deposition) as the developer must be explicit
about what sensitivity they want so nothing unexpected can happen.</p></li>
<li><p>BDSBeamline can now return indices of beam line elements of a certain type.</p></li>
<li><p>All sensitive detector classes have been renamed as have the accessor functions in BDSSDManager.
This is to make the naming more consistent.</p></li>
</ul>
</section>
<section id="id45">
<h3>Bug Fixes<a class="headerlink" href="#id45" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>Fixed reloading user file when reading more particles than defined in the file.</p></li>
<li><p>Fixed “pt” column in user file for reading particle PDG IDs. The first particle would be read
correctly and all subsequent particles would revert to the beam definition.</p></li>
<li><p>Fixed infinite tracking from nans return from field map when BDSIM format
field map file was lacking lower and upper limits.</p></li>
<li><p>Fixed incorrect writing of optional sampler information.</p></li>
<li><p>The <cite>sensitiveBeamPipe</cite> option now works and controls whether the beam pipe produces
energy loss or not. This does not affect the physics, merely whether output
information is generated or not.</p></li>
<li><p>The <cite>sensitiveOuter</cite> (formerly <cite>sensitiveBeamlineComponents</cite>) option has
been fixed and now controls whether the parts outside the beam pipe in an
element record energy loss or not.</p></li>
<li><p>Degrader and undulator did not record energy deposition.</p></li>
<li><p>Energy deposition is now correctly recorded when tracks are artificially killed.</p></li>
<li><p>Fix crystal channelling with cylindrical and torus shaped crystals. The crystal implementation
only works along the local X direction of any solid. Fixed by using a G4DisplacedSolid to
allow use of more advanced geometries than a box.</p></li>
<li><p>Fix channelling physics for standard EM and hadronic processes as this requires process biasing.</p></li>
<li><p>Fix A and Z being the wrong way around for ions in samplers.</p></li>
<li><p>Charge now correctly recorded in primaries and in samplers for partially stripped ions.</p></li>
<li><p>Solenoid tracking fixed. Fringes are constructed as appropriate according to integrator set.</p></li>
<li><p>Fix possible nan values given to Geant4 tracking with miscalculated auto-scaling value for
field maps.</p></li>
<li><p>Fix setting default seed state for random number generator if using recreate mode
and progressing beyond an event stored in the file.</p></li>
<li><p>Fix setting the energy level of an ion - wasn’t set from input.</p></li>
<li><p>SQL geometry factory didn’t clean up after repeated use. This geometry isn’t
generally supported.</p></li>
<li><p>Fixed a bug where very weak actions on particles in tracking would not be taken due to
too stringent tests of finite numbers. This would result in particles with small offsets
in magnets or particles with high momentum that would see only very small deviations being
tracked as if it were a drift.</p></li>
<li><p>Fixed segfault crash from ROOT with rebdsim when there were more dimensions in the variables
than the declared number of dimensions. For example, “y:x” for Histogram1D.</p></li>
<li><p>Fixed rare bug where segfault would occur in trying to account for energy deposition of
artificially killed particles.</p></li>
<li><p>Fix memory leak of sampler structures (relatively small).</p></li>
<li><p>Fixed parsing of + or - symbols with ion definition. Now supports H- ion.</p></li>
<li><p>Fixed very slow memory leak associated with the primary trajectory. only visible for very
large numbers of events.</p></li>
<li><p>Fixed dipole tracking for off-charge ions - reverts to backup integrator.</p></li>
<li><p>Fixed Pythonic range iteration of Event tree when trying to look at Info branch. Conflicted with
Info method of TObject. Now renamed to Summary.</p></li>
<li><p>Fixed catching the construction of dipoles with too large an angle. Limit rbends and unsplit
sbends to a maximum angle of pi/2, limit the maximum angle of all other dipoles to 2 pi.</p></li>
</ul>
</section>
<section id="id46">
<h3>Output Changes<a class="headerlink" href="#id46" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>“Info” branch of the Event and Run trees are now “Summary”. This is to avoid conflict with
ROOT TObject::Info() that could result in broken analysis or range iteration. The DataLoader
class in analysis (used by pybdsim.Data.Load) is backwards compatible. In the case of loading
older data with updated software, there will still be a member called Info that the data will
be loaded into. Python range iteration cannot be used in this case.</p></li>
<li><p>“TunnelHit” is now “EnergyLossTunnel” to be consistent. <cite>rebdsim</cite> and the analysis DataLoader
class (both Python and ROOT) are backwards compatible and both TunnelHit and ElossTunnel are
available. Only the correct one is filled with loaded data during analysis.</p></li>
<li><p>Much more granular control of what is stored in the output. See new options in ‘new’ section
above.</p></li>
<li><p>Vacuum energy deposition separated from general energy deposition and now in its own branch.</p></li>
<li><p>Memory usage (for Mac &amp; Linux) added at the end of each event in event info. This
is the memory usage of the whole program at that point including event independent
quantities such as the model.</p></li>
<li><p>Boolean flag store in even info as to whether the primary was absorbed in a collimator or not.</p></li>
<li><p>New options to control level of output as described in table in new features..</p></li>
<li><p>Tunnel energy deposition hits now respond to the <code class="code docutils literal notranslate"><span class="pre">storeElossXXXX</span></code> options to control the
level of detail with extra variables of their output.</p></li>
<li><p>New class BDSOutputROOTEventLossWorld for a record of coordinates when a particle leaves a volume,
use currently for exiting the world.</p></li>
<li><p>New structures (“branches”) in the <cite>Event</cite> tree called <code class="code docutils literal notranslate"><span class="pre">ElossWorld</span></code> and
<code class="code docutils literal notranslate"><span class="pre">ElossWorldExit</span></code> for energy deposition in the world material and energy leaving
the world (and therefore the simulation) respectively.</p></li>
<li><p>New members in <code class="code docutils literal notranslate"><span class="pre">Event.Info</span></code> that are the integrated energy deposited in various parts
for that event. These are for convenience and are the integrals of the various Eloss parts.</p></li>
</ul>
</section>
<section id="id47">
<h3>Output Class Versions<a class="headerlink" href="#id47" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>Data Version 4.</p></li>
</ul>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p><strong>Class</strong></p></th>
<th class="head"><p><strong>Changed</strong></p></th>
<th class="head"><p><strong>Old Version</strong></p></th>
<th class="head"><p><strong>New Version</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>BDSOutputROOTEventBeam</p></td>
<td><p>Y</p></td>
<td><p>2</p></td>
<td><p>3</p></td>
</tr>
<tr class="row-odd"><td><p>BDSOutputROOTEventCoords</p></td>
<td><p>N</p></td>
<td><p>1</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-even"><td><p>BDSOutputROOTEventCollimator</p></td>
<td><p>Y</p></td>
<td><p>NA</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-odd"><td><p>BDSOutputROOTEventCollimatorInfo</p></td>
<td><p>Y</p></td>
<td><p>NA</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-even"><td><p>BDSOutputROOTEventLossWorld</p></td>
<td><p>Y</p></td>
<td><p>NA</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-odd"><td><p>BDSOutputROOTEventHeader</p></td>
<td><p>N</p></td>
<td><p>2</p></td>
<td><p>2</p></td>
</tr>
<tr class="row-even"><td><p>BDSOutputROOTEventHistograms</p></td>
<td><p>N</p></td>
<td><p>2</p></td>
<td><p>2</p></td>
</tr>
<tr class="row-odd"><td><p>BDSOutputROOTEventInfo</p></td>
<td><p>Y</p></td>
<td><p>3</p></td>
<td><p>4</p></td>
</tr>
<tr class="row-even"><td><p>BDSOutputROOTEventLoss</p></td>
<td><p>Y</p></td>
<td><p>3</p></td>
<td><p>4</p></td>
</tr>
<tr class="row-odd"><td><p>BDSOutputROOTEventModel</p></td>
<td><p>Y</p></td>
<td><p>3</p></td>
<td><p>4</p></td>
</tr>
<tr class="row-even"><td><p>BDSOutputROOTEventOptions</p></td>
<td><p>Y</p></td>
<td><p>3</p></td>
<td><p>4</p></td>
</tr>
<tr class="row-odd"><td><p>BDSOutputROOTEventRunInfo</p></td>
<td><p>N</p></td>
<td><p>2</p></td>
<td><p>2</p></td>
</tr>
<tr class="row-even"><td><p>BDSOutputROOTEventSampler</p></td>
<td><p>Y</p></td>
<td><p>2</p></td>
<td><p>3</p></td>
</tr>
<tr class="row-odd"><td><p>BDSOutputROOTEventTrajectory</p></td>
<td><p>N</p></td>
<td><p>2</p></td>
<td><p>2</p></td>
</tr>
<tr class="row-even"><td><p>BDSOutputROOTEventTrajectoryPoint</p></td>
<td><p>N</p></td>
<td><p>2</p></td>
<td><p>2</p></td>
</tr>
<tr class="row-odd"><td><p>BDSOutputROOTGeant4Data</p></td>
<td><p>N</p></td>
<td><p>2</p></td>
<td><p>2</p></td>
</tr>
</tbody>
</table>
</section>
<section id="id48">
<h3>Utilities<a class="headerlink" href="#id48" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>pybdsim v2.0.0</p></li>
<li><p>pymadx v1.7.0</p></li>
<li><p>pymad8 v1.5.0</p></li>
<li><p>pytransport v1.3.0</p></li>
</ul>
</section>
</section>
<section id="v1-2-2018-08-26">
<h2>V1.2 - 2018 / 08 / 26<a class="headerlink" href="#v1-2-2018-08-26" title="Link to this heading"></a></h2>
<section id="highlights">
<h3>Highlights<a class="headerlink" href="#highlights" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p><code class="code docutils literal notranslate"><span class="pre">outerDiameter</span></code> is now <code class="code docutils literal notranslate"><span class="pre">horizontalWidth</span></code> to better describe its function (backwards-compatible).</p></li>
<li><p>Fixed dipole scaling with (the default) bdsimmatrix integrator set.</p></li>
<li><p>Solenoid tracking fixed.</p></li>
</ul>
</section>
<section id="id49">
<h3>New Features<a class="headerlink" href="#id49" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>New options to activate extra models in em_extra physics list.</p></li>
<li><p>New <code class="code docutils literal notranslate"><span class="pre">crystalcol</span></code> element for channelling crystals.</p></li>
<li><p>New <code class="code docutils literal notranslate"><span class="pre">crystal</span></code> definition in parser.</p></li>
<li><p>New “channelling” physics list for Geant4 crystal channelling physics process.</p></li>
<li><p>Field maps need not be in <cite>x</cite>, <cite>y</cite>, <cite>z</cite>, <cite>t</cite> order and lower dimension fields (i.e. 1D or 2D) can
be made for any dimension, i.e. it is now possible to specify a 1D field along the <cite>z</cite> direction.</p></li>
<li><p>Rebdsim can now analyse a select range of events specified by “EventStart” and “EventEnd” options.
Issue #240.</p></li>
<li><p>Placements can now be made with respect to S,x, and y in the main beam line, with respect to a beam line
element and lastly in global Cartesian coordinates.</p></li>
<li><p>Samplers will no longer be automatically attached (with <code class="code docutils literal notranslate"><span class="pre">sample,</span> <span class="pre">all;</span></code>) to dipoles with finite
pole face rotations, as this may lead to tracking issues in Geant4. A developer option can force
this on, although this is not recommended. Issue #241.</p></li>
<li><p><cite>hkicker</cite> and <cite>vkicker</cite> strength can be specified via the magnetic field <code class="code docutils literal notranslate"><span class="pre">B</span></code> instead of
<cite>hkick</cite> or <cite>vkick</cite>.</p></li>
<li><p>Support for dipole poleface curvature in tracking.</p></li>
<li><p>Pole face rotations and fringe fields are now available for hkickers and vkickers, both thick and thin.</p></li>
<li><p>New ability to specify the colour of any magnet and most elements through custom colour definition.</p></li>
<li><p>Geant4’s DNA physics lists have been added.</p></li>
<li><p>Solenoid fringe fields have been implemented and are on by default. They are controlled with
the <cite>includeFringeFields</cite> option.</p></li>
</ul>
</section>
<section id="id50">
<h3>General<a class="headerlink" href="#id50" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p><code class="code docutils literal notranslate"><span class="pre">outerDiameter</span></code> is now <code class="code docutils literal notranslate"><span class="pre">horizontalWidth</span></code> to better describe its function
(backwards-compatible). This naming was from a time when BDSIM could only create cylindrical
magnets and beam pipes. Given it can now create more complicated geometry, this name is not
a good choice and so has been renamed. BDSIM still supports the old syntax.</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">vhratio</span></code> is now consistent with vkickers and refers to the vertical and horizontal ratio in
the lab frame.</p></li>
<li><p>The horizontal width of kickers is now taken from <code class="code docutils literal notranslate"><span class="pre">outerDiameter</span></code>. Previously, <code class="code docutils literal notranslate"><span class="pre">outerDiameter</span></code>
corresponded to the height and <code class="code docutils literal notranslate"><span class="pre">vhratio</span></code> was really the horizontal-to-vertical ratio in
the lab frame.</p></li>
<li><p>Synchrotron radiation is now disabled with em_extra physics list (use dedicated
synchrad physics list). Avoids the double registration of the physics process.</p></li>
<li><p>New CMake variable ROOTSYS to allow easy specification of a specific ROOT installation.</p></li>
<li><p>Visualisation of trajectories significantly faster (~10x) due to different strategy with Geant4
visualisation system.</p></li>
<li><p>“ang” unit is added to the parser for Angstroms.</p></li>
<li><p>BDSIM will now exit if there is no space to make the necessary circular management objects
(teleporter and terminator).</p></li>
<li><p>long int used explicitly instead of int for event indices in analysis.</p></li>
<li><p>Reimplemented primary first hit and last hit. Last hit is now the end point of the
primary trajectory. No more linear memory usage with tracking time.</p></li>
<li><p>Beam pipe extent calculation re-implemented and much less simplistic - used
to check whether a pipe will fit inside a magnet.</p></li>
<li><p>Mini-contents for syntax section of manual, as it’s grown to a large size.</p></li>
<li><p>New rmatrix element (experimental).</p></li>
<li><p>EM Dissociation is now applicable up to 100 TeV.</p></li>
<li><p>Significantly improved aperture shape checking for whether beam pipe will fit inside a magnet.</p></li>
<li><p>BDSIM now recognises all elements by chemical abbreviation. These are found in the Geant4 NIST
database by automatically prefixing the name with “G4_”. Issue #236.</p></li>
<li><p><cite>circle</cite> distribution z and t distributions are now reversed to be consistent with all other generators.
These were T0 - dt and are now T0 + dt. Distribution will be different for the same seed as compared
to a previous version of BDSIM.</p></li>
<li><p><cite>square</cite> distribution now calls random number generator for each coordinate every time for
consistency. Distribution will be different for the same seed as compared
to a previous version of BDSIM.</p></li>
<li><p>Memory usage for sampler hits has been significantly reduced with no affect to the output
information stored.</p></li>
<li><p>The “water” material in BDSIM is now the NIST G4_WATER material and no longer the one
that was defined by BDSIM.</p></li>
<li><p>New options for physics processes in em_extra.</p></li>
</ul>
</section>
<section id="id51">
<h3>Output Changes<a class="headerlink" href="#id51" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>Data v3 incremented from v2.</p></li>
<li><p>Options class (GMAD::optionsBase) number is incremented in output.</p></li>
<li><p>New optional stepLength variable in Eloss part of Event Tree with option
<code class="code docutils literal notranslate"><span class="pre">storeElossStepLength</span></code> to use this data.</p></li>
<li><p>New optional preStepKineticEnergy in Eloss part of Event Tree with option
<code class="code docutils literal notranslate"><span class="pre">storeElossPreStepKineticEnergy</span></code> to use this data.</p></li>
<li><p>Energy Loss class (BDSOutputROOTEventLoss) number is increment in output.</p></li>
<li><p>Tilt, offsetX, offsetY and material are added to the Model Tree output.</p></li>
<li><p>Model class (BDSOutputROOTEventModel) number is incremented in output.</p></li>
<li><p>Model information extended to provide everything necessary to make machine diagrams.</p></li>
<li><p>New option <code class="code docutils literal notranslate"><span class="pre">storeModel</span></code> to turn off model storage in the output.</p></li>
<li><p>Even Info class (BDSOutputROOTEventInfo) number is incremented in output.</p></li>
<li><p>Event.Info now has a Boolean of whether the primary particle hit something or not.</p></li>
<li><p>Samplers are <strong>no longer</strong> placed next to elements with angled faces when using the <code class="code docutils literal notranslate"><span class="pre">bdsimtwo</span></code>,
<code class="code docutils literal notranslate"><span class="pre">geant4</span></code>, or <code class="code docutils literal notranslate"><span class="pre">geant4dp</span></code> integrator sets.</p></li>
<li><p>Units are now written to the ASCII survey output for each column.</p></li>
<li><p>New output class <code class="code docutils literal notranslate"><span class="pre">BDSOutputROOTEventCoords</span></code> to store coordinates for primary global coordinates.</p></li>
<li><p>New branch called “PrimaryGlobal” in Event tree that stores the coordinates used with Geant4 in
the global Cartesian frame.</p></li>
<li><p>Sampler name now stored in Orbit output from rebdsimOrbit to make sampler matching possible.</p></li>
</ul>
</section>
<section id="id52">
<h3>Bug Fixes<a class="headerlink" href="#id52" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>Fixed solenoid tracking. The anti-spiralling code in the dipole integrator that is designed
to stop infinite spiralling of low energy particles in strong fields was causing incorrect
tracking in solenoids. This has been fixed with the re-implementation of the solenoid matrix
and now includes the fringe effects. Issue #255.</p></li>
<li><p>Fixed tracking bug where particle in very niche coordinates may reflect from a sampler
at the end of a dipole with a very strongly angled pole face. #Issue 241.</p></li>
<li><p>Fixed automatic tunnel building algorithm, which accumulated wrong variables, leading to
problems when thin elements such as fringe fields or thin multipoles were included.</p></li>
<li><p>Further improvements made to tunnel building algorithm for magnets with tilt. Issue #243.</p></li>
<li><p>Fixed length check for very short elements. Small drifts would cause a crash from
Geant4 due to invalid parameters - occurred as length check was wrong.</p></li>
<li><p>Fixed non-positive definite warnings for no energy spread and time spread when using
a Gaussian beam in a composite beam definition.</p></li>
<li><p>Fixed Gauss beams used in composite distribution.</p></li>
<li><p>Fixed the problem where no particles were being tracked when using a userfile bunch distribution with only one column.</p></li>
<li><p>Fixed bug where last particle was missed from user bunch distribution file.</p></li>
<li><p>Fixed corrupted example files for userfile bunch distribution. Issue #244.</p></li>
<li><p>Fixed cutting planes in G4CutTubs constructor for tunnel in Geant up to Geant4.10.2.p02
from too short tunnel section.</p></li>
<li><p>Reimplemented the method of finding primary first and last hit so BDSIM doesn’t need to
save the whole trajectory for the primary. This fixes the behaviour of linearly growing
unbounded memory usage when tracking for a long time in a ring. Issue #246, #242.</p></li>
<li><p>Optical calculation now works for sub-relativistic positrons.</p></li>
<li><p>ATF2 MAD-X output was not included in worked example as advertised - now included.</p></li>
<li><p>Fixed scaling variable used when scaling a field map to a decapole magnet strength.</p></li>
<li><p>Survey units for magnetic fields are now fixed from kT to T.</p></li>
<li><p>Fixed issue where C-shaped vkickers and hkickers would ignore <code class="code docutils literal notranslate"><span class="pre">yokeOnInside</span></code>. Issue #251.</p></li>
<li><p>Fixed possible overlap in vkicker, hkicker, and h-style dipole geometry with highly asymmetric
beam pipes.</p></li>
<li><p>Fixed incorrect report that beam pipe wouldn’t fit in magnet for various aperture shapes. Issue #253.</p></li>
<li><p>Fixed issue where the option <code class="code docutils literal notranslate"><span class="pre">storePrimaries</span> <span class="pre">=</span> <span class="pre">0</span></code> would result in the hits for the first sampler
being written to the primary sampler structure. Issue #245.</p></li>
<li><p>Fixed lack of interaction with vacuum when processes biased - due to a specific Geant4 version.
Issue #220.</p></li>
<li><p>Fixed incorrect dipole scaling. Issue #239.</p></li>
<li><p>Fixed E0 spread in <cite>ring</cite> beam distribution, which was finite in contrast to the description
that it is always the central value.</p></li>
<li><p>Fixed reproducibility for the <cite>ring</cite> distribution that didn’t use the same random number generator
as every other distribution. Coordinates will be different for this distribution for the same seed now.</p></li>
<li><p>Fixed inconsistency of <cite>t</cite> and <cite>z</cite> coordinate in <cite>square</cite> beam distribution.</p></li>
<li><p><cite>square</cite> beam distribution now varies with <code class="code docutils literal notranslate"><span class="pre">envelopeT</span></code>.</p></li>
<li><p>Fixed S coordinate in output. Issues #247 and #248.</p></li>
<li><p>Fixed the setting of the sampler diameter where the user specifies a smaller one than that calcualted
from the minimum bending radius.</p></li>
</ul>
</section>
<section id="id53">
<h3>Utilities<a class="headerlink" href="#id53" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>pybdsim v1.9.0</p></li>
<li><p>pymadx v1.5.0</p></li>
<li><p>pymad8 v1.4.1</p></li>
<li><p>pytransport v1.2.1</p></li>
</ul>
</section>
</section>
<section id="v1-1-2018-05-23">
<h2>V1.1 - 2018 / 05 / 23<a class="headerlink" href="#v1-1-2018-05-23" title="Link to this heading"></a></h2>
<section id="id54">
<h3>New Features<a class="headerlink" href="#id54" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>New visualiser command “/bds/beamline/goto name” to move visualiser to view a particular element.</p></li>
<li><p>Check explicitly on incompatible physics lists that may cause a crash when used together.</p></li>
</ul>
</section>
<section id="id55">
<h3>General<a class="headerlink" href="#id55" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>Global coordinates are now always stored for primary first hit.</p></li>
</ul>
</section>
<section id="id56">
<h3>Bug Fixes<a class="headerlink" href="#id56" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>Fixed wrong transforms for finite <cite>S0</cite> in composite beam distribution.</p></li>
<li><p>Fixed crash when finite <cite>S0</cite> was used with <cite>-\-generatePrimariesOnly</cite> executable option.</p></li>
<li><p>Fixed units from mm to m for PrimaryFirstHit and PrimaryLastHit for
<cite>x</cite>, <cite>y</cite>, <cite>z</cite>, <cite>X</cite>, <cite>Y</cite>, <cite>Z</cite> positions.</p></li>
<li><p>Fixed segfault for double deletion when ‘qgsp_bic’ and ‘qgsp_bert’ were attempted to be used together.</p></li>
</ul>
</section>
<section id="id57">
<h3>Utilities<a class="headerlink" href="#id57" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>pybdsim v1.6</p></li>
<li><p>pymadx v1.2</p></li>
<li><p>pymad8 v1.1</p></li>
<li><p>pytransport v1.0</p></li>
</ul>
</section>
</section>
<section id="v1-0-2018-04-10">
<h2>V1.0 - 2018 / 04 / 10<a class="headerlink" href="#v1-0-2018-04-10" title="Link to this heading"></a></h2>
<section id="id58">
<h3>Highlights<a class="headerlink" href="#id58" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>Full support for dipole fringe fields and pole faces in tracking.</p></li>
<li><p>Full low energy (sub-relativistic) tracking.</p></li>
<li><p>Validation against PTC for sub-relativistic to high energy.</p></li>
</ul>
</section>
<section id="id59">
<h3>New Features<a class="headerlink" href="#id59" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>Support for Geant4.10.4 - however, this version is unusable as G4ExtrudedSolid is
broken and used in BDSIM. We recommend Geant4.10.4.p01.</p></li>
<li><p>H-style dipoles controllable by default or per element with <cite>hStyle</cite> option.</p></li>
<li><p>Control over dipole proportions with global and per element options <cite>vhRatio</cite>,
<cite>coilWidthFraction</cite> and <cite>coilHeightFraction</cite>.</p></li>
<li><p>Support for extra Geant4 physics lists: <cite>G4ChargeExchangePhysics</cite>, <cite>G4HadronDElasticPhysics</cite>,
<cite>G4HadronElasticPhysicsHP</cite>, <cite>G4HadronElasticPhysicsLEND</cite>, <cite>G4HadronElasticPhysicsXS</cite>,
<cite>G4HadronHElasticPhysics</cite>, <cite>G4HadronPhysicsShielding</cite>, <cite>G4HadronPhysicsShieldingLEND</cite>,
<cite>G4IonElasticPhysics</cite>, <cite>G4IonQMDPhysics</cite>, <cite>G4RadioactiveDecayPhysics</cite>, <cite>G4StoppingPhysics</cite>,
<cite>G4HadronElasticPhysicsPHP</cite>, <cite>G4MuonicAtomDecayPhysics</cite>, <cite>G4NeutronTrackingCut</cite>.</p></li>
<li><p>New options <cite>neutronTrackingTime</cite>, <cite>neutronKineticEnerygLimit</cite> and <cite>useLENDGammaNuclear</cite>
(Geant4.10.4 onward) physics options.</p></li>
<li><p>Support for new numerical integrator tracking algorithms in Geant 4.10.3 and 4.10.4.</p></li>
<li><p>New integrator set “geant4dp” for Dormand Prince integrators (Geant 4.10.4 or higher required).</p></li>
<li><p>Significantly improved analysis documentation.</p></li>
<li><p>New component: ‘gap’. Creates a space in the beam line with no geometry.</p></li>
<li><p>Ability to specify the world volume material with the <cite>worldMaterial</cite> option.</p></li>
<li><p>Introduced <cite>minimumRange</cite> and <cite>minimumKineticEnergy</cite> user limits as provided by G4UserLimits.</p></li>
<li><p>Ability to limit step size in user-specified fields.</p></li>
<li><p>Ability to control turn number print out with <cite>printFractionTurns</cite>.</p></li>
<li><p>Magnet yokes now have a general multipolar field.</p></li>
<li><p>Sampler diameter is automatically reduced when high angle bends are used to prevent overlaps.</p></li>
<li><p>New CMake option to disable event display for installation with ROOT EVE problems.</p></li>
<li><p>Ability to combine rebdsim output files with correct statistical analysis, allowing high throughput
analysis with scaling. New tool <cite>rebdsimCombine</cite> for this purpose.</p></li>
<li><p>Parameter tests for all bunch distributions - BDSIM will exit with message if parameters are invalid.</p></li>
<li><p><cite>scaling</cite> parameter for each element allowing simple scaling of strengths.</p></li>
<li><p>New program to convert PTC output in a TFS file to BDSIM output format (<cite>ptc2bdsim</cite>).</p></li>
</ul>
</section>
<section id="id60">
<h3>Output Changes<a class="headerlink" href="#id60" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>The ROOT class definition has been incremented to “2” from “1”.</p></li>
<li><p>Output files now have header structure with software versions.</p></li>
<li><p>Output files now have ‘geant4 data’ that includes particle masses used in the simulation.</p></li>
<li><p>“t” is now “T” in samplers and trajectory output to be consistent with naming convention
of global and local coordinates.</p></li>
<li><p>Samplers now have optional charge, mass, rigidity and ion A and Z
(see <a class="reference internal" href="model_control.html#bdsim-options-output"><span class="std std-ref">Output Options</span></a> for details).</p></li>
<li><p>Classes in library can calculate on-the-fly for user analysis.</p></li>
<li><p>Trajectory momentum is now in GeV.</p></li>
</ul>
</section>
<section id="analysis-changes">
<h3>Analysis Changes<a class="headerlink" href="#analysis-changes" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>“<strong>librebdsimlib</strong>” has been changed to “<strong>librebdsim</strong>” to be more consistent for output loading.</p></li>
<li><p>Support for logarithmic binning of histograms in rebdsim.</p></li>
<li><p>“HistogramND” in rebdsim now creates <strong>per-entry</strong> histograms on the tree. This introduces the
ability to create per-event histograms in analysis that were not previously possible. Older
style histograms that are a sum across all events are now made with “SimpleHistogramND”.</p></li>
<li><p>New option in rebdsim to turn off histogram merging (for speed).</p></li>
<li><p>Analysis classes have member names changed to match those in the output files, i.e. “eloss” is
now “Eloss” in <cite>bdsim/analysis/Event.hh</cite>.</p></li>
<li><p>Rebdsim is now tolerant of a missing ‘.’ on the end of the Tree name (a ROOT subtlety).</p></li>
<li><p>‘orbit’ and ‘optics’ are now ‘Orbit’ and ‘Optics’ in the output.</p></li>
<li><p>New executable option for <cite>rebdsimOptics</cite> <code class="code docutils literal notranslate"><span class="pre">--emittanceOnFly</span></code> to calculate emittance
at each sampler.</p></li>
</ul>
</section>
<section id="id61">
<h3>General<a class="headerlink" href="#id61" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>Physics list names are now consistently named with ‘_’ between words. Old list
names are still supported.</p></li>
<li><p><cite>hadronic</cite> and <cite>hadronic_hp</cite> physics lists have switched from <cite>qgsp_bert</cite> and
<cite>qgsp_bert_hp</cite> to <cite>ftfp_bert</cite> and <cite>ftfp_bert_hp</cite> respectively, as these are
recommended by Geant4 for high energy hadronic interactions.</p></li>
<li><p>“bdsim” integrator set now maps to “bdsimtwo” integrator set.</p></li>
<li><p>All objects in the parser can now be extended later rather than just elements.</p></li>
<li><p>Tuned colours of hkicker and vkicker.</p></li>
<li><p>Relative file paths are no longer padded excessively with slashes when translated
to absolute paths.</p></li>
<li><p>More efficient file IO in rebdsim improves analysis speed.</p></li>
<li><p>The world material is now air instead of G4_Galactic.</p></li>
<li><p><cite>printModuloFraction</cite> is now <cite>printFractionEvents</cite>.</p></li>
<li><p><cite>includeIronMagFields</cite> option is now <cite>yokeFields</cite>.</p></li>
<li><p>Vacuum volumes now visible in <cite>-\-vis_debug</cite> mode.</p></li>
<li><p>Only forward moving particles are now considered for the optical function calculation.</p></li>
<li><p>Updated examples for ATF2, LHC. New Diamond machine example.</p></li>
</ul>
</section>
<section id="id62">
<h3>Bug Fixes<a class="headerlink" href="#id62" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>Fixed magnetic field strength for AWAKE dipole using pure dipole field.</p></li>
<li><p>User limits are now applied to external geometry.</p></li>
<li><p>Fixed bug where some visualisation settings wouldn’t be applied to all logical
volumes in external geometry.</p></li>
<li><p>Fixed bug where some file paths may not be translated to absolute paths correctly.</p></li>
<li><p>Fixed a bug where recreate mode would fail with the new Beam structure in the output.</p></li>
<li><p>Prevent segfault when analysing wrong type of file with rebdsim (use ‘backwardsCompatible’
option to analyse old files without the new header structure).</p></li>
<li><p>The <cite>stopTracks</cite> option has been removed as it did not function as intended. Use <cite>stopSecondaries</cite>.</p></li>
<li><p><cite>thresholdCutCharged</cite> and <cite>thresholdCutPhotons</cite> have been removed as they did not function as intended.</p></li>
<li><p>Fixed bug where the world size would be too small with placements of large externally provided
geometry with strong rotations.</p></li>
<li><p>When no energy was specified in the <cite>userfile</cite> bunch distribution, the central beam energy was
1000x too low - fixed - missing factory of GeV.</p></li>
<li><p>Number of turns simulated is now number desired and not number+1.</p></li>
<li><p>Limits to control maximum step length and tracking time were not attached to magnet yoke geometry.</p></li>
<li><p>Fixed crash when using octagonal or racetrack apertures in a magnet with pole geometry.</p></li>
<li><p>Fixed issue where ~10% of particles may appear offset in samplers in large ring models.</p></li>
<li><p>Fixed some very small overlaps not reported by Geant4 in magnet yoke geometry.</p></li>
<li><p>Fixed issue where drift in magnet was always 1pm shorter than expected.</p></li>
<li><p>Fringe fields are no longer built in between two dipoles against each other.</p></li>
<li><p>Fixed Gauss Twiss bunch generator for finite dispersion in <cite>x</cite>, <cite>xp</cite>, <cite>y</cite>, <cite>yp</cite>.</p></li>
<li><p>Fixed bug where overlapping dipole end pieces would be produced.</p></li>
<li><p>Fixed GDML preprocessing for parameterised variables.</p></li>
<li><p>Tracking limits are now attached to magnet yokes.</p></li>
<li><p>Fixed central value of <cite>T0</cite> not being set for <cite>circle</cite>, <cite>gauss</cite>,
<cite>gausstwiss</cite>, <cite>gaussmatrix</cite>, <cite>halo</cite> and <cite>square</cite>
distributions.</p></li>
</ul>
</section>
<section id="id63">
<h3>Utilities<a class="headerlink" href="#id63" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>pybdsim v1.4</p></li>
<li><p>pymadx v1.1</p></li>
<li><p>pymad8 v1.0</p></li>
<li><p>pytransport v1.0</p></li>
</ul>
</section>
</section>
<section id="v0-993-2017-12-11">
<h2>V0.993 - 2017 / 12 / 11<a class="headerlink" href="#v0-993-2017-12-11" title="Link to this heading"></a></h2>
<section id="id64">
<h3>New Features<a class="headerlink" href="#id64" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>Executable option <cite>-\-writeseedstate</cite> is now <cite>-\-writeSeedState</cite>.</p></li>
<li><p>Executable option <cite>-\-exportgeometryto</cite> is now <cite>-\-exportGeometryTo</cite>.</p></li>
<li><p>Executable option <cite>-\-distrfile</cite> is now <cite>-\-distrFile</cite>.</p></li>
<li><p>Redefined simpler syntax for halo distribution. Please see manual for new parameters.</p></li>
<li><p>Support for all EM physics lists included with Geant4.10.3.p03.</p></li>
<li><p>Support for an ion as the primary beam particle.</p></li>
<li><p>Support for ion physics lists.</p></li>
<li><p>Ability to load two GDML files with degenerate object names correctly compensating for
deficiency in Geant4 GDML parser.</p></li>
<li><p>Local copy of GDML schema included. No longer require internet access to load GDML files. Custom
local schema still supported.</p></li>
<li><p>Support for Geant4.10.4 - however, we don’t recommend using this until p01 is used, as there
is a fault with G4ExtrudedSolid that is used for all poled magnet geometry.</p></li>
</ul>
</section>
<section id="id65">
<h3>Bug Fixes<a class="headerlink" href="#id65" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>Compilation fixes for compilers with XCode 9.</p></li>
<li><p>Fixed possible compiler-dependent tracking bug where particle would get stuck in dipole.</p></li>
<li><p>Cherenkov radiation in water fixed with specification of optical refractive index.</p></li>
<li><p>Fixed ATF2 example input syntax and updated model.</p></li>
<li><p>Removed temporary files created in current working directory.</p></li>
</ul>
</section>
<section id="id66">
<h3>Output Changes<a class="headerlink" href="#id66" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>Options split into options and beam - beam contains all information related to beam definition.</p></li>
<li><p>Associated output classes and analysis classes added for Beam in output.</p></li>
<li><p>Removed older output format.</p></li>
</ul>
</section>
<section id="id67">
<h3>General<a class="headerlink" href="#id67" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>Updated automatic Geant4 from AFS to version 10.3.p01 (latest available).</p></li>
<li><p>Updated automatic ROOT from AFS to version 6.06.08.</p></li>
<li><p>Remove support for ROOT v5 and require v6 onward.</p></li>
</ul>
</section>
<section id="id68">
<h3>Utilities<a class="headerlink" href="#id68" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>Python utilities now use a setup.py compatible with PIP.</p></li>
<li><p>pybdsim v1.3</p></li>
<li><p>pymadx v1.0</p></li>
<li><p>pymad8 v0.8</p></li>
<li><p>pytransport v0.1 (new)</p></li>
</ul>
</section>
</section>
<section id="v0-992-2017-07-26">
<h2>V0.992 - 2017 / 07 / 26<a class="headerlink" href="#v0-992-2017-07-26" title="Link to this heading"></a></h2>
<section id="id69">
<h3>New Features<a class="headerlink" href="#id69" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>Preparsing for GDML for pygeometry generated geometry - overcomes Geant4’s GDML parser
deficiency of only allowing one GDML file to be loaded in the whole program.</p></li>
<li><p>Visualisation of multiple beam lines.</p></li>
<li><p>Option to use first sampler emittance as assumed emittance throughout lattice in optical
function calculation.</p></li>
<li><p>Additional materials for LHC tunnel and geometry.</p></li>
</ul>
</section>
<section id="id70">
<h3>Bug Fixes<a class="headerlink" href="#id70" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>Fixed uncaught exception in analysis DataLoader class construction depending on optional arguments.</p></li>
<li><p>BDSIM installation no longer dependent on build files - ROOT analysis dictionaries would use
build headers. Issues #197 and #199.</p></li>
<li><p>Fixed magnitude of B-field in rfcavity that resulted in extraordinarily strong B-fields.</p></li>
<li><p>Fixed rf E- and pill-box fields ignoring phase and being a factor of 2:math:<cite>pi</cite> too low in frequency.</p></li>
<li><p>Fixed for crash when particle was at exactly 0 in a quadrupole.</p></li>
<li><p>Fixed compiler warnings for Clang 8.1.</p></li>
<li><p>Fixed all variable shadowing throughout codebase and reintroduced compiler warning if present.</p></li>
<li><p>Fixed field transform for tilted and offset magnets. This fixes incorrect tracking for tilted
magnets when using the “bdsimtwo” integrator set for dipoles.</p></li>
</ul>
</section>
<section id="id71">
<h3>General<a class="headerlink" href="#id71" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>Separated field and geometry in rf cavity element.</p></li>
<li><p>Revised implementation of rf cavity construction for greater flexibility.</p></li>
<li><p>RF cavity phase now automatically calculated based on location in lattice.</p></li>
<li><p>Removal of old ROOT analysis scripts for very old data format.</p></li>
<li><p>Revised construction to allow construction of multiple beam lines dynamically.</p></li>
</ul>
</section>
<section id="id72">
<h3>Utilities<a class="headerlink" href="#id72" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>pymadx v0.9</p></li>
<li><p>pybdsim v1.2</p></li>
<li><p>pymad8 v0.7</p></li>
</ul>
</section>
</section>
<section id="v0-991-2017-07-04">
<h2>V0.991 - 2017 / 07 / 04<a class="headerlink" href="#v0-991-2017-07-04" title="Link to this heading"></a></h2>
<section id="id73">
<h3>Bug Fixes<a class="headerlink" href="#id73" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>Fixed simple histogram weighting with Boolean expressions in rebdsim.</p></li>
<li><p>Fixed comparator always failing.</p></li>
<li><p>Fixed loading default event information in analysis.</p></li>
<li><p>Fixed executing BDSIM from outside the directory containing the main gmad file.</p></li>
<li><p>Fixed charge dependence of thin multipole and dipole fringe integrators.</p></li>
<li><p>Scaled dipole fringe and thin multipole by momentum of particle.</p></li>
<li><p>Fixed for loading geometry files prefixed with superfluous ‘./’.</p></li>
<li><p>Fixed for duplicate run beam on icon in visualiser for Geant4.10.3 onward.</p></li>
</ul>
</section>
<section id="id74">
<h3>General<a class="headerlink" href="#id74" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>Separated Doxygen cmake into own macro.</p></li>
</ul>
</section>
<section id="id75">
<h3>Utilities<a class="headerlink" href="#id75" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>pymadx v0.9</p></li>
<li><p>pybdsim v1.1</p></li>
<li><p>pymad8 v0.7</p></li>
</ul>
</section>
</section>
<section id="v0-99-2017-06-09">
<h2>V0.99 - 2017 / 06 / 09<a class="headerlink" href="#v0-99-2017-06-09" title="Link to this heading"></a></h2>
<section id="id76">
<h3>New Features<a class="headerlink" href="#id76" title="Link to this heading"></a></h3>
<blockquote>
<div><ul class="simple">
<li><p>Parser will expand values from structures when printing. Issue #167.</p></li>
<li><p>Optical physics example and test. Issue #156.</p></li>
<li><p>Improved parser error messages. Issue #170.</p></li>
<li><p>Support for compressed input coordinate files for beam distributions using tar and gz.</p></li>
<li><p>Switch entirely to CMake labels instead of naming convention for tests.</p></li>
<li><p>AWAKE experiment code refactored into module.</p></li>
<li><p>New <em>shield</em> element that is a drift surrounded by rectangle of material.</p></li>
<li><p>New <em>placement</em> element that allows an object with geometry to be placed independent of the beam line.</p></li>
<li><p>maximumTrackLength option to limit any track in the geometry.</p></li>
<li><p>Ability to offset beam line w.r.t. world coordinates at start.</p></li>
<li><p>Check for required Geant4 environment variables.</p></li>
<li><p>Thin horizontal and vertical (and combined) kickers.</p></li>
<li><p>Thin multipoles.</p></li>
<li><p>Compatibility with Geant4.10.3.</p></li>
</ul>
</div></blockquote>
<section id="fields-integrators">
<h4>Fields &amp; Integrators<a class="headerlink" href="#fields-integrators" title="Link to this heading"></a></h4>
<blockquote>
<div><ul class="simple">
<li><p>Complete refactorisation of field classes and construction.</p></li>
<li><p>Centralised construction of fields.</p></li>
<li><p>1-4D BDSIM format field map loading.</p></li>
<li><p>2D Poisson SuperFish SF7 format field map loading.</p></li>
<li><p>1-4D nearest neighbour, linear and cubic interpolators for field maps.</p></li>
<li><p>Support for compressed field maps using tar and gz.</p></li>
<li><p>Ability to choose integrator sets for all elements via parser.</p></li>
<li><p>Removal of all individual magnet classes - centralised construction in BDSMagnet.</p></li>
<li><p>New executable - “bdsinterpolator” - allows loaded and interpolated field to be queried and written out.</p></li>
<li><p>Rewritten dipole integrator using Geant4’s helical stepper.</p></li>
<li><p>All integrators tested for low energy spiralling particles.</p></li>
<li><p>Introduction of visualisation commands.</p></li>
</ul>
</div></blockquote>
</section>
<section id="geometry">
<h4>Geometry<a class="headerlink" href="#geometry" title="Link to this heading"></a></h4>
<blockquote>
<div><ul class="simple">
<li><p>Rewritten external geometry loading.</p></li>
<li><p>Ability to overlay externally provided geometry on magnets (except sbend).</p></li>
<li><p>Automatically generated tight-fitting containers for externally loaded GDML geometry.</p></li>
<li><p><em>circularvacuum</em> beam pipe geometry that allows no geometry for the beam pipe; only vacuum.</p></li>
<li><p>Magnet colours tweaked slightly - pybdsim now matches BDSIM colour-wise.</p></li>
<li><p>Additional curvilinear bridge world to ensure continuous curvilinear coordinates.</p></li>
</ul>
</div></blockquote>
</section>
<section id="output-analysis">
<h4>Output &amp; Analysis<a class="headerlink" href="#output-analysis" title="Link to this heading"></a></h4>
<blockquote>
<div><ul class="simple">
<li><p>Protection against invalid sampler names that would cause ROOT branching errors.</p></li>
<li><p>1x 3D histogram in default output that can be placed along the beam line.</p></li>
<li><p>Support for 3D histograms in rebdsim.</p></li>
<li><p>All magnet strength components written out to survey.</p></li>
<li><p>Change of syntax in rebdsim analysis file to specify dimensions of histogram.</p></li>
<li><p>Stricter parsing of analysisConfig.txt for syntax checking.</p></li>
<li><p>New executable rebdsimOrbit to extract single orbit from sampler data.</p></li>
</ul>
</div></blockquote>
</section>
</section>
<section id="id77">
<h3>Bug Fixes<a class="headerlink" href="#id77" title="Link to this heading"></a></h3>
<blockquote>
<div><ul class="simple">
<li><p>ASCII seed state can be loaded properly. Issue #163.</p></li>
<li><p>rfcavity can be created without a cavitymodel instance. Issue #165.</p></li>
<li><p>Memory leak in comparator event tree comparison fixed. Issue #169.</p></li>
<li><p>Zero angle bend with finite field can be created. Issue #176.</p></li>
<li><p>Samplers are compared properly in comparator. Issue #177.</p></li>
<li><p>Sampler names in Model tree now match those exactly in the Event tree.</p></li>
<li><p>Missing virtual keyword from destructors fixed through to fix leaks at the end of the program.</p></li>
<li><p>GFlash parameterisation is only loaded if specified in physics list.</p></li>
<li><p>Fixed geometry construction errors that may occur due to dynamic tolerances for physically large models.</p></li>
<li><p>Fixed infinite loop events if the primary vertex starts outside the world volume.</p></li>
<li><p>Regions and biases set correctly to components in BDSLine class.</p></li>
<li><p>Circle distribution did not have central value offsets.</p></li>
<li><p>Fix double registration of pion decay as well as some others for muons when using muon physics list.</p></li>
<li><p>Particles from physics list are now constructed correctly allowing more
particles to be used in the beam definition.</p></li>
<li><p>Removal of Cherenkov radiation from muon physics significantly reducing simulation time.</p></li>
<li><p>Fix double registration of pion decay with muon physics list.</p></li>
<li><p>Issue #134 - samplers cause tracking warning.</p></li>
<li><p>Long running events due to spiralling particles. Issues #178, #132, #187.</p></li>
</ul>
</div></blockquote>
</section>
<section id="id78">
<h3>General<a class="headerlink" href="#id78" title="Link to this heading"></a></h3>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Sampler_</span></code> prefix was removed from all samplers in rootevent output.</p></li>
<li><p>Sampler thickness reduced from 40 nm to 10 pm.</p></li>
<li><p>Removal of unnecessary step length limit to half the length of an element.</p></li>
<li><p>Revised region construction allowing arbitrary number to be constructed.</p></li>
<li><p>Revised bend construction with reduced volume count in some cases.</p></li>
</ul>
</div></blockquote>
</section>
<section id="id79">
<h3>Utilities<a class="headerlink" href="#id79" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>pymadx v0.8</p></li>
<li><p>pybdsim v1.0</p></li>
<li><p>pymad8 v0.7</p></li>
</ul>
</section>
</section>
<section id="v0-95-2016-11-07">
<h2>V0.95 - 2016 / 11 / 07<a class="headerlink" href="#v0-95-2016-11-07" title="Link to this heading"></a></h2>
<section id="id80">
<h3>New Features<a class="headerlink" href="#id80" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>Comparator program introduced for statistical comparison against reference results.</p></li>
<li><p>rebdsim analysis examples and tests added.</p></li>
<li><p>ROOT examples and tests added for analysis code usage in ROOT.</p></li>
<li><p>Discrete optics only program (rebdsimOptics) added.</p></li>
<li><p>Update CLHEP in AFS build to 2.3.1.0 for apple and 2.3.3.0 for RHL6.</p></li>
<li><p>Reduced compilation time.</p></li>
</ul>
</section>
<section id="id81">
<h3>Bug Fixes<a class="headerlink" href="#id81" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>Fixed geometry tolerance issue that would cause Geant4 run-time errors for
regular geometry for some particularly large spatial size models.</p></li>
<li><p>Fixed for linker error with ZLIB and gzstream. Issues #9, #155, #158.</p></li>
<li><p>Fixed NaN errors in certain circumstances when calculating optical functions.</p></li>
<li><p>Fixed shadowing compilation warnings.</p></li>
<li><p>Fixed geometry overlaps in rf cavity geometry. Issue #136.</p></li>
<li><p>Coverity fixes for uninitialised variables / small memory leaks. Issues #152, #156.</p></li>
<li><p>Fixed potential magnet geometry errors when creating very thin components.</p></li>
<li><p>Fixed negative interaction warnings due to biasing. Issue #141.</p></li>
</ul>
</section>
<section id="id82">
<h3>General<a class="headerlink" href="#id82" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>Deprecate BDSIM Plank scattering, laserwire calorimeter and Bremsstrahlung
lead particle biasing.</p></li>
</ul>
</section>
<section id="id83">
<h3>Utilities<a class="headerlink" href="#id83" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>pymadx v0.7</p></li>
<li><p>pybdsim v0.9</p></li>
<li><p>pymad8 v0.6</p></li>
<li><p>robdsim v0.7</p></li>
</ul>
</section>
</section>
<section id="v0-94-2016-09-13">
<h2>V0.94 - 2016 / 09 / 13<a class="headerlink" href="#v0-94-2016-09-13" title="Link to this heading"></a></h2>
<section id="id84">
<h3>New Features<a class="headerlink" href="#id84" title="Link to this heading"></a></h3>
<section id="analysis">
<h4>Analysis<a class="headerlink" href="#analysis" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p>Analysis class has been refactored to allow analysis on any tree in the BDSIM
ROOT event output format using rebdsim.</p></li>
</ul>
</section>
<section id="id85">
<h4>Geometry<a class="headerlink" href="#id85" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p>Tilted dipoles are now supported.</p></li>
<li><p>The Read-Out geometry has been moved to the Geant4 parallel world scheme.</p></li>
<li><p>The parallel sensitive geometry for tunnel hits has been deprecated and the
functionality now provided by the new parallel read-out geometry.</p></li>
<li><p>The read-out geometry construction has moved out of BDSAcceleratorComponent
to its own geometry factory.</p></li>
<li><p>Beam pipes are now constructed with arbitrary 3-vector surface normals, rather
than angled faces described by an angle only in the x-z plane.</p></li>
<li><p>The side of the yoke of a dipole with poled geometry can now be controlled with
the <code class="code docutils literal notranslate"><span class="pre">yokeOnLeft</span></code> option.</p></li>
<li><p>New interfaces to the auxiliary navigator have been written that use the mid-point
of a step to much more robustly locate the required volume in the parallel
curvilinear geometry.</p></li>
<li><p>Overlap checking between adjacent dipoles with pole face rotations (and even tilts)
prevents overlaps in geometry.</p></li>
</ul>
</section>
<section id="output">
<h4>Output<a class="headerlink" href="#output" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p>Tunnel hits are now of the same type as general energy loss hits.</p></li>
<li><p>The track ID can now be optionally written out to energy deposition hits.</p></li>
</ul>
</section>
<section id="parser">
<h4>Parser<a class="headerlink" href="#parser" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p>The option <code class="code docutils literal notranslate"><span class="pre">modularPhysicsListsOn</span></code> has been deprecated.</p></li>
<li><p>New per-element parameter <code class="code docutils literal notranslate"><span class="pre">yokeOnLeft</span></code>.</p></li>
</ul>
</section>
<section id="physics">
<h4>Physics<a class="headerlink" href="#physics" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p>The modular physics lists are now compulsory and the old physics construction has
been deprecated.</p></li>
<li><p>The existing BDSIM laserwire Compton scattering process construction was moved to
the modular physics list scheme.</p></li>
</ul>
</section>
</section>
<section id="id86">
<h3>Bug Fixes<a class="headerlink" href="#id86" title="Link to this heading"></a></h3>
<section id="id87">
<h4>Geometry<a class="headerlink" href="#id87" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p>Extent inheritance with BDSGeoemetryComponent was fixed resolving rare overlaps.</p></li>
<li><p>Poled geometry variable clean up fixed to ensure components from factories aren’t
related to each other - could cause rare crash on exit.</p></li>
<li><p>Fixed extents and possible overlaps in tunnel ‘rectaboveground’ geometry.</p></li>
</ul>
</section>
<section id="id88">
<h4>Output<a class="headerlink" href="#id88" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p>Energy deposition coordinates are randomly chosen along the step of the deposition. The
x,y,z coordinates now match the random point, whereas they were the post step point previously.</p></li>
</ul>
</section>
<section id="id89">
<h4>Physics<a class="headerlink" href="#id89" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p>Fixed an issue that would cause infinite loops with strong process biasing.</p></li>
</ul>
</section>
<section id="id90">
<h4>General<a class="headerlink" href="#id90" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p>Initialisation of variables fixed throughout.</p></li>
<li><p>Significantly improved compilation speed.</p></li>
<li><p>Removed executable permission on all source files.</p></li>
</ul>
</section>
</section>
<section id="id91">
<h3>Utilities<a class="headerlink" href="#id91" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>pymadx v0.6</p></li>
<li><p>pybdsim v0.8</p></li>
<li><p>pymad8 v0.5</p></li>
<li><p>robdsim v0.7</p></li>
</ul>
</section>
</section>
<section id="v0-93-2016-08-24">
<h2>V0.93 - 2016 / 08 / 24<a class="headerlink" href="#v0-93-2016-08-24" title="Link to this heading"></a></h2>
<section id="id92">
<h3>New Features<a class="headerlink" href="#id92" title="Link to this heading"></a></h3>
<section id="id93">
<h4>Analysis<a class="headerlink" href="#id93" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p>New analysis tool ‘rebdsim’ replaces robdsim.</p></li>
<li><p>Analysis directory with event, model, event info and options analysis.</p></li>
<li><p>Histogram merging with correct statistical uncertainties.</p></li>
<li><p>Deprecated root utilities to <code class="code docutils literal notranslate"><span class="pre">analysis/old/</span></code>.</p></li>
<li><p>Rewritten optical function calculation with validated calculation.</p></li>
</ul>
</section>
<section id="build">
<h4>Build<a class="headerlink" href="#build" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p>Require CMake 2.8.12 or higher.</p></li>
<li><p>Require Geant4 compiled with external CLHEP - ensures strong reproducibility.</p></li>
<li><p>Start of bootstrapping scripts in <code class="code docutils literal notranslate"><span class="pre">depend/</span></code>.</p></li>
<li><p>Factorisation of BDSIM’s cmake package finding into <code class="code docutils literal notranslate"><span class="pre">cmake/</span></code>.</p></li>
</ul>
</section>
<section id="id94">
<h4>Geometry<a class="headerlink" href="#id94" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p>Coil geometry introduced to generic library magnets.</p></li>
<li><p>Overlap checking between magnets with pole face rotations.</p></li>
<li><p>Collimator colour can now be controlled.</p></li>
<li><p>End pieces for coils also introduced</p></li>
<li><p>Default poled dipole geometry is now a C-shaped magnet with yoke on inside of bend.</p></li>
</ul>
</section>
<section id="id95">
<h4>Output<a class="headerlink" href="#id95" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p>Switched to rootevent as default and <strong>recommended</strong> format.</p></li>
<li><p>Include full set of options used in simulation in output.</p></li>
<li><p>Include software version in output.</p></li>
<li><p>Store seed state per event.</p></li>
<li><p>Store histograms per event.</p></li>
<li><p>Run and event durations stored in output.</p></li>
<li><p>Output written in event of a crash.</p></li>
<li><p>Refactor of trajectory information.</p></li>
<li><p>Write out primary trajectory points.</p></li>
</ul>
</section>
<section id="id96">
<h4>Parser<a class="headerlink" href="#id96" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p>Factorised options into optionsBase that is simple structure for easy saving.</p></li>
</ul>
</section>
<section id="id97">
<h4>Physics<a class="headerlink" href="#id97" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p>“Modular physics” list is now the default.</p></li>
<li><p>Use geant4 helper class for physics lists construction to ensure correct order.</p></li>
<li><p>Ability to provide a default bias to all types of volumes (vacuum, accelerator, all).</p></li>
<li><p>Attribute energy deposition (uniformly) randomly along the step where it occurred for more accurate energy deposition - currently only s, not x,y,z - they represent before, after.</p></li>
<li><p>‘solid’ air materials for cross-section validation.</p></li>
<li><p>Seed states are saved and restored in the primary generator action rather than event action.</p></li>
</ul>
</section>
<section id="tracking">
<h4>Tracking<a class="headerlink" href="#tracking" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p>Geant4 Runge-Kutta stepper for quadrupole and sextupole for increased robustness.</p></li>
</ul>
</section>
<section id="id98">
<h4>General<a class="headerlink" href="#id98" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p>Strong recreation for an event by setting seed state issue (#118, #139).</p></li>
<li><p>A BDSAcceleratorComponent can own an associated end piece(s) (before and after).</p></li>
<li><p>A BDSAcceleratorComponent can have a input and output angled face.</p></li>
<li><p>Halo bunch distribution developed significantly.</p></li>
<li><p>Revised executable options for recreation / using a seed state.</p></li>
<li><p>Signal handling improved.</p></li>
<li><p>Templated user bunch file - can now use gzip compressed files.</p></li>
<li><p>Improved default options for more realistic geometry.</p></li>
</ul>
</section>
</section>
<section id="id99">
<h3>Bug Fixes<a class="headerlink" href="#id99" title="Link to this heading"></a></h3>
<section id="id100">
<h4>Geometry<a class="headerlink" href="#id100" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p>Fixed loading for multiple GDML files having conflicting ‘world’ volumes.</p></li>
<li><p>Reimplementation of pole geometry fixes gaps in poles (issue #110).</p></li>
</ul>
</section>
<section id="id101">
<h4>Parser<a class="headerlink" href="#id101" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p>Fixed issue of parser python interface (issue #133).</p></li>
</ul>
</section>
<section id="id102">
<h4>Physics<a class="headerlink" href="#id102" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p>Modular physics lists are truly modular - fixes segfaults (issue #130).</p></li>
</ul>
</section>
<section id="id103">
<h4>Tracking<a class="headerlink" href="#id103" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p>Fixes for cavity field values (issue #124).</p></li>
<li><p>Fixed field value transform in sextupoles and above for global / local coordinates.</p></li>
<li><p>Auxiliary navigator used more routinely for transforms with optional caching.</p></li>
</ul>
</section>
<section id="id104">
<h4>General<a class="headerlink" href="#id104" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p>Issues #115, #127, #129, #131</p></li>
</ul>
</section>
</section>
<section id="id105">
<h3>Utilities<a class="headerlink" href="#id105" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>pymadx v0.6</p></li>
<li><p>pybdsim v0.7</p></li>
<li><p>pymad8 v0.41</p></li>
<li><p>robdsim v0.7</p></li>
</ul>
</section>
</section>
<section id="v0-92-2016-03-29">
<h2>V0.92 - 2016 / 03 / 29<a class="headerlink" href="#v0-92-2016-03-29" title="Link to this heading"></a></h2>
<section id="id106">
<h3>New Features<a class="headerlink" href="#id106" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>Samplers are attached at the <em>exit</em> instead of the <em>entrance</em> of an element.</p></li>
<li><p>Poleface rotations for bends are implemented (issue #100).</p></li>
<li><p>Geant4 9.6.x versions support has been dropped (issue #111).</p></li>
<li><p>DUMP element removed (issue #116).</p></li>
</ul>
<section id="id107">
<h4>Geometry<a class="headerlink" href="#id107" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p>Samplers are no longer placed in the physical world but in a parallel sampler world.</p></li>
<li><p>Above ground ‘tunnel’ geometry implemented.</p></li>
<li><p>Introduced new RF cavity geometry and fields (still in development).</p></li>
</ul>
</section>
<section id="id108">
<h4>Output<a class="headerlink" href="#id108" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p>ROOT version 6 support (issue #114).</p></li>
<li><p>Option to fill ROOT with double or float precision.</p></li>
</ul>
</section>
<section id="id109">
<h4>Parser<a class="headerlink" href="#id109" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p>Support for string variable (issue #126).</p></li>
</ul>
</section>
<section id="id110">
<h4>Physics<a class="headerlink" href="#id110" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p>Modular physics lists are default (issue #121).</p></li>
<li><p>Use Geant4 provided synchrotron radiation instead of BDSIM one.</p></li>
</ul>
</section>
</section>
<section id="id111">
<h3>Bug fixes<a class="headerlink" href="#id111" title="Link to this heading"></a></h3>
<section id="id112">
<h4>Geometry<a class="headerlink" href="#id112" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p>Tunnel geometry fixes (issues #88 and #89).</p></li>
</ul>
</section>
<section id="id113">
<h4>Parser<a class="headerlink" href="#id113" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p>Fixed fast list insertion (issue #113).</p></li>
<li><p>Support for tildes in path names (issue #119).</p></li>
</ul>
</section>
<section id="id114">
<h4>Physics<a class="headerlink" href="#id114" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p>Old physics code cleanup (issue #123).</p></li>
<li><p>Physics biasing properly initialised (issue #84).</p></li>
</ul>
</section>
<section id="id115">
<h4>General<a class="headerlink" href="#id115" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p>PDF Manual builds on Ubuntu (issue #85).</p></li>
<li><p>1D Histogram class significantly faster for uneven bin width histograms.</p></li>
</ul>
</section>
</section>
<section id="id116">
<h3>Utilities<a class="headerlink" href="#id116" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>pymadx v0.4</p></li>
<li><p>pybdsim v0.5</p></li>
<li><p>pymad8 v0.3</p></li>
<li><p>robdsim v0.5</p></li>
</ul>
</section>
</section>
<section id="v0-91-2015-12-17">
<h2>V0.91 - 2015 / 12 / 17<a class="headerlink" href="#v0-91-2015-12-17" title="Link to this heading"></a></h2>
<section id="id117">
<h3>New Features<a class="headerlink" href="#id117" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>New tests for file IO, coordinate transforms, aperture models, extra optical lattice patterns and general ring examples.</p></li>
</ul>
<section id="id118">
<h4>Geometry<a class="headerlink" href="#id118" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p>Race track and octagonal aperture models introduced.</p></li>
<li><p>New wedged energy degrader component introduced.</p></li>
</ul>
</section>
<section id="id119">
<h4>Output<a class="headerlink" href="#id119" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p>Optional reduced number of variables in ROOT output - formats now “root” and “rootdetailed” (issue #107)</p></li>
<li><p>Forced dependency on ROOT</p></li>
</ul>
</section>
<section id="id120">
<h4>Parser<a class="headerlink" href="#id120" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p>Parser warns for redefined variable, and exits for usage of undeclared variables (issue #98)</p></li>
<li><p>Parser reorganised to C++ class structure (issue #77)</p></li>
<li><p>Command line options more flexible (issue #105)</p></li>
<li><p>Ability to define Geant4 regions as objects in parser.</p></li>
<li><p>Can attach samplers to all elements of one type (i.e. collimators).</p></li>
</ul>
</section>
<section id="id121">
<h4>Physics<a class="headerlink" href="#id121" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p>Can attach biasing to any part of any element from parser.</p></li>
</ul>
</section>
<section id="id122">
<h4>Tracking<a class="headerlink" href="#id122" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p>Ability to start bunch from any S-position along accelerator, rather than just at beginning.</p></li>
</ul>
</section>
</section>
<section id="id123">
<h3>Bug fixes<a class="headerlink" href="#id123" title="Link to this heading"></a></h3>
<section id="id124">
<h4>Geometry<a class="headerlink" href="#id124" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p>Fixed for LHC detailed geometry when beam shield is rotated.</p></li>
<li><p>Consolidation and improvement of aperture parameter validity testing.</p></li>
<li><p>Fixed for femtometre occasional overlaps in magnet outer geometry.</p></li>
<li><p>Fixed placement overlaps in rbend.</p></li>
<li><p>Fixed segfault with RfCavity at end of run.</p></li>
<li><p>Fixed crashes with zero angle sector bends.</p></li>
</ul>
</section>
<section id="id125">
<h4>Parser<a class="headerlink" href="#id125" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p>Multiple command line arguments without space will now be recognised and highlighted.</p></li>
</ul>
</section>
<section id="id126">
<h4>Physics<a class="headerlink" href="#id126" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p>Made required version of Geant4 consistent across biasing code.</p></li>
</ul>
</section>
<section id="id127">
<h4>Tracking<a class="headerlink" href="#id127" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p>Fields only constructed if non-zero strength used - avoids tracking errors for zero strength components.</p></li>
<li><p>Fixed several issues with vertical and horizontal kicker construction and tracking.</p></li>
<li><p>Broken external magnet fields disabled by default.</p></li>
<li><p>Circular turn counting bugs fixed.</p></li>
<li><p>Particles no longer killed with circular flag on if starting slightly behind starting midpoint.</p></li>
<li><p>Particles no longer stepped by teleporter at beginning of 1st turn if starting behind starting midpoint.</p></li>
<li><p>Fixed teleporter tracking for backwards travelling particles that would get stuck in a loop.</p></li>
</ul>
</section>
<section id="id128">
<h4>General<a class="headerlink" href="#id128" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p>Add CMake protection against Geant4 built with multithreading on (issue #103).</p></li>
</ul>
</section>
</section>
<section id="id129">
<h3>Utilities<a class="headerlink" href="#id129" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>pymadx v0.3</p></li>
<li><p>pybdsim v0.4</p></li>
<li><p>pymad8 v0.2</p></li>
<li><p>robdsim v0.4</p></li>
</ul>
</section>
</section>
<section id="v0-9-2015-11-10">
<h2>V0.9 - 2015 / 11 / 10<a class="headerlink" href="#v0-9-2015-11-10" title="Link to this heading"></a></h2>
<section id="id130">
<h3>New Features<a class="headerlink" href="#id130" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>Physics biasing with ability to change cross-section for individual particles
and processes, as well as attach to a variety of objects</p></li>
<li><p>Decapole magnet</p></li>
<li><p>Robdsim analysis package as separate executable for testing</p></li>
<li><p>Tracking tester</p></li>
<li><p>Improved C++11 use and iterator implementation across containers</p></li>
<li><p>Can fill histogram with energy hit over a range covering several bins</p></li>
<li><p>Introduced a separate auxiliary G4Navigator to avoid accidentally moving
the particle during tracking when querying global-to-local transforms.</p></li>
<li><p>Transform for curvilinear coordinates to global coordinates
so primaries in those coordinates can be injected from anywhere (issue #63)</p></li>
<li><p>Parser put in GMAD namespace</p></li>
<li><p>New executable options for writing out geometry coordinates as built by BDSIM</p></li>
<li><p>Magnets now have tightly fitting invisible container volumes, as opposed to
large boxes before.</p></li>
<li><p>Changed return type of magnet outer geometry factories to new BDSMagnetOuter
class. This is because the container construction is now delegated to the
magnet outer factory for tight-fitting container volumes.</p></li>
<li><p>Extended examples and tests</p></li>
<li><p>Move entirely to Geant4 visualisation manager supporting all available visualisers
available with the local Geant4 installation</p></li>
</ul>
</section>
<section id="id131">
<h3>Bug fixes<a class="headerlink" href="#id131" title="Link to this heading"></a></h3>
<section id="id132">
<h4>Geometry<a class="headerlink" href="#id132" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p>Fixed bug where the read-out coordinates would also be offset by the offset
of the element.</p></li>
<li><p>Fixed overlaps in read out geometry.</p></li>
<li><p>Reduced duplication in magnet outer factories.</p></li>
<li><p>Fixed overlaps in rbend geometry (issue #64).</p></li>
<li><p>Increased tolerance for sector bends (issue #73).</p></li>
<li><p>Protected against zero angle sector bends (issue #74).</p></li>
<li><p>Fixed overlaps in GDML geometry (issue #81).</p></li>
<li><p>Geometry fixes (issues #76, 94, 95)</p></li>
</ul>
</section>
<section id="id133">
<h4>Physics<a class="headerlink" href="#id133" title="Link to this heading"></a></h4>
</section>
<section id="id134">
<h4>Parser<a class="headerlink" href="#id134" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p>Occasional material parser segfault fixed (issue #25)</p></li>
<li><p>Improved syntax checking and to not ignore unknown keywords (issue #71)</p></li>
<li><p>Element extension fixed (issue #87)</p></li>
</ul>
</section>
<section id="id135">
<h4>Tracking<a class="headerlink" href="#id135" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p>Dipole uses local coordinates and can bend in any direction (issue #78)</p></li>
</ul>
</section>
<section id="id136">
<h4>General<a class="headerlink" href="#id136" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p>Samplers can be attached to occurrence of a duplicated element (issue #47).</p></li>
<li><p>Output survey updated and fixed (issue #60)</p></li>
<li><p>Check for Geant4 environment variables (issue #62)</p></li>
<li><p>Consistent policy for overwriting output files (issue #65)</p></li>
<li><p>Improved memory and CPU for output writing (issue #86)</p></li>
</ul>
</section>
</section>
<section id="id137">
<h3>Utilities<a class="headerlink" href="#id137" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>pymadx v0.2</p></li>
<li><p>pybdsim v0.3</p></li>
<li><p>pymad8 v0.2</p></li>
<li><p>robdsim v0.3</p></li>
</ul>
</section>
</section>
<section id="v0-8-2015-08-10">
<h2>V0.8 - 2015 / 08 / 10<a class="headerlink" href="#v0-8-2015-08-10" title="Link to this heading"></a></h2>
<section id="id138">
<h3>New Features<a class="headerlink" href="#id138" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>Tunnel geometry and flexible tunnel factories for different styles</p></li>
<li><p>Tunnel read out geometry introduced for coordinates along tunnel axis</p></li>
<li><p>C++11 adopted (required)</p></li>
<li><p><cite>stopSecondaries</cite> option</p></li>
<li><p>Removed dependency on boost (issue #57)</p></li>
<li><p>Restructured examples directory - top level contains only full machines
and sub-directories contain features</p></li>
<li><p>Example documentation in manual and in place beside each example with
example screenshots</p></li>
<li><p>Updated python utilities <em>pybdsim v0.1</em>, <em>pymadx v0.1</em>, <em>pymad8 v0.1</em> and <em>robdsim v0.2</em></p></li>
<li><p>Repeated components are not duplicated in memory - previously, they would
be repeatedly constructed. Reduced memory footprint.</p></li>
<li><p>Component information comes from Physical Volumes instead of Logical Volumes</p></li>
<li><p>Improved manual documentation</p></li>
<li><p>Improved Doxygen documentation</p></li>
<li><p>Rubbish collection for all objects, rather than relying on only one run and
Geant4 (partial) rubbish collection.</p></li>
<li><p>String representation of enum types leading to more readable output</p></li>
<li><p>Introduced ability to switch to new modular physics lists with flexible
construction and addition of physics lists without hard-coded names for each
combination - the user must turn this on explicitly</p></li>
</ul>
</section>
<section id="id139">
<h3>Bug fixes<a class="headerlink" href="#id139" title="Link to this heading"></a></h3>
<section id="id140">
<h4>Geometry<a class="headerlink" href="#id140" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p>Geometry overlaps (issues #55 and #58)</p></li>
<li><p>Transform3d fix (issue #54)</p></li>
<li><p>Fixed placement of objects outside x,z global plane - rotation bug, similarly
for read-out geometry placement.</p></li>
<li><p>Fixed broken circular control - bug was introduced in v0.7 - (issue #51).</p></li>
<li><p>Strict checking of read out geometry construction to avoid invalid solids that
would cause Geant4 to exit and BDSIM to crash.</p></li>
<li><p>Strict checking on teleporter volume construction for circular machines that
would cause Geant4 to exit and BDSIM to crash.</p></li>
<li><p>Fixed calculation of length of sector bend magnet that would cause it to be
slightly short - introduced in v0.7.</p></li>
<li><p>Removed stored axes of rotation due to better implementation in BDSBeamline,
avoiding duplication of information.</p></li>
<li><p>Fixed issue of zero angle rbends causing a crash (issue #44).</p></li>
<li><p>Event number print-out is now dynamic and based on the number of events to be
generated. It is also controllable with the <cite>printModuloFraction</cite> option.</p></li>
<li><p>Protected against bad user-specified values of <cite>lengthSafety</cite> to avoid
geometry overlaps.</p></li>
<li><p>Improved parser speed.</p></li>
</ul>
</section>
<section id="id141">
<h4>Physics<a class="headerlink" href="#id141" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p>SR radiation fixed in dipole (issue #53).</p></li>
<li><p>Removed continuous synchrotron radiation, as it traps particles in low step-size
infinite loop.</p></li>
<li><p>Removal of poorly set deltaIntersection, chordStepMinimum and lengthSafety
variables from examples - these should be left unset unless the user knows
their purpose.</p></li>
</ul>
</section>
<section id="id142">
<h4>Output<a class="headerlink" href="#id142" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p>Changed all transverse output units to <strong>metres</strong> - manual updated accordingly.</p></li>
<li><p>Changed <cite>z</cite> in ASCII output to <strong>global Z</strong> instead of local z.</p></li>
<li><p>Recorded energy in output is now unweighted, but energy recorded in convenient
energy loss histogram is. Could have lead to double weighting previously.</p></li>
<li><p>Fixed global coordinates being written out as local coordinates in ROOT
output.</p></li>
<li><p>Random number generator seed state not written out when no output is specified.</p></li>
</ul>
</section>
<section id="id143">
<h4>Parser<a class="headerlink" href="#id143" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p>Return error if superfluous arguments are present (issue #56).</p></li>
<li><p>Make parser more robust against duplicate element names (issue #43).</p></li>
<li><p>Fixed warnings about compiling c as c++ being deprecated behaviour.</p></li>
</ul>
</section>
<section id="id144">
<h4>General<a class="headerlink" href="#id144" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p>Fixed wrong print out warning due to logic error (issue #51).</p></li>
<li><p>Fixed boundary effects of energy deposition (issue #52).</p></li>
<li><p>Fixed large memory leak for events with large number of particles - was due to
accumulation of BDSTrajectory objects.</p></li>
</ul>
</section>
</section>
</section>
<section id="v0-702-2015-07-28-hotfix">
<h2>V0.702 2015 / 07 / 28 - Hotfix<a class="headerlink" href="#v0-702-2015-07-28-hotfix" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p>Fixes for physics production range cuts were not obeyed in simulation.</p></li>
</ul>
</section>
<section id="v0-701-2015-07-02-hotfix">
<h2>V0.701 2015 / 07 / 02 - Hotfix<a class="headerlink" href="#v0-701-2015-07-02-hotfix" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p>Fix for global X-coordinate not written to output for energy deposition.</p></li>
</ul>
</section>
<section id="v0-7-2015-06-30">
<h2>V0.7 - 2015 / 06 / 30<a class="headerlink" href="#v0-7-2015-06-30" title="Link to this heading"></a></h2>
<section id="id145">
<h3>New Features<a class="headerlink" href="#id145" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>Ability to write no output</p></li>
<li><p>New magnet geometry factories introduced with seven possible magnet types.</p></li>
<li><p>Introduction of –vis_debug flag to see container volumes without debug build.</p></li>
<li><p>Revised magnet colours (same base colour, just prettier variant)</p></li>
<li><p>New manual using sphinx documentation system</p></li>
<li><p>Default visualiser provided - no requirement for a vis.mac by the user</p></li>
<li><p>Nicer visualisation GUI by default</p></li>
<li><p>Improved visualisation for GDML geometry</p></li>
<li><p>Support for all Geant4 visualisers introduced (issue #11).</p></li>
</ul>
</section>
<section id="id146">
<h3>Bug fixes<a class="headerlink" href="#id146" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>Fixed overlapping volumes and tracking errors in beam pipes.</p></li>
<li><p>Fixes for wrong transverse coordinates for geometry other than cylindrical magnets (issue #30).</p></li>
<li><p>Histograms are now written to disk in case of crash or kill signal (issue #38).</p></li>
<li><p>Fix for uncontrolled memory consumption for synchrotron radiation (issue #36).</p></li>
<li><p>Fixed syntax error in parser on windows end of line character (issue #40).</p></li>
<li><p>Follow user paths properly (issue #24).</p></li>
<li><p>Parser can end on commented line (issue #41).</p></li>
<li><p>Introduction of more flexible and weighted halo bunch distribution.</p></li>
<li><p>Significant tidy of BDSAcceleratorComponent base class and derived classes.</p></li>
<li><p>Fix LHC magnet geometry overlaps and improve efficiency as well as more flexible with different beam pipes.</p></li>
<li><p>New BDSBeamline class used for component placement consistently in code.</p></li>
</ul>
</section>
</section>
<section id="v0-65-2015-04-10">
<h2>V0.65 - 2015 / 04 / 10<a class="headerlink" href="#v0-65-2015-04-10" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p>New base class for any geometrical object BDSGeometryComponent</p></li>
<li><p>New interchangeable beam pipes with six possible beam pipe shapes</p></li>
<li><p>New sensitive detector manager to hold single instance of sd classes</p></li>
<li><p>Introduction of G4Galactic material for ‘empty’ volumes rather than beam pipe vacuum</p></li>
<li><p>Possibility to write to multiple output formats at once</p></li>
<li><p>Extensive removal of unnecessary headers throughout</p></li>
<li><p>Updated python utilities</p></li>
<li><p>Fix for muon spoiler magnetic field (thanks to B. Pilicer)</p></li>
<li><p>Fix for invisible cylinder of iron surrounding drifts previously</p></li>
</ul>
</section>
<section id="v0-64-2015-02-16">
<h2>V0.64 - 2015 / 02 / 16<a class="headerlink" href="#v0-64-2015-02-16" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p>New histogram manager and factorisation of histograms from outputs</p></li>
<li><p>Extra per-element histograms</p></li>
<li><p>Basic implementation of valid solenoid</p></li>
</ul>
</section>
<section id="v0-63-2015-02-06">
<h2>V0.63 - 2015 / 02 / 06<a class="headerlink" href="#v0-63-2015-02-06" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p>Large angle sbends split into multiple sbends, based on aperture error tolerance - currently 1mm.</p></li>
<li><p>New geometry construction and placement for sbends and rbends - no overlapping volumes and
simpler / increased performance</p></li>
<li><p>Proper building under c++11 if available</p></li>
<li><p>Introduction of composite bunch distribution</p></li>
<li><p>Drop support for Geant4 versions 9.5 and older</p></li>
</ul>
</section>
<section id="v0-62-2014-08-07">
<h2>V0.62 - 2014 / 08 / 07<a class="headerlink" href="#v0-62-2014-08-07" title="Link to this heading"></a></h2>
</section>
<section id="v0-61-2014-08-05">
<h2>V0.61 - 2014 / 08 / 05<a class="headerlink" href="#v0-61-2014-08-05" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p>Geant4 version 10 support</p></li>
</ul>
</section>
<section id="v0-6-2013-12-02">
<h2>v0.6 - 2013 / 12 / 02<a class="headerlink" href="#v0-6-2013-12-02" title="Link to this heading"></a></h2>
</section>
<section id="v0-5-2008-11-08">
<h2>v0.5 - 2008 / 11 / 08<a class="headerlink" href="#v0-5-2008-11-08" title="Link to this heading"></a></h2>
</section>
<section id="v0-4-2008-02-26">
<h2>v0.4 - 2008 / 02 / 26<a class="headerlink" href="#v0-4-2008-02-26" title="Link to this heading"></a></h2>
</section>
<section id="v0-3-2007-01-26">
<h2>v0.3 - 2007 / 01 / 26<a class="headerlink" href="#v0-3-2007-01-26" title="Link to this heading"></a></h2>
</section>
<section id="v0-2-2006-05-18">
<h2>v0.2 - 2006 / 05 / 18<a class="headerlink" href="#v0-2-2006-05-18" title="Link to this heading"></a></h2>
</section>
<section id="v0-1-2006-02-22">
<h2>v0.1 - 2006 / 02 / 22<a class="headerlink" href="#v0-1-2006-02-22" title="Link to this heading"></a></h2>
</section>
<section id="beta-2005-05-01">
<h2>beta - 2005 / 05 / 01<a class="headerlink" href="#beta-2005-05-01" title="Link to this heading"></a></h2>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="support.html" class="btn btn-neutral float-left" title="Support" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="developer.html" class="btn btn-neutral float-right" title="Developer Documentation" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright Beam Delivery Simulation (BDSIM) Copyright (c) Royal Holloway, University of London, 2001 - 2025.
      <span class="lastupdated">Last updated on Jun 13, 2025.
      </span></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
    <!-- Theme Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-JYMKZHVZJ2"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-JYMKZHVZJ2', {
          'anonymize_ip': false,
      });
    </script> 

</body>
</html>