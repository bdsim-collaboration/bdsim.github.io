<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Model Construction &mdash; BDSIM 1.7.7.develop documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="_static/graphviz.css?v=fd3f3429" />

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js?v=5d32c60e"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="_static/documentation_options.js?v=106dc6df"></script>
        <script src="_static/doctools.js?v=9a2dae69"></script>
        <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Model Control" href="model_control.html" />
    <link rel="prev" title="Input Syntax" href="input_syntax.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            BDSIM
              <img src="_static/bdsim-logo-small.jpg" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                1.7.7.develop
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">User Guide</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="licence.html">Licence &amp; Disclaimer</a></li>
<li class="toctree-l1"><a class="reference internal" href="authorship.html">Authorship</a></li>
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="running.html">Running BDSIM</a></li>
<li class="toctree-l1"><a class="reference internal" href="input_syntax.html">Input Syntax</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Model Construction</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#lattice-description">Lattice Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="#circular-machines">Circular Machines</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#terminator">Terminator</a></li>
<li class="toctree-l3"><a class="reference internal" href="#teleporter">Teleporter</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#beamline-starting-point">Beamline Starting Point</a></li>
<li class="toctree-l2"><a class="reference internal" href="#magnet-strength-polarity">Magnet Strength Polarity</a></li>
<li class="toctree-l2"><a class="reference internal" href="#synchronous-time-and-phase">Synchronous Time and Phase</a></li>
<li class="toctree-l2"><a class="reference internal" href="#acceleration">Acceleration</a></li>
<li class="toctree-l2"><a class="reference internal" href="#beamline-elements">Beamline Elements</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#simple-example-extend-and-copy">Simple example, extend and copy</a></li>
<li class="toctree-l3"><a class="reference internal" href="#component-strength-scaling">Component Strength Scaling</a></li>
<li class="toctree-l3"><a class="reference internal" href="#magnet-yoke-field-scaling">Magnet Yoke Field Scaling</a></li>
<li class="toctree-l3"><a class="reference internal" href="#drift">drift</a></li>
<li class="toctree-l3"><a class="reference internal" href="#rbend">rbend</a></li>
<li class="toctree-l3"><a class="reference internal" href="#sbend">sbend</a></li>
<li class="toctree-l3"><a class="reference internal" href="#quadrupole">quadrupole</a></li>
<li class="toctree-l3"><a class="reference internal" href="#sextupole">sextupole</a></li>
<li class="toctree-l3"><a class="reference internal" href="#octupole">octupole</a></li>
<li class="toctree-l3"><a class="reference internal" href="#decapole">decapole</a></li>
<li class="toctree-l3"><a class="reference internal" href="#multipole">multipole</a></li>
<li class="toctree-l3"><a class="reference internal" href="#thinmultipole">thinmultipole</a></li>
<li class="toctree-l3"><a class="reference internal" href="#vkicker">vkicker</a></li>
<li class="toctree-l3"><a class="reference internal" href="#hkicker">hkicker</a></li>
<li class="toctree-l3"><a class="reference internal" href="#kicker">kicker</a></li>
<li class="toctree-l3"><a class="reference internal" href="#tkicker">tkicker</a></li>
<li class="toctree-l3"><a class="reference internal" href="#rf">rf</a></li>
<li class="toctree-l3"><a class="reference internal" href="#rfx-rfy">rfx &amp; rfy</a></li>
<li class="toctree-l3"><a class="reference internal" href="#target">target</a></li>
<li class="toctree-l3"><a class="reference internal" href="#rcol">rcol</a></li>
<li class="toctree-l3"><a class="reference internal" href="#ecol">ecol</a></li>
<li class="toctree-l3"><a class="reference internal" href="#jcol">jcol</a></li>
<li class="toctree-l3"><a class="reference internal" href="#jcoltip">jcoltip</a></li>
<li class="toctree-l3"><a class="reference internal" href="#degrader">degrader</a></li>
<li class="toctree-l3"><a class="reference internal" href="#muspoiler">muspoiler</a></li>
<li class="toctree-l3"><a class="reference internal" href="#shield">shield</a></li>
<li class="toctree-l3"><a class="reference internal" href="#dump">dump</a></li>
<li class="toctree-l3"><a class="reference internal" href="#solenoid">solenoid</a></li>
<li class="toctree-l3"><a class="reference internal" href="#wirescanner">wirescanner</a></li>
<li class="toctree-l3"><a class="reference internal" href="#laser">laser</a></li>
<li class="toctree-l3"><a class="reference internal" href="#gap">gap</a></li>
<li class="toctree-l3"><a class="reference internal" href="#crystalcol">crystalcol</a></li>
<li class="toctree-l3"><a class="reference internal" href="#undulator">undulator</a></li>
<li class="toctree-l3"><a class="reference internal" href="#transform3d">transform3d</a></li>
<li class="toctree-l3"><a class="reference internal" href="#rmatrix">rmatrix</a></li>
<li class="toctree-l3"><a class="reference internal" href="#thinrmatrix">thinrmatrix</a></li>
<li class="toctree-l3"><a class="reference internal" href="#element">element</a></li>
<li class="toctree-l3"><a class="reference internal" href="#marker">marker</a></li>
<li class="toctree-l3"><a class="reference internal" href="#ct">ct</a></li>
<li class="toctree-l3"><a class="reference internal" href="#muoncooler">muoncooler</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#offsets-tilts-component-misalignment">Offsets &amp; Tilts - Component Misalignment</a></li>
<li class="toctree-l2"><a class="reference internal" href="#lattice-sequence">Lattice Sequence</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#line">Line</a></li>
<li class="toctree-l3"><a class="reference internal" href="#use-defining-which-line-to-use">use - Defining which Line to Use</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#multiple-beam-lines">Multiple Beam Lines</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#examples">Examples</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#detectors">Detectors</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#beam-loss-monitors">Beam Loss Monitors</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#blm-shapes">BLM Shapes</a></li>
<li class="toctree-l4"><a class="reference internal" href="#blm-output">BLM Output</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id11">Examples</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="model_control.html">Model Control</a></li>
<li class="toctree-l1"><a class="reference internal" href="model_customisation.html">Model Customisation</a></li>
<li class="toctree-l1"><a class="reference internal" href="model_conversion.html">Model Conversion</a></li>
<li class="toctree-l1"><a class="reference internal" href="externalgeometry.html">External Geometry Formats</a></li>
<li class="toctree-l1"><a class="reference internal" href="output.html">Output</a></li>
<li class="toctree-l1"><a class="reference internal" href="output_analysis.html">Output Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="python_utilities.html">Python Utilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="visualisation.html">Visualisation</a></li>
<li class="toctree-l1"><a class="reference internal" href="interfacing.html">Interfacing</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Examples &amp; Tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="support.html">Support</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="history.html">Version History</a></li>
<li class="toctree-l1"><a class="reference internal" href="developer.html">Developer Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="model_description.html">Model Description</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">BDSIM</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Model Construction</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/model_construction.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="model-construction">
<span id="id1"></span><h1>Model Construction<a class="headerlink" href="#model-construction" title="Link to this heading"></a></h1>
<p>The following sections describe the basics of how to prepare a BDSIM model.</p>
<ul class="simple">
<li><p><a class="reference internal" href="#lattice-description"><span class="std std-ref">Lattice Description</span></a></p></li>
<li><p><a class="reference internal" href="#circular-machines"><span class="std std-ref">Circular Machines</span></a></p></li>
<li><p><a class="reference internal" href="#beamline-starting-point"><span class="std std-ref">Beamline Starting Point</span></a></p></li>
<li><p><a class="reference internal" href="#magnet-strength-polarity"><span class="std std-ref">Magnet Strength Polarity</span></a></p></li>
<li><p><a class="reference internal" href="#synchronous-time-and-phase"><span class="std std-ref">Synchronous Time and Phase</span></a></p></li>
<li><p><a class="reference internal" href="#lattice-elements"><span class="std std-ref">Beamline Elements</span></a></p></li>
<li><p><a class="reference internal" href="#offsets-and-tilts"><span class="std std-ref">Offsets &amp; Tilts - Component Misalignment</span></a></p></li>
<li><p><a class="reference internal" href="#lattice-sequence"><span class="std std-ref">Lattice Sequence</span></a></p></li>
<li><p><a class="reference internal" href="#multiple-beamlines"><span class="std std-ref">Multiple Beam Lines</span></a></p></li>
<li><p><a class="reference internal" href="#detectors"><span class="std std-ref">Detectors</span></a></p></li>
</ul>
<section id="lattice-description">
<span id="id2"></span><h2>Lattice Description<a class="headerlink" href="#lattice-description" title="Link to this heading"></a></h2>
<p>A model of the accelerator is given to BDSIM via input text files in the <a class="reference internal" href="input_syntax.html#gmad-syntax"><span class="std std-ref">GMAD Syntax</span></a>.
The overall program structure should follow:</p>
<ol class="arabic simple">
<li><p>Component definition (see <a class="reference internal" href="#lattice-elements"><span class="std std-ref">Beamline Elements</span></a>)</p></li>
<li><p>Sequence definition using defined components (see <a class="reference internal" href="#lattice-sequence"><span class="std std-ref">Lattice Sequence</span></a>)</p></li>
<li><p>Which sequence to use (see <a class="reference internal" href="#the-use-command"><span class="std std-ref">use - Defining which Line to Use</span></a>)</p></li>
<li><p>Where to record output (see <a class="reference internal" href="model_control.html#sampler-output"><span class="std std-ref">Output at a Surface - Samplers</span></a>)</p></li>
<li><p>Options, including which physics lists, number to simulate etc. (see <a class="reference internal" href="model_control.html#bdsim-options"><span class="std std-ref">Options</span></a>)</p></li>
<li><p>A beam definition (see <a class="reference internal" href="model_control.html#beam-parameters"><span class="std std-ref">Beam Parameters</span></a>)</p></li>
</ol>
<ul class="simple">
<li><p>Specifying and option or definition again, will overwrite the previous value.</p></li>
<li><p>The only <strong>order specific</strong> part is the <strong>use</strong> command (see <a class="reference internal" href="#the-use-command"><span class="std std-ref">use - Defining which Line to Use</span></a>) as this
copied whatever sequence is <em>used</em> at that point, so any further updates to the component
definitions will not be observed.</p></li>
<li><p>Apart from this, all other parts can be defined or redefined in any order in the input.</p></li>
<li><p>A beam line (using a sequence / line and the <code class="code docutils literal notranslate"><span class="pre">use</span></code> command are optional.</p></li>
</ul>
<p>These are described in the following sections. Aside from these standard parameters, more
detail may be added to the model through customisation - see <a class="reference internal" href="model_customisation.html#model-customisation"><span class="std std-ref">Model Customisation</span></a>.</p>
</section>
<section id="circular-machines">
<span id="id3"></span><h2>Circular Machines<a class="headerlink" href="#circular-machines" title="Link to this heading"></a></h2>
<p>To simulate circular machines, BDSIM should be executed with the <code class="code docutils literal notranslate"><span class="pre">--circular</span></code> executable option
(see <a class="reference internal" href="running.html#executable-options"><span class="std std-ref">Executable Options</span></a>), or with the <code class="code docutils literal notranslate"><span class="pre">option,</span> <span class="pre">circular=1;</span></code> in the input GMAD file. This
installs special beam line elements called the <cite>teleporter</cite> and <cite>terminator</cite> at the end of the lattice
that are described below.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>There must be a minimum <span class="math notranslate nohighlight">\(0.2 \mu m\)</span> gap between the last element and the beginning
of the sequence to accommodate these elements. This has a minimal impact on tracking.</p>
</div>
<p>Both the terminator and teleporter are invisible and very thin elements that are not normally
shown in the visualiser. These can be visualised by executing BDSIM with the <code class="code docutils literal notranslate"><span class="pre">--vis_debug</span></code>
executable option.</p>
<p>The turn number is automatically stored in the energy loss output in the data when the
circular option is used.</p>
<section id="terminator">
<h3>Terminator<a class="headerlink" href="#terminator" title="Link to this heading"></a></h3>
<p>In a Geant4 / BDSIM model, all particles are tracked down to zero energy or until they leave the world
volume. In the case of a circular accelerator, the particles may circulate indefinitely as they lose
no energy traversing the magnetic fields. To control this behaviour and limit the number of turns
taken in the circular machine, the terminator is inserted. This is a very thin disk that has
dynamic limits attached to it. It is normally transparent to all particles and composed of vacuum.
After the desired number of turns of the primary particle has elapsed, it switches to being
an infinite absorber. It achieves this by setting limits (G4UserLimits) with a maximum allowed energy
of 0eV.</p>
<p>The user should set the option <cite>nturns</cite> (default 1) (see <a class="reference internal" href="model_control.html#options-common"><span class="std std-ref">Common Options</span></a>).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">option</span><span class="p">,</span> <span class="n">nturns</span><span class="o">=</span><span class="mi">56</span><span class="p">;</span>
</pre></div>
</div>
</section>
<section id="teleporter">
<h3>Teleporter<a class="headerlink" href="#teleporter" title="Link to this heading"></a></h3>
<p>Not all optical models close perfectly in Cartesian coordinates, i.e. the ends don’t perfectly
align. Some small offsets may be tolerable, as most tracking codes use curvilinear coordinates.
To account for this, the teleporter is a small disk volume inserted to make up the space
and shift particles transversely as if the ends matched up perfectly. This is automatically
calculated and constructed when using the <code class="code docutils literal notranslate"><span class="pre">--circular</span></code> executable option.</p>
<p>Although the teleporter may not be required in a well-formed model that closes, the minimum
gap of <span class="math notranslate nohighlight">\(0.2 \mu m\)</span> is required for the terminator.</p>
</section>
</section>
<section id="beamline-starting-point">
<span id="id4"></span><h2>Beamline Starting Point<a class="headerlink" href="#beamline-starting-point" title="Link to this heading"></a></h2>
<p>The main beamline, by default, starts at <code class="code docutils literal notranslate"><span class="pre">(X,Y,Z)</span> <span class="pre">=</span> <span class="pre">(0,0,0)</span></code> and points in the
positive unit <cite>Z</cite> direction.</p>
<p>The initial position and direction of the baemline may be change with the options described
in <a class="reference internal" href="model_control.html#beamline-offset"><span class="std std-ref">Offset for Main Beam Line</span></a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>It should be noted that the beam or ‘bunch’ definition will move along with the
beamline and the offset of the beam is with respect to this.</p>
</div>
</section>
<section id="magnet-strength-polarity">
<span id="id5"></span><h2>Magnet Strength Polarity<a class="headerlink" href="#magnet-strength-polarity" title="Link to this heading"></a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>BDSIM strictly follows the MAD-X definition of magnet strength parameter
<cite>k</cite> - a <strong>positive</strong> <cite>k</cite> corresponds to <strong>horizontal focussing</strong> for a
<strong>positively</strong> charged particle. This therefore indicates a positive <cite>k</cite>
corresponds to horizontal defocussing for a negatively charged particle.
However, MAD-X treats all particles as positively charged for tracking purposes.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>BDSIM currently treats k absolutely, so to convert a MAD-X lattice for
negatively particles, the MAD-X k values must be multiplied by -1. The
pybdsim converter provides an option called <cite>flipmagnets</cite> for this
purpose. This may be revised in future releases depending on changes
to MAD-X.</p>
</div>
</section>
<section id="synchronous-time-and-phase">
<span id="id6"></span><h2>Synchronous Time and Phase<a class="headerlink" href="#synchronous-time-and-phase" title="Link to this heading"></a></h2>
<p>Some components have time dependent fields, such as an <cite>rf</cite> cavity element. By default, these
are given a synchronous global time in their construction so that local time is zero at the
centre of the component for a synchronous particle. The time is calculated from the integration
of the design particle throughout the beamline as it is constructed including acceleration
and deceleration. See <a class="reference internal" href="dev_fields.html#fields-beamline-integration"><span class="std std-ref">Synchronous Time &amp; Rigidity With Acceleration</span></a>.</p>
<p>If the element is reused several times in a machine, it is constructed uniquely for
each instance so that the fields are unique with their own synchronous time or phase.</p>
</section>
<section id="acceleration">
<span id="id7"></span><h2>Acceleration<a class="headerlink" href="#acceleration" title="Link to this heading"></a></h2>
<p>BDSIM includes acceleration of particles. Along a beamline the nominal momentum of the
beam may change. Up until BDSIM v1.8.0 it was the user’s responsibility to recalculate
normalised magnet strengths (such as k1 for a quadrupole) and scaling factors for
dipoles externally to the program. Since v1.8.0, BDSIM calculates the change in kinetic
energy and therefore momentum and rigidity of the nominal ‘design’ beam particle along
the beamline and adjusts the rigidity used to calculate real field gradients from normalised
strengths.</p>
<p>The old behaviour (i.e. no rolling rigidity adjustment) can be restored by turning off the option:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">option</span><span class="p">,</span> <span class="n">integrateKineticEnergyInBeamline</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
</pre></div>
</div>
<p>which is turned on by default.</p>
<p>If a change in energy is detected by any component along the beamline, the design particle
properties will be printed out once more at the end of construction of the beamline, even
if it ends up being similar (e.g. through the input parameters) to the starting ones.</p>
</section>
<section id="beamline-elements">
<span id="lattice-elements"></span><h2>Beamline Elements<a class="headerlink" href="#beamline-elements" title="Link to this heading"></a></h2>
<p>BDSIM provides a variety of different elements each with their own function, geometry and
potential fields. Any element in BDSIM is described with the following pattern</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">name</span><span class="p">:</span> <span class="nb">type</span><span class="p">,</span> <span class="n">parameter</span><span class="o">=</span><span class="n">value</span><span class="p">,</span> <span class="n">parameter</span><span class="o">=</span><span class="s2">&quot;string&quot;</span><span class="p">;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Note the colon ‘:’ between name and type. The double (not single) inverted commas
for a string parameter and that each functional line must end with a semi-colon.
Spaces will be ignored.</p>
</div>
<p>The following elements may be defined</p>
<ul class="simple">
<li><p><a class="reference internal" href="#drift">drift</a></p></li>
<li><p><a class="reference internal" href="#rbend">rbend</a></p></li>
<li><p><a class="reference internal" href="#sbend">sbend</a></p></li>
<li><p><a class="reference internal" href="#quadrupole">quadrupole</a></p></li>
<li><p><a class="reference internal" href="#sextupole">sextupole</a></p></li>
<li><p><a class="reference internal" href="#octupole">octupole</a></p></li>
<li><p><a class="reference internal" href="#decapole">decapole</a></p></li>
<li><p><a class="reference internal" href="#multipole">multipole</a></p></li>
<li><p><a class="reference internal" href="#thinmultipole">thinmultipole</a></p></li>
<li><p><a class="reference internal" href="#vkicker">vkicker</a></p></li>
<li><p><a class="reference internal" href="#hkicker">hkicker</a></p></li>
<li><p><a class="reference internal" href="#kicker">kicker</a></p></li>
<li><p><a class="reference internal" href="#tkicker">tkicker</a></p></li>
<li><p><a class="reference internal" href="#rf">rf</a></p></li>
<li><p><a class="reference internal" href="#component-rfx-rfy"><span class="std std-ref">rfx &amp; rfy</span></a></p></li>
<li><p><a class="reference internal" href="#target">target</a></p></li>
<li><p><a class="reference internal" href="#rcol">rcol</a></p></li>
<li><p><a class="reference internal" href="#jcol">jcol</a></p></li>
<li><p><a class="reference internal" href="#jcoltip">jcoltip</a></p></li>
<li><p><a class="reference internal" href="#ecol">ecol</a></p></li>
<li><p><a class="reference internal" href="#degrader">degrader</a></p></li>
<li><p><a class="reference internal" href="#muspoiler">muspoiler</a></p></li>
<li><p><a class="reference internal" href="#shield">shield</a></p></li>
<li><p><a class="reference internal" href="#dump">dump</a></p></li>
<li><p><a class="reference internal" href="#solenoid">solenoid</a></p></li>
<li><p><a class="reference internal" href="#laser">laser</a></p></li>
<li><p><a class="reference internal" href="#gap">gap</a></p></li>
<li><p><a class="reference internal" href="#crystalcol">crystalcol</a></p></li>
<li><p><a class="reference internal" href="#undulator">undulator</a></p></li>
<li><p><a class="reference internal" href="#transform3d">transform3d</a></p></li>
<li><p><a class="reference internal" href="#rmatrix">rmatrix</a></p></li>
<li><p><a class="reference internal" href="#thinrmatrix">thinrmatrix</a></p></li>
<li><p><a class="reference internal" href="#element">element</a></p></li>
<li><p><a class="reference internal" href="#marker">marker</a></p></li>
<li><p><a class="reference internal" href="#wirescanner">wirescanner</a></p></li>
<li><p><a class="reference internal" href="#ct">ct</a></p></li>
<li><p><a class="reference internal" href="#muoncooler">muoncooler</a></p></li>
</ul>
<p>These are detailed in the following sections.</p>
<section id="simple-example-extend-and-copy">
<h3>Simple example, extend and copy<a class="headerlink" href="#simple-example-extend-and-copy" title="Link to this heading"></a></h3>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">d1</span><span class="p">:</span> <span class="n">drift</span><span class="p">,</span> <span class="n">l</span><span class="o">=</span><span class="mi">5</span><span class="o">*</span><span class="n">m</span><span class="p">;</span>
</pre></div>
</div>
<p>This defines a drift element with name <cite>d1</cite> and a length of 5 metres. The definition can later be changed or extended with</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">d1</span><span class="p">:</span> <span class="n">l</span><span class="o">=</span><span class="mi">3</span><span class="o">*</span><span class="n">m</span><span class="p">,</span> <span class="n">aper</span><span class="o">=</span><span class="mf">0.1</span><span class="o">*</span><span class="n">m</span><span class="p">;</span>
</pre></div>
</div>
<p>Note the omission of the type <cite>drift</cite>. This will change the length of <cite>d1</cite> to 3 metres and set the aperture size to 10 centimetres.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>This only works for beam line elements and not other objects in GMAD syntax (such as a placement).</p>
</div>
<p>An element can also be defined by copying an existing element</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">d2</span><span class="p">:</span> <span class="n">d1</span><span class="p">,</span> <span class="n">l</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">m</span><span class="p">;</span>
</pre></div>
</div>
<p>Element <cite>d2</cite> is a drift with the properties of <cite>d1</cite> and a length of 2 metres. Note that if <cite>d1</cite> is changed again, <cite>d2</cite> will <strong>not</strong> change.</p>
</section>
<section id="component-strength-scaling">
<h3>Component Strength Scaling<a class="headerlink" href="#component-strength-scaling" title="Link to this heading"></a></h3>
<p>In the case of acceleration or energy degradation, the central energy of the beam may
change. However, BDSIM constructs all fields with respect to the rigidity calculated
from the particle species and the <code class="code docutils literal notranslate"><span class="pre">energy</span></code> parameter in the beam definition (i.e. not the
central or mean energy of the beam <code class="code docutils literal notranslate"><span class="pre">E0</span></code>, but the design energy given by <code class="code docutils literal notranslate"><span class="pre">energy</span></code>).
To easily scale the strengths, every beam line element has the parameter <cite>scaling</cite> that enables
its strength to be directly scaled.</p>
<p>In the case of a dipole, this scales the field but not the angle (the field may be calculated
from the angle if none is specified). For example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">beam</span><span class="p">,</span> <span class="n">particle</span><span class="o">=</span><span class="s2">&quot;e-&quot;</span><span class="p">,</span>
      <span class="n">energy</span><span class="o">=</span><span class="mi">10</span><span class="o">*</span><span class="n">GeV</span><span class="p">;</span>

<span class="n">sb1</span><span class="p">:</span> <span class="n">sbend</span><span class="p">,</span> <span class="n">l</span><span class="o">=</span><span class="mf">2.5</span><span class="o">*</span><span class="n">m</span><span class="p">,</span> <span class="n">angle</span><span class="o">=</span><span class="mf">0.1</span><span class="p">;</span>
<span class="n">d1</span><span class="p">:</span> <span class="n">drift</span><span class="p">,</span> <span class="n">l</span><span class="o">=</span><span class="mi">1</span><span class="o">*</span><span class="n">m</span><span class="p">;</span>
<span class="n">cav1</span><span class="p">:</span> <span class="n">rf</span><span class="p">,</span> <span class="n">l</span><span class="o">=</span><span class="mi">1</span><span class="o">*</span><span class="n">m</span><span class="p">,</span> <span class="n">gradient</span><span class="o">=</span><span class="mi">50</span><span class="o">*</span><span class="n">MV</span><span class="o">/</span><span class="n">m</span><span class="p">,</span> <span class="n">frequency</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
<span class="n">sb2</span><span class="p">:</span> <span class="n">sbend</span><span class="p">,</span> <span class="n">l</span><span class="o">=</span><span class="mf">2.5</span><span class="o">*</span><span class="n">m</span><span class="p">,</span> <span class="n">angle</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">scaling</span><span class="o">=</span><span class="mf">1.005</span><span class="p">;</span>

<span class="n">l1</span><span class="p">:</span> <span class="n">line</span><span class="o">=</span><span class="p">(</span><span class="n">sb1</span><span class="p">,</span><span class="n">d1</span><span class="p">,</span><span class="n">cav1</span><span class="p">,</span><span class="n">d1</span><span class="p">,</span><span class="n">sb2</span><span class="p">,</span><span class="n">d1</span><span class="p">);</span>
</pre></div>
</div>
<p>In this example an rf cavity is used to accelerate the beam by 50 MeV (50 MV / m for 1 m).
The particle passes through one bend, the cavity and then another. As the second bend is
scaled (by a factor of (10 GeV + 50 MeV) / 10 GeV) = 1.005) a particle starting at (0,0) with
perfect energy will appear at (0,0) after this lattice.</p>
<p>In the case of a quadrupole or other magnet, the scaling is internally applied to the <cite>k1</cite>
or appropriate parameter that is used along with the design rigidity to calculate a field
gradient.</p>
<p>An example is included in <cite>examples/features/components/scaling.gmad</cite>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The user should take care to use this linear scaling parameter wisely- particularly
in sub-relativistic regimes. The fields should typically be scaled with momentum and
not total energy of the particle.</p>
</div>
</section>
<section id="magnet-yoke-field-scaling">
<h3>Magnet Yoke Field Scaling<a class="headerlink" href="#magnet-yoke-field-scaling" title="Link to this heading"></a></h3>
<p>As described in <a class="reference internal" href="dev_fields.html#yoke-multipole-field"><span class="std std-ref">General Yoke Multipole</span></a>, BDSIM uses by default an approximate magnetic
field for the yoke or “outer” part of each magnet. This is a sum of infinite (in <span class="math notranslate nohighlight">\(z\)</span>)
current sources placed in the <span class="math notranslate nohighlight">\(x, y\)</span> plane half way between each pole. This field is
only approximate and field maps should be used if a very accurate model is desired.</p>
<p>These fields are normalised to match the vacuum field at the pole tip, so the transition
is smooth.</p>
<p>However, to control this, an arbitrary scaling factor can be applied to all elements with
a yoke field (i.e. all magnets). This can be applied individually, or as an option to all
components. Individually specified parameters will take precedence.</p>
<p>In both cases the parameter and option is <code class="code docutils literal notranslate"><span class="pre">scalingFieldOuter</span></code> and should be a numerical
factor (e.g. 1.0 is the default).</p>
<p>An example model is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">d1</span><span class="p">:</span> <span class="n">drift</span><span class="p">,</span> <span class="n">l</span><span class="o">=</span><span class="mi">1</span><span class="o">*</span><span class="n">m</span><span class="p">;</span>
<span class="n">q1</span><span class="p">:</span> <span class="n">quadrupole</span><span class="p">,</span> <span class="n">l</span><span class="o">=</span><span class="mi">20</span><span class="o">*</span><span class="n">cm</span><span class="p">,</span> <span class="n">k1</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">scalingFieldOuter</span><span class="o">=</span><span class="mf">1.5</span><span class="p">;</span>
<span class="n">q2</span><span class="p">:</span> <span class="n">quadrupole</span><span class="p">,</span> <span class="n">l</span><span class="o">=</span><span class="mi">20</span><span class="o">*</span><span class="n">cm</span><span class="p">,</span> <span class="n">k1</span><span class="o">=</span><span class="mf">0.2</span><span class="p">;</span>
<span class="n">l1</span><span class="p">:</span> <span class="n">line</span><span class="o">=</span><span class="p">(</span><span class="n">d1</span><span class="p">,</span><span class="n">q1</span><span class="p">,</span><span class="n">d1</span><span class="p">,</span><span class="n">q2</span><span class="p">,</span><span class="n">d1</span><span class="p">);</span>
<span class="n">use</span><span class="p">,</span> <span class="n">l1</span><span class="p">;</span>

<span class="n">beam</span><span class="p">,</span> <span class="n">particle</span><span class="o">=</span><span class="s2">&quot;proton&quot;</span><span class="p">,</span> <span class="n">kineticEnergy</span><span class="o">=</span><span class="mi">100</span><span class="o">*</span><span class="n">GeV</span><span class="p">;</span>

<span class="n">option</span><span class="p">,</span> <span class="n">scalingFieldOuter</span><span class="o">=</span><span class="mf">2.0</span><span class="p">;</span>
</pre></div>
</div>
<p>Here, the “q1” element will have an arbitrary scaling factor of the 1.5 over the normal field inside
the pole tip radius. For “q2”, the default is picked up from the option with a value of 2.0.</p>
<p>This is recommended only for systematic error studies.</p>
</section>
<section id="drift">
<h3>drift<a class="headerlink" href="#drift" title="Link to this heading"></a></h3>
<figure class="align-center">
<a class="reference internal image-reference" href="_images/drift.png"><img alt="_images/drift.png" src="_images/drift.png" style="width: 50%;" /></a>
</figure>
<p><cite>drift</cite> defines a straight beam pipe with no field.</p>
<table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p>Parameter</p></td>
<td><p>Description</p></td>
<td><p>Default</p></td>
<td><p>Required</p></td>
</tr>
<tr class="row-even"><td><p><cite>l</cite></p></td>
<td><p>Length [m]</p></td>
<td><p>0</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-odd"><td><p><cite>vacuumMaterial</cite></p></td>
<td><p>The vacuum material
to use, can be user
defined</p></td>
<td><p>vacuum</p></td>
<td><p>No</p></td>
</tr>
</tbody>
</table>
<p>Notes:</p>
<ul class="simple">
<li><p>The <a class="reference internal" href="model_customisation.html#aperture-parameters"><span class="std std-ref">Aperture Parameters</span></a> may also be specified.</p></li>
<li><p>The default beam pipe material is “stainlessSteel”. This applies to all BDSIM elements that have a beam pipe.</p></li>
</ul>
<p>Examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">l203b</span><span class="p">:</span> <span class="n">drift</span><span class="p">,</span> <span class="n">l</span><span class="o">=</span><span class="mi">1</span><span class="o">*</span><span class="n">m</span><span class="p">;</span>
<span class="n">l204c</span><span class="p">:</span> <span class="n">drift</span><span class="p">,</span> <span class="n">l</span><span class="o">=</span><span class="mi">3</span><span class="o">*</span><span class="n">cm</span><span class="p">,</span> <span class="n">beampipeRadius</span><span class="o">=</span><span class="mi">10</span><span class="o">*</span><span class="n">cm</span><span class="p">;</span>
</pre></div>
</div>
</section>
<section id="rbend">
<span id="component-rbend"></span><h3>rbend<a class="headerlink" href="#rbend" title="Link to this heading"></a></h3>
<figure class="align-center">
<a class="reference internal image-reference" href="_images/rbend.png"><img alt="_images/rbend.png" src="_images/rbend.png" style="width: 40%;" /></a>
</figure>
<p><cite>rbend</cite> defines a rectangular bend magnet. Either the total bending angle, <cite>angle</cite>, or the magnetic field, <cite>B</cite>, (in Tesla)
for the nominal beam energy can be specified.
If both are defined the magnet is under or over-powered.
The faces of the magnet are normal to the chord of the
input and output points. It can be specified using:</p>
<ol class="arabic simple">
<li><p><cite>angle</cite> only - <cite>B</cite> calculated from the angle and the beam design rigidity.</p></li>
<li><p><cite>B</cite> only - the angle is calculated from the beam design rigidity.</p></li>
<li><p><cite>angle</cite> &amp; <cite>B</cite>  - physically constructed using the angle, and field strength as <cite>B</cite>
(see also <a class="reference internal" href="#component-strength-scaling">Component Strength Scaling</a>).</p></li>
</ol>
<p>Pole face rotations can be applied to both the input and output faces of the
magnet, based upon the reference system shown in the figure below. A pure dipole
field is provided in the beam pipe and a more general dipole (as
described by <a class="reference internal" href="dev_fields.html#yoke-multipole-field"><span class="std std-ref">General Yoke Multipole</span></a>) is provided for the yoke. A
quadrupolar component can be specified using the <cite>k1</cite> parameter that is given by:</p>
<div class="math notranslate nohighlight">
\[k_{1} = \frac{1}{B \rho}\,\frac{dB_{y}}{dx}\,[m^{-2}]\]</div>
<p>If <cite>k1</cite> is specified, the integrator from the <cite>bdsimmatrix</cite> integrator set is used. This
results in no physical pole face angle being constructed for tracking purposes. The
tracking still includes the pole face effects.</p>
<p>The default geometry is a C-shaped yoke and this is by default built on the inside
of the bend. For H-shaped used <code class="code docutils literal notranslate"><span class="pre">hStyle=1</span></code> and for the yoke on the outside, use
<code class="code docutils literal notranslate"><span class="pre">yokeOnInside=0</span></code> in the definition respectively.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>See <a class="reference internal" href="model_control.html#bend-tracking-behaviour"><span class="std std-ref">Dipole Behaviour</span></a> for important notes about dipole tracking.</p>
</div>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Parameter</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>Default</p></th>
<th class="head"><p>Required</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><cite>l</cite></p></td>
<td><p>Chord Length [m]</p></td>
<td><p>0</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-odd"><td><p><cite>angle</cite></p></td>
<td><p>Angle [rad]</p></td>
<td><p>0</p></td>
<td><p>Yes, and or <cite>B</cite></p></td>
</tr>
<tr class="row-even"><td><p><cite>B</cite></p></td>
<td><p>Magnetic field [T]</p></td>
<td><p>0</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-odd"><td><p><cite>e1</cite></p></td>
<td><p>Input pole face angle [rad]</p></td>
<td><p>0</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-even"><td><p><cite>e2</cite></p></td>
<td><p>Output pole face angle [rad]</p></td>
<td><p>0</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-odd"><td><p><cite>material</cite></p></td>
<td><p>Magnet outer material</p></td>
<td><p>Iron</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-even"><td><p><cite>yokeOnInside</cite></p></td>
<td><p>Yoke on inside of bend</p></td>
<td><p>1</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-odd"><td><p><cite>hStyle</cite></p></td>
<td><p>H style poled geometry</p></td>
<td><p>0</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-even"><td><p><cite>k1</cite></p></td>
<td><p>Quadrupole coefficient for
function magnet</p></td>
<td><p>0</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-odd"><td><p><cite>fint</cite></p></td>
<td><p>Fringe field integral for the
entrance face of the rbend</p></td>
<td><p>0</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-even"><td><p><cite>fintx</cite></p></td>
<td><p>Fringe field integral for the
exit face of the rbend. -1 means
default to the same as fint. 0
there will be no effect.</p></td>
<td><p>-1</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-odd"><td><p><cite>fintK2</cite></p></td>
<td><p>Second fringe field integral for
the entrance face of the rbend</p></td>
<td><p>0</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-even"><td><p><cite>fintxK2</cite></p></td>
<td><p>Second fringe field integral for
the exit face of the rbend</p></td>
<td><p>0</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-odd"><td><p><cite>hgap</cite></p></td>
<td><p>The half gap of the poles for
<strong>fringe field purposes only</strong></p></td>
<td><p>0</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-even"><td><p><cite>h1</cite></p></td>
<td><p>Input poleface curvature
<span class="math notranslate nohighlight">\([m^{-1}]\)</span></p></td>
<td><p>0</p></td>
<td><p>no</p></td>
</tr>
<tr class="row-odd"><td><p><cite>h2</cite></p></td>
<td><p>Output poleface curvature
<span class="math notranslate nohighlight">\([m^{-1}]\)</span></p></td>
<td><p>0</p></td>
<td><p>no</p></td>
</tr>
<tr class="row-even"><td><p><cite>tilt</cite></p></td>
<td><p>Tilt of magnet [rad]</p></td>
<td><p>0</p></td>
<td><p>no</p></td>
</tr>
</tbody>
</table>
<p>Notes:</p>
<ul class="simple">
<li><p>The <a class="reference internal" href="model_customisation.html#aperture-parameters"><span class="std std-ref">Aperture Parameters</span></a> may also be specified.</p></li>
<li><p>The <a class="reference internal" href="model_customisation.html#magnet-geometry-parameters"><span class="std std-ref">Magnet Geometry Parameters</span></a> may also be specified.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In the case that the <cite>lhcleft</cite> or <cite>lhcright</cite> magnet geometry types are used,
the yoke field will be a sum of two regular yoke fields at the LHC beam pipe
separation. The option <code class="code docutils literal notranslate"><span class="pre">yokeFieldsMatchLHCGeometry</span></code> can be used to control
this. On by default.</p>
</div>
<figure class="align-center" id="id12">
<a class="reference internal image-reference" href="_images/poleface_notation_rbend.pdf"><img alt="_images/poleface_notation_rbend.pdf" src="_images/poleface_notation_rbend.pdf" style="width: 75%;" /></a>
<figcaption>
<p><span class="caption-text">Pole face notation for an rbend.</span><a class="headerlink" href="#id12" title="Link to this image"></a></p>
</figcaption>
</figure>
<p>A few points about rbends:</p>
<ol class="arabic simple">
<li><p>For large angles (&gt; 100 mrad), particles may hit the aperture, as the beam pipe is
represented by a straight (chord) section and even nominal energy particles
may hit the aperture, depending on the degree of tracking accuracy specified. In this
case, consider splitting the <cite>rbend</cite> into multiple ones.</p></li>
<li><p>The pole face rotation angle is limited to <span class="math notranslate nohighlight">\(\pm \pi /4\)</span> radians.</p></li>
<li><p>If a non-zero pole face rotation angle is specified, the element preceding / succeeding
the rotated magnet face must either be a drift or an rbend with opposite rotation (e.g. an rbend with
<span class="math notranslate nohighlight">\(e2 = 0.1\)</span> can be followed by an rbend with <span class="math notranslate nohighlight">\(e1 = -0.1\)</span>). The preceding / succeeding
element must be longer than the projected length from the rotation, given by
<span class="math notranslate nohighlight">\(2 \tan(\mathrm{eX})\)</span>.</p></li>
<li><p>Fringe field kicks are applied in a thin fringe field magnet (0.1 micron thick by default) at the beginning
or at the end of the rbend. The length of the fringe field element can be
set by the option <cite>thinElementLength</cite> (see <a class="reference internal" href="model_control.html#bdsim-options"><span class="std std-ref">Options</span></a>) but is an advanced option.</p></li>
<li><p>In the case of finite <cite>fint</cite> or <cite>fintx</cite> and <cite>hgap</cite>, a fringe field is used even
if <cite>e1</cite> and <cite>e2</cite> have no angle.</p></li>
<li><p>The <cite>fintK2</cite> and <cite>fintxK2</cite> parameters are for a second fringe field correction term that are included to
enable optics comparisons with TRANSPORT. Whilst this term is not available in MAD-X, the default values
of 0 mean this second fringe field correction will not be applied unless <cite>fintK2</cite> or <cite>fintxK2</cite> are
explicitly specified as non-zero.</p></li>
<li><p>The effect of pole face rotations and fringe field kicks can be turned off for all dipoles by setting
the option <cite>includeFringeFields=0</cite> (see <a class="reference internal" href="model_control.html#bdsim-options"><span class="std std-ref">Options</span></a>).</p></li>
<li><p>The poleface curvature does not construct the curved geometry. The effect is instead applied in the thin
fringefield magnet.</p></li>
<li><p>rbends are limited in angle to less than <span class="math notranslate nohighlight">\(\pi/2\)</span>.</p></li>
<li><p>A positive <cite>tilt</cite> angle corresponds to a clockwise rotation when looking along the beam direction as
we use a right-handed coordinate system. A positive tilt angle of <span class="math notranslate nohighlight">\(\pi/2\)</span> for an rbend with a
positive bending angle will produce a vertical bend where the beam is bent downwards.</p></li>
<li><p>The sign of the pole face rotations do not change when flipping the sign of the magnet bending angle. This
is to match the behaviour of MAD-X; i.e. a positive pole face angle reduces the length of the outer side of
the bend (the side furthest from the centre of curvature).</p></li>
</ol>
<p>Examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">MRB20</span><span class="p">:</span> <span class="n">rbend</span><span class="p">,</span> <span class="n">l</span><span class="o">=</span><span class="mi">3</span><span class="o">*</span><span class="n">m</span><span class="p">,</span> <span class="n">angle</span><span class="o">=</span><span class="mf">0.003</span><span class="p">;</span>
<span class="n">r1</span><span class="p">:</span> <span class="n">rbend</span><span class="p">,</span> <span class="n">l</span><span class="o">=</span><span class="mf">5.43</span><span class="n">m</span><span class="p">,</span> <span class="n">beampipeRadius</span><span class="o">=</span><span class="mi">10</span><span class="o">*</span><span class="n">cm</span><span class="p">,</span> <span class="n">B</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">Tesla</span><span class="p">;</span>
<span class="n">RB04</span><span class="p">:</span> <span class="n">rbend</span><span class="p">,</span> <span class="n">l</span><span class="o">=</span><span class="mf">1.8</span><span class="o">*</span><span class="n">m</span><span class="p">,</span> <span class="n">angle</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">e1</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">e2</span><span class="o">=-</span><span class="mf">0.1</span>
</pre></div>
</div>
</section>
<section id="sbend">
<h3>sbend<a class="headerlink" href="#sbend" title="Link to this heading"></a></h3>
<figure class="align-center">
<a class="reference internal image-reference" href="_images/sbend.png"><img alt="_images/sbend.png" src="_images/sbend.png" style="width: 40%;" /></a>
</figure>
<p><cite>sbend</cite> defines a sector bend magnet. Either the total bending angle, <cite>angle</cite>, or the magnetic field, <cite>B</cite>, (in Tesla)
for the nominal beam energy can be specified.
If both are defined the magnet is under or over-powered.
The faces of the magnet are normal to the curvilinear coordinate
system. It can be specified using:</p>
<ol class="arabic simple">
<li><p><cite>angle</cite> only - <cite>B</cite> calculated from the angle and the beam design rigidity.</p></li>
<li><p><cite>B</cite> only - the angle is calculated from the beam design rigidity.</p></li>
<li><p><cite>angle</cite> &amp; <cite>B</cite>  - physically constructed using the angle, and field strength as <cite>B</cite>
(see also <a class="reference internal" href="#component-strength-scaling">Component Strength Scaling</a>).</p></li>
</ol>
<p>Pole face rotations can be applied to both the input and output faces of the magnet,
based upon the reference system shown in the figure below. A pure dipole field is
provided in the beam pipe and a more general dipole (as described by
<a class="reference internal" href="dev_fields.html#yoke-multipole-field"><span class="std std-ref">General Yoke Multipole</span></a>) is provided for the yoke. A quadrupolar component can
be specified using the <cite>k1</cite> parameter that is given by:</p>
<div class="math notranslate nohighlight">
\[k_{1} = \frac{1}{B \rho}\,\frac{dB_{y}}{dx}\,[m^{-2}]\]</div>
<p>If <cite>k1</cite> is specified, the integrator from <cite>bdsimmatrix</cite> integrator set is used. This
results in no physical pole face angle being constructed for tracking purposes. The
tracking still includes the pole face effects.</p>
<p>The <cite>sbend</cite> geometry is constructed as many small straight sections with angled faces. This
makes no effect on tracking, but allows a much higher variety of apertures and magnet
geometry to be used given the Geant4 geometry. The number of segments is computed such
that the maximum tangential error in the aperture is 1 mm.</p>
<p>The default geometry is a C-shaped yoke and this is by default built on the inside
of the bend. For H-shaped used <code class="code docutils literal notranslate"><span class="pre">hStyle=1</span></code> and for the yoke on the outside, use
<code class="code docutils literal notranslate"><span class="pre">yokeOnInside=0</span></code> in the definition respectively.</p>
<p>With the default integrator set, the pole face rotations are not built into the geometry
such that the tracking will match MADX. If you use the <code class="code docutils literal notranslate"><span class="pre">geant4</span></code> integrator set,
the pole face geometry will be built fully.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>See <a class="reference internal" href="model_control.html#bend-tracking-behaviour"><span class="std std-ref">Dipole Behaviour</span></a> for important notes about dipole tracking.</p>
</div>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Parameter</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>Default</p></th>
<th class="head"><p>Required</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><cite>l</cite></p></td>
<td><p>Arc length [m]</p></td>
<td><p>0</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-odd"><td><p><cite>angle</cite></p></td>
<td><p>Angle [rad]</p></td>
<td><p>0</p></td>
<td><p>Yes, and or <cite>B</cite></p></td>
</tr>
<tr class="row-even"><td><p><cite>B</cite></p></td>
<td><p>Magnetic field [T]</p></td>
<td><p>0</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-odd"><td><p><cite>e1</cite></p></td>
<td><p>Input pole face angle [rad]</p></td>
<td><p>0</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-even"><td><p><cite>e2</cite></p></td>
<td><p>Output pole face angle [rad]</p></td>
<td><p>0</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-odd"><td><p><cite>material</cite></p></td>
<td><p>Magnet outer material</p></td>
<td><p>Iron</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-even"><td><p><cite>yokeOnInside</cite></p></td>
<td><p>Yoke on inside of bend</p></td>
<td><p>1</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-odd"><td><p><cite>hStyle</cite></p></td>
<td><p>H style poled geometry</p></td>
<td><p>0</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-even"><td><p><cite>k1</cite></p></td>
<td><p>Quadrupole coefficient for
function magnet</p></td>
<td><p>0</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-odd"><td><p><cite>fint</cite></p></td>
<td><p>Fringe field integral for the
entrance face of the sbend</p></td>
<td><p>0</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-even"><td><p><cite>fintx</cite></p></td>
<td><p>Fringe field integral for the
exit face of the sbend. -1 means
default to the same as fint. 0
there will be no effect.</p></td>
<td><p>-1</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-odd"><td><p><cite>fintK2</cite></p></td>
<td><p>Second fringe field integral for
the entrance face of the sbend</p></td>
<td><p>0</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-even"><td><p><cite>fintxK2</cite></p></td>
<td><p>Second fringe field integral for
the exit face of the sbend</p></td>
<td><p>0</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-odd"><td><p><cite>hgap</cite></p></td>
<td><p>The half gap of the poles for
<strong>fringe field purposes only</strong></p></td>
<td><p>0</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-even"><td><p><cite>h1</cite></p></td>
<td><p>Input poleface curvature
<span class="math notranslate nohighlight">\([m^{-1}]\)</span></p></td>
<td><p>0</p></td>
<td><p>no</p></td>
</tr>
<tr class="row-odd"><td><p><cite>h2</cite></p></td>
<td><p>Output poleface curvature
<span class="math notranslate nohighlight">\([m^{-1}]\)</span></p></td>
<td><p>0</p></td>
<td><p>no</p></td>
</tr>
<tr class="row-even"><td><p><cite>tilt</cite></p></td>
<td><p>Tilt of magnet [rad]</p></td>
<td><p>0</p></td>
<td><p>no</p></td>
</tr>
</tbody>
</table>
<p>Notes:</p>
<ul class="simple">
<li><p>The <a class="reference internal" href="model_customisation.html#aperture-parameters"><span class="std std-ref">Aperture Parameters</span></a> may also be specified.</p></li>
<li><p>The <a class="reference internal" href="model_customisation.html#magnet-geometry-parameters"><span class="std std-ref">Magnet Geometry Parameters</span></a> may also be specified.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In the case that the <cite>lhcleft</cite> or <cite>lhcright</cite> magnet geometry types are used,
the yoke field will be a sum of two regular yoke fields at the LHC beam pipe
separation. The option <code class="code docutils literal notranslate"><span class="pre">yokeFieldsMatchLHCGeometry</span></code> can be used to control
this. On by default.</p>
</div>
<figure class="align-center" id="id13">
<a class="reference internal image-reference" href="_images/poleface_notation_sbend.pdf"><img alt="_images/poleface_notation_sbend.pdf" src="_images/poleface_notation_sbend.pdf" style="width: 75%;" /></a>
<figcaption>
<p><span class="caption-text">Pole face notation for an sbend.</span><a class="headerlink" href="#id13" title="Link to this image"></a></p>
</figcaption>
</figure>
<p>A few points about sbends:</p>
<ol class="arabic simple">
<li><p>The pole face rotation angle is limited to <span class="math notranslate nohighlight">\(\pm \pi /4\)</span> radians.</p></li>
<li><p>If a non-zero pole face rotation angle is specified, the element preceding / succeeding
the rotated magnet face must either be a drift or an sbend with the opposite rotation
(e.g. an sbend with <span class="math notranslate nohighlight">\(e2 = 0.1\)</span> can be followed by an sbend with
<span class="math notranslate nohighlight">\(e1 = -0.1\)</span>). The preceding / succeeding element must be longer than
the projected length from the rotation, given by <span class="math notranslate nohighlight">\(2 \tan(\mathrm{eX})\)</span>.</p></li>
<li><p>Fringe field kicks are applied in a thin fringe field magnet (0.1 micron thick by default) at the beginning
or at the end of the sbend. The length of the fringe field magnet can be
set by the option <cite>thinElementLength</cite> (see <a class="reference internal" href="model_control.html#bdsim-options"><span class="std std-ref">Options</span></a>).</p></li>
<li><p>In the case of finite <cite>fint</cite> or <cite>fintx</cite> and <cite>hgap</cite> a fringe field is used even
if <cite>e1</cite> and <cite>e2</cite> have no angle.</p></li>
<li><p>The <cite>fintK2</cite> and <cite>fintxK2</cite> parameters are for a second fringe field correction term that are included to
enable optics comparisons with TRANSPORT. Whilst this term is not available in MAD-X, the default values
of 0 mean this second fringe field correction will not be applied unless <cite>fintK2</cite> or <cite>fintxK2</cite> are
explicitly specified as non-zero.</p></li>
<li><p>The effect of pole face rotations and fringe field kicks can be turned off for all dipoles by setting
the option <cite>includeFringeFields=0</cite> (see <a class="reference internal" href="model_control.html#bdsim-options"><span class="std std-ref">Options</span></a>).</p></li>
<li><p>The poleface curvature does not construct the curved geometry. The effect is instead applied in the thin
fringefield magnet.</p></li>
<li><p>Sbends are limited in angle to less than <span class="math notranslate nohighlight">\(2\pi\)</span>. If the sbends are not split with the
option <code class="code docutils literal notranslate"><span class="pre">dontSplitSBends</span></code>, an sbend will be limited in angle to a maximum of <span class="math notranslate nohighlight">\(\pi/2\)</span>.</p></li>
<li><p>A positive <cite>tilt</cite> angle corresponds to a clockwise rotation when looking along the beam direction as
we use a right-handed coordinate system. A positive tilt angle of <span class="math notranslate nohighlight">\(\pi/2\)</span> for an sbend with a
positive bending angle will produce a vertical bend where the beam is bent downwards.</p></li>
<li><p>The sign of the pole face rotations do not change when flipping the sign of the magnet bending angle. This
is to match the behaviour of MAD-X; i.e. a positive pole face angle reduces the length of the outer side of
the bend (the side furthest from the centre of curvature).</p></li>
</ol>
<p>Examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">s1</span><span class="p">:</span> <span class="n">sbend</span><span class="p">,</span> <span class="n">l</span><span class="o">=</span><span class="mf">14.5</span><span class="o">*</span><span class="n">m</span><span class="p">,</span> <span class="n">angle</span><span class="o">=</span><span class="mf">0.005</span><span class="p">,</span> <span class="n">magnetGeometryType</span><span class="o">=</span><span class="s2">&quot;lhcright&quot;</span><span class="p">;</span>
<span class="n">mb201x</span><span class="p">:</span> <span class="n">sbend</span><span class="p">,</span> <span class="n">l</span><span class="o">=</span><span class="mf">304.2</span><span class="o">*</span><span class="n">cm</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mf">1.5</span><span class="o">*</span><span class="n">Tesla</span><span class="p">;</span>
<span class="n">SB17A</span><span class="p">:</span> <span class="n">sbend</span><span class="p">,</span> <span class="n">l</span><span class="o">=</span><span class="mf">0.61</span><span class="o">*</span><span class="n">m</span><span class="p">,</span> <span class="n">angle</span><span class="o">=</span><span class="mf">0.016</span><span class="p">,</span> <span class="n">e1</span><span class="o">=-</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">e2</span><span class="o">=</span><span class="mf">0.09</span>
</pre></div>
</div>
</section>
<section id="quadrupole">
<h3>quadrupole<a class="headerlink" href="#quadrupole" title="Link to this heading"></a></h3>
<figure class="align-center">
<a class="reference internal image-reference" href="_images/quadrupole.png"><img alt="_images/quadrupole.png" src="_images/quadrupole.png" style="width: 30%;" /></a>
</figure>
<p><cite>quadrupole</cite> defines a quadrupole magnet. The strength parameter <span class="math notranslate nohighlight">\(k_1\)</span> is defined as</p>
<div class="math notranslate nohighlight">
\[k_{1} = \frac{1}{B \rho}\,\frac{dB_{y}}{dx}\,[m^{-2}]\]</div>
<table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p>Parameter</p></td>
<td><p>Description</p></td>
<td><p>Default</p></td>
<td><p>Required</p></td>
</tr>
<tr class="row-even"><td><p><cite>l</cite></p></td>
<td><p>Length [m]</p></td>
<td><p>0</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-odd"><td><p><cite>k1</cite></p></td>
<td><p>Quadrupole coefficient</p></td>
<td><p>0</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-even"><td><p><cite>material</cite></p></td>
<td><p>Magnet outer material</p></td>
<td><p>Iron</p></td>
<td><p>No</p></td>
</tr>
</tbody>
</table>
<p>Notes:</p>
<ul class="simple">
<li><p>The <a class="reference internal" href="model_customisation.html#aperture-parameters"><span class="std std-ref">Aperture Parameters</span></a> may also be specified.</p></li>
<li><p>The <a class="reference internal" href="model_customisation.html#magnet-geometry-parameters"><span class="std std-ref">Magnet Geometry Parameters</span></a> may also be specified.</p></li>
<li><p>See <a class="reference internal" href="#id5">Magnet Strength Polarity</a> for polarity notes.</p></li>
<li><p>If <cite>lhcright</cite> or <cite>lhcleft</cite> magnet geometry types are used the yoke field is a sum of two
as described in <a class="reference internal" href="dev_fields.html#fields-multipole-outer-lhc"><span class="std std-ref">Multipole Yoke - Dual</span></a>.</p></li>
</ul>
<p>A pure quadrupolar field is provided in the beam pipe and a more general multipole (as
described by <a class="reference internal" href="dev_fields.html#yoke-multipole-field"><span class="std std-ref">General Yoke Multipole</span></a>) is provided for the yoke.</p>
<p>Examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">q1</span><span class="p">:</span> <span class="n">quadrupole</span><span class="p">,</span> <span class="n">l</span><span class="o">=</span><span class="mf">0.3</span><span class="o">*</span><span class="n">m</span><span class="p">,</span> <span class="n">k1</span><span class="o">=</span><span class="mf">45.23</span><span class="p">;</span>
<span class="n">qm15ff</span><span class="p">:</span> <span class="n">quadrupole</span><span class="p">,</span> <span class="n">l</span><span class="o">=</span><span class="mi">20</span><span class="o">*</span><span class="n">cm</span><span class="p">,</span> <span class="n">k1</span><span class="o">=</span><span class="mf">95.2</span><span class="p">;</span>
</pre></div>
</div>
</section>
<section id="sextupole">
<h3>sextupole<a class="headerlink" href="#sextupole" title="Link to this heading"></a></h3>
<figure class="align-center">
<a class="reference internal image-reference" href="_images/sextupole.png"><img alt="_images/sextupole.png" src="_images/sextupole.png" style="width: 30%;" /></a>
</figure>
<p><cite>sextupole</cite> defines a sextupole magnet. The strength parameter <span class="math notranslate nohighlight">\(k_2\)</span> is defined as</p>
<div class="math notranslate nohighlight">
\[k_{2} = \frac{1}{B \rho}\,\frac{d^{2}B_{y}}{dx^{2}}\,[m^{-3}]\]</div>
<table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p>Parameter</p></td>
<td><p>Description</p></td>
<td><p>Default</p></td>
<td><p>Required</p></td>
</tr>
<tr class="row-even"><td><p><cite>l</cite></p></td>
<td><p>Length [m]</p></td>
<td><p>0</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-odd"><td><p><cite>k2</cite></p></td>
<td><p>Sextupole coefficient</p></td>
<td><p>0</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-even"><td><p><cite>material</cite></p></td>
<td><p>Magnet outer material</p></td>
<td><p>Iron</p></td>
<td><p>No</p></td>
</tr>
</tbody>
</table>
<p>Notes:</p>
<ul class="simple">
<li><p>The <a class="reference internal" href="model_customisation.html#aperture-parameters"><span class="std std-ref">Aperture Parameters</span></a> may also be specified.</p></li>
<li><p>The <a class="reference internal" href="model_customisation.html#magnet-geometry-parameters"><span class="std std-ref">Magnet Geometry Parameters</span></a> may also be specified.</p></li>
<li><p>See <a class="reference internal" href="#id5">Magnet Strength Polarity</a> for polarity notes.</p></li>
<li><p>If <cite>lhcright</cite> or <cite>lhcleft</cite> magnet geometry types are used the yoke field is a sum of two
as described in ref:<cite>fields-multipole-outer-lhc</cite>.</p></li>
</ul>
<p>A pure sextupolar field is provided in the beam pipe and a more general multipole (as
described by <a class="reference internal" href="dev_fields.html#yoke-multipole-field"><span class="std std-ref">General Yoke Multipole</span></a>) is provided for the yoke.</p>
<p>Examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sx1</span><span class="p">:</span> <span class="n">sextupole</span><span class="p">,</span> <span class="n">l</span><span class="o">=</span><span class="mf">0.5</span><span class="o">*</span><span class="n">m</span><span class="p">,</span> <span class="n">k2</span><span class="o">=</span><span class="mf">4.678</span><span class="p">;</span>
<span class="n">sx2</span><span class="p">:</span> <span class="n">sextupole</span><span class="p">,</span> <span class="n">l</span><span class="o">=</span><span class="mi">20</span><span class="o">*</span><span class="n">cm</span><span class="p">,</span> <span class="n">k2</span><span class="o">=</span><span class="mf">45.32</span><span class="p">;</span>
</pre></div>
</div>
</section>
<section id="octupole">
<h3>octupole<a class="headerlink" href="#octupole" title="Link to this heading"></a></h3>
<figure class="align-center">
<a class="reference internal image-reference" href="_images/octupole.png"><img alt="_images/octupole.png" src="_images/octupole.png" style="width: 30%;" /></a>
</figure>
<p><cite>octupole</cite> defines an octupole magnet. The strength parameter <span class="math notranslate nohighlight">\(k_3\)</span> is defined as</p>
<div class="math notranslate nohighlight">
\[k_{3} = \frac{1}{B \rho}\,\frac{d^{3}B_{y}}{dx^{3}}\,[m^{-4}]\]</div>
<table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p>Parameter</p></td>
<td><p>Description</p></td>
<td><p>Default</p></td>
<td><p>Required</p></td>
</tr>
<tr class="row-even"><td><p><cite>l</cite></p></td>
<td><p>Length [m]</p></td>
<td><p>0</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-odd"><td><p><cite>k3</cite></p></td>
<td><p>Octupole coefficient</p></td>
<td><p>0</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-even"><td><p><cite>material</cite></p></td>
<td><p>Magnet outer material</p></td>
<td><p>Iron</p></td>
<td><p>No</p></td>
</tr>
</tbody>
</table>
<p>Notes:</p>
<ul class="simple">
<li><p>The <a class="reference internal" href="model_customisation.html#aperture-parameters"><span class="std std-ref">Aperture Parameters</span></a> may also be specified.</p></li>
<li><p>The <a class="reference internal" href="model_customisation.html#magnet-geometry-parameters"><span class="std std-ref">Magnet Geometry Parameters</span></a> may also be specified.</p></li>
<li><p>See <a class="reference internal" href="#id5">Magnet Strength Polarity</a> for polarity notes.</p></li>
</ul>
<p>A pure octupolar field is provided in the beam pipe and a more general multipole (as
described by <a class="reference internal" href="dev_fields.html#yoke-multipole-field"><span class="std std-ref">General Yoke Multipole</span></a>) is provided for the yoke.</p>
<p>Examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">oct4b</span><span class="p">:</span> <span class="n">octupole</span><span class="p">,</span> <span class="n">l</span><span class="o">=</span><span class="mf">0.3</span><span class="o">*</span><span class="n">m</span><span class="p">,</span> <span class="n">k3</span><span class="o">=</span><span class="mf">32.9</span><span class="p">;</span>
</pre></div>
</div>
</section>
<section id="decapole">
<h3>decapole<a class="headerlink" href="#decapole" title="Link to this heading"></a></h3>
<figure class="align-center">
<a class="reference internal image-reference" href="_images/decapole.png"><img alt="_images/decapole.png" src="_images/decapole.png" style="width: 30%;" /></a>
</figure>
<p><cite>decapole</cite> defines a decapole magnet. The strength parameter <span class="math notranslate nohighlight">\(k_4\)</span> is defined as</p>
<div class="math notranslate nohighlight">
\[k_{2} = \frac{1}{B \rho}\,\frac{d^{4}B_{y}}{dx^{4}}\,[m^{-5}]\]</div>
<table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p>Parameter</p></td>
<td><p>Description</p></td>
<td><p>Default</p></td>
<td><p>Required</p></td>
</tr>
<tr class="row-even"><td><p><cite>l</cite></p></td>
<td><p>Length [m]</p></td>
<td><p>0</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-odd"><td><p><cite>k4</cite></p></td>
<td><p>Decapole coefficient</p></td>
<td><p>0</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-even"><td><p><cite>material</cite></p></td>
<td><p>Magnet outer material</p></td>
<td><p>Iron</p></td>
<td><p>No</p></td>
</tr>
</tbody>
</table>
<p>A pure decapolar field is provided in the beam pipe and a more general multipole (as
described by <a class="reference internal" href="dev_fields.html#yoke-multipole-field"><span class="std std-ref">General Yoke Multipole</span></a>) is provided for the yoke.</p>
<ul class="simple">
<li><p>The <a class="reference internal" href="model_customisation.html#aperture-parameters"><span class="std std-ref">Aperture Parameters</span></a> may also be specified.</p></li>
<li><p>The <a class="reference internal" href="model_customisation.html#magnet-geometry-parameters"><span class="std std-ref">Magnet Geometry Parameters</span></a> may also be specified.</p></li>
<li><p>See <a class="reference internal" href="#id5">Magnet Strength Polarity</a> for polarity notes.</p></li>
</ul>
<p>Examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">MXDEC3</span><span class="p">:</span> <span class="n">decapole</span><span class="p">,</span> <span class="n">l</span><span class="o">=</span><span class="mf">0.3</span><span class="o">*</span><span class="n">m</span><span class="p">,</span> <span class="n">k4</span><span class="o">=</span><span class="mf">32.9</span><span class="p">;</span>
</pre></div>
</div>
</section>
<section id="multipole">
<h3>multipole<a class="headerlink" href="#multipole" title="Link to this heading"></a></h3>
<p><cite>multipole</cite> defines a general multipole magnet. The strength parameter
<span class="math notranslate nohighlight">\(knl\)</span> is a list defined as</p>
<div class="math notranslate nohighlight">
\[knl[n] = \frac{1}{B \rho} \frac{d^{n}B_{y}}{dx^{n}}\,[m^{-(n+1)}]\]</div>
<p>starting with the <strong>quadrupole</strong> component. The skew strength parameter <span class="math notranslate nohighlight">\(ksl\)</span>
is a list representing the skew coefficients.</p>
<table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p>Parameter</p></td>
<td><p>Description</p></td>
<td><p>Default</p></td>
<td><p>Required</p></td>
</tr>
<tr class="row-even"><td><p><cite>l</cite></p></td>
<td><p>Length [m]</p></td>
<td><p>0</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-odd"><td><p><cite>knl</cite></p></td>
<td><p>List of normal coefficients</p></td>
<td><p>0</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-even"><td><p><cite>ksl</cite></p></td>
<td><p>List of skew coefficients</p></td>
<td><p>0</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-odd"><td><p><cite>material</cite></p></td>
<td><p>Magnet outer material</p></td>
<td><p>Iron</p></td>
<td><p>No</p></td>
</tr>
</tbody>
</table>
<p>Notes:</p>
<ul class="simple">
<li><p>The values for <cite>knl</cite> and <cite>ksl</cite> are 1-counting, i.e. the first number is the order 1 component,
which is the quadrupole coefficient.</p></li>
<li><p>The <a class="reference internal" href="model_customisation.html#aperture-parameters"><span class="std std-ref">Aperture Parameters</span></a> may also be specified.</p></li>
<li><p>The <a class="reference internal" href="model_customisation.html#magnet-geometry-parameters"><span class="std std-ref">Magnet Geometry Parameters</span></a> may also be specified.</p></li>
<li><p>See <a class="reference internal" href="#id5">Magnet Strength Polarity</a> for polarity notes.</p></li>
<li><p>No yoke field is provided.</p></li>
</ul>
<p>Examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">OCTUPOLE1</span> <span class="p">:</span> <span class="n">multipole</span><span class="p">,</span> <span class="n">l</span><span class="o">=</span><span class="mf">0.5</span><span class="o">*</span><span class="n">m</span> <span class="p">,</span> <span class="n">knl</span><span class="o">=</span><span class="p">{</span> <span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span> <span class="p">}</span> <span class="p">,</span> <span class="n">ksl</span><span class="o">=</span><span class="p">{</span> <span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span> <span class="p">};</span>
<span class="n">QUADRUPOLE1</span><span class="p">:</span> <span class="n">multipole</span><span class="p">,</span> <span class="n">l</span><span class="o">=</span><span class="mi">20</span><span class="o">*</span><span class="n">cm</span><span class="p">,</span> <span class="n">knl</span><span class="o">=</span><span class="p">{</span><span class="mf">2.3</span><span class="p">};</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If a multipole has a length equal to zero, it will be converted in a <a class="reference internal" href="#thinmultipole">thinmultipole</a>.</p>
</div>
</section>
<section id="thinmultipole">
<h3>thinmultipole<a class="headerlink" href="#thinmultipole" title="Link to this heading"></a></h3>
<p><cite>thinmultipole</cite> is the same as multipole, but is set to have a default length of 0.1 micron.
For thin multipoles, the length parameter is not required. The element will appear as a thin length of drift
tube. A thin multipole can be placed next to a bending magnet with finite pole face rotation angles.</p>
<ul class="simple">
<li><p><cite>knl</cite> and <cite>ksl</cite> are the same as the thick multiple documented above.  See <a class="reference internal" href="#multipole">multipole</a>.</p></li>
</ul>
<p>Examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">THINOCTUPOLE1</span> <span class="p">:</span> <span class="n">thinmultipole</span> <span class="p">,</span> <span class="n">knl</span><span class="o">=</span><span class="p">{</span> <span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span> <span class="p">}</span> <span class="p">,</span> <span class="n">ksl</span><span class="o">=</span><span class="p">{</span> <span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span> <span class="p">};</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The length of the thin multipole can be changed by setting <cite>thinElementLength</cite> (see <a class="reference internal" href="model_control.html#bdsim-options"><span class="std std-ref">Options</span></a>).</p>
</div>
</section>
<section id="vkicker">
<h3>vkicker<a class="headerlink" href="#vkicker" title="Link to this heading"></a></h3>
<p><cite>vkicker</cite> can either be a thin or thick vertical dipole magnet. If specified
with a finite length <code class="code docutils literal notranslate"><span class="pre">l</span></code>, it will be constructed as a thick dipole. However, if no length (or
a length of exactly 0 is specified), a thin kicker will be built. In practice, the thin version is
constructed as a 0.1um slice with only the aperture geometry and no surrounding geometry and is not
visible with the default visualisation settings.</p>
<p>The strength is specified by the parameter <code class="code docutils literal notranslate"><span class="pre">vkick</span></code>, which is the fractional momentum kick
in the vertical direction. A positive value corresponds to an increase in <span class="math notranslate nohighlight">\(p_y\)</span>. In the
case of the thin kicker the position is not affected, whereas with the thick kicker, the position
will change.</p>
<p>The strength may also be specified by the magnetic field <code class="code docutils literal notranslate"><span class="pre">B</span></code>. A positive field value corresponds
to an increase in <span class="math notranslate nohighlight">\(p_y\)</span> for a positively charged particle.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p><code class="code docutils literal notranslate"><span class="pre">vkick</span></code> will supersede the strength even if <code class="code docutils literal notranslate"><span class="pre">B</span></code> is specified. Therefore, the
user should specify only <code class="code docutils literal notranslate"><span class="pre">vkick</span></code> or <code class="code docutils literal notranslate"><span class="pre">B</span></code>.</p>
</div>
<p>In the case of a thick vertical kicker, the resulting bending angle is calculated using:</p>
<div class="math notranslate nohighlight">
\[\theta = \sin^{-1}(\,p_y),\]</div>
<p>where <span class="math notranslate nohighlight">\(p_y\)</span> is the fractional change in vertical momentum. The dipole field strength is
then calculated with respect to the chord length:</p>
<div class="math notranslate nohighlight">
\[\mathbf{B} = B\rho\, \frac{\theta}{\mathrm{chord\,length}}\]</div>
<p>For thin kickers, the magnetic field <code class="code docutils literal notranslate"><span class="pre">B</span></code> is ignored and the element is treated as a drift.</p>
<ul class="simple">
<li><p>The <a class="reference internal" href="model_customisation.html#aperture-parameters"><span class="std std-ref">Aperture Parameters</span></a> may also be specified.</p></li>
<li><p>For a vkicker with a finite length, the <a class="reference internal" href="model_customisation.html#magnet-geometry-parameters"><span class="std std-ref">Magnet Geometry Parameters</span></a> may also be specified.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Pole face rotations and fringe fields can be applied to vkickers by supplying the same
parameters that would be applied to an <a class="reference internal" href="#rbend">rbend</a> or <a class="reference internal" href="#sbend">sbend</a> . If the vkicker is zero length,
the B field value must be supplied in order to calculate the bending radius which required
to apply the effects correctly.</p>
</div>
<ul class="simple">
<li><p>Fringe field kicks are applied in a thin fringe field magnet (0.1 micron thick by default) at the
beginning or at the end of the vkicker. The length of the fringe field element can be set by the
option <cite>thinElementLength</cite> (see <a class="reference internal" href="model_control.html#bdsim-options"><span class="std std-ref">Options</span></a>).</p></li>
<li><p>For zero length vkickers, the pole face and fringe field kicks are applied in the same thin element
as the vkick.</p></li>
<li><p>In the case of finite fint or fintx and hgap, a fringe field is used even if e1 and e2 have no angle.</p></li>
<li><p>The effect of pole face rotations and fringe field kicks can be turned off for all magnets by setting
the option <cite>includeFringeFields=0</cite> (see <a class="reference internal" href="model_control.html#bdsim-options"><span class="std std-ref">Options</span></a>).</p></li>
<li><p>No pole face geometry is constructed.</p></li>
</ul>
<p>A pure dipole field is provided in the beam pipe and a more general multipole (as
described by <a class="reference internal" href="dev_fields.html#yoke-multipole-field"><span class="std std-ref">General Yoke Multipole</span></a>) is provided for the yoke.</p>
<p>Examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">KX15v</span><span class="p">:</span> <span class="n">vkicker</span><span class="p">,</span> <span class="n">vkick</span><span class="o">=</span><span class="mf">1.3e-5</span><span class="p">;</span>
<span class="n">KX17v</span><span class="p">:</span> <span class="n">vkicker</span><span class="p">,</span> <span class="n">vkick</span><span class="o">=-</span><span class="mf">2.4e-2</span><span class="p">,</span> <span class="n">l</span><span class="o">=</span><span class="mf">0.5</span><span class="o">*</span><span class="n">m</span><span class="p">;</span>
<span class="n">KX18v</span><span class="p">:</span> <span class="n">vkicker</span><span class="p">,</span> <span class="n">B</span><span class="o">=</span><span class="mf">0.04</span><span class="o">*</span><span class="n">T</span><span class="p">;</span>
</pre></div>
</div>
</section>
<section id="hkicker">
<h3>hkicker<a class="headerlink" href="#hkicker" title="Link to this heading"></a></h3>
<p><cite>hkicker</cite> can either be a thin horizontal kicker or a thick horizontal dipole magnet. If
specified with a finite length <code class="code docutils literal notranslate"><span class="pre">l</span></code>, it will be constructed as a dipole. However, if no length (or
a length of exactly 0) is specified, a thin kicker will be built. This is typically a 0.1um slice
with only the shape of the aperture and no surrounding geometry. It is also typically not
visible with the default visualisation settings.</p>
<p>The strength is specified by the parameter <code class="code docutils literal notranslate"><span class="pre">hkick</span></code>, which is the fractional momentum kick
in the vertical direction. A positive value corresponds to an increase in <span class="math notranslate nohighlight">\(p_x\)</span>. In the
case of the thin kicker the position is not affected, whereas with the thick kicker, the position
will change.</p>
<p>The strength may also be specified by the magnetic field <code class="code docutils literal notranslate"><span class="pre">B</span></code>. A positive field value corresponds
to an decrease in <span class="math notranslate nohighlight">\(p_x\)</span> (note right-handed coordinate frame) for a positively charged particle.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p><code class="code docutils literal notranslate"><span class="pre">hkick</span></code> will supersede the strength even if <code class="code docutils literal notranslate"><span class="pre">B</span></code> is specified. Therefore, the
user should specify only <code class="code docutils literal notranslate"><span class="pre">hkick</span></code> or <code class="code docutils literal notranslate"><span class="pre">B</span></code>.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>A positive value of <cite>hkick</cite> causes an increase in horizontal momentum, so the particle
will bend to the left looking along the beam line, i.e. in positive <cite>x</cite>. This is
the opposite of a bend where a positive <em>angle</em> causes a deflection in negative
<cite>x</cite>.</p>
</div>
<p>For thin kickers, the magnetic field <code class="code docutils literal notranslate"><span class="pre">B</span></code> is ignored and the element is treated as a drift.</p>
<ul class="simple">
<li><p>The <a class="reference internal" href="model_customisation.html#aperture-parameters"><span class="std std-ref">Aperture Parameters</span></a> may also be specified.</p></li>
<li><p>For a hkicker with a finite length, the <a class="reference internal" href="model_customisation.html#magnet-geometry-parameters"><span class="std std-ref">Magnet Geometry Parameters</span></a> may also be specified.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Pole face rotations and fringe fields can be applied to hkickers by supplying the same
parameters that would be applied to an <a class="reference internal" href="#rbend">rbend</a> or <a class="reference internal" href="#sbend">sbend</a> . If the hkicker is zero length,
the B field value must be supplied in order to calculate the bending radius which required
to apply the effects correctly.</p>
</div>
<ul class="simple">
<li><p>Fringe field kicks are applied in a thin fringe field magnet (0.1 micron thick by default) at the
beginning or at the end of the hkicker. The length of the fringe field element can be set by the
option <cite>thinElementLength</cite> (see <a class="reference internal" href="model_control.html#bdsim-options"><span class="std std-ref">Options</span></a>).</p></li>
<li><p>For zero length hkickers, the pole face and fringe field kicks are applied in the same thin element
as the hkick.</p></li>
<li><p>In the case of finite fint or fintx and hgap, a fringe field is used even if e1 and e2 have no angle.</p></li>
<li><p>The effect of pole face rotations and fringe field kicks can be turned off for all magnets by setting
the option <cite>includeFringeFields=0</cite> (see <a class="reference internal" href="model_control.html#bdsim-options"><span class="std std-ref">Options</span></a>).</p></li>
<li><p>No pole face geometry is constructed.</p></li>
</ul>
<p>A pure dipole field is provided in the beam pipe and a more general multipole (as
described by <a class="reference internal" href="dev_fields.html#yoke-multipole-field"><span class="std std-ref">General Yoke Multipole</span></a>) is provided for the yoke.</p>
<p>Examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">KX17h</span><span class="p">:</span> <span class="n">hkicker</span><span class="p">,</span> <span class="n">hkick</span><span class="o">=</span><span class="mf">0.01</span><span class="p">;</span>
<span class="n">KX19h</span><span class="p">:</span> <span class="n">hkicker</span><span class="p">,</span> <span class="n">hkick</span><span class="o">=-</span><span class="mf">1.3e-5</span><span class="p">,</span> <span class="n">l</span><span class="o">=</span><span class="mf">0.2</span><span class="o">*</span><span class="n">m</span><span class="p">;</span>
<span class="n">KX21h</span><span class="p">:</span> <span class="n">hkicker</span><span class="p">,</span> <span class="n">B</span><span class="o">=</span><span class="mf">0.03</span><span class="o">*</span><span class="n">T</span><span class="p">;</span>
</pre></div>
</div>
</section>
<section id="kicker">
<h3>kicker<a class="headerlink" href="#kicker" title="Link to this heading"></a></h3>
<p><cite>kicker</cite> defines a combined horizontal and vertical kicker.  Either both or one of the
parameters <cite>hkick</cite> and <cite>vkick</cite> may be specified. Like the <cite>hkicker</cite> and <cite>vkicker</cite>, this
may also be thin or thick. In the case of the thick kicker, the field is the linear
sum of two independently calculated fields.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Pole face rotation and fringe fields kicks are unavailable for plain kickers</p>
</div>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">kick1</span><span class="p">:</span> <span class="n">kicker</span><span class="p">,</span> <span class="n">l</span><span class="o">=</span><span class="mf">0.45</span><span class="o">*</span><span class="n">m</span><span class="p">,</span> <span class="n">hkick</span><span class="o">=</span><span class="mf">1.23e-4</span><span class="p">,</span> <span class="n">vkick</span><span class="o">=</span><span class="mf">0.3e-4</span><span class="p">;</span>
</pre></div>
</div>
</section>
<section id="tkicker">
<h3>tkicker<a class="headerlink" href="#tkicker" title="Link to this heading"></a></h3>
<p>BDSIM, like MAD-X, provides a <cite>tkicker</cite> element. This is an alias in BDSIM for a <a class="reference internal" href="#kicker">kicker</a>,
however MAD-X differentiates the two on the basis of fitting parameters. BDSIM does
not make this distinction. See <a class="reference internal" href="#kicker">kicker</a> for more details.</p>
<p>In the case of a <cite>tkicker</cite>, the field <code class="code docutils literal notranslate"><span class="pre">B</span></code> cannot be used and only <cite>hkick</cite> and <cite>vkick</cite>
can be used.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Pole face rotation and fringe fields kicks are unavailable for tkickers</p>
</div>
</section>
<section id="rf">
<span id="component-rf"></span><h3>rf<a class="headerlink" href="#rf" title="Link to this heading"></a></h3>
<figure class="align-center">
<a class="reference internal image-reference" href="_images/rfcavity.png"><img alt="_images/rfcavity.png" src="_images/rfcavity.png" style="width: 50%;" /></a>
</figure>
<p><cite>rf</cite> or <cite>rfcavity</cite> defines an RF cavity with a time varying electric or electromagnetic field.
There are several geometry and field options as well as ways to specify the strength.
The default field is a uniform (in space) electric-only field that is time varying
according to a cosine (see <a class="reference internal" href="dev_fields.html#field-sinusoid-efield"><span class="std std-ref">Sinusoidal Electric Field</span></a>).  Optionally, the electromagnetic
field for a pill-box cavity may be used (see <a class="reference internal" href="dev_fields.html#field-pill-box"><span class="std std-ref">Pill-Box Cavity</span></a>). The <cite>G4ClassicalRK4</cite>
numerical integrator is used to calculate the motion of particles in both cases. Fringes for
the edge effects are provided by default and are controllable with the option <cite>includeFringeFieldsCavities</cite>.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p><strong>Parameter</strong></p></th>
<th class="head"><p><strong>Description</strong></p></th>
<th class="head"><p><strong>Default</strong></p></th>
<th class="head"><p><strong>Required</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><cite>l</cite></p></td>
<td><p>Length [m]</p></td>
<td><p>0</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-odd"><td><p><cite>E</cite></p></td>
<td><p>Voltage [V] that will be
across the length <cite>l</cite></p></td>
<td><p>0</p></td>
<td><p>Yes (or <cite>gradient</cite>)</p></td>
</tr>
<tr class="row-even"><td><p><cite>gradient</cite></p></td>
<td><p>Electric field [V/m]</p></td>
<td><p>0</p></td>
<td><p>Yes (or <cite>E</cite>)</p></td>
</tr>
<tr class="row-odd"><td><p><cite>frequency</cite></p></td>
<td><p>Frequency of oscillation (Hz)</p></td>
<td><p>0</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-even"><td><p><cite>phase</cite></p></td>
<td><p>Phase offset (rad)</p></td>
<td><p>0</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-odd"><td><p><cite>tOffset</cite></p></td>
<td><p>Offset in global time (s)</p></td>
<td><p>0</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-even"><td><p><cite>material</cite></p></td>
<td><p>Outer material</p></td>
<td><p>“”</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-odd"><td><p><cite>cavityModel</cite></p></td>
<td><p>Name of cavity model object</p></td>
<td><p>“”</p></td>
<td><p>No</p></td>
</tr>
</tbody>
</table>
<p>Either <code class="code docutils literal notranslate"><span class="pre">gradient</span></code> or <code class="code docutils literal notranslate"><span class="pre">E</span></code> should be specified. <code class="code docutils literal notranslate"><span class="pre">E</span></code> (the <em>voltage</em>) is given in Volts,
and internally is divided by the length of the element (<code class="code docutils literal notranslate"><span class="pre">l</span></code>) to give the electric
field in Volts/m. If <code class="code docutils literal notranslate"><span class="pre">gradient</span></code> is specified, this is already Volts/m and the length
is not involved. The slight misnomer of <cite>E</cite> instead of say <cite>voltage</cite> is historical.</p>
<p><strong>Units</strong> Since the value of <cite>m</cite> as a unit in GMAD is 1.0, it doesn’t practically make a
difference whether you write <code class="code docutils literal notranslate"><span class="pre">gradient=10*MV/m</span></code> or <code class="code docutils literal notranslate"><span class="pre">gradient=10*MV</span></code>. However,
it is best to be explicit in units or none at all and assume the default ones.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The design energy of the machine is affected by the accelerator (or decceleration)
and the nominal rigidity used to calculate fields from normalised strenghts
such as <code class="code docutils literal notranslate"><span class="pre">k1</span></code> for a quadrupole will be updated accordingly. This is the
default behaviour since v1.8.0 and can be turned off with
<code class="code docutils literal notranslate"><span class="pre">option,</span> <span class="pre">integrateKineticEnergyAlongBeamline=0;</span></code>.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The elliptical cavity geometry may not render or appear in the Geant4
QT visualiser.  The geometry exists and is valid, but this is due to
deficiencies of the Geant4 visualisation system. The geometry exists
and is fully functional.</p>
</div>
<ul class="simple">
<li><p>The field is such that a positive E-field results in acceleration of the primary particle
(depending on the primary particle charge).</p></li>
<li><p>The global synchronous time at the centre of the element is calculated automatically
such that zero phase results in the peak E-field at the centre of the component
for its position in the lattice.</p></li>
<li><p>Either <cite>tOffset</cite> or <cite>phase</cite> may be used to specify the phase of the oscillator.</p></li>
<li><p>If <cite>phase</cite> is specified, this is added to the calculated synchronous (global) phase from
either the lattice position or <cite>tOffset</cite>.</p></li>
<li><p>The material must be specified in the <cite>rf</cite> gmad element or in the attached cavity model
by name. The cavity model will override the element material.</p></li>
<li><p>The entrance / exit cavity fringes are not constructed if the previous / next element
is also an rf cavity.</p></li>
<li><p>The cavity fringe element is by default the same radius as the beam pipe radius. If a cavity
model is supplied, the cavity fringes are built with the same radius as the model iris radius.</p></li>
<li><p>The step length in the cavity is limited for all particles to be 2.5% of the minimum
of the element length and the wavelength (given the frequency). In the case of 0 frequency,
only the length is considered. This is to ensure accurate numerical integration of the
motion through the varying field.</p></li>
<li><p>If <cite>tOffset</cite> is specified, a phase offset is calculated from this and the frequency provided.</p></li>
<li><p>In the case where <cite>frequency</cite> is not set and therefore 0, the field is multiplied by the
cosine of the phase. See the developer documentation <a class="reference internal" href="dev_fields.html#field-sinusoid-efield"><span class="std std-ref">Sinusoidal Electric Field</span></a> for a
description of the field.</p></li>
</ul>
<p>Simple examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rf1</span><span class="p">:</span> <span class="n">rf</span><span class="p">,</span> <span class="n">l</span><span class="o">=</span><span class="mi">10</span><span class="o">*</span><span class="n">cm</span><span class="p">,</span> <span class="n">E</span><span class="o">=</span><span class="mi">10</span><span class="o">*</span><span class="n">MV</span><span class="p">,</span> <span class="n">frequency</span><span class="o">=</span><span class="mi">90</span><span class="o">*</span><span class="n">MHz</span><span class="p">,</span> <span class="n">phase</span><span class="o">=</span><span class="mf">0.02</span><span class="p">;</span>
<span class="n">rf2</span><span class="p">:</span> <span class="n">rf</span><span class="p">,</span> <span class="n">l</span><span class="o">=</span><span class="mi">10</span><span class="o">*</span><span class="n">cm</span><span class="p">,</span> <span class="n">gradient</span><span class="o">=</span><span class="mi">14</span><span class="o">*</span><span class="n">MV</span><span class="o">/</span><span class="n">m</span><span class="p">,</span> <span class="n">frequency</span><span class="o">=</span><span class="mi">450</span><span class="o">*</span><span class="n">MHz</span><span class="p">;</span>
<span class="n">rf3</span><span class="p">:</span> <span class="n">rf</span><span class="p">,</span> <span class="n">l</span><span class="o">=</span><span class="mi">10</span><span class="o">*</span><span class="n">cm</span><span class="p">,</span> <span class="n">E</span><span class="o">=</span><span class="mi">10</span><span class="o">*</span><span class="n">MV</span><span class="p">,</span> <span class="n">frequency</span><span class="o">=</span><span class="mi">90</span><span class="o">*</span><span class="n">MHz</span><span class="p">,</span> <span class="n">tOffset</span><span class="o">=</span><span class="mf">3.2</span><span class="o">*</span><span class="n">ns</span><span class="p">;</span>
</pre></div>
</div>
<p>Rather than just a simple E-field, an electromagnetic field that is the solution to
a cylindrical pill-box cavity may be used. A cavity object (described in more detail
below) is used to specify the field type. All other cavity parameters may be safely ignored
and only the field type will be used. The field is described in <a class="reference internal" href="dev_fields.html#field-pill-box"><span class="std std-ref">Pill-Box Cavity</span></a>.</p>
<p>Pill-box field example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rffield</span><span class="p">:</span> <span class="n">field</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;rfcavity&quot;</span><span class="p">;</span>
<span class="n">rf4</span><span class="p">:</span> <span class="n">rf</span><span class="p">,</span> <span class="n">l</span><span class="o">=</span><span class="mi">10</span><span class="o">*</span><span class="n">cm</span><span class="p">,</span> <span class="n">E</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">kV</span><span class="p">,</span> <span class="n">frequency</span><span class="o">=</span><span class="mf">1.2</span><span class="o">*</span><span class="n">GHz</span><span class="p">,</span> <span class="n">fieldVacuum</span><span class="o">=</span><span class="s2">&quot;rffield&quot;</span><span class="p">;</span>
</pre></div>
</div>
<p>Elliptical SRF cavity geometry is also provided and may be specified by use of another
‘cavity’ object in the parser. This cavity object can then be attached to an <cite>rf</cite>
object by name. Details can be found in <a class="reference internal" href="model_customisation.html#cavity-geometry-parameters"><span class="std std-ref">Cavity Geometry Parameters</span></a>.</p>
</section>
<section id="rfx-rfy">
<span id="component-rfx-rfy"></span><h3>rfx &amp; rfy<a class="headerlink" href="#rfx-rfy" title="Link to this heading"></a></h3>
<figure class="align-center">
<a class="reference internal image-reference" href="_images/rfx.png"><img alt="_images/rfx.png" src="_images/rfx.png" style="width: 60%;" /></a>
</figure>
<p><cite>rfx</cite> or <cite>rfy</cite> define an RF cavity with a time varying electric (only) field that is transverse
to the S direction the accelerator is built along. Particularly, for <cite>rfx</cite> it is in the local
<cite>x</cite> direction and for <cite>rfy</cite> it is in the local <cite>y</cite> direction. The cavity will look like a cylindrical
pillbox cavity much the same way as <cite>rf</cite>.</p>
<ul class="simple">
<li><p>A positive <cite>gradient</cite> or field value causes a positive deflection in that direction.</p></li>
<li><p>Only <cite>gradient</cite> can be specified because if we specify voltage only, we need the length
to calculate a gradient for the electric field and the exact width of the cavity can be
ambiguous given a combination of parameters.</p></li>
</ul>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p><strong>Parameter</strong></p></th>
<th class="head"><p><strong>Description</strong></p></th>
<th class="head"><p><strong>Default</strong></p></th>
<th class="head"><p><strong>Required</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><cite>l</cite></p></td>
<td><p>Length [m]</p></td>
<td><p>0</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-odd"><td><p><cite>gradient</cite></p></td>
<td><p>Electric field [V/m]</p></td>
<td><p>0</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-even"><td><p><cite>frequency</cite></p></td>
<td><p>Frequency of oscillation (Hz)</p></td>
<td><p>0</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-odd"><td><p><cite>phase</cite></p></td>
<td><p>Phase offset (rad)</p></td>
<td><p>0</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-even"><td><p><cite>tOffset</cite></p></td>
<td><p>Offset in time (s)</p></td>
<td><p>0</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-odd"><td><p><cite>material</cite></p></td>
<td><p>Outer material</p></td>
<td><p>“”</p></td>
<td><p>Yes</p></td>
</tr>
</tbody>
</table>
<p>See <a class="reference internal" href="#component-rf"><span class="std std-ref">rf</span></a> for details about <cite>phase</cite> and <cite>tOffset</cite>. The field is the same
as <a class="reference internal" href="dev_fields.html#field-sinusoid-efield"><span class="std std-ref">Sinusoidal Electric Field</span></a>, but pointing transversely.</p>
<p>Examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rf1</span><span class="p">:</span> <span class="n">rfx</span><span class="p">,</span> <span class="n">l</span><span class="o">=</span><span class="mi">20</span><span class="o">*</span><span class="n">cm</span><span class="p">,</span> <span class="n">gradient</span><span class="o">=</span><span class="mi">12</span><span class="o">*</span><span class="n">MV</span> <span class="o">/</span> <span class="n">m</span><span class="p">,</span> <span class="n">frequency</span><span class="o">=</span><span class="mi">450</span><span class="o">*</span><span class="n">MHz</span><span class="p">;</span>
</pre></div>
</div>
</section>
<section id="target">
<h3>target<a class="headerlink" href="#target" title="Link to this heading"></a></h3>
<figure class="align-center">
<a class="reference internal image-reference" href="_images/target.png"><img alt="_images/target.png" src="_images/target.png" style="width: 40%;" /></a>
</figure>
<p>A <cite>target</cite> defines a block of 1 material. By default, a square shape is used but a
circular one can also be used. A target can be achieved similarly with an <cite>rcol</cite>
with no <cite>xsize</cite> or <cite>ysize</cite> specified.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p><strong>Parameter</strong></p></th>
<th class="head"><p><strong>Description</strong></p></th>
<th class="head"><p><strong>Default</strong></p></th>
<th class="head"><p><strong>Required</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><cite>l</cite></p></td>
<td><p>Length [m]</p></td>
<td><p>0</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-odd"><td><p><cite>material</cite></p></td>
<td><p>Outer material</p></td>
<td><p>None</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-even"><td><p><cite>horizontalWidth</cite></p></td>
<td><p>Outer full width [m]</p></td>
<td><p>0.5 m</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-odd"><td><p><cite>colour</cite></p></td>
<td><p>Name of colour desired for block
See <a class="reference internal" href="model_customisation.html#colours"><span class="std std-ref">Colours</span></a></p></td>
<td><p>“”</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-even"><td><p><cite>minimumKineticEnergy</cite></p></td>
<td><p>Minimum kinetic energy below
which to artificially kill
particles in this target only</p></td>
<td><p>0</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-odd"><td><p><cite>apertureType</cite></p></td>
<td><p>Temporarily used to describe the
outer shape - only “circular” or
“rectangular” are accepted</p></td>
<td><p>“rectangular”</p></td>
<td><p>No</p></td>
</tr>
</tbody>
</table>
<ul class="simple">
<li><p>In future, <cite>apertureType</cite> will not be used to control the outer shape and any
shape will be possible.</p></li>
</ul>
</section>
<section id="rcol">
<h3>rcol<a class="headerlink" href="#rcol" title="Link to this heading"></a></h3>
<figure class="align-center">
<a class="reference internal image-reference" href="_images/rcol.png"><img alt="_images/rcol.png" src="_images/rcol.png" style="width: 40%;" /></a>
</figure>
<p>An <cite>rcol</cite> defines a rectangular collimator. The aperture is rectangular and the external
volume is square.</p>
<ul class="simple">
<li><p>If no <cite>xsize</cite> or <cite>ysize</cite> are provided, they are assumed to be 0 and <strong>a solid block</strong> is made.</p></li>
</ul>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p><strong>Parameter</strong></p></th>
<th class="head"><p><strong>Description</strong></p></th>
<th class="head"><p><strong>Default</strong></p></th>
<th class="head"><p><strong>Required</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><cite>l</cite></p></td>
<td><p>Length [m]</p></td>
<td><p>0</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-odd"><td><p><cite>xsize</cite></p></td>
<td><p>Horizontal half aperture [m]</p></td>
<td><p>0</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-even"><td><p><cite>ysize</cite></p></td>
<td><p>Vertical half aperture [m]</p></td>
<td><p>0</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-odd"><td><p><cite>material</cite></p></td>
<td><p>Outer material</p></td>
<td><p>None</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-even"><td><p><cite>horizontalWidth</cite></p></td>
<td><p>Outer full width [m]</p></td>
<td><p>0.5 m</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-odd"><td><p><cite>xsizeOut</cite></p></td>
<td><p>Horizontal exit half aperture [m]</p></td>
<td><p><cite>xsize</cite> value</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-even"><td><p><cite>ysizeOut</cite></p></td>
<td><p>Vertical exit half aperture [m]</p></td>
<td><p><cite>ysize</cite> value</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-odd"><td><p><cite>colour</cite></p></td>
<td><p>Name of colour desired for block
See <a class="reference internal" href="model_customisation.html#colours"><span class="std std-ref">Colours</span></a></p></td>
<td><p>“”</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-even"><td><p><cite>minimumKineticEnergy</cite></p></td>
<td><p>Minimum kinetic energy below
which to artificially kill
particles in this collimator only</p></td>
<td><p>0</p></td>
<td><p>No</p></td>
</tr>
</tbody>
</table>
<p>Notes:</p>
<ul class="simple">
<li><p><cite>horizontalWidth</cite> should be big enough to encompass the xsize and ysize.</p></li>
<li><p>The parameter <cite>minimumKineticEnergy</cite> (in GeV by default) may be specified to artificially kill
particles below this kinetic energy in the collimator. This is useful to match other simulations
where collimators can be assumed to be infinite absorbers. If this behaviour is required, the
user should specify an energy greater than the total beam energy.</p></li>
<li><p>The collimator can be tapered by specifying an exit aperture size with <cite>xsizeOut</cite> and
<cite>ysizeOut</cite>, with the <cite>xsize</cite> and <cite>ysize</cite> parameters defining the entrance aperture.</p></li>
<li><p>All collimators can be made infinite absorbers with the general option
<code class="code docutils literal notranslate"><span class="pre">collimatorsAreInfiniteAbsorbers</span></code> (see <a class="reference internal" href="model_control.html#options-tracking"><span class="std std-ref">Tracking Options</span></a>).</p></li>
</ul>
<p>Examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>! Standard
TCP15: rcol, l=1.22*m, material=&quot;graphite&quot;, xsize=104*um, ysize=5*cm;

! Tapered
TCP16: rcol, l=1.22*m, material=&quot;graphite&quot;, xsize=104*um, ysize=5*cm, xsizeOut=208*um, ysizeOut=10*cm;
! with kinetic energy limit
TCP6CD: rcol, l=0.6*m, material=&quot;C&quot;, xsize=200*um, ysize=5*cm, minimumKineticEnergy=10*MeV;
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The outer shape of an rcol can be made circular by defining <code class="code docutils literal notranslate"><span class="pre">apertureType=&quot;circular&quot;</span></code> for
that specific element. This is a temporary facility and may cause overlaps if the
<code class="code docutils literal notranslate"><span class="pre">horizontalWidth</span></code> parameter is smaller than the radius from the <cite>xsize</cite> and <cite>ysize</cite>
parameters. In future this will be improved and generalised for any inner and outer shape. No
other outer shapes are supported just now.</p>
</div>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">r1</span><span class="p">:</span> <span class="n">rcol</span><span class="p">,</span> <span class="n">l</span><span class="o">=</span><span class="mi">1</span><span class="o">*</span><span class="n">m</span><span class="p">,</span> <span class="n">material</span><span class="o">=</span><span class="s2">&quot;Cu&quot;</span><span class="p">,</span> <span class="n">xsize</span><span class="o">=</span><span class="mi">10</span><span class="o">*</span><span class="n">mm</span><span class="p">,</span> <span class="n">ysize</span><span class="o">=</span><span class="mi">3</span><span class="o">*</span><span class="n">mm</span><span class="p">,</span> <span class="n">apertureType</span><span class="o">=</span><span class="s2">&quot;circular&quot;</span><span class="p">,</span> <span class="n">horizontalWidth</span><span class="o">=</span><span class="mi">10</span><span class="o">*</span><span class="n">cm</span><span class="p">;</span>
</pre></div>
</div>
</section>
<section id="ecol">
<h3>ecol<a class="headerlink" href="#ecol" title="Link to this heading"></a></h3>
<figure class="align-center">
<a class="reference internal image-reference" href="_images/ecol.png"><img alt="_images/ecol.png" src="_images/ecol.png" style="width: 40%;" /></a>
</figure>
<p><cite>ecol</cite> defines an elliptical collimator. This is exactly the same as <cite>rcol</cite> except that
the aperture is elliptical and the <cite>xsize</cite> and <cite>ysize</cite> define the horizontal and vertical
<strong>half-axes</strong> respectively.</p>
<ul class="simple">
<li><p>A circular aperture collimator can be achieved by setting <cite>xsize</cite> and <cite>ysize</cite> to the
same value.</p></li>
<li><p>When tapered, the ratio between the horizontal and vertical half-axes of the entrance
aperture (<cite>xsize</cite> and <cite>ysize</cite>) <strong>must</strong> be the same ratio for the exit aperture (<cite>xsizeOut</cite> and <cite>ysizeOut</cite>).</p></li>
<li><p>All the same conditions for <cite>rcol</cite> apply for <cite>ecol</cite>.</p></li>
</ul>
</section>
<section id="jcol">
<h3>jcol<a class="headerlink" href="#jcol" title="Link to this heading"></a></h3>
<figure class="align-center">
<a class="reference internal image-reference" href="_images/jcol.png"><img alt="_images/jcol.png" src="_images/jcol.png" style="width: 40%;" /></a>
</figure>
<p><cite>jcol</cite> defines a jaw collimator with two square blocks on either side in the horizontal plane.
If a vertical <cite>jcol</cite> is required, the <cite>tilt</cite> parameter should be used to rotate it by <span class="math notranslate nohighlight">\(\pi/2\)</span>.
The horizontal position of each jaw can be set separately with the <cite>xsizeLeft</cite> and <cite>xsizeRight</cite>
apertures which are the distances from the centre of element to the left and right jaws respectively.
The collimator jaws can be individually tilted in a plane perpendicular to the jaw opening plane with the
<cite>jawTiltLeft</cite> and <cite>jawTiltRight</cite> arguments. In this case, the set aperture is in the middle of the collimator.
This feature can be useful for example in aligning the jaws to the beam envelope.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p><strong>Parameter</strong></p></th>
<th class="head"><p><strong>Description</strong></p></th>
<th class="head"><p><strong>Default</strong></p></th>
<th class="head"><p><strong>Required</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><cite>l</cite></p></td>
<td><p>Length [m]</p></td>
<td><p>0</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-odd"><td><p><cite>xsize</cite></p></td>
<td><p>Horizontal half aperture [m]</p></td>
<td><p>0</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-even"><td><p><cite>ysize</cite></p></td>
<td><p>Half height of jaws [m]</p></td>
<td><p>0</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-odd"><td><p><cite>material</cite></p></td>
<td><p>Outer material</p></td>
<td><p>None</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-even"><td><p><cite>xsizeLeft</cite></p></td>
<td><p>Left jaw aperture [m]</p></td>
<td><p>0</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-odd"><td><p><cite>xsizeRight</cite></p></td>
<td><p>Right jaw aperture [m]</p></td>
<td><p>0</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-even"><td><p><cite>jawTiltLeft</cite></p></td>
<td><p>Left jaw tilt angle [rad]</p></td>
<td><p>0</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-odd"><td><p><cite>jawTiltRight</cite></p></td>
<td><p>Right jaw tilt angle [rad]</p></td>
<td><p>0</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-even"><td><p><cite>horizontalWidth</cite></p></td>
<td><p>Outer full width [m]</p></td>
<td><p>0.5 m</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-odd"><td><p><cite>colour</cite></p></td>
<td><p>Name of colour desired for
block. See <a class="reference internal" href="model_customisation.html#colours"><span class="std std-ref">Colours</span></a>.</p></td>
<td><p>“”</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-even"><td><p><cite>minimumKineticEnergy</cite></p></td>
<td><p>Minimum kinetic energy below
which to artificially kill
particles in this collimator only</p></td>
<td><p>0</p></td>
<td><p>No</p></td>
</tr>
</tbody>
</table>
<p>Notes:</p>
<ul class="simple">
<li><p>The <cite>horizontalWidth</cite> must be greater than 2x <cite>xsize</cite>.</p></li>
<li><p>To prevent the jaws overlapping with one another, a jaw cannot be constructed that crosses the
X axis of the element (i.e supplying a negative <cite>xsizeLeft</cite> or <cite>xsizeRight</cite> will not work). Should
you require this, please offset the element using the element parameters <cite>offsetX</cite> and <cite>offsetY</cite> instead.</p></li>
<li><p>To construct a collimator jaws with one jaw closed (i.e. an offset of 0), the horizontal half aperture
must be set to 0, with the other jaws half aperture set as appropriate.</p></li>
<li><p>If <cite>xsize</cite>, <cite>xsizeLeft</cite> and <cite>xsizeRight</cite> are not specified, the collimator will be constructed
as a box with no aperture.</p></li>
<li><p>For <strong>only one jaw</strong>, specifying a jaw aperture which is larger than half the <cite>horizontalWidth</cite> value
will result in that jaw not being constructed. If both jaw apertures are greater than
half the <cite>horizontalWidth</cite>, no jaws will be built and BDSIM will exit.</p></li>
<li><p>To preserve the longitudinal dimensions, jaw tilt specified with <cite>jawTiltLeft</cite> or <cite>jawTiltRight</cite> and <cite>xsizeRight</cite>
uses parallelepipeds instead of boxes for the collimator jaws. Relative to using angled boxes, this can introduce and
error in the material traversed by incident particles, which scales as $btan(alpha)$, where b is
the impact parameter (depth of impact) and $alpha$ is the jaw tilt angle.</p></li>
<li><p>The parameter <cite>minimumKineticEnergy</cite> (GeV by default) may be specified to artificially kill
particles below this kinetic energy in the collimator. This is useful to match other simulations
where collimators can be assumed to be infinite absorbers. If this behaviour is required, the
user should specify an energy greater than the total beam energy.</p></li>
<li><p>All collimators can be made infinite absorbers with the general option
<code class="code docutils literal notranslate"><span class="pre">collimatorsAreInfiniteAbsorbers</span></code> (see <a class="reference internal" href="model_control.html#options-tracking"><span class="std std-ref">Tracking Options</span></a>).</p></li>
</ul>
<p>Examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>! standard
TCP15: jcol, l=1.22*m, material=&quot;graphite&quot;, xsize=0.1*cm, ysize=5*cm;

! two separately specified jaws
j1: jcol, l=1*m, horizontalWidth=1*m, material=&quot;Cu&quot;, xsizeLeft=1*cm, xsizeRight=1.5*cm;

! only left jaw
j2: jcol, l=0.9*m, horizontalWidth=1*m, material=&quot;Cu&quot;, xsizeLeft=1*cm, xsizeRight=2*m;
</pre></div>
</div>
</section>
<section id="jcoltip">
<h3>jcoltip<a class="headerlink" href="#jcoltip" title="Link to this heading"></a></h3>
<figure class="align-center">
<a class="reference internal image-reference" href="_images/jcoltip.png"><img alt="_images/jcoltip.png" src="_images/jcoltip.png" style="width: 40%;" /></a>
</figure>
<p><cite>jcoltip</cite> defines a jaw collimator with an additional tip material. It consists of two square blocks on either side in the horizontal plane, similar to <cite>jcol</cite>, but with a tip of a different material. If a vertical <cite>jcoltip</cite> is required, the <cite>tilt</cite> parameter should be used to rotate it by <span class="math notranslate nohighlight">\(\pi/2\)</span>. The horizontal position of each jaw can be set separately with the <cite>xsizeLeft</cite> and <cite>xsizeRight</cite> apertures, which are the distances from the centre of the element to the left and right jaws, respectively.</p>
<p>The tip thickness and material are defined using <cite>tipThickness</cite> and <cite>tipMaterial</cite>. The collimator jaws can be individually tilted in a plane perpendicular to the jaw opening plane with the <cite>jawTiltLeft</cite> and <cite>jawTiltRight</cite> arguments. In this case, the set aperture is in the middle of the collimator. This feature can be useful for example in aligning the jaws to the beam envelope.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p><strong>Parameter</strong></p></th>
<th class="head"><p><strong>Description</strong></p></th>
<th class="head"><p><strong>Default</strong></p></th>
<th class="head"><p><strong>Required</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><cite>l</cite></p></td>
<td><p>Length [m]</p></td>
<td><p>0</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-odd"><td><p><cite>xsize</cite></p></td>
<td><p>Horizontal half aperture [m]</p></td>
<td><p>0</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-even"><td><p><cite>ysize</cite></p></td>
<td><p>Half height of jaws [m]</p></td>
<td><p>0</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-odd"><td><p><cite>material</cite></p></td>
<td><p>Bulk material of the jaw</p></td>
<td><p>None</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-even"><td><p><cite>tipMaterial</cite></p></td>
<td><p>Material of the jaw tip</p></td>
<td><p>None</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-odd"><td><p><cite>tipThickness</cite></p></td>
<td><p>Thickness of the tip [m]</p></td>
<td><p>0</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-even"><td><p><cite>xsizeLeft</cite></p></td>
<td><p>Left jaw aperture [m]</p></td>
<td><p>0</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-odd"><td><p><cite>xsizeRight</cite></p></td>
<td><p>Right jaw aperture [m]</p></td>
<td><p>0</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-even"><td><p><cite>jawTiltLeft</cite></p></td>
<td><p>Left jaw tilt angle [rad]</p></td>
<td><p>0</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-odd"><td><p><cite>jawTiltRight</cite></p></td>
<td><p>Right jaw tilt angle [rad]</p></td>
<td><p>0</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-even"><td><p><cite>horizontalWidth</cite></p></td>
<td><p>Outer full width [m]</p></td>
<td><p>0.5 m</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-odd"><td><p><cite>colour</cite></p></td>
<td><p>Name of colour desired for
block. See <a class="reference internal" href="model_customisation.html#colours"><span class="std std-ref">Colours</span></a>.</p></td>
<td><p>“”</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-even"><td><p><cite>minimumKineticEnergy</cite></p></td>
<td><p>Minimum kinetic energy below
which to artificially kill
particles in this collimator only</p></td>
<td><p>0</p></td>
<td><p>No</p></td>
</tr>
</tbody>
</table>
<p>Notes:</p>
<ul class="simple">
<li><p>The <cite>horizontalWidth</cite> must be greater than 2x <cite>xsize</cite>.</p></li>
<li><p>To prevent the jaws overlapping with one another, a jaw cannot be constructed that crosses the
X axis of the element (i.e supplying a negative <cite>xsizeLeft</cite> or <cite>xsizeRight</cite> will not work). Should
you require this, please offset the element using the element parameters <cite>offsetX</cite> and <cite>offsetY</cite> instead.</p></li>
<li><p>To construct a collimator jaws with one jaw closed (i.e. an offset of 0), the horizontal half aperture
must be set to 0, with the other jaws half aperture set as appropriate.</p></li>
<li><p>If <cite>xsize</cite>, <cite>xsizeLeft</cite> and <cite>xsizeRight</cite> are not specified, the collimator will be constructed
as a box with no aperture.</p></li>
<li><p>For <strong>only one jaw</strong>, specifying a jaw aperture which is larger than half the <cite>horizontalWidth</cite> value
will result in that jaw not being constructed. If both jaw apertures are greater than
half the <cite>horizontalWidth</cite>, no jaws will be built and BDSIM will exit.</p></li>
<li><p>To preserve the longitudinal dimensions, jaw tilt specified with <cite>jawTiltLeft</cite> or <cite>jawTiltRight</cite> and <cite>xsizeRight</cite>
uses parallelepipeds instead of boxes for the collimator jaws. Relative to using angled boxes, this can introduce and
error in the material traversed by incident particles, which scales as $btan(alpha)$, where b is
the impact parameter (depth of impact) and $alpha$ is the jaw tilt angle.</p></li>
<li><p>The parameter <cite>minimumKineticEnergy</cite> (GeV by default) may be specified to artificially kill
particles below this kinetic energy in the collimator. This is useful to match other simulations
where collimators can be assumed to be infinite absorbers. If this behaviour is required, the
user should specify an energy greater than the total beam energy.</p></li>
<li><p>All collimators can be made infinite absorbers with the general option
<code class="code docutils literal notranslate"><span class="pre">collimatorsAreInfiniteAbsorbers</span></code> (see <a class="reference internal" href="model_control.html#options-tracking"><span class="std std-ref">Tracking Options</span></a>).</p></li>
</ul>
<p>Examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>! standard
col: jcoltip, l=1.22*m, material=&quot;Cu&quot;, tipMaterial=&quot;W&quot;, tipThickness=1*cm, xsize=0.1*cm, ysize=5*cm;

! two separately specified jaws with tip material
j1: jcoltip, l=1*m, horizontalWidth=1*m, material=&quot;Cu&quot;, tipMaterial=&quot;W&quot;, tipThickness=1*cm, xsizeLeft=1*cm, xsizeRight=1.5*cm;

! only left jaw with tip
j2: jcoltip, l=1*m, horizontalWidth=1*m, material=&quot;Cu&quot;, tipMaterial=&quot;W&quot;, tipThickness=1*cm, xsizeLeft=1*cm, xsizeRight=2*m;
</pre></div>
</div>
</section>
<section id="degrader">
<h3>degrader<a class="headerlink" href="#degrader" title="Link to this heading"></a></h3>
<figure class="align-center">
<a class="reference internal image-reference" href="_images/degrader.png"><img alt="_images/degrader.png" src="_images/degrader.png" style="width: 60%;" /></a>
</figure>
<p><cite>degrader</cite> defines interleaved pyramidal pieces of material. Depending on the physics list
used, this is capable of reducing the beam energy. This happens only through interaction
and the use of a physics list. Note, the default physics list in BDSIM is no physics and
only magnetic tracking, in which case this component will have no effect.</p>
<ul class="simple">
<li><p>If 1 wedge is specified, the degrader will be composed of 1 half wedge on each side.</p></li>
<li><p>If 2 wedges are specified, the degrader will be a half, a whole then a half wedge.</p></li>
<li><p>The above diagram shows a degrader with 3 wedges specified.</p></li>
</ul>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The nominal beam energy of each magnet after the degrader is unchanged and
is still the design energy of the machine. It is not possible to accurately
calculate the degradation in kinetic energy for all materials and particles
analytically. The user should use the <code class="code docutils literal notranslate"><span class="pre">scaling</span></code> parameter for any
magnet placed after the degrader to linearly scale the field strength. Or in
the case where there are no magnets before the degrader, set the design energy
of using the beam command as the energy afterwards and the <code class="code docutils literal notranslate"><span class="pre">E0</span></code> to the
higher input energy.</p>
</div>
<table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p>Parameter</p></td>
<td><p>Description</p></td>
<td><p>Default</p></td>
<td><p>Required</p></td>
</tr>
<tr class="row-even"><td><p><cite>l</cite></p></td>
<td><p>Length [m]</p></td>
<td><p>0</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-odd"><td><p><cite>numberWedges</cite></p></td>
<td><p>Number of degrader wedges</p></td>
<td><p>1</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-even"><td><p><cite>wedgeLength</cite></p></td>
<td><p>Degrader wedge length [m]</p></td>
<td><p>0</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-odd"><td><p><cite>degraderHeight</cite></p></td>
<td><p>Degrader height [m]</p></td>
<td><p>0</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-even"><td><p><cite>materialThickness</cite></p></td>
<td><p>Amount of material seen by the beam [m]</p></td>
<td><p>0</p></td>
<td><p>Yes/No*</p></td>
</tr>
<tr class="row-odd"><td><p><cite>degraderOffset</cite></p></td>
<td><p>Horizontal offset of both wedge sets</p></td>
<td><p>0</p></td>
<td><p>Yes/No*</p></td>
</tr>
<tr class="row-even"><td><p><cite>material</cite></p></td>
<td><p>Degrader material</p></td>
<td><p>Carbon</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-odd"><td><p><cite>horizontalWidth</cite></p></td>
<td><p>Outer full width [m]</p></td>
<td><p>global</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-even"><td><p><cite>colour</cite></p></td>
<td><p>Colour of block. See <a class="reference internal" href="model_customisation.html#colours"><span class="std std-ref">Colours</span></a></p></td>
<td><p>“”</p></td>
<td><p>No</p></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Either <cite>materialThickness</cite> or <cite>degraderOffset</cite> can be specified to adjust the horizontal
lateral wedge position, and consequently the total material thickness the beam can propagate
through. An offset of zero will corresponds to a full closed degrader, and is equivalent to a
materialThickness being the degrader length. If both are specified, <cite>degraderOffset</cite> will be ignored.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When numberWedges is specified to be n, the degrader will consist of n-1 <cite>full</cite> wedges and
two <cite>half</cite> wedges. When viewed from above, a <cite>full</cite> wedge appears as an isosceles triangle, and
a <cite>half</cite> wedge appears as a right-angled triangle.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>A base is included with each wedge. Without it, if the materialThickness were to be set to
the same as the degrader length, only half the beam would be degraded when passing through a wedge.
The base provides material such that the whole width of the beam pipe would see material when the
degrader is fully closed. As such, the degrader offset must be greater than or equal to zero.
Negative offsets causes BDSIM to exit.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If the user wants a fully open degrader, the degrader offset should be set to a value larger
than the wedgeLength.</p>
</div>
<p>Examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">DEG1</span><span class="p">:</span> <span class="n">degrader</span><span class="p">,</span> <span class="n">l</span><span class="o">=</span><span class="mf">0.25</span><span class="o">*</span><span class="n">m</span><span class="p">,</span> <span class="n">material</span><span class="o">=</span><span class="s2">&quot;carbon&quot;</span><span class="p">,</span> <span class="n">numberWedges</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">wedgeLength</span><span class="o">=</span><span class="mi">100</span><span class="o">*</span><span class="n">mm</span><span class="p">,</span> <span class="n">degraderHeight</span><span class="o">=</span><span class="mi">100</span><span class="o">*</span><span class="n">mm</span><span class="p">,</span> <span class="n">materialThickness</span><span class="o">=</span><span class="mi">200</span><span class="o">*</span><span class="n">mm</span><span class="p">;</span>
<span class="n">DEG2</span><span class="p">:</span> <span class="n">degrader</span><span class="p">,</span> <span class="n">l</span><span class="o">=</span><span class="mf">0.25</span><span class="o">*</span><span class="n">m</span><span class="p">,</span> <span class="n">material</span><span class="o">=</span><span class="s2">&quot;carbon&quot;</span><span class="p">,</span> <span class="n">numberWedges</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">wedgeLength</span><span class="o">=</span><span class="mi">100</span><span class="o">*</span><span class="n">mm</span><span class="p">,</span> <span class="n">degraderHeight</span><span class="o">=</span><span class="mi">100</span><span class="o">*</span><span class="n">mm</span><span class="p">,</span> <span class="n">degraderOffset</span><span class="o">=</span><span class="mi">50</span><span class="o">*</span><span class="n">mm</span><span class="p">;</span>
</pre></div>
</div>
</section>
<section id="muspoiler">
<h3>muspoiler<a class="headerlink" href="#muspoiler" title="Link to this heading"></a></h3>
<figure class="align-center">
<a class="reference internal image-reference" href="_images/muspoiler.png"><img alt="_images/muspoiler.png" src="_images/muspoiler.png" style="width: 40%;" /></a>
</figure>
<p><cite>muspoiler</cite> defines a muon spoiler, which is a rotationally magnetised iron cylinder with
a beam pipe in the middle. There is no magnetic field in the beam pipe.</p>
<table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p>Parameter</p></td>
<td><p>Description</p></td>
<td><p>Default</p></td>
<td><p>Required</p></td>
</tr>
<tr class="row-even"><td><p><cite>l</cite></p></td>
<td><p>Length [m]</p></td>
<td><p>0</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-odd"><td><p><cite>B</cite></p></td>
<td><p>Magnetic field [T]</p></td>
<td><p>0</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-even"><td><p><cite>material</cite></p></td>
<td><p>Outer material</p></td>
<td><p>Iron</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-odd"><td><p><cite>horizontalWidth</cite></p></td>
<td><p>Outer full width [m]</p></td>
<td><p>global</p></td>
<td><p>No</p></td>
</tr>
</tbody>
</table>
<p>Notes:</p>
<ul class="simple">
<li><p>The <a class="reference internal" href="model_customisation.html#aperture-parameters"><span class="std std-ref">Aperture Parameters</span></a> may also be specified.</p></li>
<li><p>No field is constructed if B is the default 0.</p></li>
</ul>
</section>
<section id="shield">
<h3>shield<a class="headerlink" href="#shield" title="Link to this heading"></a></h3>
<figure class="align-center">
<a class="reference internal image-reference" href="_images/shield.png"><img alt="_images/shield.png" src="_images/shield.png" style="width: 40%;" /></a>
</figure>
<p><cite>shield</cite> defines a square block of material with a square aperture. The user may choose
the outer width and inner horizontal and vertical apertures of the block. A beam pipe
is also placed inside the aperture.  If the beam pipe dimensions (including thickness)
are greater than the aperture, the beam pipe will not be created.</p>
<table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p>Parameter</p></td>
<td><p>Description</p></td>
<td><p>Default</p></td>
<td><p>Required</p></td>
</tr>
<tr class="row-even"><td><p><cite>l</cite></p></td>
<td><p>Length [m]</p></td>
<td><p>0</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-odd"><td><p><cite>material</cite></p></td>
<td><p>Outer material</p></td>
<td><p>Iron</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-even"><td><p><cite>horizontalWidth</cite></p></td>
<td><p>Outer full width [m]</p></td>
<td><p>global</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-odd"><td><p><cite>xsize</cite></p></td>
<td><p>Horizontal inner half aperture [m]</p></td>
<td><p>0</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-even"><td><p><cite>ysize</cite></p></td>
<td><p>Vertical inner half aperture [m]</p></td>
<td><p>0</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-odd"><td><p><cite>colour</cite></p></td>
<td><p>Colour of block. See <a class="reference internal" href="model_customisation.html#colours"><span class="std std-ref">Colours</span></a></p></td>
<td><p>“”</p></td>
<td><p>No</p></td>
</tr>
</tbody>
</table>
<p>Notes:</p>
<ul class="simple">
<li><p>The <a class="reference internal" href="model_customisation.html#aperture-parameters"><span class="std std-ref">Aperture Parameters</span></a> may also be specified.</p></li>
</ul>
</section>
<section id="dump">
<h3>dump<a class="headerlink" href="#dump" title="Link to this heading"></a></h3>
<figure class="align-center">
<a class="reference internal image-reference" href="_images/dump.png"><img alt="_images/dump.png" src="_images/dump.png" style="width: 40%;" /></a>
</figure>
<p><cite>dump</cite> defines a square or circular block of material that is an infinite absorber. All
particles impacting the dump will be absorbed irrespective of the particle and physics
processes.</p>
<p>This is intended as a useful way to absorb a beam with no computational time. Normally,
the world volume is filled with air. If the beam reaches the end of the beam line it will
hit the air and likely create a shower of particles that will take some time to simulate.
In this case, when this isn’t required, it is recommended to use a dump object to absorb
the beam.</p>
<table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p>Parameter</p></td>
<td><p>Description</p></td>
<td><p>Default</p></td>
<td><p>Required</p></td>
</tr>
<tr class="row-even"><td><p><cite>l</cite></p></td>
<td><p>Length [m]</p></td>
<td><p>1 mm</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-odd"><td><p><cite>horizontalWidth</cite></p></td>
<td><p>Outer full width [m]</p></td>
<td><p>global</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-even"><td><p><cite>apertureType</cite></p></td>
<td><p>Which shape</p></td>
<td><p>rectangular</p></td>
<td><p>No</p></td>
</tr>
</tbody>
</table>
<p>How this works: the material of the dump is actually vacuum, but G4UserLimits are used to
kill particles. This requires the cuts and limits physics process that is included automatically.
In the case of using a Geant4 reference physics list (see <a class="reference internal" href="model_control.html#physics-geant4-lists"><span class="std std-ref">Geant4 Reference Physics Lists</span></a>), the
necessary process is added automatically to enforce this.</p>
<p>The dump may accept <cite>apertureType</cite> with the value of either <cite>circular</cite> or <cite>rectangular</cite> for
the shape of the dump. By default it is rectangular.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Although the syntax is “rectangular”, the shape for the dump will be square. This
will be improved in future when any shape can be used.</p>
</div>
<p>Examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">d1</span><span class="p">:</span> <span class="n">dump</span><span class="p">,</span> <span class="n">horizontalWidth</span><span class="o">=</span><span class="mi">20</span><span class="o">*</span><span class="n">cm</span><span class="p">;</span>
<span class="n">d2</span><span class="p">:</span> <span class="n">dump</span><span class="p">,</span> <span class="n">horizontalWidth</span><span class="o">=</span><span class="mi">30</span><span class="o">*</span><span class="n">cm</span><span class="p">,</span> <span class="n">apertureType</span><span class="o">=</span><span class="s2">&quot;circular&quot;</span><span class="p">;</span>
<span class="n">d3</span><span class="p">:</span> <span class="n">dump</span><span class="p">,</span> <span class="n">l</span><span class="o">=</span><span class="mf">0.3</span><span class="o">*</span><span class="n">m</span><span class="p">,</span> <span class="n">horizontalWidth</span><span class="o">=</span><span class="mi">40</span><span class="o">*</span><span class="n">cm</span><span class="p">,</span> <span class="n">apertureType</span><span class="o">=</span><span class="s2">&quot;rectangular&quot;</span><span class="p">;</span>
</pre></div>
</div>
<p>Here, <cite>d1</cite> is a rectangular block 20 cm wide (full width) and 1 mm long in z. <cite>d2</cite> is a
circular disk with diameter 30 cm and length of 1 mm in z. <cite>d3</cite> is 30 cm long in z and
40 cm width (full width) in x and y with a square shape.</p>
</section>
<section id="solenoid">
<h3>solenoid<a class="headerlink" href="#solenoid" title="Link to this heading"></a></h3>
<figure class="align-center">
<a class="reference internal image-reference" href="_images/solenoid.png"><img alt="_images/solenoid.png" src="_images/solenoid.png" style="width: 40%;" /></a>
</figure>
<p><cite>solenoid</cite> defines a solenoid magnet. This utilises a thick lens transfer map with a
hard edge field profile. Fringes for the edge effects are provided by default and
are controllable with the option <cite>includeFringeFields</cite>. A field is supplied that is
used in the case a particle cannot be tracked using the integrator. In this case, it
is a perfect dipole field along the local <span class="math notranslate nohighlight">\(z\)</span> axis inside the beam pipe with
no spatial variation. Outside the beam pipe, in the <em>‘yoke’</em>, a solenoidal field
according to a cylindrical current source is constructed.</p>
<table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p>Parameter</p></td>
<td><p>Description</p></td>
<td><p>Default</p></td>
<td><p>Required</p></td>
</tr>
<tr class="row-even"><td><p><cite>l</cite></p></td>
<td><p>Length [m]</p></td>
<td><p>0</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-odd"><td><p><cite>ks</cite></p></td>
<td><p>Solenoid strength</p></td>
<td><p>0</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-even"><td><p><cite>B</cite></p></td>
<td><p>Magnetic field</p></td>
<td><p>0</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-odd"><td><p><cite>material</cite></p></td>
<td><p>Outer material</p></td>
<td><p>Iron</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-even"><td><p><cite>horizontalWidth</cite></p></td>
<td><p>Outer full width [m]</p></td>
<td><p>global</p></td>
<td><p>No</p></td>
</tr>
</tbody>
</table>
<ul class="simple">
<li><p>A positive field corresponds to a field in along the direction of positive S.</p></li>
<li><p>The entrance / exit solenoid fringes are not constructed if the previous / next element is also a solenoid.</p></li>
<li><p>See <a class="reference internal" href="#id5">Magnet Strength Polarity</a> for polarity notes.</p></li>
</ul>
<p>A thin sheet cylinder is place also inside the yoke but of the same material. The
colour is copper colour to indicate this is the shape used to calculate the solenoidal
field for the yoke. This is of the same material so it has no effect on physics results.
The ‘current’ cylinder is chosen to be <span class="math notranslate nohighlight">\(0.8 \times l\)</span> and the radius is
<span class="math notranslate nohighlight">\(\frac{1}{3}\)</span> of the distance between the beam pipe radius and the outer radius.</p>
<p>Examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">atlassol</span><span class="p">:</span> <span class="n">solenoid</span><span class="p">,</span> <span class="n">l</span><span class="o">=</span><span class="mi">20</span><span class="o">*</span><span class="n">m</span><span class="p">,</span> <span class="n">ks</span><span class="o">=</span><span class="mf">0.004</span><span class="p">;</span>
</pre></div>
</div>
<p>Another visualisation:</p>
<figure class="align-center" id="id14">
<a class="reference internal image-reference" href="_images/solenoid2.png"><img alt="_images/solenoid2.png" src="_images/solenoid2.png" style="width: 70%;" /></a>
<figcaption>
<p><span class="caption-text">A partially transparent visualiation of a solenoid showing the interior current
cylinder sheet - made of the same material as the yoke. The field is shown in the
<span class="math notranslate nohighlight">\(x-z\)</span> plane.</span><a class="headerlink" href="#id14" title="Link to this image"></a></p>
</figcaption>
</figure>
</section>
<section id="wirescanner">
<h3>wirescanner<a class="headerlink" href="#wirescanner" title="Link to this heading"></a></h3>
<figure class="align-center">
<a class="reference internal image-reference" href="_images/wirescanner.png"><img alt="_images/wirescanner.png" src="_images/wirescanner.png" style="width: 40%;" /></a>
</figure>
<p><cite>wirescanner</cite> defines a cylindrical object within a beam pipe to represent a wire
scanner typically use in an accelerator.</p>
<table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p>parameter</p></td>
<td><p>description</p></td>
<td><p>default</p></td>
<td><p>required</p></td>
</tr>
<tr class="row-even"><td><p><cite>l</cite></p></td>
<td><p>length of drift section around wire</p></td>
<td><p>0</p></td>
<td><p>yes</p></td>
</tr>
<tr class="row-odd"><td><p><cite>wireDiameter</cite></p></td>
<td><p>diameter of wire [m]</p></td>
<td><p>0</p></td>
<td><p>yes</p></td>
</tr>
<tr class="row-even"><td><p><cite>wireLength</cite></p></td>
<td><p>length of wirescanner [m]</p></td>
<td><p>0</p></td>
<td><p>yes</p></td>
</tr>
<tr class="row-odd"><td><p><cite>material</cite></p></td>
<td><p>material of wire</p></td>
<td><p>none</p></td>
<td><p>yes</p></td>
</tr>
<tr class="row-even"><td><p><cite>wireAngle</cite></p></td>
<td><p>angle of the wire w.r.t. vertical</p></td>
<td><p>0</p></td>
<td><p>no</p></td>
</tr>
<tr class="row-odd"><td><p><cite>wireOffsetX</cite></p></td>
<td><p>x offset of the wire from the center [m]</p></td>
<td><p>0</p></td>
<td><p>no</p></td>
</tr>
<tr class="row-even"><td><p><cite>wireOffsetY</cite></p></td>
<td><p>y offset of the wire from the center [m]</p></td>
<td><p>0</p></td>
<td><p>no</p></td>
</tr>
<tr class="row-odd"><td><p><cite>wireOffsetZ</cite></p></td>
<td><p>z offset of the wire from the center [m]</p></td>
<td><p>0</p></td>
<td><p>no</p></td>
</tr>
</tbody>
</table>
<p>Notes:</p>
<ul class="simple">
<li><p>The angle is the rotation from vertical in the clock-wise direction looping in the
positive S direction (the usually direction of the beam).</p></li>
</ul>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>After BDSIM V1.3.2 <code class="code docutils literal notranslate"><span class="pre">wireAngle</span></code> is used for the angle instead of
<code class="code docutils literal notranslate"><span class="pre">angle</span></code> as <code class="code docutils literal notranslate"><span class="pre">angle</span></code> is used specifically for angles of bends
and this could result in the curvilinear world being made very small.</p>
</div>
<p>The offsets are with respect to the centre of the beam pipe section the wire is placed inside.
This should therefore be less than half the element length <cite>l</cite>. The usual beam pipe parameters
can be specified and apply the to the beam pipe. For example, <cite>material</cite> is used for the beam
pipe material whereas <cite>wireMaterial</cite> is used for the material of the wire.</p>
<p>The user should take care to define a wire long enough to intercept the beam but be sufficiently
short to fit inside the beam pipe given the offsets in x, y and z. Checks are made on the end
points of the wire.</p>
<p>Examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ws45Deg</span><span class="p">:</span> <span class="n">wirescanner</span><span class="p">,</span> <span class="n">l</span><span class="o">=</span><span class="mi">4</span><span class="o">*</span><span class="n">cm</span><span class="p">,</span> <span class="n">wireDiameter</span><span class="o">=</span><span class="mf">0.1</span><span class="o">*</span><span class="n">mm</span><span class="p">,</span> <span class="n">wireLength</span><span class="o">=</span><span class="mi">5</span><span class="o">*</span><span class="n">cm</span><span class="p">,</span>
                      <span class="n">wireOffsetX</span><span class="o">=</span><span class="mi">1</span><span class="o">*</span><span class="n">cm</span><span class="p">,</span> <span class="n">angle</span><span class="o">=</span><span class="n">pi</span><span class="o">/</span><span class="mi">4</span><span class="p">,</span> <span class="n">wireMaterial</span><span class="o">=</span><span class="s2">&quot;C&quot;</span><span class="p">,</span>
                      <span class="n">aper1</span><span class="o">=</span><span class="mi">5</span><span class="o">*</span><span class="n">cm</span><span class="p">;</span>

<span class="n">wsVertical</span><span class="p">:</span> <span class="n">wirescanner</span><span class="p">,</span> <span class="n">l</span><span class="o">=</span><span class="mi">4</span><span class="o">*</span><span class="n">cm</span><span class="p">,</span> <span class="n">wireDiameter</span><span class="o">=</span><span class="mf">0.1</span><span class="o">*</span><span class="n">mm</span><span class="p">,</span> <span class="n">wireLength</span><span class="o">=</span><span class="mi">5</span><span class="o">*</span><span class="n">cm</span><span class="p">,</span>
                         <span class="n">wireOffsetX</span><span class="o">=</span><span class="mi">1</span><span class="o">*</span><span class="n">cm</span><span class="p">,</span> <span class="n">wireOffsetZ</span><span class="o">=</span><span class="mf">1.6</span><span class="o">*</span><span class="n">cm</span><span class="p">,</span> <span class="n">wireMaterial</span><span class="o">=</span><span class="s2">&quot;C&quot;</span><span class="p">;</span>
</pre></div>
</div>
</section>
<section id="laser">
<h3>laser<a class="headerlink" href="#laser" title="Link to this heading"></a></h3>
<p><cite>laser</cite> defines a drift section with a laser beam inside. The laser acts as a static target
of photons.</p>
<table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p>Parameter</p></td>
<td><p>Description</p></td>
<td><p>Default</p></td>
<td><p>Required</p></td>
</tr>
<tr class="row-even"><td><p><cite>l</cite></p></td>
<td><p>Length of drift section [m]</p></td>
<td><p>0</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-odd"><td><p><cite>x</cite>, <cite>y</cite>, <cite>z</cite></p></td>
<td><p>Components of laser direction vector (normalised)</p></td>
<td><p>(1,0,0)</p></td>
<td><p>yes</p></td>
</tr>
<tr class="row-even"><td><p><cite>waveLength</cite></p></td>
<td><p>Laser wavelength [m]</p></td>
<td><p>532*nm</p></td>
<td><p>Yes</p></td>
</tr>
</tbody>
</table>
<p>Examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">laserwire</span><span class="p">:</span> <span class="n">laser</span><span class="p">,</span> <span class="n">l</span><span class="o">=</span><span class="mi">1</span><span class="o">*</span><span class="n">um</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">wavelength</span><span class="o">=</span><span class="mi">532</span><span class="o">*</span><span class="n">nm</span><span class="p">;</span>
</pre></div>
</div>
</section>
<section id="gap">
<h3>gap<a class="headerlink" href="#gap" title="Link to this heading"></a></h3>
<p><cite>gap</cite> defines a gap where no physical geometry is placed. It will be a region of the world,
composed of the same material as the world volume.</p>
<table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p>Parameter</p></td>
<td><p>Description</p></td>
<td><p>Default</p></td>
<td><p>Required</p></td>
</tr>
<tr class="row-even"><td><p><cite>l</cite></p></td>
<td><p>Length [m]</p></td>
<td><p>0</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-odd"><td><p><cite>angle</cite></p></td>
<td><p>Angle [rad]</p></td>
<td><p>0</p></td>
<td><p>No</p></td>
</tr>
</tbody>
</table>
<p>Examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">GAP1</span><span class="p">:</span> <span class="n">gap</span><span class="p">,</span> <span class="n">l</span><span class="o">=</span><span class="mf">0.25</span><span class="o">*</span><span class="n">m</span><span class="p">,</span> <span class="n">angle</span><span class="o">=</span><span class="mf">0.01</span><span class="o">*</span><span class="n">rad</span><span class="p">;</span>
</pre></div>
</div>
</section>
<section id="crystalcol">
<span id="element-crystal-col"></span><h3>crystalcol<a class="headerlink" href="#crystalcol" title="Link to this heading"></a></h3>
<figure class="align-center">
<a class="reference internal image-reference" href="_images/crystalcol.png"><img alt="_images/crystalcol.png" src="_images/crystalcol.png" style="width: 30%;" /></a>
</figure>
<p><cite>crystalcol</cite> defines a crystal collimator that uses crystals to channel particles. It is
composed of a beam pipe with one or two crystals inside it. The crystals can be the same
(but placed at different angles) or different. The crystals are placed +- <cite>xsize</cite> away
from the centre.</p>
<p>The crystal is defined in a separate object in the parser and referred to by the name of
that object. At least one of <cite>crystalBoth</cite>, <cite>crystalLeft</cite> and <cite>crystalRight</cite> must be
specified.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>This requires the user to use the “completechannelling” or “channelling” physics list
for channelling to take place.</p>
</div>
<table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p>Parameter</p></td>
<td><p>Description</p></td>
<td><p>Default</p></td>
<td><p>Required</p></td>
</tr>
<tr class="row-even"><td><p><cite>l</cite></p></td>
<td><p>Length [m]</p></td>
<td><p>0</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-odd"><td><p><cite>xsize</cite></p></td>
<td><p>Half-gap distance of each crystal from centre [m]</p></td>
<td><p>0</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-even"><td><p><cite>material</cite></p></td>
<td><p>Material</p></td>
<td><p>“”</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-odd"><td><p><cite>crystalBoth</cite></p></td>
<td><p>Name of crystal object for both crystals</p></td>
<td><p>“”</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-even"><td><p><cite>crystalLeft</cite></p></td>
<td><p>Name of crystal object for right crystal</p></td>
<td><p>“”</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-odd"><td><p><cite>crystalRight</cite></p></td>
<td><p>Name of crystal object for left crystal</p></td>
<td><p>“”</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-even"><td><p><cite>crystalAngleYAxisLeft</cite></p></td>
<td><p>Rotation angle of left crystal [rad]</p></td>
<td><p>0</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-odd"><td><p><cite>crystalAngleYAxisRight</cite></p></td>
<td><p>Rotation angle of right crystal [rad]</p></td>
<td><p>0</p></td>
<td><p>No</p></td>
</tr>
</tbody>
</table>
<p>Notes:</p>
<ul class="simple">
<li><p>A positive crystalAngleYAxisLeft will result in the crystal being rotated away from the z axis of the
collimator. Therefore, a positive angle for both a left and right crystal will result in diverging
crystals.</p></li>
<li><p>The bending angle of the left crystal is reversed from the definition. Therefore a positive bending angle
will result in the crystal bending away from the z axis of the collimator for both left and right crystals.</p></li>
<li><p>Crystal channelling potential files are required for this - see <a class="reference internal" href="model_customisation.html#crystals"><span class="std std-ref">Crystals</span></a> for more details.</p></li>
<li><p>If only <cite>crystalLeft</cite> or <cite>crystalRight</cite> is specified, only one crystal will be placed.</p></li>
<li><p>If both <cite>crystalLeft</cite> and <cite>crystalRight</cite> are specified, both will be constructed uniquely and placed.</p></li>
<li><p>If <cite>crystalBoth</cite> is specified, <cite>crystalLeft</cite> and <cite>crystalRight</cite> will be ignored and the <cite>crystalBoth</cite>
definition will be used for both crystals. The angles will be unique.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Crystal channelling is only available in Geant4.10.4 onwards. If BDSIM is compiled with a Geant4
version below this, the geometry will be constructed correctly but the channelling physics process
will not be used and the crystal will not channel particles.</p>
</div>
<ul class="simple">
<li><p>See <a class="reference internal" href="model_customisation.html#crystals"><span class="std std-ref">Crystals</span></a> for the definition of a crystal object.</p></li>
</ul>
<p>Examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">lovelycrystal</span><span class="p">:</span> <span class="n">crystal</span><span class="p">,</span> <span class="n">material</span> <span class="o">=</span> <span class="s2">&quot;G4_Si&quot;</span><span class="p">,</span>
                      <span class="n">data</span> <span class="o">=</span> <span class="s2">&quot;data/Si220pl&quot;</span><span class="p">,</span>
                      <span class="n">shape</span> <span class="o">=</span> <span class="s2">&quot;box&quot;</span><span class="p">,</span>
                      <span class="n">lengthY</span> <span class="o">=</span> <span class="mi">5</span><span class="o">*</span><span class="n">cm</span><span class="p">,</span>
                      <span class="n">lengthX</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">mm</span><span class="p">,</span>
                      <span class="n">lengthZ</span> <span class="o">=</span> <span class="mi">4</span><span class="o">*</span><span class="n">mm</span><span class="p">,</span>
                      <span class="n">sizeA</span> <span class="o">=</span> <span class="mf">5.43</span><span class="o">*</span><span class="n">ang</span><span class="p">,</span>
                      <span class="n">sizeB</span> <span class="o">=</span> <span class="mf">5.43</span><span class="o">*</span><span class="n">ang</span><span class="p">,</span>
                      <span class="n">sizeC</span> <span class="o">=</span> <span class="mf">5.43</span><span class="o">*</span><span class="n">ang</span><span class="p">,</span>
                      <span class="n">alpha</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
                      <span class="n">beta</span>  <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
                      <span class="n">gamma</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
                      <span class="n">spaceGroup</span> <span class="o">=</span> <span class="mi">227</span><span class="p">,</span>
                      <span class="n">bendingAngleYAxis</span> <span class="o">=</span> <span class="mf">0.1</span><span class="o">*</span><span class="n">rad</span><span class="p">,</span>
                      <span class="n">bendingAngleZAxis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

 <span class="n">col1</span> <span class="p">:</span> <span class="n">crystalcol</span><span class="p">,</span> <span class="n">l</span><span class="o">=</span><span class="mi">6</span><span class="o">*</span><span class="n">mm</span><span class="p">,</span> <span class="n">apertureType</span><span class="o">=</span><span class="s2">&quot;rectangular&quot;</span><span class="p">,</span> <span class="n">aper1</span><span class="o">=</span><span class="mf">0.25</span><span class="o">*</span><span class="n">cm</span><span class="p">,</span> <span class="n">aper2</span><span class="o">=</span><span class="mi">5</span><span class="o">*</span><span class="n">cm</span><span class="p">,</span>
                    <span class="n">crystalBoth</span><span class="o">=</span><span class="s2">&quot;lovelycrystal&quot;</span><span class="p">,</span> <span class="n">crystalAngleYAxisLeft</span><span class="o">=-</span><span class="mf">0.1</span><span class="o">*</span><span class="n">rad</span><span class="p">,</span>
                    <span class="n">crystalAngleYAxisRight</span><span class="o">=-</span><span class="mf">0.1</span><span class="o">*</span><span class="n">rad</span><span class="p">,</span> <span class="n">xsize</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">mm</span><span class="p">;</span>
</pre></div>
</div>
<p>More examples can be found in <code class="code docutils literal notranslate"><span class="pre">bdsim/examples/components</span></code> and are described in <a class="reference internal" href="examples/11_crystals.html#crystal-examples"><span class="std std-ref">Crystals</span></a>.</p>
</section>
<section id="undulator">
<h3>undulator<a class="headerlink" href="#undulator" title="Link to this heading"></a></h3>
<figure class="align-center">
<a class="reference internal image-reference" href="_images/undulator.png"><img alt="_images/undulator.png" src="_images/undulator.png" style="width: 60%;" /></a>
</figure>
<p><cite>undulator</cite> defines an undulator magnet which has a sinusoidally varying field along the element with
field components:</p>
<div class="math notranslate nohighlight">
\[\begin{split}B_{x} ~ &amp;= ~ 0 \\
B_{y} ~ &amp;= ~ B \cdot \cos\big(z \frac{2\pi}{\lambda}\big) \cosh\big(y \frac{2\pi}{\lambda}\big)\\
B_{z} ~ &amp;= ~ -B \cdot \sin\big(z \frac{2\pi}{\lambda}\big) \sinh\big(y \frac{2\pi}{\lambda}\big)\end{split}\]</div>
<p>where <span class="math notranslate nohighlight">\(\lambda\)</span> is the undulator period.</p>
<table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p>Parameter</p></td>
<td><p>Description</p></td>
<td><p>Default</p></td>
<td><p>Required</p></td>
</tr>
<tr class="row-even"><td><p><cite>l</cite></p></td>
<td><p>Length [m]</p></td>
<td><p>0</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-odd"><td><p><cite>B</cite></p></td>
<td><p>Magnetic field [T]</p></td>
<td><p>0</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-even"><td><p><cite>undulatorPeriod</cite></p></td>
<td><p>Undulator magnetic period [m]</p></td>
<td><p>1</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-odd"><td><p><cite>undulatorGap</cite></p></td>
<td><p>Undulator gap [m]</p></td>
<td><p>0</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-even"><td><p><cite>undulatorMagnetHeight</cite></p></td>
<td><p>Undulator magnet height [m]</p></td>
<td><p>0</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-odd"><td><p><cite>material</cite></p></td>
<td><p>Magnet outer material</p></td>
<td><p>Iron</p></td>
<td><p>No</p></td>
</tr>
</tbody>
</table>
<p>Notes:</p>
<ul class="simple">
<li><p>The undulator period must be an integer factor of the undulator length. If not, BDSIM will exit.</p></li>
<li><p>The undulator gap is the total distance between the upper and lower sets of magnets. If not supplied,
it is set to twice the beam pipe diameter.</p></li>
<li><p>The undulator magnet height is the vertical height of the sets of magnets. If not supplied, it is set
to the 0.5*horizontalWidth - undulator gap.</p></li>
<li><p>The <a class="reference internal" href="model_customisation.html#aperture-parameters"><span class="std std-ref">Aperture Parameters</span></a> may also be specified.</p></li>
<li><p>See <a class="reference internal" href="#id5">Magnet Strength Polarity</a> for polarity notes.</p></li>
<li><p>To generate radiation from particles propagating through the undulator field, synchrotron radiation
physics must be included in the model’s physicsList. See <a class="reference internal" href="model_control.html#physics-processes"><span class="std std-ref">Physics Processes</span></a> for further details.</p></li>
</ul>
<p>Examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">u1</span><span class="p">:</span> <span class="n">undulator</span><span class="p">,</span> <span class="n">l</span><span class="o">=</span><span class="mf">2.0</span><span class="o">*</span><span class="n">m</span><span class="p">,</span> <span class="n">B</span><span class="o">=</span><span class="mf">0.1</span><span class="o">*</span><span class="n">T</span><span class="p">,</span> <span class="n">undulatorPeriod</span><span class="o">=</span><span class="mf">0.2</span><span class="o">*</span><span class="n">m</span><span class="p">;</span>
<span class="n">u2</span><span class="p">:</span> <span class="n">undulator</span><span class="p">,</span> <span class="n">l</span><span class="o">=</span><span class="mf">3.2</span><span class="o">*</span><span class="n">m</span><span class="p">,</span> <span class="n">B</span><span class="o">=</span><span class="mf">0.02</span><span class="o">*</span><span class="n">T</span><span class="p">,</span> <span class="n">undulatorPeriod</span><span class="o">=</span><span class="mf">0.16</span><span class="o">*</span><span class="n">m</span><span class="p">,</span> <span class="n">undulatorGap</span><span class="o">=</span><span class="mi">15</span><span class="o">*</span><span class="n">cm</span><span class="p">,</span> <span class="n">undulatorMagnetHeight</span><span class="o">=</span><span class="mi">10</span><span class="o">*</span><span class="n">cm</span><span class="p">;</span>
</pre></div>
</div>
</section>
<section id="transform3d">
<h3>transform3d<a class="headerlink" href="#transform3d" title="Link to this heading"></a></h3>
<p><cite>transform3d</cite> defines an arbitrary three-dimensional transformation of the curvilinear coordinate
system at that point in the beam line sequence. The user is responsible for ensuring no overlaps
in geometry are introduced. The drifts on either side currently will not have matching angular faces.</p>
<p>Two representations of rotation can be used. Either Euler angles or Axis Angle where unit vector
components are supplied to create an axis to rotate around by an angle. Euler is the default.
To select the axis angle representation, set <code class="code docutils literal notranslate"><span class="pre">axisAngle=1</span></code>.</p>
<table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p>Parameter</p></td>
<td><p>Description</p></td>
<td><p>Default</p></td>
<td><p>Required</p></td>
</tr>
<tr class="row-even"><td><p><cite>x</cite></p></td>
<td><p>x offset</p></td>
<td><p>0</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-odd"><td><p><cite>y</cite></p></td>
<td><p>y offset</p></td>
<td><p>0</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-even"><td><p><cite>z</cite></p></td>
<td><p>z offset</p></td>
<td><p>0</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-odd"><td><p><cite>phi</cite></p></td>
<td><p>phi Euler angle</p></td>
<td><p>0</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-even"><td><p><cite>theta</cite></p></td>
<td><p>theta Euler angle</p></td>
<td><p>0</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-odd"><td><p><cite>psi</cite></p></td>
<td><p>psi Euler angle</p></td>
<td><p>0</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-even"><td><p><cite>axisAngle</cite></p></td>
<td><p>whether to use axis angle</p></td>
<td><p>0</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-odd"><td><p><cite>axisX</cite></p></td>
<td><p>x component of axis vector</p></td>
<td><p>0</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-even"><td><p><cite>axisY</cite></p></td>
<td><p>y component of axis vector</p></td>
<td><p>0</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-odd"><td><p><cite>axisZ</cite></p></td>
<td><p>z component of axis vector</p></td>
<td><p>0</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-even"><td><p><cite>angle</cite></p></td>
<td><p>angle to rotate about axis</p></td>
<td><p>0</p></td>
<td><p>No</p></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>this permanently changes the coordinate frame, so care must be taken to undo any rotation
if intended for only one component.</p>
</div>
<p>Examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rcolrot</span><span class="p">:</span> <span class="n">transform3d</span><span class="p">,</span> <span class="n">psi</span><span class="o">=</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span>

<span class="n">tr1</span><span class="p">:</span> <span class="n">transform3d</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">mm</span><span class="p">,</span> <span class="n">axisAngle</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">axisY</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">angle</span><span class="o">=</span><span class="n">pi</span><span class="o">/</span><span class="mi">10</span><span class="p">;</span>
</pre></div>
</div>
</section>
<section id="rmatrix">
<span id="element-rmatrix"></span><h3>rmatrix<a class="headerlink" href="#rmatrix" title="Link to this heading"></a></h3>
<p><cite>rmatrix</cite> defines an arbitrary 4 <span class="math notranslate nohighlight">\(\times\)</span> 4 R matrix which represents a physical effect on the beam for
an element of finite length. The effect of an rmatrix describes the total effect through the full length of
the element, but is applied in a single instantaneous kick. As BDSIM is designed to track particles in a 3D model,
to apply this rmatrix in finite length geometry, BDSIM uses a parallel transporter to simply advance the particles
along S but without changing the particles transverse coordinates. The transverse effect from the matrix is applied
once in the middle of the element, whereafter particles are once again parallel transported to the end of the
element. This way, the correct transverse effect is applied, the recorded tracking time is correct as the particle
has tracked through a finite length element, and the model is constructed with the correct physical length.</p>
<p>The mathematical effect of the matrix on a particle is:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{pmatrix}
x_1    \\
x'_1   \\
y_1    \\
y'_1   \\
\end{pmatrix}
=
 \begin{pmatrix}
 R_{11} &amp; R_{12} &amp; R_{13} &amp; R_{14} \\
 R_{21} &amp; R_{22} &amp; R_{23} &amp; R_{24} \\
 R_{31} &amp; R_{32} &amp; R_{33} &amp; R_{34} \\
 R_{41} &amp; R_{42} &amp; R_{43} &amp; R_{44} \\
\end{pmatrix}
\begin{pmatrix}
x_0    \\
x'_0   \\
y_0    \\
y'_0   \\
\end{pmatrix}\end{split}\]</div>
<p>The geometry of an rmatrix element is simply that of a drift tube of the same length.</p>
<table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p>Parameter</p></td>
<td><p>Description</p></td>
<td><p>Default</p></td>
<td><p>Required</p></td>
</tr>
<tr class="row-even"><td><p><cite>l</cite></p></td>
<td><p>Length [m]</p></td>
<td><p>0</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-odd"><td><p><cite>rmat11</cite></p></td>
<td><p>matrix element <span class="math notranslate nohighlight">\(R_{11}\)</span></p></td>
<td><p>1</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-even"><td><p><cite>rmat12</cite></p></td>
<td><p>matrix element <span class="math notranslate nohighlight">\(R_{12}\)</span></p></td>
<td><p>0</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-odd"><td><p><cite>rmat13</cite></p></td>
<td><p>matrix element <span class="math notranslate nohighlight">\(R_{13}\)</span></p></td>
<td><p>0</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-even"><td><p><cite>rmat14</cite></p></td>
<td><p>matrix element <span class="math notranslate nohighlight">\(R_{14}\)</span></p></td>
<td><p>0</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-odd"><td><p><cite>rmat21</cite></p></td>
<td><p>matrix element <span class="math notranslate nohighlight">\(R_{21}\)</span></p></td>
<td><p>0</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-even"><td><p><cite>rmat22</cite></p></td>
<td><p>matrix element <span class="math notranslate nohighlight">\(R_{22}\)</span></p></td>
<td><p>1</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-odd"><td><p><cite>rmat23</cite></p></td>
<td><p>matrix element <span class="math notranslate nohighlight">\(R_{23}\)</span></p></td>
<td><p>0</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-even"><td><p><cite>rmat24</cite></p></td>
<td><p>matrix element <span class="math notranslate nohighlight">\(R_{24}\)</span></p></td>
<td><p>0</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-odd"><td><p><cite>rmat31</cite></p></td>
<td><p>matrix element <span class="math notranslate nohighlight">\(R_{31}\)</span></p></td>
<td><p>0</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-even"><td><p><cite>rmat32</cite></p></td>
<td><p>matrix element <span class="math notranslate nohighlight">\(R_{32}\)</span></p></td>
<td><p>0</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-odd"><td><p><cite>rmat33</cite></p></td>
<td><p>matrix element <span class="math notranslate nohighlight">\(R_{33}\)</span></p></td>
<td><p>1</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-even"><td><p><cite>rmat34</cite></p></td>
<td><p>matrix element <span class="math notranslate nohighlight">\(R_{34}\)</span></p></td>
<td><p>0</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-odd"><td><p><cite>rmat41</cite></p></td>
<td><p>matrix element <span class="math notranslate nohighlight">\(R_{41}\)</span></p></td>
<td><p>0</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-even"><td><p><cite>rmat42</cite></p></td>
<td><p>matrix element <span class="math notranslate nohighlight">\(R_{42}\)</span></p></td>
<td><p>0</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-odd"><td><p><cite>rmat43</cite></p></td>
<td><p>matrix element <span class="math notranslate nohighlight">\(R_{43}\)</span></p></td>
<td><p>0</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-even"><td><p><cite>rmat44</cite></p></td>
<td><p>matrix element <span class="math notranslate nohighlight">\(R_{44}\)</span></p></td>
<td><p>1</p></td>
<td><p>No</p></td>
</tr>
</tbody>
</table>
<p>Examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rm1</span><span class="p">:</span> <span class="n">rmatrix</span><span class="p">,</span> <span class="n">rmat12</span><span class="o">=</span><span class="mf">0.997</span><span class="p">,</span> <span class="n">rmat21</span><span class="o">=-</span><span class="mf">0.924</span><span class="p">;</span>
</pre></div>
</div>
</section>
<section id="thinrmatrix">
<h3>thinrmatrix<a class="headerlink" href="#thinrmatrix" title="Link to this heading"></a></h3>
<p><cite>thinrmatrix</cite> defines an arbitrary 4 <span class="math notranslate nohighlight">\(\times\)</span> 4 R matrix which represents a physical effect on the beam
within a thin element. Unlike the rmatrix, a thinrmatrix is an instantaneous effect in a thin element, therefore
no geometry is constructed. The parameters for a thinmatrix are the same as those for an <a class="reference internal" href="#element-rmatrix"><span class="std std-ref">rmatrix</span></a> except
for the length, <cite>l</cite>, which is not required.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The length of the thinrmatrix can be changed by setting <cite>thinElementLength</cite> (see <a class="reference internal" href="model_control.html#bdsim-options"><span class="std std-ref">Options</span></a>).</p>
</div>
<p>Examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rm1</span><span class="p">:</span> <span class="n">thinrmatrix</span><span class="p">,</span> <span class="n">rmat12</span><span class="o">=</span><span class="mf">0.997</span><span class="p">,</span> <span class="n">rmat21</span><span class="o">=-</span><span class="mf">0.924</span><span class="p">;</span>
</pre></div>
</div>
</section>
<section id="element">
<span id="id8"></span><h3>element<a class="headerlink" href="#element" title="Link to this heading"></a></h3>
<p><cite>element</cite> defines an arbitrary beam line element that’s defined by externally provided geometry.
It includes the possibility of overlaying a field as well. Several geometry formats are supported
but GDML is the recommended and tested format.</p>
<p>The user must supply the length of the geometry accurately to ensure a tight fit in the beamline.
BDSIM will leave a gap of this length, then place the geometry at the centre of that location. If
the geometry is suspected to be too long, a warning will be printed but the model still created
and visualisable.</p>
<p>The outermost volume of the loaded geometry is simply placed in the beam line. There is no placement
offset other than the <code class="code docutils literal notranslate"><span class="pre">offsetX</span></code>, <code class="code docutils literal notranslate"><span class="pre">offsetY</span></code> and <code class="code docutils literal notranslate"><span class="pre">tilt</span></code> of that element in the beam line.
Therefore, the user must prepare geometry with the placement of the contents in the outermost volume
as required.</p>
<p>An alternative strategy is to use the <a class="reference internal" href="#gap">gap</a> beam line element and make a placement at the appropriate
point in global coordinates. Again, the user should take care to avoid overlaps and check
for them purposively.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p><strong>Parameter</strong></p></th>
<th class="head"><p><strong>Description</strong></p></th>
<th class="head"><p><strong>Default</strong></p></th>
<th class="head"><p><strong>Required</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><cite>geometryFile</cite></p></td>
<td><p>Filename of geometry</p></td>
<td><p>NA</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-odd"><td><p><cite>l</cite></p></td>
<td><p>Length - chord length in case of
a finite angle [m]</p></td>
<td><p>NA</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-even"><td><p><cite>fieldAll</cite></p></td>
<td><p>Name of field object to use</p></td>
<td><p>NA</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-odd"><td><p><cite>angle</cite></p></td>
<td><p>Angle the component bends the
beam line. A positive value
results in a deflection in
negative <cite>x</cite>.</p></td>
<td><p>0</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-even"><td><p><cite>tilt</cite></p></td>
<td><p>Tilt of the whole component.</p></td>
<td><p>0</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-odd"><td><p><cite>namedVacuumVolumes</cite></p></td>
<td><p>String with space separated list
of <strong>logical</strong> volume names in
the geometry file that should be
considered ‘vacuum’ for biasing
purposes</p></td>
<td><p>“”</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-even"><td><p><cite>autoColour</cite></p></td>
<td><p>1 or 0. Whether the geometry
should be automatically coloured
according to density.</p></td>
<td><p>1</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-odd"><td><p><cite>markAsCollimator</cite></p></td>
<td><p>Label this element as a
collimator so it appears in the
collimator histograms and hits.</p></td>
<td><p>0</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-even"><td><p><cite>stripOuterVolume</cite></p></td>
<td><p>1 or 0. Whether to strip the
outermost volume from the loaded
geometry and make it an assembly</p></td>
<td><p>0</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-odd"><td><p><cite>horizontalWidth</cite></p></td>
<td><p>Diameter of component [m] Only
required for SQL geometry</p></td>
<td><p>NA</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-even"><td><p><cite>e1</cite></p></td>
<td><p>Assumed incoming face angle of
the provided geometry [rad]</p></td>
<td><p>0</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-odd"><td><p><cite>e2</cite></p></td>
<td><p>Assumed outgoing face angle of
the provided geometry [rad]</p></td>
<td><p>0</p></td>
<td><p>No</p></td>
</tr>
</tbody>
</table>
<ul class="simple">
<li><p><cite>geometryFile</cite> should be of the format <cite>format:filename</cite>, where <cite>format</cite> is the geometry
format being used (<cite>gdml</cite> | <cite>gmad</cite> | <cite>mokka</cite>) and filename is the path to the geometry
file. See <a class="reference internal" href="model_customisation.html#externally-provided-geometry"><span class="std std-ref">Externally Provided Geometry</span></a> for more details.</p></li>
<li><p><cite>fieldAll</cite> should refer to the name of a field object the user has defined in the input
gmad file. The syntax for this is described in <a class="reference internal" href="model_customisation.html#field-maps"><span class="std std-ref">Fields</span></a>.</p></li>
<li><p>The field map will also be tilted with the component if it is tilted.</p></li>
<li><p>The angle has the same sign convention as sbends and rbends in that a positive angle
corresponds to a deflection in negative x in a right-handed coordinate system with the
<cite>element</cite> built along positive <cite>z</cite>.</p></li>
<li><p><cite>e1</cite> and <cite>e2</cite> follow the convention of the sbend and rbend components and therefore
depend on the sign of the angle of the <cite>element</cite>. See <a class="reference internal" href="#component-rbend"><span class="std std-ref">rbend</span></a>. These
angles are used to make the preceding and proceeding drifts (if they are drifts) match
the angled face of the geometry so there are no overlaps or gaps. This only works for
drifts on either side of the <cite>element</cite>.</p></li>
<li><p>If marked as a collimator, the element will also appear in the collimator histograms
and also have a collimator-specific branch made for it in the Event tree of the output
as per the other collimators. The type in the output will be “element-collimator”.</p></li>
<li><p>The outer volume can be stripped away and the geometry is made into an assembly volume
in Geant4 and placed in the world. Use the parameter <code class="code docutils literal notranslate"><span class="pre">stripOuterVolume=1</span></code> for this.</p></li>
<li><p><cite>elementLengthIsArcLength</cite> is also available as a Boolean parameter. If set true (<code class="code docutils literal notranslate"><span class="pre">=1</span></code>),
then the <cite>l</cite> will be interpreted as the arc length. Caution - it is most likely that the
container volume of the piece of geometry loaded is truly straight with angled faces and
should therefore be given as the chord length - the default interpretation.</p></li>
</ul>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>If you strip the outer volume, any field supplied will be applied to all
daughter volumes, but note that the (now from the world) air that may
appear as part of that element will not have field. No field is attached
to the world volume. Therefore, if using say a magnet geometry with yoke,
the user should take care to acknowledge where there is and is not field.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The length must be larger than the geometry so that it is contained within it and
no overlapping geometry will be produced. However, care must be taken, as the length
will be the length of the component inserted in the beamline.  If this is much larger
than the size required for the geometry, the beam may be mismatched into the rest of
the accelerator. A common practice is to add a nanometer to the length of the geometry.</p>
</div>
<p>Simple example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">detector</span><span class="p">:</span> <span class="n">element</span><span class="p">,</span> <span class="n">geometryFile</span><span class="o">=</span><span class="s2">&quot;gdml:atlasreduced.gdml&quot;</span><span class="p">,</span> <span class="n">l</span><span class="o">=</span><span class="mi">44</span><span class="o">*</span><span class="n">m</span><span class="p">;</span>
</pre></div>
</div>
<p>Example with field:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">detectorfield</span><span class="p">:</span> <span class="n">field</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;bmap2d&quot;</span><span class="p">,</span>
                      <span class="n">bScaling</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
                      <span class="n">magneticFile</span> <span class="o">=</span> <span class="s2">&quot;bdsim2d:/Path/To/File.dat&quot;</span><span class="p">;</span>

<span class="n">detec</span><span class="p">:</span> <span class="n">element</span><span class="p">,</span> <span class="n">geometryFile</span><span class="o">=</span><span class="s2">&quot;gdml:twoboxes.gdml&quot;</span><span class="p">,</span>
                <span class="n">fieldAll</span><span class="o">=</span><span class="s2">&quot;detectorfield&quot;</span><span class="p">,</span>
                <span class="n">l</span><span class="o">=</span><span class="mi">5</span><span class="o">*</span><span class="n">m</span><span class="p">,</span>
                <span class="n">horizontalWidth</span><span class="o">=</span><span class="mf">0.76</span><span class="o">*</span><span class="n">m</span><span class="p">;</span>
</pre></div>
</div>
<p>Here, in the field definition, cubic interpolation (2D to match the field type) by default and
the integrator (for the particle motion) will be the default “g4classicalrk4” (4th order Runge Kutta).</p>
<p>Or:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">specialbend</span><span class="p">:</span> <span class="n">element</span><span class="p">,</span> <span class="n">geometryFile</span><span class="o">=</span><span class="s2">&quot;gdml:MBR_dipole.gdml&quot;</span><span class="p">,</span>
                      <span class="n">fieldAll</span><span class="o">=</span><span class="s2">&quot;f1&quot;</span><span class="p">,</span>
                      <span class="n">angle</span><span class="o">=</span><span class="n">pi</span><span class="o">/</span><span class="mi">10</span><span class="p">,</span>
                      <span class="n">e1</span><span class="o">=-</span><span class="n">pi</span><span class="o">/</span><span class="mi">20</span><span class="p">,</span>
                      <span class="n">e2</span><span class="o">=-</span><span class="n">pi</span><span class="o">/</span><span class="mi">20</span><span class="p">,</span>
                      <span class="n">l</span><span class="o">=</span><span class="mf">4.5</span><span class="o">*</span><span class="n">m</span><span class="p">;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For GDML geometry, we preprocess the input file prepending all names with the name
of the element. This is to compensate for the fact that the Geant4 GDML loader does
not handle unique file names. However, in the case of very large files with  many
vertices, the preprocessing can dominate. In this case, the option <cite>preprocessGDML</cite>
should be turned off. The loading will only work with one file in this case.</p>
</div>
</section>
<section id="marker">
<h3>marker<a class="headerlink" href="#marker" title="Link to this heading"></a></h3>
<p><cite>marker</cite> defines a point in the lattice. This element has no physical length and is only
used as a reference. For example, a <cite>sampler</cite> (see <a class="reference internal" href="model_control.html#sampler-output"><span class="std std-ref">Output at a Surface - Samplers</span></a>)
is used to record particle passage at the
front of a component, but how would you record particles exiting a particular component?
The intended method is to use a <cite>marker</cite> and place it in the sequence after that element,
then attach a sampler to the marker.</p>
<p>Examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">m1</span><span class="p">:</span> <span class="n">marker</span><span class="p">;</span>
</pre></div>
</div>
</section>
<section id="ct">
<h3>ct<a class="headerlink" href="#ct" title="Link to this heading"></a></h3>
<figure class="align-center">
<a class="reference internal image-reference" href="_images/ct.png"><img alt="_images/ct.png" src="_images/ct.png" style="width: 30%;" /></a>
</figure>
<p><cite>ct</cite> defines a Computed Tomographic (CT) image, saved in the international standard DICOM format. The DICOM module of
BDSIM enables the conversion of CT images into Geant4 voxelized geometries. This conversion results in a regular mesh of
voxels. In order to correctly allow the materials and densities to each individual voxel, a HUs-to-density (HUs stands
for Hounsfield Units) table and a HUs-to-materials table must be provided. The data of this two tables must be provided
into a single, two columns <cite>data.dat</cite> file. The required format for this file is illustrated below:</p>
<figure class="align-center">
<a class="reference internal image-reference" href="_images/CTconversionFile.png"><img alt="_images/CTconversionFile.png" src="_images/CTconversionFile.png" style="width: 40%;" /></a>
</figure>
<p>The first line gives the level of compression of the image. For example <code class="code docutils literal notranslate"><span class="pre">:COMPRESSION</span> <span class="pre">4</span></code> means that only one slice
over four will be converted into the final voxelized geometry. The lines which start with <code class="code docutils literal notranslate"><span class="pre">:MATE</span></code> give data
points for the HUs-to-materials curve, while the lines which start with <code class="code docutils literal notranslate"><span class="pre">:CT2D</span></code> give data points for the
HUs-to-density curve. For each curve, a linear interpolation is done based on the data points to find the most
appropriate density and material for each voxel. The user must give the path to this file in the definition of the <cite>ct</cite>
element, as the parameter <cite>dicomDataFile</cite>. The user must also give the name of the dicom (.dcm) file to be converted.
This must be done with the flag <code class="code docutils literal notranslate"><span class="pre">:FILE</span></code>, followed by the name of the file, which needs to be in the same folder
as the interpolation data file. The last flag <code class="code docutils literal notranslate"><span class="pre">:FILE_OUT</span></code> is optional, and can be used to give a specific name to
the temporary output file which is generated during the conversion CT image.</p>
<p>An example of such a data file is provided in <cite>bdsim/examples/features/dicom/data.dat</cite> and can be used as a
starting point.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For a correct visualization of the DICOM image, a path to a colourMap.dat file must also be given,
as the parameter <cite>dicomDataPath</cite>. This file will allow the mapping of each material to a specific color in the
viewer. Its first line should bethe number of materials used in the simulation. Each material given in the
<cite>data.dat</cite> file should then have a colour scheme which the user defines via four numbers with the syntax
<code class="code docutils literal notranslate"><span class="pre">:1MAT</span> <span class="pre">X</span> <span class="pre">Y</span> <span class="pre">Z</span> <span class="pre">A</span></code> where X, Y, Z and A are numbers between 0 and 1 respectively setting the amount of red, green,
blue and opacity of the colour defined for the material MAT. An example of such a colourMap.dat file is provided in
<cite>bdsim/examples/features/dicom/colourMap.dat</cite>.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To be able to load CT images, BDSIM must be compiled with the <cite>USE_DICOM</cite> variable set to ON. Moreover, the
conversion of the images requires the installation of the <cite>DCMTK</cite> package. This package is needed to easily extract
the HUs data from the images. Information to download and install DCMTK can be found
here: <a class="reference external" href="https://dicom.offis.de/dcmtk.php.en">https://dicom.offis.de/dcmtk.php.en</a>.</p>
</div>
<p>Examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">DICOM</span><span class="p">:</span> <span class="n">ct</span><span class="p">,</span> <span class="n">l</span><span class="o">=</span><span class="mi">1</span><span class="o">*</span><span class="n">m</span><span class="p">,</span> <span class="n">dicomDataPath</span><span class="o">=</span><span class="s2">&quot;./&quot;</span><span class="p">,</span> <span class="n">dicomDataFile</span><span class="o">=</span><span class="s2">&quot;data.dat&quot;</span><span class="p">;</span>
</pre></div>
</div>
<table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p><strong>Parameter</strong></p></td>
<td><p><strong>Description</strong></p></td>
</tr>
<tr class="row-even"><td><p><cite>l</cite></p></td>
<td><p>Length of the CT element along the beamline.</p></td>
</tr>
<tr class="row-odd"><td><p><cite>dicomDataFile</cite></p></td>
<td><p>Name of the file which contains the conversion material-to-density
and material-to-HU tables.</p></td>
</tr>
<tr class="row-even"><td><p><cite>dicomDataPath</cite></p></td>
<td><p>Path to the colourMap.dat file. During the conversion of the CT
image, the temporary .g4dcm file will also be stored in this path.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="muoncooler">
<h3>muoncooler<a class="headerlink" href="#muoncooler" title="Link to this heading"></a></h3>
<figure class="align-center">
<a class="reference internal image-reference" href="_images/muoncooler.png"><img alt="_images/muoncooler.png" src="_images/muoncooler.png" style="width: 70%;" /></a>
</figure>
<p><cite>muoncooler</cite> defines a <strong>complete</strong> 6D muon cooling lattice. Upon instantiation, a logical volume
with the specified horizontal width and length is generated, providing space for the
placement of the main 6D ionisation cooling beamline elements: solenoids, dipoles, RF cavities, and absorbers.
The element ensures that fringe effects from all magnets are accounted for and
allowing for accurate summation of the electric and magnetic field contributions across the entire
lattice.</p>
<p>In the current 6D cooling implementation, the cooling channel can include:</p>
<ul class="simple">
<li><p><strong>Solenoids (coils)</strong></p></li>
<li><p><strong>Dipoles (field only, no physical magnet)</strong></p></li>
<li><p><strong>RF cavities</strong></p></li>
<li><p><strong>Absorbers</strong></p></li>
</ul>
<p>Parameters for these components can be specified as either:</p>
<ul class="simple">
<li><p>A <strong>single value</strong>, applying uniformly across all instances of that component</p></li>
<li><p>A <strong>list of values</strong>, where each value corresponds to the respective component’s position in the cooling channel</p></li>
</ul>
<p><strong>Electric and Magnetic Field Models</strong></p>
<ul class="simple">
<li><p>The <strong>solenoid field model</strong> can be either a <strong>sheet model</strong> (<cite>solenoidsheet</cite>) or a <strong>block model</strong> (<cite>solenoidblock</cite>).</p></li>
<li><p>For dipoles, two models exist currently: <cite>dipole</cite> and <cite>dipoleenge</cite>. The <cite>dipole</cite> model is a simple hard-edge dipole field, while the <cite>dipoleenge</cite> model includes Enge-type fringe fields and follows the treatment outlined in: Muratori, B.D. et al (2015) ‘Analytical expressions for fringe fields in multipole magnets’, <em>Physical Review Special Topics - Accelerators and Beams</em>, 18(6). <a class="reference external" href="https://doi.org/10.1103/physrevstab.18.064001">https://doi.org/10.1103/physrevstab.18.064001</a></p></li>
<li><p>For the RF cavities, a simple RF pillbox (<cite>rfpillbox</cite>) model has been implemented.</p></li>
</ul>
<p><strong>Table of Parameters</strong></p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p><strong>Parameter</strong></p></th>
<th class="head"><p><strong>Description</strong></p></th>
<th class="head"><p><strong>Type</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><cite>nCoils</cite></p></td>
<td><p>Number of solenoid coils in
the cooling channel</p></td>
<td><p>Integer</p></td>
</tr>
<tr class="row-odd"><td><p><cite>coilInnerRadius</cite></p></td>
<td><p>Inner radii of coils [m]</p></td>
<td><p>List[Float]</p></td>
</tr>
<tr class="row-even"><td><p><cite>coilRadialThickness</cite></p></td>
<td><p>Radial thicknesses of coils
[m]</p></td>
<td><p>List[Float]</p></td>
</tr>
<tr class="row-odd"><td><p><cite>coilLengthZ</cite></p></td>
<td><p>Lengths of coils along Z [m]</p></td>
<td><p>List[Float]</p></td>
</tr>
<tr class="row-even"><td><p><cite>coilOffsetZ</cite></p></td>
<td><p>Z-positions of coil centers
[m]</p></td>
<td><p>List[Float]</p></td>
</tr>
<tr class="row-odd"><td><p><cite>coilCurrent</cite></p></td>
<td><p>Currents in [A] (sheet model)
or densities
[A/m^2] (block model)</p></td>
<td><p>List[Float]</p></td>
</tr>
<tr class="row-even"><td><p><cite>coilMaterial</cite></p></td>
<td><p>Materials of coils</p></td>
<td><p>List[String]</p></td>
</tr>
<tr class="row-odd"><td><p><cite>onAxisTolerance</cite></p></td>
<td><p>on-axis Tolerance for
CEL integral calculation [T]</p></td>
<td><p>Float</p></td>
</tr>
<tr class="row-even"><td><p><cite>nDipoles</cite></p></td>
<td><p>Number of dipoles</p></td>
<td><p>Integer</p></td>
</tr>
<tr class="row-odd"><td><p><cite>dipoleAperture</cite></p></td>
<td><p>Aperture radii of dipoles [m]</p></td>
<td><p>List[Float]</p></td>
</tr>
<tr class="row-even"><td><p><cite>dipoleLengthZ</cite></p></td>
<td><p>Lengths of dipoles along Z [m]</p></td>
<td><p>List[Float]</p></td>
</tr>
<tr class="row-odd"><td><p><cite>dipoleFieldStrength</cite></p></td>
<td><p>Peak magnetic field strengths
of dipoles [T]</p></td>
<td><p>List[Float]</p></td>
</tr>
<tr class="row-even"><td><p><cite>dipoleEngeCoefficient</cite></p></td>
<td><p>C1 Enge coefficients of
dipoles</p></td>
<td><p>List[Float]</p></td>
</tr>
<tr class="row-odd"><td><p><cite>dipoleOffsetZ</cite></p></td>
<td><p>Z-positions of dipoles [m]</p></td>
<td><p>List[Float]</p></td>
</tr>
<tr class="row-even"><td><p><cite>nAbsorbers</cite></p></td>
<td><p>Number of absorbers</p></td>
<td><p>Integer</p></td>
</tr>
<tr class="row-odd"><td><p><cite>absorberType</cite></p></td>
<td><p>Types of absorbers
(“cylinder” or “wedge”)</p></td>
<td><p>List[String]</p></td>
</tr>
<tr class="row-even"><td><p><cite>absorberMaterial</cite></p></td>
<td><p>Materials of absorbers</p></td>
<td><p>List[String]</p></td>
</tr>
<tr class="row-odd"><td><p><cite>absorberOffsetZ</cite></p></td>
<td><p>Z-positions of absorbers [m]</p></td>
<td><p>List[Float]</p></td>
</tr>
<tr class="row-even"><td><p><cite>absorberCylinderLength</cite></p></td>
<td><p>Lengths of cylindrical
absorbers [m]</p></td>
<td><p>List[Float]</p></td>
</tr>
<tr class="row-odd"><td><p><cite>absorberCylinderRadius</cite></p></td>
<td><p>Radii of cylindrical
absorbers [m]</p></td>
<td><p>List[Float]</p></td>
</tr>
<tr class="row-even"><td><p><cite>absorberWedgeOpeningAngle</cite></p></td>
<td><p>Opening angles of wedge
absorbers [rad]</p></td>
<td><p>List[Float]</p></td>
</tr>
<tr class="row-odd"><td><p><cite>absorberWedgeHeight</cite></p></td>
<td><p>Heights of wedge
absorbers [m]</p></td>
<td><p>List[Float]</p></td>
</tr>
<tr class="row-even"><td><p><cite>absorberWedgeRotationAngle</cite></p></td>
<td><p>Rotation angles of
wedge absorbers [rad]</p></td>
<td><p>List[Float]</p></td>
</tr>
<tr class="row-odd"><td><p><cite>absorberWedgeOffsetX</cite></p></td>
<td><p>X-offsets of wedge
absorbers [m]</p></td>
<td><p>List[Float]</p></td>
</tr>
<tr class="row-even"><td><p><cite>absorberWedgeOffsetY</cite></p></td>
<td><p>Y-offsets of wedge
absorbers [m]</p></td>
<td><p>List[Float]</p></td>
</tr>
<tr class="row-odd"><td><p><cite>absorberWedgeApexToBase</cite></p></td>
<td><p>Apex-to-base lengths
of wedge absorbers [m]</p></td>
<td><p>List[Float]</p></td>
</tr>
<tr class="row-even"><td><p><cite>nRFCavities</cite></p></td>
<td><p>Number of RF cavities</p></td>
<td><p>Integer</p></td>
</tr>
<tr class="row-odd"><td><p><cite>rfOffsetZ</cite></p></td>
<td><p>Z-positions of RF cavities
[m]</p></td>
<td><p>List[Float]</p></td>
</tr>
<tr class="row-even"><td><p><cite>rfTimeOffset</cite></p></td>
<td><p>Time offsets for RF cavities
[ns]</p></td>
<td><p>List[Float]</p></td>
</tr>
<tr class="row-odd"><td><p><cite>rfLength</cite></p></td>
<td><p>Inner lengths of RF cavities
[m]</p></td>
<td><p>List[Float]</p></td>
</tr>
<tr class="row-even"><td><p><cite>rfVoltage</cite></p></td>
<td><p>Peak E-Field of RF cavities
[MV/m]</p></td>
<td><p>List[Float]</p></td>
</tr>
<tr class="row-odd"><td><p><cite>rfPhase</cite></p></td>
<td><p>Phases of RF cavities
[rad]</p></td>
<td><p>List[Float]</p></td>
</tr>
<tr class="row-even"><td><p><cite>rfFrequency</cite></p></td>
<td><p>Frequencies of RF cavities
[Hz]</p></td>
<td><p>List[Float]</p></td>
</tr>
<tr class="row-odd"><td><p><cite>rfWindowThickness</cite></p></td>
<td><p>Thickness of the RF window
[m]</p></td>
<td><p>List[Float]</p></td>
</tr>
<tr class="row-even"><td><p><cite>rfWindowMaterial</cite></p></td>
<td><p>RF Window Material</p></td>
<td><p>List[String]</p></td>
</tr>
<tr class="row-odd"><td><p><cite>rfWindowRadius</cite></p></td>
<td><p>Radii of RF cavities
[m]</p></td>
<td><p>List[Float]</p></td>
</tr>
<tr class="row-even"><td><p><cite>rfCavityMaterial</cite></p></td>
<td><p>RF cavity materials</p></td>
<td><p>List[String]</p></td>
</tr>
<tr class="row-odd"><td><p><cite>rfCavityVacuumMaterial</cite></p></td>
<td><p>RF cavity vacuum material</p></td>
<td><p>List[String]</p></td>
</tr>
<tr class="row-even"><td><p><cite>rfCavityThickness</cite></p></td>
<td><p>Thickness of RF cavities
[m]</p></td>
<td><p>List[Float]</p></td>
</tr>
<tr class="row-odd"><td><p><cite>magneticFieldModel</cite></p></td>
<td><p>Model for solenoid field</p></td>
<td><p>String</p></td>
</tr>
<tr class="row-even"><td><p><cite>dipoleFieldModel</cite></p></td>
<td><p>Model for dipole field</p></td>
<td><p>String</p></td>
</tr>
<tr class="row-odd"><td><p><cite>electricFieldModel</cite></p></td>
<td><p>Model for RF electric field</p></td>
<td><p>String</p></td>
</tr>
<tr class="row-even"><td><p><cite>l</cite></p></td>
<td><p>Length of the cooling channel
[m]</p></td>
<td><p>Float</p></td>
</tr>
<tr class="row-odd"><td><p><cite>horizontalWidth</cite></p></td>
<td><p>Width of the cooling channel
[m]</p></td>
<td><p>Float</p></td>
</tr>
</tbody>
</table>
<p>An example of a cooling channel has been provided in <cite>/examples/components/muoncooler.gmad</cite>, and can be used as a template for development.</p>
</section>
</section>
<section id="offsets-tilts-component-misalignment">
<span id="offsets-and-tilts"></span><h2>Offsets &amp; Tilts - Component Misalignment<a class="headerlink" href="#offsets-tilts-component-misalignment" title="Link to this heading"></a></h2>
<p>To simulate a real accelerator it may be necessary to introduce measured placement offsets or misalignments
and rotations. Every component can be displaced transversely and rotated along the axis of the beam propagation.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Components that have a finite angle (rbend and sbend) will only respond to tilt and not vertical or
horizontal offsets. This is because these would change the length of the bend about its central axis.
This is not currently handled but may be implemented in future releases.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>A tilt on a component with a finite angle causes the axis the angle is induced in (typically the y-
axis) to be rotated without rotating the reference frame of the beam, i.e. a dipole with a <span class="math notranslate nohighlight">\(\pi/2\)</span>
tilt will become a vertical bend without flipping x and y in the sampler or subsequent components. This
matches the behaviour of MAD8 and MAD-X.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>A right-handed coordinate system is used and the beamline is built along the <cite>z</cite> direction.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Tilts and offsets are independent of one another, that is to
say, a tilt of <span class="math notranslate nohighlight">\(\pi/2\)</span> combined with a non-zero
offsetX will not result in a vertical displacement.</p>
</div>
<p>The misalignments can be controlled through the following parameters.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Parameter</p></th>
<th class="head"><p>Default value</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><cite>offsetX</cite></p></td>
<td><p>Horizontal displacement of the component [m]</p></td>
</tr>
<tr class="row-odd"><td><p><cite>offsetY</cite></p></td>
<td><p>Vertical displacement of the component [m]</p></td>
</tr>
<tr class="row-even"><td><p><cite>tilt</cite></p></td>
<td><p>Clockwise rotation of the component, facing in the direction of the beamline
<cite>z</cite> [rad]. In the case of an rbend or sbend, this rotates the axis about which the
beam bends.</p></td>
</tr>
</tbody>
</table>
<p>Examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">d1</span><span class="p">:</span> <span class="n">drift</span><span class="p">,</span> <span class="n">l</span><span class="o">=</span><span class="mi">1</span><span class="o">*</span><span class="n">m</span><span class="p">,</span> <span class="n">offsetX</span><span class="o">=</span><span class="mi">1</span><span class="o">*</span><span class="n">cm</span><span class="p">;</span>
<span class="n">d2</span><span class="p">:</span> <span class="n">drift</span><span class="p">,</span> <span class="n">l</span><span class="o">=</span><span class="mf">0.5</span><span class="o">*</span><span class="n">m</span><span class="p">,</span> <span class="n">offsetY</span> <span class="o">=</span> <span class="mf">0.3</span><span class="o">*</span><span class="n">cm</span><span class="p">,</span> <span class="n">tilt</span><span class="o">=</span><span class="mf">0.003</span><span class="p">;</span>
</pre></div>
</div>
</section>
<section id="lattice-sequence">
<span id="id9"></span><h2>Lattice Sequence<a class="headerlink" href="#lattice-sequence" title="Link to this heading"></a></h2>
<p>Once all the necessary components have been defined, they must be placed in a sequence to make
a lattice. Elements can be repeated. A sequence of elements is defined by
a <a class="reference internal" href="#line">line</a>. Lines of lines can be made to describe the accelerator sequence programmatically, i.e.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">d1</span><span class="p">:</span> <span class="n">drift</span><span class="p">,</span> <span class="n">l</span><span class="o">=</span><span class="mi">3</span><span class="o">*</span><span class="n">m</span><span class="p">;</span>
<span class="n">q1</span><span class="p">:</span> <span class="n">quadrupole</span><span class="p">,</span> <span class="n">l</span><span class="o">=</span><span class="mf">0.1</span><span class="o">*</span><span class="n">m</span><span class="p">,</span> <span class="n">k1</span><span class="o">=</span><span class="mf">0.684</span><span class="p">;</span>
<span class="n">q2</span><span class="p">:</span> <span class="n">quadrupole</span><span class="p">,</span> <span class="n">l</span><span class="o">=</span><span class="mf">0.1</span><span class="o">*</span><span class="n">m</span><span class="p">,</span> <span class="n">k1</span><span class="o">=-</span><span class="mf">0.684</span><span class="p">;</span>
<span class="n">fodo</span><span class="p">:</span> <span class="n">line</span> <span class="o">=</span> <span class="p">(</span><span class="n">q1</span><span class="p">,</span><span class="n">d1</span><span class="p">,</span><span class="n">q2</span><span class="p">,</span><span class="n">d1</span><span class="p">);</span>
<span class="n">transportline</span><span class="p">:</span> <span class="n">line</span><span class="p">(</span><span class="n">fodo</span><span class="p">,</span> <span class="n">fodo</span><span class="p">,</span> <span class="n">fodo</span><span class="p">,</span> <span class="n">fodo</span><span class="p">);</span>
</pre></div>
</div>
<section id="line">
<h3>Line<a class="headerlink" href="#line" title="Link to this heading"></a></h3>
<p><cite>line</cite> defines a sequence of elements.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">name</span><span class="p">:</span> <span class="n">line</span><span class="o">=</span><span class="p">(</span><span class="n">element1</span><span class="p">,</span> <span class="n">element2</span><span class="p">,</span> <span class="n">element3</span><span class="p">,</span> <span class="o">...</span> <span class="p">);</span>
</pre></div>
</div>
<p>Here, <cite>element</cite> can be any element or line. Lines can also be reversed using</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">line_name</span> <span class="p">:</span> <span class="n">line</span><span class="o">=-</span><span class="p">(</span><span class="n">line_2</span><span class="p">)</span>
</pre></div>
</div>
<p>or within another line by:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">line</span><span class="o">=</span><span class="p">(</span><span class="n">line_1</span><span class="p">,</span><span class="o">-</span><span class="n">line_2</span><span class="p">)</span>
</pre></div>
</div>
<p>Reversing a line also reverses all nested lines within.</p>
</section>
<section id="use-defining-which-line-to-use">
<span id="the-use-command"></span><h3>use - Defining which Line to Use<a class="headerlink" href="#use-defining-which-line-to-use" title="Link to this heading"></a></h3>
<p>Once all elements and at least one <cite>line</cite> is defined, the main sequence of the
beam line can be defined. This is defined using the following syntax:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">use</span><span class="p">,</span> <span class="n">period</span><span class="o">=&lt;</span><span class="n">line_name</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">d1</span><span class="p">:</span> <span class="n">drift</span><span class="p">,</span> <span class="n">l</span><span class="o">=</span><span class="mf">3.2</span><span class="o">*</span><span class="n">m</span><span class="p">;</span>
<span class="n">q1</span><span class="p">:</span> <span class="n">quadrupole</span><span class="p">,</span> <span class="n">l</span><span class="o">=</span><span class="mi">20</span><span class="o">*</span><span class="n">cm</span><span class="p">,</span> <span class="n">k1</span><span class="o">=</span><span class="mf">4.5</span><span class="p">;</span>
<span class="n">q2</span><span class="p">:</span> <span class="n">quadrupole</span><span class="p">,</span> <span class="n">l</span><span class="o">=</span><span class="mi">20</span><span class="o">*</span><span class="n">cm</span><span class="p">,</span> <span class="n">k1</span><span class="o">=-</span><span class="mf">4.5</span><span class="p">;</span>
<span class="n">fodo</span><span class="p">:</span> <span class="n">line</span><span class="o">=</span><span class="p">(</span><span class="n">d1</span><span class="p">,</span><span class="n">q1</span><span class="p">,</span><span class="n">d1</span><span class="p">,</span><span class="n">q2</span><span class="p">,</span><span class="n">d1</span><span class="p">);</span>
<span class="n">use</span><span class="p">,</span> <span class="n">period</span><span class="o">=</span><span class="n">fodo</span><span class="p">;</span>
</pre></div>
</div>
<p>The beam line is placed in the world volume (the outermost coordinate system) starting
at position (0,0,0) with direction (0,0,1) - i.e. pointing in positive <cite>z</cite>. The user
may specify an initial offset and rotation for the beam line with respect to the world
volume using the options described in <a class="reference internal" href="model_control.html#beamline-offset"><span class="std std-ref">Offset for Main Beam Line</span></a>.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>When the <code class="code docutils literal notranslate"><span class="pre">use</span></code> command is called, the elements are copied internally,
so their definition is fixed. Any element parameter adjustments or redefinitions
after the <code class="code docutils literal notranslate"><span class="pre">use</span></code> command will therefore not be observed.</p>
</div>
<p>Multiple beam lines may also be visualised - but only visualised (not suitable for
simulations currently).  Details are provided in <a class="reference internal" href="#multiple-beamlines"><span class="std std-ref">Multiple Beam Lines</span></a>.</p>
</section>
</section>
<section id="multiple-beam-lines">
<span id="multiple-beamlines"></span><h2>Multiple Beam Lines<a class="headerlink" href="#multiple-beam-lines" title="Link to this heading"></a></h2>
<p>BDSIM has the ability to use multiple beam lines.  This feature is still in development and
is currently only for visualisation purposes. Secondary beam lines are placed either with
respect to the world coordinate system or with respect to a particular element in the main
beam line. A few caveats:</p>
<ul class="simple">
<li><p>Only for visualisation purposes</p></li>
<li><p>Beam lines cannot be placed with respect to an element in another secondary beam line.</p></li>
<li><p>Secondary beam lines are not suitable for tracking.</p></li>
<li><p>Secondary beam lines are not sensitive to energy deposition, nor do they produce output.</p></li>
<li><p>The user is entirely responsible for overlapping geometry. The visualiser will render
the geometry, but of course it will not be suitable for simulations, as overlaps lead
to volume navigation problems and incorrect tracking.</p></li>
</ul>
<p>The user may use any sequence defined in the parser before the <cite>use</cite> command. The secondary
beam line is produced by declaring a placement. The placement definition (see
<a class="reference internal" href="model_customisation.html#placements"><span class="std std-ref">Placements</span></a>) is augmented with the following parameters:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p><strong>Parameter</strong></p></th>
<th class="head"><p><strong>Description</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>sequence</p></td>
<td><p>Name of the sequence (with <cite>line</cite>) to use for the secondary
beam line</p></td>
</tr>
<tr class="row-odd"><td><p>referenceElement</p></td>
<td><p>The element in the sequence with respect to which the beam
line will be placed</p></td>
</tr>
<tr class="row-even"><td><p>referenceElementNumber</p></td>
<td><p>The <em>i</em> th instance of the element in the sequence (zero
counting) ( i.e. 2 -&gt; the 3rd instance of <cite>referenceElement</cite>
in the <cite>sequence</cite>).</p></td>
</tr>
</tbody>
</table>
<section id="examples">
<h3>Examples<a class="headerlink" href="#examples" title="Link to this heading"></a></h3>
<p>This example is shown in bdsim/examples/features/geometry/10_multiple_beamlines.  It defines
a simple beam line and two other sequences that are placed alongside it. Further explanation
is given below the example.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">d1</span><span class="p">:</span> <span class="n">drift</span><span class="p">,</span> <span class="n">l</span><span class="o">=</span><span class="mi">1</span><span class="o">*</span><span class="n">m</span><span class="p">;</span>
<span class="n">d2</span><span class="p">:</span> <span class="n">drift</span><span class="p">,</span> <span class="n">l</span><span class="o">=</span><span class="mi">3</span><span class="o">*</span><span class="n">m</span><span class="p">;</span>
<span class="n">d3</span><span class="p">:</span> <span class="n">drift</span><span class="p">,</span> <span class="n">l</span><span class="o">=</span><span class="mi">5</span><span class="o">*</span><span class="n">m</span><span class="p">;</span>
<span class="n">sb1</span><span class="p">:</span> <span class="n">sbend</span><span class="p">,</span> <span class="n">l</span><span class="o">=</span><span class="mi">1</span><span class="o">*</span><span class="n">m</span><span class="p">,</span> <span class="n">angle</span><span class="o">=</span><span class="mf">0.5</span><span class="p">;</span>
<span class="n">sb2</span><span class="p">:</span> <span class="n">sbend</span><span class="p">,</span> <span class="n">l</span><span class="o">=</span><span class="mi">1</span><span class="o">*</span><span class="n">m</span><span class="p">,</span> <span class="n">angle</span><span class="o">=-</span><span class="mf">0.5</span><span class="p">;</span>
<span class="n">q1</span><span class="p">:</span> <span class="n">quadrupole</span><span class="p">,</span> <span class="n">l</span><span class="o">=</span><span class="mf">0.2</span><span class="o">*</span><span class="n">m</span><span class="p">,</span> <span class="n">k1</span><span class="o">=</span><span class="mf">4.166666</span><span class="p">;</span>
<span class="n">q2</span><span class="p">:</span> <span class="n">quadrupole</span><span class="p">,</span> <span class="n">l</span><span class="o">=</span><span class="mf">0.2</span><span class="o">*</span><span class="n">m</span><span class="p">,</span> <span class="n">k1</span><span class="o">=-</span><span class="mf">4.166666</span><span class="p">;</span>

<span class="n">fodo</span><span class="p">:</span> <span class="n">line</span><span class="o">=</span><span class="p">(</span><span class="n">d1</span><span class="p">,</span><span class="n">q1</span><span class="p">,</span><span class="n">d1</span><span class="p">,</span><span class="n">q2</span><span class="p">);</span>
<span class="n">mainLine</span><span class="p">:</span> <span class="n">line</span><span class="o">=</span><span class="p">(</span><span class="n">d2</span><span class="p">,</span><span class="n">sb1</span><span class="p">,</span><span class="n">d2</span><span class="p">,</span><span class="n">sb2</span><span class="p">,</span><span class="n">d2</span><span class="p">,</span><span class="n">fodo</span><span class="p">,</span><span class="n">fodo</span><span class="p">);</span>

<span class="n">auxLine1</span><span class="p">:</span> <span class="n">line</span><span class="o">=</span><span class="p">(</span><span class="n">d3</span><span class="p">,</span><span class="n">sb1</span><span class="p">,</span><span class="n">d1</span><span class="p">,</span><span class="n">sb2</span><span class="p">,</span><span class="n">d1</span><span class="p">,</span><span class="n">fodo</span><span class="p">,</span><span class="n">d1</span><span class="p">);</span>
<span class="n">auxLine2</span><span class="p">:</span> <span class="n">line</span><span class="o">=</span><span class="p">(</span><span class="n">d1</span><span class="p">,</span><span class="n">sb1</span><span class="p">,</span><span class="n">d1</span><span class="p">,</span><span class="n">sb2</span><span class="p">,</span><span class="n">d1</span><span class="p">,</span><span class="n">fodo</span><span class="p">,</span><span class="n">d1</span><span class="p">);</span>
<span class="n">auxLine3</span><span class="p">:</span> <span class="n">line</span><span class="o">=</span><span class="p">(</span><span class="n">fodo</span><span class="p">);</span>

<span class="n">use</span><span class="p">,</span> <span class="n">mainLine</span><span class="p">;</span>

<span class="n">beam</span><span class="p">,</span> <span class="n">particle</span><span class="o">=</span><span class="s2">&quot;e-&quot;</span><span class="p">,</span>
      <span class="n">energy</span><span class="o">=</span><span class="mi">3</span><span class="o">*</span><span class="n">GeV</span><span class="p">;</span>

<span class="n">auxLine1Place</span><span class="p">:</span> <span class="n">placement</span><span class="p">,</span> <span class="n">sequence</span> <span class="o">=</span> <span class="s2">&quot;auxLine1&quot;</span><span class="p">,</span>
                          <span class="n">referenceElement</span> <span class="o">=</span> <span class="s2">&quot;d2&quot;</span> <span class="p">,</span>
                          <span class="n">referenceElementNumber</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
                          <span class="n">x</span> <span class="o">=</span> <span class="o">-</span><span class="mi">5</span><span class="o">*</span><span class="n">cm</span><span class="p">,</span>
                          <span class="n">z</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="o">*</span><span class="n">m</span><span class="p">,</span>
                          <span class="n">axisAngle</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
                          <span class="n">axisY</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
                          <span class="n">angle</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.2</span><span class="p">;</span>

<span class="n">auxLine2Place</span><span class="p">:</span> <span class="n">placement</span><span class="p">,</span> <span class="n">sequence</span> <span class="o">=</span> <span class="s2">&quot;auxLine2&quot;</span><span class="p">,</span>
                          <span class="n">referenceElement</span> <span class="o">=</span> <span class="s2">&quot;d2&quot;</span><span class="p">,</span>
                          <span class="n">referenceElementNumber</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
                          <span class="n">x</span> <span class="o">=</span> <span class="o">-</span><span class="mi">10</span><span class="o">*</span><span class="n">cm</span><span class="p">,</span>
                          <span class="n">z</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="o">*</span><span class="n">m</span><span class="p">,</span>
                          <span class="n">axisAngle</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
                          <span class="n">axisY</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
                          <span class="n">angle</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">;</span>

<span class="n">auxLine3Place</span><span class="p">:</span> <span class="n">placement</span><span class="p">,</span> <span class="n">sequence</span> <span class="o">=</span> <span class="s2">&quot;auxLine3&quot;</span><span class="p">,</span>
                          <span class="n">x</span> <span class="o">=</span> <span class="mi">1</span><span class="o">*</span><span class="n">m</span><span class="p">,</span>
                          <span class="n">axisAngle</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
                          <span class="n">axisY</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
                          <span class="n">angle</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">;</span>
</pre></div>
</div>
<p>Firstly, a series of simple elements are defined (drifts, quadrupoles and bends). A simple
sequence called <cite>fodo</cite> is defined and also the main beam line, called <cite>mainLine</cite>. After this,
extra sequences are defined that we will use for secondary beam lines.  The <cite>use</cite> command
selects which beam line the simulation will be based on.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">use</span><span class="p">,</span> <span class="n">mainLine</span><span class="p">;</span>
</pre></div>
</div>
<p>After this, the beam is defined (required for any simulation for rigidity calculations),
then the placement of secondary beam lines.</p>
<p>The first placement <cite>auxLine1Place</cite> is a placement that will place the sequence named
<cite>auxLine1</cite> with respect to the third instance of the element <cite>d2</cite> in the primary sequence
(<cite>mainLine</cite>).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">auxLine1Place</span><span class="p">:</span> <span class="n">placement</span><span class="p">,</span> <span class="n">sequence</span><span class="o">=</span><span class="s2">&quot;auxLine1&quot;</span><span class="p">,</span>
                          <span class="n">referenceElement</span><span class="o">=</span><span class="s2">&quot;d2&quot;</span> <span class="p">,</span>
                          <span class="n">referenceElementNumber</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
</pre></div>
</div>
<p>The placement is generally with respect to the centre of the element described in the primary
beam line and along the direction it’s pointing. Without any displacement, the geometry
would therefore overlap.  Here, an offset and rotation are specified for this particular placement.
An offset in <cite>x</cite> of -5 cm and -1 m in <cite>z</cite> is specified. The coordinate system is right-handed
with positive-z pointing along the direction of travel in the beam line. A negative-x
displacement is therefore to the right, looking along the direction of travel and 1 m in
<cite>z</cite> is towards the beginning of the element from the centre.  Rotations are described
in <a class="reference internal" href="model_customisation.html#placements"><span class="std std-ref">Placements</span></a>. Here, an axis angle rotation is used. The beam line is rotated about
the unit Y-axis (local to that element) by -0.2 rad.</p>
<p>The second placement uses a different sequence, but in a similar fashion.</p>
<p>The third placement doesn’t specify a <cite>referenceElement</cite>, so the placement is with respect
to the beginning of the beam line.</p>
<p>The model is shown below.</p>
<figure class="align-center">
<a class="reference internal image-reference" href="_images/multiple_beamlines.png"><img alt="_images/multiple_beamlines.png" src="_images/multiple_beamlines.png" style="width: 90%;" /></a>
</figure>
<p>The drift segments do not of course connect but are merely placed close to each other.
In future, continuous vacuum points will be provided.</p>
<figure class="align-center">
<a class="reference internal image-reference" href="_images/multiple_beamlines_junction.png"><img alt="_images/multiple_beamlines_junction.png" src="_images/multiple_beamlines_junction.png" style="width: 90%;" /></a>
</figure>
</section>
</section>
<section id="detectors">
<span id="id10"></span><h2>Detectors<a class="headerlink" href="#detectors" title="Link to this heading"></a></h2>
<p>BDSIM allows the definition of detectors in the simulation. These are objects to represent
real detectors or measure a quantity at some place in the model including the effect of the
mass of (and therefore interaction with) the detector. Currently, there is one type of detector
that is a beam loss monitor.</p>
<section id="beam-loss-monitors">
<span id="detectors-blms"></span><h3>Beam Loss Monitors<a class="headerlink" href="#beam-loss-monitors" title="Link to this heading"></a></h3>
<p>Beam loss monitors (BLMs) are simple detectors that give one integrated value per event. The
quantity to be generated can be chosen and the shape and location of the BLM can also be chosen.
Below are the available parameters. A BLM is created using the <cite>blm</cite> command.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">detectorname</span><span class="p">,</span> <span class="n">blm</span><span class="p">,</span> <span class="n">parameter</span><span class="o">=</span><span class="n">value</span><span class="o">...</span>
</pre></div>
</div>
<p>Either a simple geometric shape can be used, which is a single volume of one material, or a
user supplied geometry file can be used.</p>
<p>The quantity produced by the BLM per event is defined using a scorer (see <a class="reference internal" href="model_control.html#scorer"><span class="std std-ref">Scorer</span></a>) and
attached to the BLM with the <cite>scoreQuantity</cite> parameter. If this is not defined, it is simply
passive material.</p>
<p>The BLM signals are put in a 1D histogram for each scorer used with any BLM where each bin
is a BLM in order it appears in construction. If a certain scorer isn’t attached to a BLM, the
corresponding bin in that scorer histogram will always be 0. The best way to view the BLM signals
from a run is to use <cite>rebdsimHistoMerge</cite> as described in <a class="reference internal" href="output_analysis.html#output-analysis-quick-recipes"><span class="std std-ref">Quick Recipes</span></a>. See
also <a class="reference internal" href="#detectors-blm-output"><span class="std std-ref">BLM Output</span></a>.</p>
<p>The placement parameters are the same as the general placements (see <a class="reference internal" href="model_customisation.html#placements"><span class="std std-ref">Placements</span></a>). So the
BLM can be placed with respect to a beam line element or generally in curvilinear coordinates, or
in global Cartesian coordinates.</p>
<p>Bias objects may be attached to a BLM via the <code class="code docutils literal notranslate"><span class="pre">bias</span></code> attribute. This names a defined
bias object (see <a class="reference internal" href="model_control.html#physics-bias-cross-section-biasing"><span class="std std-ref">Cross-Section Biasing</span></a>). This is applied to all logical
volumes in the BLM.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If multiple BLMs use the same external geometry file, the biasing
will be applied to all of them as there is only one copy of the geometry in memory.</p>
</div>
<table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p><strong>Parameter</strong></p></td>
<td><p><strong>Description</strong></p></td>
</tr>
<tr class="row-even"><td><p>geometryType</p></td>
<td><p>Name of simple geometry to use (“cylinder”, “cube”, “sphere”)</p></td>
</tr>
<tr class="row-odd"><td><p>blmMaterial</p></td>
<td><p>Name of material to use for simple geometry</p></td>
</tr>
<tr class="row-even"><td><p>blm1</p></td>
<td><p>BLM shape parameter 1 - different depending on the shape used</p></td>
</tr>
<tr class="row-odd"><td><p>blm2</p></td>
<td><p>BLM shape parameter 2</p></td>
</tr>
<tr class="row-even"><td><p>blm3</p></td>
<td><p>BLM shape parameter 2</p></td>
</tr>
<tr class="row-odd"><td><p>blm4</p></td>
<td><p>BLM shape parameter 2</p></td>
</tr>
<tr class="row-even"><td><p>scoreQuantity</p></td>
<td><p>Name of a scorer object that should be used for record a quantity
in the BLM. See <a class="reference internal" href="model_control.html#scorer"><span class="std std-ref">Scorer</span></a>.</p></td>
</tr>
<tr class="row-odd"><td><p>x</p></td>
<td><p>Offset in global x</p></td>
</tr>
<tr class="row-even"><td><p>y</p></td>
<td><p>Offset in global y</p></td>
</tr>
<tr class="row-odd"><td><p>z</p></td>
<td><p>Offset in global z</p></td>
</tr>
<tr class="row-even"><td><p>s</p></td>
<td><p>Curvilinear s coordinate (global | local depending on parameters)</p></td>
</tr>
<tr class="row-odd"><td><p>phi</p></td>
<td><p>Euler angle phi for rotation</p></td>
</tr>
<tr class="row-even"><td><p>theta</p></td>
<td><p>Euler angle theta for rotation</p></td>
</tr>
<tr class="row-odd"><td><p>psi</p></td>
<td><p>Euler angle psi for rotation</p></td>
</tr>
<tr class="row-even"><td><p>axisX</p></td>
<td><p>Axis angle rotation x-component of unit vector</p></td>
</tr>
<tr class="row-odd"><td><p>axisY</p></td>
<td><p>Axis angle rotation y-component of unit vector</p></td>
</tr>
<tr class="row-even"><td><p>axisZ</p></td>
<td><p>Axis angle rotation z-component of unit vector</p></td>
</tr>
<tr class="row-odd"><td><p>angle</p></td>
<td><p>Axis angle, angle to rotate about unit vector</p></td>
</tr>
<tr class="row-even"><td><p>axisAngle</p></td>
<td><p>Boolean whether to use axis angle rotation scheme (default false)</p></td>
</tr>
<tr class="row-odd"><td><p>referenceElement</p></td>
<td><p>Name of element to place geometry with respect to (string)</p></td>
</tr>
<tr class="row-even"><td><p>referenceElementNumber</p></td>
<td><p>Occurrence of <cite>referenceElement</cite> to place with respect to if it
is used more than once in the sequence. Zero counting.</p></td>
</tr>
<tr class="row-odd"><td><p>geometryFile</p></td>
<td><p>Optional file to use for geometry of BLM including format</p></td>
</tr>
<tr class="row-even"><td><p>side</p></td>
<td><p>Optional which side of <cite>referenceElement</cite> the BLM is placed with
respect to. One of <code class="code docutils literal notranslate"><span class="pre">left</span></code>, <code class="code docutils literal notranslate"><span class="pre">right</span></code>, <code class="code docutils literal notranslate"><span class="pre">top</span></code> and
<code class="code docutils literal notranslate"><span class="pre">bottom</span></code>.</p></td>
</tr>
<tr class="row-odd"><td><p>sideOffset</p></td>
<td><p>Distance from the (square) extent of an object the BLM is placed.</p></td>
</tr>
<tr class="row-even"><td><p>bias</p></td>
<td><p>Name of bias object to apply to all volumes in the BLM.</p></td>
</tr>
</tbody>
</table>
<section id="blm-shapes">
<h4>BLM Shapes<a class="headerlink" href="#blm-shapes" title="Link to this heading"></a></h4>
<p>For each shape, the shape parameters (“blm1”, “blm2”, “blm3”, “blm4”) have different meanings. These
are described below. NA means non-applicable to this shape.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p><strong>Shape</strong></p></th>
<th class="head"><p><strong>blm1</strong></p></th>
<th class="head"><p><strong>blm2</strong></p></th>
<th class="head"><p><strong>blm3</strong></p></th>
<th class="head"><p><strong>blm4</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>cylinder</p></td>
<td><p>half length along axis</p></td>
<td><p>radius</p></td>
<td><p>NA</p></td>
<td><p>NA</p></td>
</tr>
<tr class="row-odd"><td><p>cube</p></td>
<td><p>half length in x</p></td>
<td><p>half length in y</p></td>
<td><p>half length in z</p></td>
<td><p>NA</p></td>
</tr>
<tr class="row-even"><td><p>sphere</p></td>
<td><p>radius</p></td>
<td><p>NA</p></td>
<td><p>NA</p></td>
<td><p>NA</p></td>
</tr>
</tbody>
</table>
</section>
<section id="blm-output">
<span id="detectors-blm-output"></span><h4>BLM Output<a class="headerlink" href="#blm-output" title="Link to this heading"></a></h4>
<p>BLM signals (integrals / scores per event per BLM) are stored in 1D histograms alongside other 1D
histograms such as the usual energy deposition histogram. There is 1 histogram per scorer used in any
BLM. All BLM histograms have the same number of bins which is the total number of BLMs in the model and
they are in the order they are constructed in the input. Here is an example that will clarify. This
example can be found in <code class="code docutils literal notranslate"><span class="pre">bdsim/examples/features/detectors/blms/blm-output-example.gmad</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">r1</span><span class="p">:</span> <span class="n">rcol</span><span class="p">,</span> <span class="n">l</span><span class="o">=</span><span class="mi">10</span><span class="o">*</span><span class="n">m</span><span class="p">,</span> <span class="n">horizontalWidth</span><span class="o">=</span><span class="mi">1</span><span class="o">*</span><span class="n">cm</span><span class="p">,</span> <span class="n">material</span><span class="o">=</span><span class="s2">&quot;Al&quot;</span><span class="p">;</span>
<span class="n">l1</span><span class="p">:</span> <span class="n">line</span><span class="o">=</span><span class="p">(</span><span class="n">r1</span><span class="p">);</span>
<span class="n">use</span><span class="p">,</span> <span class="n">l1</span><span class="p">;</span>

<span class="n">beam</span><span class="p">,</span> <span class="n">particle</span><span class="o">=</span><span class="s2">&quot;e-&quot;</span><span class="p">,</span>
      <span class="n">energy</span><span class="o">=</span><span class="mi">10</span><span class="o">*</span><span class="n">GeV</span><span class="p">;</span>

<span class="n">option</span><span class="p">,</span> <span class="n">physicsList</span><span class="o">=</span><span class="s2">&quot;em&quot;</span><span class="p">;</span>

<span class="n">chrg</span><span class="p">:</span> <span class="n">scorer</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;cellcharge&quot;</span><span class="p">;</span>
<span class="n">dose</span><span class="p">:</span> <span class="n">scorer</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;depositeddose&quot;</span><span class="p">;</span>
<span class="n">eDep</span><span class="p">:</span> <span class="n">scorer</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;depositedenergy&quot;</span><span class="p">;</span>

<span class="n">BLM_t1</span><span class="p">:</span> <span class="n">blm</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">10</span><span class="o">*</span><span class="n">cm</span><span class="p">,</span>
             <span class="n">side</span><span class="o">=</span><span class="s2">&quot;top&quot;</span><span class="p">,</span>
             <span class="n">geometryType</span><span class="o">=</span><span class="s2">&quot;cylinder&quot;</span><span class="p">,</span>
             <span class="n">blmMaterial</span><span class="o">=</span><span class="s2">&quot;Al&quot;</span><span class="p">,</span>
             <span class="n">blm1</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">cm</span><span class="p">,</span>
             <span class="n">blm2</span><span class="o">=</span><span class="mi">1</span><span class="o">*</span><span class="n">cm</span><span class="p">,</span>
             <span class="n">scoreQuantity</span><span class="o">=</span><span class="s2">&quot;eDep dose chrg&quot;</span><span class="p">;</span>

<span class="n">BLM_t2</span><span class="p">:</span> <span class="n">blm</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">5</span><span class="o">*</span><span class="n">cm</span><span class="p">,</span>
             <span class="n">side</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>
             <span class="n">geometryType</span><span class="o">=</span><span class="s2">&quot;cylinder&quot;</span><span class="p">,</span>
             <span class="n">blmMaterial</span><span class="o">=</span><span class="s2">&quot;Al&quot;</span><span class="p">,</span>
             <span class="n">blm1</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">cm</span><span class="p">,</span>
             <span class="n">blm2</span><span class="o">=</span><span class="mi">1</span><span class="o">*</span><span class="n">cm</span><span class="p">,</span>
             <span class="n">scoreQuantity</span><span class="o">=</span><span class="s2">&quot;dose eDep&quot;</span><span class="p">;</span>

<span class="n">BLM_t3</span><span class="p">:</span> <span class="n">blm</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">30</span><span class="o">*</span><span class="n">cm</span><span class="p">,</span>
             <span class="n">side</span><span class="o">=</span><span class="s2">&quot;top&quot;</span><span class="p">,</span>
             <span class="n">geometryType</span><span class="o">=</span><span class="s2">&quot;cylinder&quot;</span><span class="p">,</span>
             <span class="n">blmMaterial</span><span class="o">=</span><span class="s2">&quot;Al&quot;</span><span class="p">,</span>
             <span class="n">blm1</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">cm</span><span class="p">,</span>
             <span class="n">blm2</span><span class="o">=</span><span class="mi">1</span><span class="o">*</span><span class="n">cm</span><span class="p">,</span>
             <span class="n">scoreQuantity</span><span class="o">=</span><span class="s2">&quot;chrg dose&quot;</span><span class="p">;</span>
</pre></div>
</div>
<p>This model creates a scene with 1x 10m long block of aluminium (a closed rcol) and a beam of 10 GeV
electrons fired into it. 3 different scorers are used (“chrg”, “dose” and “eDep”). However, only 1 BLM
(“BLM_t1”) uses all 3.</p>
<p>The output will contain 3 histograms (1 for each scorer used with a BLM) containing 3 bins (1 for each BLM).
The histograms will be called “BLM_chrg”, “BLM_dose” and “BLM_eDep”. The second bin of the BLM_chrg histogram
(bin index #1) will always be 0 as the 2nd BLM (in order of construction) “BLM_t2” does not use the “chrg”
scorer. This is done so that a given BLM is always in the same bin in all BLM histograms.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The 2nd bin in each output histogram (bin index #1) will be for “BLM_t2” as it is the second
to be constructed, even though it is placed geometrically before “BLM_t1” with respect to the
beam line (s = 5cm vs s = 10cm).</p>
</div>
<p>The model was run with 10 events and the output summarised using <cite>rebdsimHistoMerge</cite>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">bdsim</span> <span class="o">--</span><span class="n">file</span><span class="o">=</span><span class="n">blm</span><span class="o">-</span><span class="n">output</span><span class="o">-</span><span class="n">example</span><span class="o">.</span><span class="n">gmad</span> <span class="o">--</span><span class="n">outfile</span><span class="o">=</span><span class="n">t1</span> <span class="o">--</span><span class="n">batch</span> <span class="o">--</span><span class="n">ngenerate</span><span class="o">=</span><span class="mi">10</span>
<span class="n">rebdsimHistoMerge</span> <span class="n">t1</span><span class="o">.</span><span class="n">root</span> <span class="n">t1</span><span class="o">-</span><span class="n">histos</span><span class="o">.</span><span class="n">root</span>
<span class="n">root</span> <span class="o">-</span><span class="n">l</span> <span class="n">t1</span><span class="o">-</span><span class="n">histos</span><span class="o">.</span><span class="n">root</span>
<span class="o">&gt;</span> <span class="n">TBrowser</span> <span class="n">tb</span><span class="p">;</span>
</pre></div>
</div>
<figure class="align-center" id="id15">
<a class="reference internal image-reference" href="_images/blm-histos1.png"><img alt="_images/blm-histos1.png" src="_images/blm-histos1.png" style="width: 90%;" /></a>
<figcaption>
<p><span class="caption-text">Preview of “eDep” scorer histogram for all BLMs from above example. 3rd bin is empty
as the 3rd BLM doesn’t use this scorer.</span><a class="headerlink" href="#id15" title="Link to this image"></a></p>
</figcaption>
</figure>
<figure class="align-center" id="id16">
<a class="reference internal image-reference" href="_images/blm-histos2.png"><img alt="_images/blm-histos2.png" src="_images/blm-histos2.png" style="width: 90%;" /></a>
<figcaption>
<p><span class="caption-text">Preview of “dose” scorer histogram for all BLMs from above example. All bins are filled
as all BLMs use this scorer.</span><a class="headerlink" href="#id16" title="Link to this image"></a></p>
</figcaption>
</figure>
</section>
<section id="id11">
<h4>Examples<a class="headerlink" href="#id11" title="Link to this heading"></a></h4>
<ol class="arabic">
<li><p>A simple sphere made of nitrogen. It’s placed at 2.3 metres along the beam line with a transverse offset
(in curvilinear coordinates) of 40 cm horizontally and 25 cm vertically. The sphere radius is 20 cm.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">minidetector</span><span class="p">:</span> <span class="n">blm</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mf">2.3</span><span class="o">*</span><span class="n">m</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mf">0.4</span><span class="o">*</span><span class="n">m</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">0.25</span><span class="o">*</span><span class="n">m</span><span class="p">,</span>
              <span class="n">geometryType</span><span class="o">=</span><span class="s2">&quot;sphere&quot;</span><span class="p">,</span>
              <span class="n">blmMaterial</span><span class="o">=</span><span class="s2">&quot;N&quot;</span><span class="p">,</span>
              <span class="n">blm1</span><span class="o">=</span><span class="mi">20</span><span class="o">*</span><span class="n">cm</span><span class="p">;</span>
</pre></div>
</div>
</li>
<li><p>A simple cylinder made of silicon. It’s placed globally with an offset in x of 3.2 m and y of 25 cm.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">minidetector</span><span class="p">:</span> <span class="n">blm</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mf">3.2</span><span class="o">*</span><span class="n">m</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">0.25</span><span class="o">*</span><span class="n">m</span><span class="p">,</span>
              <span class="n">geometryType</span><span class="o">=</span><span class="s2">&quot;cylinder&quot;</span><span class="p">,</span>
              <span class="n">blmMaterial</span><span class="o">=</span><span class="s2">&quot;Si&quot;</span><span class="p">,</span>
              <span class="n">blm1</span><span class="o">=</span><span class="mi">20</span><span class="o">*</span><span class="n">cm</span><span class="p">,</span>
              <span class="n">blm2</span><span class="o">=</span><span class="mi">5</span><span class="o">*</span><span class="n">cm</span><span class="p">;</span>
</pre></div>
</div>
</li>
<li><p>User defined geometry in a GDML file.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">blmdose</span><span class="p">:</span> <span class="n">scorer</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;depositedenery&quot;</span><span class="p">;</span>
<span class="n">minidetector</span><span class="p">:</span> <span class="n">blm</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mf">0.4</span><span class="o">*</span><span class="n">m</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">0.25</span><span class="o">*</span><span class="n">m</span><span class="p">,</span>
              <span class="n">geometryFile</span><span class="o">=</span><span class="s2">&quot;gdml:simpleshape.gdml&quot;</span><span class="p">,</span>
              <span class="n">blmMaterial</span><span class="o">=</span><span class="s2">&quot;N&quot;</span><span class="p">,</span>
              <span class="n">blm1</span><span class="o">=</span><span class="mi">20</span><span class="o">*</span><span class="n">cm</span><span class="p">,</span>
              <span class="n">blm2</span><span class="o">=</span><span class="mi">5</span><span class="o">*</span><span class="n">cm</span><span class="p">,</span>
              <span class="n">scorerQuantity</span><span class="o">=</span><span class="s2">&quot;blmdose&quot;</span><span class="p">;</span>
</pre></div>
</div>
</li>
</ol>
</section>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="input_syntax.html" class="btn btn-neutral float-left" title="Input Syntax" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="model_control.html" class="btn btn-neutral float-right" title="Model Control" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright Beam Delivery Simulation (BDSIM) Copyright (c) Royal Holloway, University of London, 2001 - 2025.
      <span class="lastupdated">Last updated on Jun 13, 2025.
      </span></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
    <!-- Theme Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-JYMKZHVZJ2"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-JYMKZHVZJ2', {
          'anonymize_ip': false,
      });
    </script> 

</body>
</html>